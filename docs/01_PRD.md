# Bodii - Product Requirements Document (PRD)

## 1. 제품 개요

### 1.1 제품명
**Bodii** (Body + AI)

### 1.2 제품 비전
"내 몸 관리 에이전트" - 사용자의 체성분, 식단, 운동을 통합 관리하여 건강한 몸을 만들어가는 개인 건강 관리 iOS 앱

### 1.3 핵심 가치
- **몸은 거짓말 안 해**: 데이터 기반의 정확한 추적
- **관리가 정답**: 꾸준한 기록과 분석으로 목표 달성
- **내 몸은 나의 것**: 개인 맞춤형 건강 관리

### 1.4 타겟 사용자
- 체중/체성분 관리에 관심 있는 사람
- 식단과 운동을 체계적으로 기록하고 싶은 사람
- 건강 목표를 세우고 달성 과정을 시각화하고 싶은 사람

---

## 2. 개발 단계

### Phase 1: MVP (기본 추적 시스템)
> 핵심 기능만으로 앱의 가치를 검증

- 체성분 입력/관리 (키, 몸무게, 체지방률 등)
- 체성분 변화 그래프 추적
- 기초대사량/활동대사량 자동 계산 및 저장
- 음식 수동 입력 + 칼로리/매크로 기록
- AI 식단 코멘트 (Gemini API)
- 운동 입력 → 활동 칼로리 계산
- 일일 섭취/소모 칼로리 대시보드
- 수면 시간 기록 및 추적
- Apple HealthKit 연동

### Phase 2: AI 기능 추가
> AI 기반 편의 기능 + 목표 관리

- 사진 인식으로 음식 자동 인식 (사용자 수정 가능)
- 목표 설정 (감량/증량/유지)
- 목표 기반 예상 그래프
- 히스토리 누적 → 그래프 자동 업데이트

### Phase 3: 소셜 기능
> 서버 도입 + 커뮤니티

- 회원가입/로그인
- 친구 추가 및 관리
- 커뮤니티 피드
- 랭킹/챌린지

---

## 3. 기술 스택

### 3.1 선정 결과

| 구분 | 기술 | 버전 |
|------|------|------|
| UI Framework | SwiftUI | iOS 17+ |
| Local Database | Core Data | - |
| Cloud Sync (2차) | CloudKit | - |
| Backend (3차) | TBD (Spring Boot 또는 Firebase) | - |

### 3.2 SwiftUI 선정 이유

| 기준 | SwiftUI | Flutter | React Native |
|------|---------|---------|--------------|
| **HealthKit 연동** | ✅ 네이티브 지원 | ⚠️ 브릿지 필요 | ⚠️ 브릿지 필요 |
| **카메라/사진** | ✅ 네이티브 최적화 | ⚠️ 플러그인 의존 | ⚠️ 플러그인 의존 |
| **Apple 생태계** | ✅ 완전 호환 | ❌ 제한적 | ❌ 제한적 |
| **iOS 전용 앱** | ✅ 최적 | ⚠️ 과한 선택 | ⚠️ 과한 선택 |
| **성능** | ✅ 네이티브 | ⚠️ 약간 무거움 | ⚠️ 브릿지 오버헤드 |

**결정적 요인:** 
- HealthKit은 Apple 전용 API로, 네이티브가 아니면 서드파티 브릿지에 의존
- Apple 업데이트마다 호환성 이슈 발생 가능성 존재
- iOS 전용 앱에 크로스플랫폼 프레임워크는 불필요한 복잡성 추가

### 3.3 Core Data 선정 이유

| 기준 | Core Data | SQLite 직접 | Realm |
|------|-----------|-------------|-------|
| **Apple 공식** | ✅ | ❌ | ❌ |
| **iCloud 동기화** | ✅ 내장 | ❌ 직접 구현 | ⚠️ 유료 |
| **SwiftUI 통합** | ✅ @FetchRequest | ❌ 수동 | ⚠️ 별도 설정 |
| **러닝커브** | 중간 | 낮음 | 낮음 |
| **3차 서버 확장** | ✅ REST 연동 용이 | ✅ | ✅ |

**결정적 요인:**
- 2차에서 iCloud 동기화 고려 시 Core Data + CloudKit 조합이 가장 자연스러움
- Apple 생태계 안에서 추가 비용 없이 기기 간 동기화 가능
- SwiftUI의 @FetchRequest와 자연스럽게 통합

---

## 4. 외부 API

### 4.1 음식 영양정보 (1차~)

**검색 우선순위:**
```
사용자 검색
    ↓
1순위: 식약처 DB (한국 음식)
    ↓ 없으면
2순위: USDA API (외국 음식)
    ↓ 없으면
3순위: 사용자 직접 입력
```

| API | 용도 | 비용 |
|-----|------|------|
| 식약처 식품영양성분DB | 한국 음식 칼로리/영양정보 | 무료 |
| USDA FoodData Central | 외국 음식 (피자, 파스타, 버거 등) | 무료 |

- 식약처: 공공데이터포털 Open API, 농축수산물/가공식품/음식 포함
- USDA: 미국 농무부 제공, 100만+ 식품 데이터

### 4.2 AI 식단 코멘트 (1차~)

| API | 용도 | 비용 |
|-----|------|------|
| Google Gemini | 식단 분석 및 코멘트 생성 | 월 무료 (15 RPM) |

- 끼니별 음식 입력 시 AI 코멘트 생성
- 좋은 점, 개선점, 총평 + 식단 점수 (0~10)
- 한국어 자연스러움

### 4.3 음식 이미지 인식 (2차)

| API | 용도 | 비용 |
|-----|------|------|
| Google Cloud Vision | 음식 사진 → 라벨 추출 | 월 1,000건 무료 |

- Label Detection으로 음식 종류 인식
- 인식 결과를 식약처 DB → USDA API 순서로 검색하여 영양정보 매칭

---

## 5. 데이터 저장 전략

### 5.1 핵심 원칙

```
📌 "계산은 변경 시점에 한 번, 조회는 저장된 값으로 빠르게"
```

- 값이 변경될 때만 계산하고 저장
- 조회 시에는 저장된 값 그대로 사용
- 연쇄 업데이트로 관련 데이터 일관성 유지

### 5.2 저장 위치 요약

| 데이터 | 저장 위치 | 업데이트 시점 |
|--------|-----------|---------------|
| 현재 BMR/TDEE | User.currentBMR/TDEE | 체성분/활동수준/키 변경 시 |
| 현재 체중/체지방률 | User.current* | 체성분 입력 시 |
| 체성분별 대사량 이력 | MetabolismSnapshot | 체성분 입력 시 (1:1 생성) |
| 일일 BMR/TDEE | DailyLog.bmr/tdee | DailyLog 생성 시 (User에서 복사) |
| 일일 섭취/소모 | DailyLog.total* | 음식/운동 입력/삭제 시 증분 |
| 일일 매크로 비율 | DailyLog.*Ratio | 음식 입력/삭제 시 재계산 |
| 일일 체성분 | DailyLog.weight/bodyFatPct | 체성분 입력 시 (당일만) |
| 일일 수면 | DailyLog.sleep* | 수면 입력 시 |

### 5.3 Phase별 저장 구조

**Phase 1~2: 로컬 저장**

```
사용자 기기
┌─────────────────┐
│     Bodii       │
│  ─────────────  │
│   Core Data     │
│  (로컬 SQLite)  │
└─────────────────┘
```

- 각 사용자 기기에 독립적인 DB
- 앱 삭제 시 데이터 삭제
- 서버 비용 없음

**Phase 2 (선택): iCloud 동기화**

```
사용자 iPhone          사용자 iPad
┌─────────────┐       ┌─────────────┐
│  Core Data  │ ←───→ │  Core Data  │
└─────────────┘       └─────────────┘
        ↑                   ↑
        └───────┬───────────┘
                ↓
         ┌───────────┐
         │  iCloud   │
         │ (CloudKit)│
         └───────────┘
```

**Phase 3: 서버 도입**

```
┌─────────────┐      ┌─────────────┐
│  Core Data  │      │   Server    │
│   (개인)    │ ←──→ │  (소셜)     │
└─────────────┘      └─────────────┘
```

- 개인 데이터: 로컬 유지 (오프라인 사용 가능)
- 소셜 데이터: 서버 저장 (친구, 커뮤니티, 랭킹)

---

## 6. 성공 지표

### Phase 1 (MVP)
- [ ] 앱스토어 출시 완료
- [ ] 일일 체성분/식단/운동/수면 기록 가능
- [ ] 그래프로 변화 추이 확인 가능
- [ ] 대시보드에서 오늘 현황 빠르게 조회 (0.5초 이내)

### Phase 2
- [ ] 사진 촬영 → 음식 인식 성공률 70% 이상
- [ ] 목표 대비 진행률 그래프 제공

### Phase 3
- [ ] 친구 추가 및 피드 공유 기능
- [ ] MAU (월간 활성 사용자) 측정 시작

---

## 7. 제약 사항

### 기술적 제약
- iOS 17 이상 지원 (SwiftUI 최신 기능 활용)
- iPhone 전용 (iPad 추후 고려)

### 비용 제약
- 1~2차: 무료 API만 사용
- 3차: 서버 비용 발생 (Firebase 또는 클라우드)

### 일정
- 1차 MVP: 5주 (병렬 작업 시)
- 2차 AI: MVP 출시 후 피드백 반영하여 결정
- 3차 소셜: 사용자 확보 후 진행

---

## 8. 문서 목록

| 문서 | 파일명 | 설명 |
|------|--------|------|
| PRD | 01_PRD.md | 본 문서 |
| 기능 명세서 | 02_FEATURE_SPEC.md | 상세 기능 정의 + 저장 전략 |
| 사용자 흐름도 | 03_USER_FLOW.md | 화면 흐름 및 인터랙션 |
| ERD | 04_ERD.md | 데이터베이스 설계 + 저장 전략 |
| 태스크 | 05_TASKS.md | TaskMaster 태스크 목록 |
| 알고리즘 | 06_ALGORITHM.md | BMR/TDEE/MET 계산 공식 |
| 개발 가이드 | 06_DEVELOPMENT_GUIDE.md | 아키텍처 및 코딩 컨벤션 |
| 포트폴리오 | 07_PORTFOLIO_STUDY.md | 학습 포인트 및 포트폴리오 가이드 |
| 엣지 케이스 | 08_EDGE_CASES.md | 예외 상황 처리 정책 |
| 에러 핸들링 | 09_ERROR_HANDLING.md | 에러 처리 정책 |
| 테스트 시나리오 | 10_TEST_SCENARIOS.md | 테스트 케이스 및 시나리오 |

---

*문서 버전: 2.0*
*작성일: 2026-01-11*
*수정: 데이터 저장 전략 섹션 추가, 일정 업데이트*
