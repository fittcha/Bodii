# Bodii - 사용자 흐름도

## 1. 앱 전체 네비게이션 구조

```
┌─────────────────────────────────────────────────────────────┐
│                         Bodii                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐     │
│ │   홈   │ │  식단  │ │  운동  │ │  수면  │ │  설정  │     │
│ │(대시보드)│ │        │ │        │ │        │ │        │     │
│ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘     │
│      ↓          ↓          ↓          ↓          ↓          │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐     │
│ │일일요약│ │식단기록│ │운동기록│ │수면기록│ │ 프로필 │     │
│ │ 체성분 │ │검색/입력│ │HealthKit│ │히스토리│ │목표설정│     │
│ │ 그래프 │ │히스토리│ │히스토리│ │ 그래프 │ │ 앱설정 │     │
│ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 온보딩 플로우

```
┌─────────────┐
│   앱 시작   │
└──────┬──────┘
       ↓
┌─────────────┐     아니오     ┌─────────────┐
│ 첫 실행인가? │ ───────────→ │   홈 화면   │
└──────┬──────┘               └─────────────┘
       │ 예
       ↓
┌─────────────┐
│  온보딩 1   │
│ 앱 소개     │
└──────┬──────┘
       ↓
┌─────────────┐
│  온보딩 2   │
│ 기본정보입력│
│ - 이름      │
│ - 성별      │
│ - 생년월일  │
└──────┬──────┘
       ↓
┌─────────────┐
│  온보딩 3   │
│ 체성분 입력 │
│ - 키        │
│ - 몸무게    │
│ - 체지방률  │
└──────┬──────┘
       ↓
┌─────────────┐
│  온보딩 4   │
│ 활동수준    │
│ 선택        │
└──────┬──────┘
       ↓
┌─────────────┐
│  온보딩 5   │
│ HealthKit   │
│ 권한 요청   │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. User 생성                            │
│ 2. BMR/TDEE 계산                        │
│ 3. User.current* 저장                   │
│ 4. BodyRecord 생성                      │
│ 5. MetabolismSnapshot 생성              │
│ 6. 온보딩 완료 플래그 저장              │
└──────┬──────────────────────────────────┘
       ↓
┌─────────────┐
│  온보딩 완료 │
│  홈 화면    │
└─────────────┘
```

---

## 3. 홈(대시보드) 화면 플로우

```
┌─────────────────────────────────────────┐
│              홈 대시보드                 │
│     (User + DailyLog 조회, 계산 없음)    │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────┐     │
│  │      오늘의 칼로리 현황         │     │
│  │  ┌─────────────────────────┐   │     │
│  │  │    1,450 / 2,100 kcal   │   │     │
│  │  │    ○○○○○○○●●●          │   │     │
│  │  │    남은 칼로리: 650      │   │     │
│  │  │   (DailyLog.netCalories) │   │     │
│  │  └─────────────────────────┘   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │      매크로 현황                │     │
│  │  탄수화물  ████████░░  150g    │     │
│  │  단백질    ██████░░░░  80g     │     │
│  │  지방      ████░░░░░░  45g     │     │
│  │  (DailyLog.*Ratio 사용)        │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │      오늘의 운동                │     │ ──→ 운동 탭
│  │  🏃 러닝 30분 (280 kcal)       │     │
│  │  (DailyLog.exerciseMinutes)    │     │
│  │  + 운동 추가                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │      수면                       │     │ ──→ 수면 탭
│  │  🔵 7시간 30분 (Excellent)     │     │
│  │  (DailyLog.sleepStatus)        │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │      체성분                     │     │ ──→ 체성분 상세
│  │  현재 체중: 72.5kg (-0.5)      │     │
│  │  체지방률: 18.2%               │     │
│  │  (User.currentWeight/BodyFatPct)│     │
│  │  [그래프 미리보기]             │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
```

---

## 4. 체성분 관리 플로우

```
┌─────────────┐
│ 체성분 화면 │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│                                          │
│  ┌────────────────────────────────┐     │
│  │     체성분 그래프               │     │
│  │  [1주|1개월|3개월|6개월|1년]   │     │
│  │  (MetabolismSnapshot 데이터)    │     │
│  │                                 │     │
│  │     74 ─┐                       │     │
│  │     73 ─┤    ╭──╮               │     │
│  │     72 ─┤───╯    ╰──●          │     │
│  │     71 ─┴─────────────         │     │
│  │         1/1  1/5  1/10         │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  + 체성분 기록하기              │     │ ──┐
│  └────────────────────────────────┘     │   │
│                                          │   │
│  ┌────────────────────────────────┐     │   │
│  │     히스토리                    │     │   │
│  │  ┌──────────────────────────┐  │     │   │
│  │  │ 2026.01.11               │  │     │   │
│  │  │ 72.5kg | 18.2% | 32.1kg  │  │     │   │
│  │  └──────────────────────────┘  │     │   │
│  │  ┌──────────────────────────┐  │     │   │
│  │  │ 2026.01.08               │  │     │   │
│  │  │ 73.0kg | 18.5% | 31.8kg  │  │     │   │
│  │  └──────────────────────────┘  │     │   │
│  └────────────────────────────────┘     │   │
│                                          │   │
└─────────────────────────────────────────┘   │
                                               │
       ┌───────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│          체성분 입력 (모달)              │
├─────────────────────────────────────────┤
│                                          │
│  측정일      [2026.01.11 14:30 ▼]       │
│             (기본값: 현재 일시)          │
│                                          │
│  몸무게 *    [72.5          ] kg        │
│                                          │
│  체지방량    [13.2          ] kg        │
│                     ↕ 자동 계산          │
│  체지방률    [18.2          ] %         │
│                                          │
│  골격근량    [32.1          ] kg        │
│                                          │
│  ┌────────────────────────────────┐     │
│  │            저장                 │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. BodyRecord 저장                      │
│ 2. BMR/TDEE 계산                        │
│ 3. User.current* 업데이트               │
│ 4. MetabolismSnapshot 생성              │
│ 5. DailyLog 업데이트 (당일인 경우)      │
└─────────────────────────────────────────┘
```

---

## 5. 식단 기록 플로우

```
┌─────────────┐
│  식단 화면  │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│            2026.01.11 (토)              │
│  ◀                              ▶       │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────┐     │
│  │  아침  (450 kcal)              │     │
│  │  ├─ 현미밥 1공기 (300)         │     │
│  │  └─ 계란프라이 2개 (150)       │     │
│  │  + 음식 추가                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  점심  (0 kcal)                │     │
│  │  + 음식 추가                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  저녁  (0 kcal)                │     │
│  │  + 음식 추가                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  간식  (0 kcal)                │     │
│  │  + 음식 추가                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ────────────────────────────────────   │
│  총 섭취: 450 kcal                      │
│  (DailyLog.totalCaloriesIn)             │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  매크로 비율         탄 61%    │     │
│  │      ┌───┐           단 23%    │     │
│  │     /탄 \ 지         지 16%    │     │
│  │    │단   │                     │     │
│  │     \___/   (DailyLog.*Ratio)  │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
```

---

## 6. 음식 추가 → 저장 플로우

```
┌─────────────────────────────────────────┐
│           음식 추가 화면                 │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────┐     │
│  │  🔍 음식 검색...                │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  📷 사진으로 인식 (Phase 2)    │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  ✏️ 직접 입력                   │     │
│  └────────────────────────────────┘     │
│                                          │
│  ────────────────────────────────────   │
│  최근 먹은 음식                          │
│  ┌──────────────────────────────┐       │
│  │ 현미밥         300 kcal      │       │
│  └──────────────────────────────┘       │
│                                          │
└─────────────────────────────────────────┘
       ↓ (검색 실행)
┌─────────────────────────────────────────┐
│           검색 결과                      │
│  (1순위: 식약처 → 2순위: USDA)          │
├─────────────────────────────────────────┤
│  ┌──────────────────────────────┐       │
│  │ 김치찌개 (돼지고기)           │       │
│  │ 1인분(300g) | 180 kcal       │       │
│  └──────────────────────────────┘       │
│  ┌──────────────────────────────┐       │
│  │ 참치김치찌개                  │       │
│  │ 1인분(300g) | 165 kcal       │       │
│  └──────────────────────────────┘       │
└─────────────────────────────────────────┘
       ↓ (음식 선택)
┌─────────────────────────────────────────┐
│           음식 상세                      │
├─────────────────────────────────────────┤
│                                          │
│  김치찌개 (돼지고기)                     │
│                                          │
│  ────────────────────────────────────   │
│  영양정보 (1인분 300g 기준)              │
│                                          │
│  칼로리      180 kcal                   │
│  탄수화물    12g                        │
│  단백질      15g                        │
│  지방        8g                         │
│                                          │
│  ────────────────────────────────────   │
│  섭취량      [  1  ] 인분               │
│  끼니 선택   ○아침 ●점심 ○저녁 ○간식   │
│                                          │
│  ┌────────────────────────────────┐     │
│  │           추가하기              │     │
│  └────────────────────────────────┘     │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. FoodRecord 저장                      │
│ 2. DailyLog.totalCaloriesIn += 180      │
│ 3. DailyLog.totalCarbs += 12            │
│ 4. DailyLog.totalProtein += 15          │
│ 5. DailyLog.totalFat += 8               │
│ 6. DailyLog.*Ratio 재계산               │
│ 7. DailyLog.netCalories 재계산          │
└──────┬──────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│  ✓ 점심에 김치찌개가 추가되었습니다     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  🤖 AI 코멘트 보기              │     │
│  └────────────────────────────────┘     │
└─────────────────────────────────────────┘
```

---

## 7. 운동 기록 플로우

```
┌─────────────┐
│  운동 화면  │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│            2026.01.11 (토)              │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────┐     │
│  │     오늘의 활동                 │     │
│  │                                 │     │
│  │  🔥 소모 칼로리: 420 kcal      │     │
│  │     (DailyLog.totalCaloriesOut) │     │
│  │  👣 걸음 수: 8,542             │     │
│  │     (DailyLog.steps)            │     │
│  │  ⏱️ 운동 시간: 75분            │     │
│  │     (DailyLog.exerciseMinutes)  │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  + 운동 기록하기                │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │     오늘의 운동                 │     │
│  │  ┌──────────────────────────┐  │     │
│  │  │ 🏃 러닝                   │  │     │
│  │  │ 30분 | 중강도 | 280 kcal │  │     │
│  │  └──────────────────────────┘  │     │
│  │  ┌──────────────────────────┐  │     │
│  │  │ 🏋️ 웨이트                 │  │     │
│  │  │ 45분 | 고강도 | 140 kcal │  │     │
│  │  └──────────────────────────┘  │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
       ↓ (운동 추가 클릭)
┌─────────────────────────────────────────┐
│          운동 입력 (모달)                │
├─────────────────────────────────────────┤
│                                          │
│  운동 종류 선택                          │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐   │
│  │ 걷기 │ │ 러닝 │ │ 자전거│ │ 수영 │   │
│  └──────┘ └──────┘ └──────┘ └──────┘   │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐   │
│  │웨이트│ │크로스│ │ 요가 │ │ 기타 │   │
│  │      │ │ 핏   │ │      │ │      │   │
│  └──────┘ └──────┘ └──────┘ └──────┘   │
│                                          │
│  ────────────────────────────────────   │
│                                          │
│  운동 시간    [    45    ] 분           │
│                                          │
│  강도         ○ 저  ● 중  ○ 고         │
│                                          │
│  ────────────────────────────────────   │
│  예상 소모 칼로리: 280 kcal             │
│  (MET × User.currentWeight × 시간)      │
│                                          │
│  ┌────────────────────────────────┐     │
│  │            저장                 │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. ExerciseRecord 저장                  │
│ 2. DailyLog.totalCaloriesOut += 280     │
│ 3. DailyLog.exerciseMinutes += 45       │
│ 4. DailyLog.exerciseCount += 1          │
└─────────────────────────────────────────┘
```

---

## 8. 수면 기록 플로우

```
┌─────────────┐
│   앱 실행    │
│(새벽2시 이후)│
└──────┬──────┘
       ↓
┌─────────────┐     아니오     ┌─────────────┐
│ 오늘 첫 실행?│ ───────────→ │   홈 화면   │
│ (02:00 기준) │               └─────────────┘
└──────┬──────┘
       │ 예
       ↓
┌─────────────┐     3회 초과    ┌─────────────┐
│ 스킵 3회 미만?│ ───────────→ │   홈 화면   │
└──────┬──────┘               │ (수면탭 유도)│
       │ 예                    └─────────────┘
       ↓
┌─────────────────────────────────────────┐
│         수면 시간 입력 팝업              │
├─────────────────────────────────────────┤
│                                          │
│           어젯밤 수면 시간은?            │
│                                          │
│    ┌─────────────────────────┐          │
│    │       ┌─────┐  ┌─────┐  │          │
│    │       │  6  │  │  50 │  │          │
│    │       │ [▲] │  │ [▲] │  │          │
│    │       │  7  │  │  00 │  │          │
│    │       │ [▼] │  │ [▼] │  │          │
│    │       │  8  │  │  10 │  │          │
│    │       └─────┘  └─────┘  │          │
│    │         시간    분(10분) │          │
│    └─────────────────────────┘          │
│                                          │
│    ┌─────────────────────────┐          │
│    │          저장하기        │          │
│    └─────────────────────────┘          │
│                                          │
│    ┌─────────────────────────┐          │
│    │          나중에          │          │
│    └─────────────────────────┘          │
│                                          │
└─────────────────────────────────────────┘
       ↓ (저장 클릭)
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. 수면 상태 계산 (duration → status)   │
│ 2. SleepRecord 저장                     │
│ 3. DailyLog.sleepDuration = 420         │
│ 4. DailyLog.sleepStatus = 3 (Excellent) │
└─────────────────────────────────────────┘
```

### 수면 탭 화면

```
┌─────────────────────────────────────────┐
│              수면                        │
├─────────────────────────────────────────┤
│                                          │
│  ┌─────────────────────────────────┐    │
│  │   수면 그래프 [1주|●1개월|3개월] │    │
│  │   (DailyLog.sleepDuration 사용)  │    │
│  │                                 │    │
│  │  9h ─┤ 🟠                        │    │
│  │  8h ─┤      🔵    🔵             │    │
│  │  7h ─┤           ───────────    │    │
│  │  6h ─┤ 🟢              🟢        │    │
│  │  5h ─┤      🟡                   │    │
│  │  4h ─┤                🔴         │    │
│  │      └────────────────────────  │    │
│  │        1/7  1/8  1/9 1/10 1/11   │    │
│  │                                 │    │
│  │  ─── 평균 6.8시간               │    │
│  │                                 │    │
│  │  🔵 Excellent  🟢 Good  🟡 Soso │    │
│  │  🔴 Bad  🟠 Oversleep           │    │
│  └─────────────────────────────────┘    │
│                                          │
│  ┌─────────────────────────────────┐    │
│  │     히스토리                     │    │
│  │  ┌───────────────────────────┐  │    │
│  │  │ 🔵 2026.01.11  8시간 00분  │  │ → 수정
│  │  └───────────────────────────┘  │    │
│  │  ┌───────────────────────────┐  │    │
│  │  │ 🟢 2026.01.10  7시간 00분  │  │    │
│  │  └───────────────────────────┘  │    │
│  └─────────────────────────────────┘    │
│                                          │
└─────────────────────────────────────────┘
```

---

## 9. Phase 2: 사진 인식 플로우

```
┌─────────────┐
│ 📷 사진으로 │
│    인식     │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│           카메라 / 갤러리                │
├─────────────────────────────────────────┤
│  ┌────────────────────────────────┐     │
│  │        [카메라 뷰파인더]        │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌──────────┐          ┌──────────┐     │
│  │  갤러리  │    📸    │   취소   │     │
│  └──────────┘          └──────────┘     │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│              분석 중...                  │
│         ◠ ◠ ◠  AI 분석 중               │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│           인식 결과                      │
├─────────────────────────────────────────┤
│  ┌────────────────────────────────┐     │
│  │    [촬영된 음식 사진]           │     │
│  └────────────────────────────────┘     │
│                                          │
│  인식된 음식:                            │
│  ┌──────────────────────────────┐       │
│  │ ✓ 비빔밥           510 kcal  │ ✕     │
│  └──────────────────────────────┘       │
│  ┌──────────────────────────────┐       │
│  │ ✓ 된장찌개         120 kcal  │ ✕     │
│  └──────────────────────────────┘       │
│                                          │
│  + 음식 추가 (인식 안 된 것)            │
│                                          │
│  ────────────────────────────────────   │
│  총 칼로리: 630 kcal                    │
│                                          │
│  ┌────────────────────────────────┐     │
│  │         이대로 추가             │     │
│  └────────────────────────────────┘     │
└─────────────────────────────────────────┘
```

---

## 10. Phase 2: 목표 설정 플로우

```
┌─────────────┐
│  목표 설정  │
└──────┬──────┘
       ↓
┌─────────────────────────────────────────┐
│           목표 설정                      │
├─────────────────────────────────────────┤
│                                          │
│  목표 유형                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ │
│  │   감량   │ │   유지   │ │   증량   │ │
│  │    ●    │ │    ○    │ │    ○    │ │
│  └──────────┘ └──────────┘ └──────────┘ │
│                                          │
│  ────────────────────────────────────   │
│                                          │
│  현재 체중        72.5 kg               │
│  (User.currentWeight)                   │
│                                          │
│  목표 체중        [   68   ] kg         │
│                                          │
│  주간 감량 목표                          │
│  ○ 0.25kg (권장)                        │
│  ● 0.5kg (보통)                         │
│  ○ 0.75kg (빠름)                        │
│                                          │
│  ────────────────────────────────────   │
│                                          │
│  예상 달성일: 2026년 3월 15일           │
│  일일 권장 칼로리: 1,600 kcal           │
│  (TDEE 2,100 - 500 적자)                │
│                                          │
│  ┌────────────────────────────────┐     │
│  │          목표 설정              │     │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
       ↓
┌─────────────────────────────────────────┐
│              저장 처리                   │
├─────────────────────────────────────────┤
│ 1. Goal 생성                            │
│ 2. goalType = 0 (감량)                  │
│ 3. targetWeight = 68                    │
│ 4. weeklyWeightRate = -0.5              │
│ 5. startWeight = User.currentWeight     │
│ 6. startBMR = User.currentBMR           │
│ 7. startTDEE = User.currentTDEE         │
│ 8. dailyCalorieTarget = 1600            │
└─────────────────────────────────────────┘
```

---

## 11. 설정 화면 구조

```
┌─────────────────────────────────────────┐
│              설정                        │
├─────────────────────────────────────────┤
│                                          │
│  ┌────────────────────────────────┐     │
│  │  👤 프로필                      │     │
│  │  이름, 성별, 생년월일           │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  📊 신체 정보                   │     │
│  │  키, 활동 수준                  │ ▶   │
│  │  (변경 시 BMR/TDEE 재계산)      │     │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  🎯 목표 설정 (Phase 2)         │     │
│  │  체중 목표, 감량 속도           │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  ❤️ HealthKit 연동              │     │
│  │  권한 관리                      │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  🔔 알림 설정                   │     │
│  │  식사, 운동, 체중 기록 알림     │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  💾 데이터 관리                 │     │
│  │  내보내기, 초기화               │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
│  ┌────────────────────────────────┐     │
│  │  ℹ️ 앱 정보                     │     │
│  │  버전, 라이선스                 │ ▶   │
│  └────────────────────────────────┘     │
│                                          │
└─────────────────────────────────────────┘
```

---

*문서 버전: 2.0*
*작성일: 2026-01-11*
*수정: 저장 처리 로직 추가, DailyLog/User 데이터 소스 명시, 연쇄 업데이트 플로우 추가*
