{
  "file_path": "Bodii/Data/Mappers/BodyRecordMapper.swift",
  "main_branch_history": [],
  "task_views": {
    "003-body-composition-tracking-with-bmr-tdee": {
      "task_id": "003-body-composition-tracking-with-bmr-tdee",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "",
        "timestamp": "2026-01-12T19:14:58.058319"
      },
      "worktree_state": {
        "content": "//\n//  BodyRecordMapper.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mapper Pattern\n// Core Data \uc5d4\ud2f0\ud2f0\uc640 Domain \uc5d4\ud2f0\ud2f0 \uac04\uc758 \ubcc0\ud658\uc744 \ub2f4\ub2f9\ud558\ub294 \ub9e4\ud37c\n// \ud83d\udca1 Java \ube44\uad50: ModelMapper \ub610\ub294 MapStruct\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport Foundation\nimport CoreData\n\n// MARK: - BodyRecordMapper\n\n/// BodyRecord (Core Data) \u2194 BodyCompositionEntry (Domain) \ub9e4\ud37c\n/// \ub370\uc774\ud130 \ub808\uc774\uc5b4\uc640 \ub3c4\uba54\uc778 \ub808\uc774\uc5b4 \uac04\uc758 \uacbd\uacc4\ub97c \uba85\ud655\ud788 \uad6c\ubd84\ud569\ub2c8\ub2e4.\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Clean Architecture - Data Layer\n/// - Core Data\uc758 NSManagedObject\ub97c \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\n/// - \ub3c4\uba54\uc778 \ub808\uc774\uc5b4\uac00 Core Data \uc758\uc874\uc131\uc744 \uac16\uc9c0 \uc54a\ub3c4\ub85d \uaca9\ub9ac\n/// - \uc591\ubc29\ud5a5 \ubcc0\ud658 \uc9c0\uc6d0 (toDomain, toEntity)\n/// \ud83d\udca1 Java \ube44\uad50: DTO \u2194 Entity \ubcc0\ud658 \ub9e4\ud37c\uc640 \uc720\uc0ac\nstruct BodyRecordMapper {\n\n    // MARK: - Types\n\n    /// \ub9e4\ud551 \uc911 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc5d0\ub7ec\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Error Type\n    /// Swift\uc758 Error \ud504\ub85c\ud1a0\ucf5c\uc744 conform\ud558\uc5ec throw \uac00\ub2a5\ud55c \ud0c0\uc785 \uc815\uc758\n    /// \ud83d\udca1 Java \ube44\uad50: Custom Exception\uacfc \uc720\uc0ac\n    enum MappingError: Error, LocalizedError {\n        /// \ud544\uc218 \ud544\ub4dc \ub204\ub77d\n        case missingRequiredField(String)\n\n        /// \uc798\ubabb\ub41c \ub370\uc774\ud130 \ud0c0\uc785\n        case invalidDataType(String)\n\n        /// \uc5d0\ub7ec \uc124\uba85 (\uc0ac\uc6a9\uc790\uc5d0\uac8c \ud45c\uc2dc\ud560 \uba54\uc2dc\uc9c0)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: LocalizedError Protocol\n        /// errorDescription\uc744 \uad6c\ud604\ud558\uc5ec \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n        var errorDescription: String? {\n            switch self {\n            case .missingRequiredField(let field):\n                return \"\ud544\uc218 \ud544\ub4dc\uac00 \ub204\ub77d\ub418\uc5c8\uc2b5\ub2c8\ub2e4: \\(field)\"\n            case .invalidDataType(let field):\n                return \"\uc798\ubabb\ub41c \ub370\uc774\ud130 \ud0c0\uc785\uc785\ub2c8\ub2e4: \\(field)\"\n            }\n        }\n    }\n\n    // MARK: - Initialization\n\n    /// Mapper \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Stateless Mapper\n    /// \uc774 Mapper\ub294 \uc0c1\ud0dc\ub97c \uac16\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ubcc4\ub3c4 \ucd08\uae30\ud654 \ubd88\ud544\uc694\n    /// \uadf8\ub7ec\ub098 \uba85\uc2dc\uc801\uc73c\ub85c init\uc744 \uc81c\uacf5\ud558\uc5ec \uc77c\uad00\uc131 \uc720\uc9c0\n    init() {}\n\n    // MARK: - Core Data \u2192 Domain\n\n    /// BodyRecord (Core Data)\ub97c BodyCompositionEntry (Domain)\ub85c \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Handling\n    /// Core Data\uc758 optional \ud544\ub4dc\ub97c \uc548\uc804\ud558\uac8c \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: Optional.ofNullable()\uacfc \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameter entity: Core Data BodyRecord \uc5d4\ud2f0\ud2f0\n    /// - Returns: Domain BodyCompositionEntry\n    /// - Throws: MappingError - \ud544\uc218 \ud544\ub4dc \ub204\ub77d \uc2dc\n    func toDomain(_ entity: BodyRecord) throws -> BodyCompositionEntry {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Guard Let Pattern\n        // optional\uc744 unwrap\ud558\uace0 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\ub97c throw\n        // \ud83d\udca1 Java \ube44\uad50: Objects.requireNonNull()\uacfc \uc720\uc0ac\n\n        guard let id = entity.id else {\n            throw MappingError.missingRequiredField(\"id\")\n        }\n\n        guard let date = entity.date else {\n            throw MappingError.missingRequiredField(\"date\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSDecimalNumber \u2192 Decimal Conversion\n        // Core Data\uc758 NSDecimalNumber\ub97c Swift\uc758 Decimal\ub85c \ubcc0\ud658\n        // weight\ub294 non-optional\uc774\ubbc0\ub85c \uc9c1\uc811 \uc811\uadfc \uac00\ub2a5\n        let weight = entity.weight ?? Decimal(0)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Chaining with Nil Coalescing\n        // bodyFatPercent\uac00 nil\uc774\uba74 \uae30\ubcf8\uac12 0 \uc0ac\uc6a9\n        // \uc2e4\uc81c\ub85c\ub294 \ud544\uc218\uac12\uc774\uc9c0\ub9cc Core Data \ubaa8\ub378\uc5d0\uc11c optional\ub85c \uc815\uc758\ub428\n        let bodyFatPercent = entity.bodyFatPercent ?? Decimal(0)\n\n        let muscleMass = entity.muscleMass ?? Decimal(0)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Calculated vs Stored Value\n        // bodyFatMass\uac00 \uc800\uc7a5\ub418\uc5b4 \uc788\uc73c\uba74 \uc0ac\uc6a9\ud558\uace0, \uc5c6\uc73c\uba74 \uc790\ub3d9 \uacc4\uc0b0\n        // \uacfc\uac70 \ub370\uc774\ud130\uc758 \uc77c\uad00\uc131\uc744 \uc704\ud574 \uc800\uc7a5\ub41c \uac12\uc744 \uc6b0\uc120 \uc0ac\uc6a9\n        let bodyFatMass = entity.bodyFatMass ?? BodyCompositionEntry.calculateBodyFatMass(\n            weight: weight,\n            bodyFatPercent: bodyFatPercent\n        )\n\n        return BodyCompositionEntry(\n            id: id,\n            date: date,\n            weight: weight,\n            bodyFatPercent: bodyFatPercent,\n            muscleMass: muscleMass,\n            bodyFatMass: bodyFatMass\n        )\n    }\n\n    /// \uc5ec\ub7ec BodyRecord\ub97c \ud55c \ubc88\uc5d0 \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Collection Transformation\n    /// Swift\uc758 map\uc744 \ud65c\uc6a9\ud55c \uceec\ub809\uc158 \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Stream.map()\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter entities: Core Data BodyRecord \ubc30\uc5f4\n    /// - Returns: Domain BodyCompositionEntry \ubc30\uc5f4\n    /// - Throws: MappingError - \ubcc0\ud658 \uc911 \uc5d0\ub7ec \ubc1c\uc0dd \uc2dc\n    func toDomain(_ entities: [BodyRecord]) throws -> [BodyCompositionEntry] {\n        return try entities.map { try toDomain($0) }\n    }\n\n    // MARK: - Domain \u2192 Core Data\n\n    /// BodyCompositionEntry (Domain)\ub97c BodyRecord (Core Data)\ub85c \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObject Creation\n    /// Core Data \uc5d4\ud2f0\ud2f0\ub97c \uc0dd\uc131\ud558\ub824\uba74 NSManagedObjectContext\uac00 \ud544\uc694\n    /// \ud83d\udca1 Java \ube44\uad50: EntityManager\ub97c \uc0ac\uc6a9\ud55c \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\uacfc \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - domainEntity: Domain BodyCompositionEntry\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Returns: Core Data BodyRecord\n    func toEntity(_ domainEntity: BodyCompositionEntry, context: NSManagedObjectContext) -> BodyRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObject Initialization\n        // Core Data \uc5d4\ud2f0\ud2f0\ub294 context\uc640 \ud568\uaed8 \uc0dd\uc131\ub418\uc5b4\uc57c \ud568\n        // entity\ub294 context\uac00 \uad00\ub9ac\ud558\ub294 \uac1d\uccb4 \uc124\uba85 \uc815\ubcf4\n        let entity = BodyRecord(context: context)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Value Assignment\n        // Domain entity\uc758 \uac12\uc744 Core Data entity\ub85c \ubcf5\uc0ac\n        entity.id = domainEntity.id\n        entity.date = domainEntity.date\n        entity.weight = domainEntity.weight\n        entity.bodyFatPercent = domainEntity.bodyFatPercent\n        entity.muscleMass = domainEntity.muscleMass\n        entity.bodyFatMass = domainEntity.bodyFatMass\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Timestamp Management\n        // createdAt\uc740 \uc0dd\uc131 \uc2dc\uc810\uc744 \uae30\ub85d\ud558\ub294 \uac10\uc0ac(audit) \ud544\ub4dc\n        // Core Data\uc5d0\uc11c\ub9cc \uc0ac\uc6a9\ub418\uace0 Domain\uc5d0\ub294 \ub178\ucd9c\ub418\uc9c0 \uc54a\uc74c\n        entity.createdAt = Date()\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Return Unsaved Entity\n        // \uc5ec\uae30\uc11c\ub294 context.save()\ub97c \ud638\ucd9c\ud558\uc9c0 \uc54a\uc74c\n        // \uc800\uc7a5\uc740 Repository \ub808\uc774\uc5b4\uc5d0\uc11c \ub2f4\ub2f9 (\ub2e8\uc77c \ucc45\uc784 \uc6d0\uce59)\n        return entity\n    }\n\n    /// \uae30\uc874 BodyRecord \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Update vs Create\n    /// \uc0c8\ub85c\uc6b4 \uc5d4\ud2f0\ud2f0\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uace0 \uae30\uc874 \uc5d4\ud2f0\ud2f0\ub97c \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 merge() \uba54\uc11c\ub4dc\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - entity: \uc5c5\ub370\uc774\ud2b8\ud560 Core Data BodyRecord\n    ///   - domainEntity: \uc0c8\ub85c\uc6b4 \uac12\uc744 \uac00\uc9c4 Domain BodyCompositionEntry\n    func updateEntity(_ entity: BodyRecord, from domainEntity: BodyCompositionEntry) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Partial Update\n        // ID\uc640 createdAt\uc740 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 \ub098\uba38\uc9c0 \ud544\ub4dc\ub9cc \uc5c5\ub370\uc774\ud2b8\n        // \ubd88\ubcc0(immutable) \ud544\ub4dc\uc640 \uac00\ubcc0(mutable) \ud544\ub4dc \uad6c\ubd84\n\n        entity.date = domainEntity.date\n        entity.weight = domainEntity.weight\n        entity.bodyFatPercent = domainEntity.bodyFatPercent\n        entity.muscleMass = domainEntity.muscleMass\n        entity.bodyFatMass = domainEntity.bodyFatMass\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Audit Trail\n        // updatedAt \uac19\uc740 \ud544\ub4dc\uac00 \uc788\ub2e4\uba74 \uc5ec\uae30\uc11c \uac31\uc2e0\n        // \ud604\uc7ac BodyRecord \ubaa8\ub378\uc5d0\ub294 updatedAt\uc774 \uc5c6\uc9c0\ub9cc \ud5a5\ud6c4 \ucd94\uac00 \uac00\ub2a5\n    }\n}\n\n// MARK: - Convenience Extensions\n\nextension BodyRecordMapper {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Methods\n    /// \uc790\uc8fc \uc0ac\uc6a9\ub418\ub294 \ud328\ud134\uc744 \uac04\ud3b8\ud558\uac8c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 \ud5ec\ud37c \uba54\uc11c\ub4dc\n\n    /// Domain \uc5d4\ud2f0\ud2f0\ub85c \uc0c8 Core Data \uc5d4\ud2f0\ud2f0 \uc0dd\uc131 \ubc0f \uc989\uc2dc \uc800\uc7a5\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Combined Operation\n    /// \uc0dd\uc131\uacfc \uc800\uc7a5\uc744 \ud55c \ubc88\uc5d0 \ucc98\ub9ac\ud558\ub294 \ud3b8\uc758 \uba54\uc11c\ub4dc\n    /// \ud83d\udca1 \uc8fc\uc758: \uc5d0\ub7ec \ucc98\ub9ac\ub97c \uc704\ud574 throws \uc0ac\uc6a9\n    ///\n    /// - Parameters:\n    ///   - domainEntity: Domain BodyCompositionEntry\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Returns: \uc800\uc7a5\ub41c Core Data BodyRecord\n    /// - Throws: Core Data \uc800\uc7a5 \uc5d0\ub7ec\n    func createAndSave(_ domainEntity: BodyCompositionEntry, context: NSManagedObjectContext) throws -> BodyRecord {\n        let entity = toEntity(domainEntity, context: context)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Try Expression\n        // context.save()\uac00 throw\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c try \ud0a4\uc6cc\ub4dc \ud544\uc694\n        // \ud83d\udca1 Java \ube44\uad50: checked exception \ucc98\ub9ac\uc640 \uc720\uc0ac\n        try context.save()\n\n        return entity\n    }\n\n    /// Domain \uc5d4\ud2f0\ud2f0\ub85c \uae30\uc874 Core Data \uc5d4\ud2f0\ud2f0 \uc5c5\ub370\uc774\ud2b8 \ubc0f \uc989\uc2dc \uc800\uc7a5\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Update and Persist\n    /// \uc5c5\ub370\uc774\ud2b8\uc640 \uc800\uc7a5\uc744 \ud55c \ubc88\uc5d0 \ucc98\ub9ac\n    ///\n    /// - Parameters:\n    ///   - entity: \uc5c5\ub370\uc774\ud2b8\ud560 Core Data BodyRecord\n    ///   - domainEntity: \uc0c8\ub85c\uc6b4 \uac12\uc744 \uac00\uc9c4 Domain BodyCompositionEntry\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Throws: Core Data \uc800\uc7a5 \uc5d0\ub7ec\n    func updateAndSave(_ entity: BodyRecord, from domainEntity: BodyCompositionEntry, context: NSManagedObjectContext) throws {\n        updateEntity(entity, from: domainEntity)\n        try context.save()\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mapper Pattern \uc774\ud574\n///\n/// Mapper\uc758 \uc5ed\ud560:\n/// - \ub370\uc774\ud130 \ub808\uc774\uc5b4(Core Data)\uc640 \ub3c4\uba54\uc778 \ub808\uc774\uc5b4(Business Logic)\uc758 \uacbd\uacc4 \uc815\uc758\n/// - \uac01 \ub808\uc774\uc5b4\uac00 \uc11c\ub85c\uc758 \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d\uc744 \uc54c\uc9c0 \ubabb\ud558\ub3c4\ub85d \uaca9\ub9ac\n/// - \ud14c\uc2a4\ud2b8 \uac00\ub2a5\uc131 \ud5a5\uc0c1 (\ub3c4\uba54\uc778 \ub85c\uc9c1\uc744 Core Data \uc5c6\uc774 \ud14c\uc2a4\ud2b8 \uac00\ub2a5)\n///\n/// \uc65c Mapper\uac00 \ud544\uc694\ud55c\uac00?\n/// 1. \uad00\uc2ec\uc0ac\uc758 \ubd84\ub9ac (Separation of Concerns)\n///    - Domain\uc740 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc5d0\ub9cc \uc9d1\uc911\n///    - Data Layer\ub294 \uc601\uc18d\uc131(persistence)\uc5d0\ub9cc \uc9d1\uc911\n///\n/// 2. \ub3c5\ub9bd\uc131 (Independence)\n///    - Core Data\ub97c \ub2e4\ub978 DB\ub85c \ubcc0\uacbd\ud574\ub3c4 Domain\uc740 \uc601\ud5a5 \uc5c6\uc74c\n///    - Domain \uc5d4\ud2f0\ud2f0 \ubcc0\uacbd \uc2dc Core Data \ubaa8\ub378\uc740 \uc601\ud5a5 \ucd5c\uc18c\ud654\n///\n/// 3. \ud14c\uc2a4\ud2b8 \uc6a9\uc774\uc131 (Testability)\n///    - Domain \ub85c\uc9c1\uc744 \ud14c\uc2a4\ud2b8\ud560 \ub54c Core Data mock \ubd88\ud544\uc694\n///    - \uc21c\uc218\ud55c Swift \uac1d\uccb4\ub85c \ud14c\uc2a4\ud2b8 \uac00\ub2a5\n///\n/// 4. \ud0c0\uc785 \uc548\uc804\uc131 (Type Safety)\n///    - Core Data\uc758 optional/non-optional \ubd88\uc77c\uce58 \ud574\uacb0\n///    - NSDecimalNumber \u2194 Decimal \ubcc0\ud658 \uc77c\uad00\uc131\n///\n/// Clean Architecture\uc758 \ub808\uc774\uc5b4:\n/// ```\n/// Presentation Layer (UI)\n///        \u2193\n/// Domain Layer (Business Logic) \u2190 BodyCompositionEntry\n///        \u2193\n/// Data Layer (Persistence) \u2190 BodyRecord (Core Data)\n///        \u2193\n/// Mapper: \uc774 \ub808\uc774\uc5b4 \uac04\uc758 \ubc88\uc5ed\uae30 \uc5ed\ud560\n/// ```\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - Mapper\ub294 stateless\ud574\uc57c \ud568 (\uc0c1\ud0dc\ub97c \uac16\uc9c0 \uc54a\uc74c)\n/// - \ub2e8\ubc29\ud5a5\ubcf4\ub2e4\ub294 \uc591\ubc29\ud5a5 \ubcc0\ud658 \uc9c0\uc6d0\uc774 \uc720\uc6a9\n/// - \ubcf5\uc7a1\ud55c \ub85c\uc9c1\uc740 Mapper\uac00 \uc544\ub2cc Use Case\uc5d0 \uc704\uce58\n/// - \ubcc0\ud658 \uc2e4\ud328 \uc2dc \uba85\ud655\ud55c \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n///\n",
        "last_modified": "2026-01-12T19:14:58.420640"
      },
      "task_intent": {
        "title": "Body Composition Tracking with BMR/TDEE",
        "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-12T19:14:58.258482",
  "last_updated": "2026-01-12T19:14:58.270856"
}