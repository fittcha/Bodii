{
  "file_path": "Bodii/Data/Mappers/KFDAFoodMapper.swift",
  "main_branch_history": [],
  "task_views": {
    "005-korean-food-database-integration": {
      "task_id": "005-korean-food-database-integration",
      "branch_point": {
        "commit_hash": "c44bfbcd7c1699b176a8bb155e8c35f43ebd4ad9",
        "content": "",
        "timestamp": "2026-01-13T07:46:23.878686"
      },
      "worktree_state": {
        "content": "//\n//  KFDAFoodMapper.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Mapper Pattern\n// DTO(Data Transfer Object)\ub97c Domain Entity\ub85c \ubcc0\ud658\ud558\ub294 \ub9e4\ud37c\n// \ud83d\udca1 Java \ube44\uad50: ModelMapper, MapStruct\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport Foundation\n\n/// \uc2dd\uc57d\ucc98 API DTO\ub97c Food \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\ud558\ub294 \ub9e4\ud37c\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mapper Pattern in Clean Architecture\n/// \ub370\uc774\ud130 \ub808\uc774\uc5b4\uc758 DTO\ub97c \ub3c4\uba54\uc778 \ub808\uc774\uc5b4\uc758 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\n/// \uac01 \ub808\uc774\uc5b4 \uac04\uc758 \uc758\uc874\uc131\uc744 \ubd84\ub9ac\ud558\uace0 \ub3c4\uba54\uc778 \ub85c\uc9c1\uc744 \ubcf4\ud638\n/// \ud83d\udca1 Java \ube44\uad50: DTO -> Entity \ubcc0\ud658 \ub9e4\ud37c\uc640 \ub3d9\uc77c\ud55c \ud328\ud134\n///\n/// **\ubcc0\ud658 \ub85c\uc9c1:**\n/// - \ubb38\uc790\uc5f4 \uc601\uc591 \uc815\ubcf4\ub97c \uc22b\uc790 \ud0c0\uc785\uc73c\ub85c \ubcc0\ud658\n/// - \ud544\uc218 \ud544\ub4dc \uac80\uc99d \ubc0f \uae30\ubcf8\uac12 \uc124\uc815\n/// - \ucd9c\ucc98\ub97c .governmentAPI\ub85c \uc124\uc815\n/// - API \ucf54\ub4dc \uc800\uc7a5 (\uc911\ubcf5 \uc81c\uac70\uc5d0 \uc0ac\uc6a9)\n///\n/// **\uc0ac\uc6a9 \uc608\uc2dc:**\n/// ```swift\n/// let dto = KFDAFoodDTO(...)\n/// let mapper = KFDAFoodMapper()\n///\n/// // DTO\ub97c \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\n/// let food = try mapper.toDomain(from: dto)\n/// print(food.name) // \"\ud604\ubbf8\ubc25\"\n/// print(food.calories) // 330\n/// print(food.source) // .governmentAPI\n/// ```\nstruct KFDAFoodMapper {\n\n    // MARK: - Mapping Methods\n\n    /// KFDAFoodDTO\ub97c Food \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Throwing Functions\n    /// \ubcc0\ud658 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\ub97c throw\ud558\uc5ec \ud638\ucd9c\uc790\uac00 \ucc98\ub9ac\ud558\ub3c4\ub85d \ud568\n    /// \ud83d\udca1 Java \ube44\uad50: throws Exception\uacfc \ub3d9\uc77c\ud55c \uac1c\ub150\n    ///\n    /// - Parameter dto: \uc2dd\uc57d\ucc98 API \uc751\ub2f5 DTO\n    ///\n    /// - Returns: Food \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\n    ///\n    /// - Throws: `MappingError` - \ud544\uc218 \ud544\ub4dc \ub204\ub77d \ub610\ub294 \ubcc0\ud658 \uc2e4\ud328\n    ///\n    /// - Example:\n    /// ```swift\n    /// do {\n    ///     let food = try mapper.toDomain(from: dto)\n    /// } catch MappingError.missingRequiredField(let field) {\n    ///     print(\"Missing field: \\(field)\")\n    /// } catch MappingError.invalidNutritionData(let field) {\n    ///     print(\"Invalid data: \\(field)\")\n    /// }\n    /// ```\n    func toDomain(from dto: KFDAFoodDTO) throws -> Food {\n        // \ud544\uc218 \ud544\ub4dc \uac80\uc99d\n        guard !dto.foodCd.isEmpty else {\n            throw MappingError.missingRequiredField(\"foodCd\")\n        }\n\n        guard !dto.descKor.isEmpty else {\n            throw MappingError.missingRequiredField(\"descKor\")\n        }\n\n        // \uce7c\ub85c\ub9ac \ubcc0\ud658 (\ud544\uc218 \ud544\ub4dc)\n        guard let calories = parseCalories(from: dto.enercKcal) else {\n            throw MappingError.invalidNutritionData(\"enercKcal\")\n        }\n\n        // \ud0c4\uc218\ud654\ubb3c \ubcc0\ud658 (\ud544\uc218 \ud544\ub4dc)\n        guard let carbohydrates = dto.parseDecimal(dto.chocdf), carbohydrates >= 0 else {\n            throw MappingError.invalidNutritionData(\"chocdf\")\n        }\n\n        // \ub2e8\ubc31\uc9c8 \ubcc0\ud658 (\ud544\uc218 \ud544\ub4dc)\n        guard let protein = dto.parseDecimal(dto.prot), protein >= 0 else {\n            throw MappingError.invalidNutritionData(\"prot\")\n        }\n\n        // \uc9c0\ubc29 \ubcc0\ud658 (\ud544\uc218 \ud544\ub4dc)\n        guard let fat = dto.parseDecimal(dto.fat), fat >= 0 else {\n            throw MappingError.invalidNutritionData(\"fat\")\n        }\n\n        // 1\ud68c \uc81c\uacf5\ub7c9 \ubcc0\ud658 (\ud544\uc218 \ud544\ub4dc)\n        guard let servingSize = parseServingSize(from: dto) else {\n            throw MappingError.invalidNutritionData(\"servingSize\")\n        }\n\n        // \uc120\ud0dd \ud544\ub4dc \ubcc0\ud658\n        let sodium = dto.parseDecimal(dto.na)\n        let fiber = dto.parseDecimal(dto.fibtg)\n        let sugar = dto.parseDecimal(dto.sugar)\n        let servingUnit = dto.servingUnit?.trimmingCharacters(in: .whitespaces)\n\n        // Food \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\n        return Food(\n            id: UUID(),\n            name: dto.descKor.trimmingCharacters(in: .whitespaces),\n            calories: calories,\n            carbohydrates: carbohydrates,\n            protein: protein,\n            fat: fat,\n            sodium: sodium,\n            fiber: fiber,\n            sugar: sugar,\n            servingSize: servingSize,\n            servingUnit: servingUnit,\n            source: .governmentAPI,\n            apiCode: dto.foodCd,\n            createdByUserId: nil,\n            createdAt: Date()\n        )\n    }\n\n    // MARK: - Helper Methods\n\n    /// \uce7c\ub85c\ub9ac \ubb38\uc790\uc5f4\uc744 Int32\ub85c \ubcc0\ud658\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Type Conversion with Validation\n    /// API\uc758 \ubb38\uc790\uc5f4 \ub370\uc774\ud130\ub97c \uc571\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ud0c0\uc785\uc73c\ub85c \uc548\uc804\ud558\uac8c \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Integer.parseInt() + validation\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter value: \uce7c\ub85c\ub9ac \ubb38\uc790\uc5f4 (\uc608: \"330\", \"330.5\")\n    ///\n    /// - Returns: Int32 \uce7c\ub85c\ub9ac \uac12 (\ubc18\uc62c\ub9bc), \ubcc0\ud658 \uc2e4\ud328 \uc2dc nil\n    ///\n    /// - Note: \uc18c\uc218\uc810 \uce7c\ub85c\ub9ac\ub294 \ubc18\uc62c\ub9bc \ucc98\ub9ac (330.5 \u2192 331)\n    private func parseCalories(from value: String?) -> Int32? {\n        guard let value = value,\n              !value.isEmpty,\n              let decimal = Decimal(string: value.trimmingCharacters(in: .whitespaces)),\n              decimal >= 0 else {\n            return nil\n        }\n\n        // \ubc18\uc62c\ub9bc\ud558\uc5ec Int32\ub85c \ubcc0\ud658\n        let rounded = NSDecimalNumber(decimal: decimal).doubleValue.rounded()\n        return Int32(rounded)\n    }\n\n    /// 1\ud68c \uc81c\uacf5\ub7c9\uc744 \uadf8\ub7a8(g) \ub2e8\uc704 Decimal\ub85c \ubcc0\ud658\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Fallback Strategy\n    /// \uc5ec\ub7ec \ud544\ub4dc \uc911 \uc720\ud6a8\ud55c \uac12\uc744 \ucc3e\uc544 \uc0ac\uc6a9\ud558\ub294 \ud3f4\ubc31 \uc804\ub7b5\n    /// \ud83d\udca1 Java \ube44\uad50: Optional chaining\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter dto: \uc2dd\uc57d\ucc98 API \uc751\ub2f5 DTO\n    ///\n    /// - Returns: \uc81c\uacf5\ub7c9 (g), \ubcc0\ud658 \uc2e4\ud328 \uc2dc nil\n    ///\n    /// - Note: servingSize \u2192 servingWt \uc21c\uc11c\ub85c \ud3f4\ubc31, \ub458 \ub2e4 \uc5c6\uc73c\uba74 100g \uae30\ubcf8\uac12\n    private func parseServingSize(from dto: KFDAFoodDTO) -> Decimal? {\n        // servingSize \uc6b0\uc120 \uc2dc\ub3c4\n        if let servingSize = dto.parseDecimal(dto.servingSize), servingSize > 0 {\n            return servingSize\n        }\n\n        // servingWt\ub85c \ud3f4\ubc31\n        if let servingWt = dto.parseDecimal(dto.servingWt), servingWt > 0 {\n            return servingWt\n        }\n\n        // \uae30\ubcf8\uac12: 100g (\ud45c\uc900 1\ud68c \uc81c\uacf5\ub7c9)\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reasonable Defaults\n        // API \ub370\uc774\ud130\uac00 \ubd88\uc644\uc804\ud55c \uacbd\uc6b0 \ud569\ub9ac\uc801\uc778 \uae30\ubcf8\uac12 \uc81c\uacf5\n        // \ud83d\udca1 Java \ube44\uad50: Default value pattern\n        return Decimal(100)\n    }\n}\n\n// MARK: - Mapping Error\n\n/// \ub9e4\ud551 \uacfc\uc815\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc5d0\ub7ec\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Error Types\n/// \ub3c4\uba54\uc778\ubcc4 \uc5d0\ub7ec \ud0c0\uc785\uc744 \uc815\uc758\ud558\uc5ec \uba85\ud655\ud55c \uc5d0\ub7ec \ucc98\ub9ac\n/// \ud83d\udca1 Java \ube44\uad50: Custom Exception\uacfc \ub3d9\uc77c\ud55c \uac1c\ub150\nenum MappingError: Error {\n    /// \ud544\uc218 \ud544\ub4dc \ub204\ub77d\n    case missingRequiredField(String)\n\n    /// \uc798\ubabb\ub41c \uc601\uc591 \uc815\ubcf4 \ub370\uc774\ud130\n    case invalidNutritionData(String)\n\n    /// \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801 \uc5d0\ub7ec \uba54\uc2dc\uc9c0\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: LocalizedError Protocol\n    /// \uc0ac\uc6a9\uc790\uc5d0\uac8c \ubcf4\uc5ec\uc904 \uc218 \uc788\ub294 \ud55c\uae00 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n    /// \ud83d\udca1 Java \ube44\uad50: getMessage()\uc640 \uc720\uc0ac\n    var localizedDescription: String {\n        switch self {\n        case .missingRequiredField(let field):\n            return \"\ud544\uc218 \ud544\ub4dc\uac00 \ub204\ub77d\ub418\uc5c8\uc2b5\ub2c8\ub2e4: \\(field)\"\n        case .invalidNutritionData(let field):\n            return \"\uc601\uc591 \uc815\ubcf4 \ub370\uc774\ud130\uac00 \uc798\ubabb\ub418\uc5c8\uc2b5\ub2c8\ub2e4: \\(field)\"\n        }\n    }\n}\n\n// MARK: - Batch Mapping\n\nextension KFDAFoodMapper {\n\n    /// \uc5ec\ub7ec DTO\ub97c \ud55c \ubc88\uc5d0 \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \ubc30\uc5f4\ub85c \ubcc0\ud658\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Batch Processing with Error Handling\n    /// \uc77c\ubd80 \ubcc0\ud658 \uc2e4\ud328\ud574\ub3c4 \uc131\uacf5\ud55c \ud56d\ubaa9\ub4e4\uc740 \ubc18\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Stream.map() with filter\uc640 \uc720\uc0ac\n    ///\n    /// - Parameter dtos: \uc2dd\uc57d\ucc98 API \uc751\ub2f5 DTO \ubc30\uc5f4\n    ///\n    /// - Returns: \uc131\uacf5\uc801\uc73c\ub85c \ubcc0\ud658\ub41c Food \uc5d4\ud2f0\ud2f0 \ubc30\uc5f4\n    ///\n    /// - Note: \ubcc0\ud658 \uc2e4\ud328\ud55c \ud56d\ubaa9\uc740 \uc790\ub3d9\uc73c\ub85c \uc81c\uc678\ub428\n    ///\n    /// - Example:\n    /// ```swift\n    /// let dtos: [KFDAFoodDTO] = [...]\n    /// let foods = mapper.toDomainArray(from: dtos)\n    /// // \uc77c\ubd80 DTO\uac00 \uc798\ubabb\ub418\uc5b4\ub3c4 \uc720\ud6a8\ud55c Food\ub9cc \ubc18\ud658\ub428\n    /// ```\n    func toDomainArray(from dtos: [KFDAFoodDTO]) -> [Food] {\n        dtos.compactMap { dto in\n            try? toDomain(from: dto)\n        }\n    }\n}\n",
        "last_modified": "2026-01-14T22:55:39.262629"
      },
      "task_intent": {
        "title": "005-korean-food-database-integration",
        "description": "Integrate Korean Food & Drug Administration (\uc2dd\uc57d\ucc98) food nutrition database API as primary source, with USDA FoodData Central as fallback for international foods. Prioritize Korean dishes (kimchi jjigae, bibimbap, tteokbokki) that are poorly covered by competitors.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:31.722236",
  "last_updated": "2026-01-13T07:46:24.091076"
}