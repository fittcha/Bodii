{
  "file_path": "Bodii/Domain/Entities/SleepRecord.swift",
  "main_branch_history": [],
  "task_views": {
    "002-project-foundation-core-data-model": {
      "task_id": "002-project-foundation-core-data-model",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "",
        "timestamp": "2026-01-14T13:34:17.674713"
      },
      "worktree_state": {
        "content": "//\n//  SleepRecord.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-11.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Auto-Status Calculation\n// SleepRecord\ub294 \uc218\uba74 \uc2dc\uac04(\ubd84)\uc5d0 \ub530\ub77c \uc218\uba74 \uc0c1\ud0dc\ub97c \uc790\ub3d9\uc73c\ub85c \uacc4\uc0b0\n// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 @PrePersist/@PreUpdate\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc Swift\ub294 factory method \uc0ac\uc6a9\n\nimport Foundation\n\n// MARK: - SleepRecord\n\n/// \uc218\uba74 \uae30\ub85d \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\n/// - \uc0ac\uc6a9\uc790\uc758 \uc218\uba74 \uc2dc\uac04\uacfc \uc0c1\ud0dc\ub97c \uae30\ub85d\n/// - \uc218\uba74 \uc2dc\uac04(\ubd84)\uc5d0 \ub530\ub77c \uc218\uba74 \uc0c1\ud0dc \uc790\ub3d9 \uacc4\uc0b0\n/// - HealthKit \uc5f0\ub3d9 \uc9c0\uc6d0 (\uc790\ub3d9 \uae30\ub85d)\n///\n/// ## \uc8fc\uc694 \uae30\ub2a5\n/// - \uc218\uba74 \uc2dc\uac04 \uae30\ubc18 \uc218\uba74 \uc0c1\ud0dc \uc790\ub3d9 \uacb0\uc815\n/// - DailyLog\uc5d0\uc11c \uc77c\uc77c \uc218\uba74 \ub370\uc774\ud130 \uc9d1\uacc4\uc5d0 \uc0ac\uc6a9\n/// - HealthKit \ub370\uc774\ud130 \uc5f0\ub3d9 \uc9c0\uc6d0\n/// - 02:00 \uc218\uba74 \uacbd\uacc4 \ub85c\uc9c1 \uc801\uc6a9\n///\n/// ## \uc218\uba74 \uc0c1\ud0dc \uacb0\uc815 \uae30\uc900\n/// ```\n/// \ub098\uc068 (bad): 0-329\ubd84 (0-5.5\uc2dc\uac04)\n/// \ubcf4\ud1b5 (soso): 330-389\ubd84 (5.5-6.5\uc2dc\uac04)\n/// \uc88b\uc74c (good): 390-449\ubd84 (6.5-7.5\uc2dc\uac04)\n/// \ub9e4\uc6b0 \uc88b\uc74c (excellent): 450-540\ubd84 (7.5-9\uc2dc\uac04)\n/// \uacfc\uc218\uba74 (oversleep): 541\ubd84 \uc774\uc0c1 (9\uc2dc\uac04 \ucd08\uacfc)\n/// ```\n///\n/// ## 02:00 \uc218\uba74 \uacbd\uacc4 \ub85c\uc9c1\n/// - 00:00 ~ 01:59\uc5d0 \uae30\ub85d\ub41c \uc218\uba74\uc740 \uc804\ub0a0\uc758 \uc218\uba74\uc73c\ub85c \uac04\uc8fc\n/// - 02:00 ~ 23:59\uc5d0 \uae30\ub85d\ub41c \uc218\uba74\uc740 \ub2f9\uc77c\uc758 \uc218\uba74\uc73c\ub85c \uac04\uc8fc\n/// - DateUtils.getLogicalDate()\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub17c\ub9ac\uc801 \ub0a0\uc9dc \uacb0\uc815\n///\n/// ## \ub370\uc774\ud130 \uad00\uacc4\n/// - DailyLog (N:1): \uac19\uc740 \ub0a0\uc9dc\uc758 SleepRecord\ub4e4\uc774 DailyLog\uc5d0 \uc9d1\uacc4\ub428\n/// - HealthKit: fromHealthKit\uc774 true\uba74 HealthKit\uc5d0\uc11c \uc790\ub3d9 \uae30\ub85d\ub41c \ub370\uc774\ud130\n///\n/// ## \uc0ac\uc6a9 \uc608\uc2dc\n/// ```swift\n/// // 1. \uc218\ub3d9 \uc218\uba74 \uae30\ub85d (\uc0ac\uc6a9\uc790 \uc785\ub825)\n/// let record = SleepRecord.create(\n///     userId: userId,\n///     date: Date(),\n///     duration: 420\n/// )\n/// print(record.status) // .good (\uc790\ub3d9 \uacc4\uc0b0: 420\ubd84 = 7\uc2dc\uac04)\n///\n/// // 2. HealthKit \uc5f0\ub3d9 \uae30\ub85d\n/// let healthKitRecord = SleepRecord.createFromHealthKit(\n///     userId: userId,\n///     date: Date(),\n///     duration: 480,\n///     healthKitId: \"HK-SLEEP-12345\"\n/// )\n/// print(healthKitRecord.status) // .excellent (\uc790\ub3d9 \uacc4\uc0b0: 480\ubd84 = 8\uc2dc\uac04)\n/// print(healthKitRecord.fromHealthKit) // true\n/// ```\nstruct SleepRecord: Identifiable, Codable, Equatable {\n\n    // MARK: - Properties\n\n    // MARK: Identifier\n\n    /// \uc218\uba74 \uae30\ub85d \uace0\uc720 \uc2dd\ubcc4\uc790\n    /// - UUID \ud0c0\uc785\uc73c\ub85c \uc804\uc5ed \uace0\uc720\uc131 \ubcf4\uc7a5\n    let id: UUID\n\n    /// \uc0ac\uc6a9\uc790 \uace0\uc720 \uc2dd\ubcc4\uc790\n    /// - User \uc5d4\ud2f0\ud2f0\uc640\uc758 \uc678\ub798 \ud0a4 \uad00\uacc4\n    let userId: UUID\n\n    // MARK: Record Data\n\n    /// \uc218\uba74 \ub0a0\uc9dc\n    /// - 02:00 sleep boundary \ub85c\uc9c1 \uc801\uc6a9 (DateUtils.getLogicalDate)\n    /// - DailyLog \uc9d1\uacc4 \uc2dc \uc774 \ub0a0\uc9dc \uae30\uc900\uc73c\ub85c \uadf8\ub8f9\ud654\n    ///\n    /// ## \uc608\uc2dc\n    /// - 2024-01-02 01:30\uc5d0 \uc218\uba74 \uc885\ub8cc \u2192 2024-01-01\ub85c \uae30\ub85d (\uc804\ub0a0 \uc218\uba74)\n    /// - 2024-01-02 07:00\uc5d0 \uc218\uba74 \uc885\ub8cc \u2192 2024-01-02\ub85c \uae30\ub85d (\ub2f9\uc77c \uc218\uba74)\n    let date: Date\n\n    /// \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - \ucd1d \uc218\uba74 \uc2dc\uac04 (\uc218\uba74 \uc2dc\uc791\ubd80\ud130 \uc885\ub8cc\uae4c\uc9c0)\n    /// - \uc218\uba74 \uc0c1\ud0dc(status) \uc790\ub3d9 \uacc4\uc0b0\uc5d0 \uc0ac\uc6a9\n    ///\n    /// ## \uc608\uc2dc\n    /// - 420\ubd84 = 7\uc2dc\uac04 \u2192 good\n    /// - 480\ubd84 = 8\uc2dc\uac04 \u2192 excellent\n    /// - 300\ubd84 = 5\uc2dc\uac04 \u2192 bad\n    let duration: Int\n\n    /// \uc218\uba74 \uc0c1\ud0dc\n    /// - duration(\ubd84)\uc73c\ub85c\ubd80\ud130 \uc790\ub3d9 \uacc4\uc0b0\n    /// - SleepStatus.from(durationMinutes:)\uc744 \uc0ac\uc6a9\ud558\uc5ec \uacb0\uc815\n    /// - .bad, .soso, .good, .excellent, .oversleep \uc911 \ud558\ub098\n    let status: SleepStatus\n\n    // MARK: HealthKit Integration\n\n    /// HealthKit \uc5f0\ub3d9 \uc5ec\ubd80\n    /// - true: HealthKit\uc5d0\uc11c \uc790\ub3d9\uc73c\ub85c \uae30\ub85d\ub41c \uc218\uba74\n    /// - false: \uc0ac\uc6a9\uc790\uac00 \uc218\ub3d9\uc73c\ub85c \uc785\ub825\ud55c \uc218\uba74\n    let fromHealthKit: Bool\n\n    /// HealthKit \uc218\uba74 \uace0\uc720 \uc2dd\ubcc4\uc790\n    /// - HealthKit\uc5d0\uc11c \uac00\uc838\uc628 \uc218\uba74 \ub370\uc774\ud130\uc758 \uc6d0\ubcf8 ID\n    /// - \uc911\ubcf5 \ubc29\uc9c0 \ubc0f \ub3d9\uae30\ud654\uc5d0 \uc0ac\uc6a9\n    let healthKitId: String?\n\n    // MARK: Timestamps\n\n    /// \uc0dd\uc131 \uc2dc\uac01\n    /// - \uc218\uba74 \uae30\ub85d\uc774 DB\uc5d0 \ucd94\uac00\ub41c \uc2dc\uac01\n    let createdAt: Date\n\n    /// \uc218\uc815 \uc2dc\uac01\n    /// - \uc218\uba74 \uae30\ub85d\uc774 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc218\uc815\ub41c \uc2dc\uac01\n    var updatedAt: Date\n\n    // MARK: - Factory Methods\n\n    /// \uc218\uba74 \uae30\ub85d \uc0dd\uc131 (\uc218\ub3d9 \uc785\ub825)\n    /// - Parameters:\n    ///   - userId: \uc0ac\uc6a9\uc790 \uace0\uc720 \uc2dd\ubcc4\uc790\n    ///   - date: \uc218\uba74 \ub0a0\uc9dc (\ub17c\ub9ac\uc801 \ub0a0\uc9dc, 02:00 boundary \uc801\uc6a9\ub41c \ub0a0\uc9dc)\n    ///   - duration: \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - Returns: \uc218\uba74 \uc0c1\ud0dc\uac00 \uc790\ub3d9 \uacc4\uc0b0\ub41c SleepRecord\n    ///\n    /// ## \uc0ac\uc6a9 \uc608\uc2dc\n    /// ```swift\n    /// let record = SleepRecord.create(\n    ///     userId: userId,\n    ///     date: Date(),\n    ///     duration: 420\n    /// )\n    /// print(record.duration) // 420\ubd84 (7\uc2dc\uac04)\n    /// print(record.status) // .good (\uc790\ub3d9 \uacc4\uc0b0)\n    /// print(record.fromHealthKit) // false\n    /// ```\n    static func create(\n        userId: UUID,\n        date: Date,\n        duration: Int\n    ) -> SleepRecord {\n        let status = SleepStatus.from(durationMinutes: duration)\n\n        let now = Date()\n        return SleepRecord(\n            id: UUID(),\n            userId: userId,\n            date: date,\n            duration: duration,\n            status: status,\n            fromHealthKit: false,\n            healthKitId: nil,\n            createdAt: now,\n            updatedAt: now\n        )\n    }\n\n    /// HealthKit \uc5f0\ub3d9 \uc218\uba74 \uae30\ub85d \uc0dd\uc131\n    /// - Parameters:\n    ///   - userId: \uc0ac\uc6a9\uc790 \uace0\uc720 \uc2dd\ubcc4\uc790\n    ///   - date: \uc218\uba74 \ub0a0\uc9dc (\ub17c\ub9ac\uc801 \ub0a0\uc9dc, 02:00 boundary \uc801\uc6a9\ub41c \ub0a0\uc9dc)\n    ///   - duration: \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    ///   - healthKitId: HealthKit \uc218\uba74 \uace0\uc720 \uc2dd\ubcc4\uc790\n    /// - Returns: \uc218\uba74 \uc0c1\ud0dc\uac00 \uc790\ub3d9 \uacc4\uc0b0\ub41c SleepRecord (HealthKit \uc5f0\ub3d9)\n    ///\n    /// ## \uc0ac\uc6a9 \uc608\uc2dc\n    /// ```swift\n    /// let record = SleepRecord.createFromHealthKit(\n    ///     userId: userId,\n    ///     date: Date(),\n    ///     duration: 480,\n    ///     healthKitId: \"HK-SLEEP-12345\"\n    /// )\n    /// print(record.status) // .excellent (\uc790\ub3d9 \uacc4\uc0b0: 480\ubd84 = 8\uc2dc\uac04)\n    /// print(record.fromHealthKit) // true\n    /// print(record.healthKitId) // \"HK-SLEEP-12345\"\n    /// ```\n    static func createFromHealthKit(\n        userId: UUID,\n        date: Date,\n        duration: Int,\n        healthKitId: String\n    ) -> SleepRecord {\n        let status = SleepStatus.from(durationMinutes: duration)\n\n        let now = Date()\n        return SleepRecord(\n            id: UUID(),\n            userId: userId,\n            date: date,\n            duration: duration,\n            status: status,\n            fromHealthKit: true,\n            healthKitId: healthKitId,\n            createdAt: now,\n            updatedAt: now\n        )\n    }\n\n    // MARK: - Helper Methods\n\n    /// \uc218\uba74 \uc2dc\uac04 \uc5c5\ub370\uc774\ud2b8\n    /// - Parameter newDuration: \uc0c8\ub85c\uc6b4 \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - Returns: \uc218\uba74 \uc0c1\ud0dc\uac00 \uc7ac\uacc4\uc0b0\ub41c SleepRecord\n    ///\n    /// ## \uc0ac\uc6a9 \uc2dc\ub098\ub9ac\uc624\n    /// \uc0ac\uc6a9\uc790\uac00 \uc218\uba74 \uc2dc\uac04\uc744 \uc218\uc815\ud560 \ub54c \uc218\uba74 \uc0c1\ud0dc\ub97c \uc790\ub3d9\uc73c\ub85c \uc7ac\uacc4\uc0b0\n    ///\n    /// ## \uc608\uc2dc\n    /// ```swift\n    /// let original = SleepRecord.create(userId: userId, date: Date(), duration: 360)\n    /// // original.duration = 360\ubd84 (6\uc2dc\uac04)\n    /// // original.status = .soso\n    ///\n    /// let updated = original.updatingDuration(420)\n    /// // updated.duration = 420\ubd84 (7\uc2dc\uac04)\n    /// // updated.status = .good (\uc7ac\uacc4\uc0b0)\n    /// ```\n    func updatingDuration(_ newDuration: Int) -> SleepRecord {\n        let newStatus = SleepStatus.from(durationMinutes: newDuration)\n\n        return SleepRecord(\n            id: id,\n            userId: userId,\n            date: date,\n            duration: newDuration,\n            status: newStatus,\n            fromHealthKit: fromHealthKit,\n            healthKitId: healthKitId,\n            createdAt: createdAt,\n            updatedAt: Date()\n        )\n    }\n\n    // MARK: - Computed Properties\n\n    /// \uc218\uba74 \uc2dc\uac04\uc744 \uc2dc\uac04 \ub2e8\uc704\ub85c \ubc18\ud658\n    /// - Returns: \uc218\uba74 \uc2dc\uac04 (\uc18c\uc218\uc810 1\uc790\ub9ac, \uc2dc\uac04 \ub2e8\uc704)\n    ///\n    /// ## \uc608\uc2dc\n    /// ```swift\n    /// let record = SleepRecord.create(..., duration: 420)\n    /// print(record.durationInHours) // 7.0\uc2dc\uac04\n    ///\n    /// let record2 = SleepRecord.create(..., duration: 450)\n    /// print(record2.durationInHours) // 7.5\uc2dc\uac04\n    /// ```\n    var durationInHours: Double {\n        return Double(duration) / 60.0\n    }\n}\n\n// MARK: - SleepRecord + CustomStringConvertible\n\nextension SleepRecord: CustomStringConvertible {\n    /// \ub514\ubc84\uae45\uc6a9 \ubb38\uc790\uc5f4 \ud45c\ud604\n    var description: String {\n        let healthKitText = fromHealthKit ? \" [HealthKit]\" : \"\"\n        let hoursText = String(format: \"%.1f\", durationInHours)\n\n        return \"\"\"\n        SleepRecord(\n          id: \\(id.uuidString.prefix(8))...,\n          userId: \\(userId.uuidString.prefix(8))...,\n          date: \\(date.formatted(style: .short)),\n          duration: \\(duration)\ubd84 (\\(hoursText)\uc2dc\uac04),\n          status: \\(status.displayName),\n          fromHealthKit: \\(fromHealthKit)\\(healthKitText),\n          createdAt: \\(createdAt.formatted(style: .dateTime))\n        )\n        \"\"\"\n    }\n}\n",
        "last_modified": "2026-01-14T13:34:18.075518"
      },
      "task_intent": {
        "title": "Project Foundation & Core Data Model",
        "description": "Set up Xcode project with SwiftUI, MVVM architecture, Core Data persistence layer with 9 entities (User, BodyRecord, MetabolismSnapshot, Food, FoodRecord, ExerciseRecord, SleepRecord, DailyLog, Goal), and utility services for date handling and input validation.",
        "from_plan": true
      },
      "commits_behind_main": 3,
      "status": "active",
      "merged_at": null
    },
    "004-project-foundation-core-data-model": {
      "task_id": "004-project-foundation-core-data-model",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "",
        "timestamp": "2026-01-12T19:14:54.682468"
      },
      "worktree_state": {
        "content": "//\n//  SleepRecord.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2024-01-12.\n//\n\nimport Foundation\n\n/// \uc218\uba74 \uae30\ub85d \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\n///\n/// \uc0ac\uc6a9\uc790\uc758 \uc218\uba74 \uc2dc\uac04\uacfc \ud488\uc9c8\uc744 \uae30\ub85d\ud569\ub2c8\ub2e4.\n///\n/// - Note: date\ub294 02:00 \uae30\uc900\uc73c\ub85c \ud558\ub8e8\ub97c \uad6c\ubd84\ud569\ub2c8\ub2e4.\n///         - 02:00 ~ \uc775\uc77c 01:59 = \uac19\uc740 \ub0a0\n///         - \uc608: 2026-01-11 03:00 \uc785\ub825 \u2192 date = 2026-01-11\n///         - \uc608: 2026-01-11 01:00 \uc785\ub825 \u2192 date = 2026-01-10\n///\n/// - Note: status\ub294 duration(\ubd84 \ub2e8\uc704)\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c \uacb0\uc815\ub429\ub2c8\ub2e4.\n///         - Bad (\ud83d\udd34): 330\ubd84 \ubbf8\ub9cc (5\uc2dc\uac04 30\ubd84 \ubbf8\ub9cc)\n///         - Soso (\ud83d\udfe1): 330~390\ubd84 (5\uc2dc\uac04 30\ubd84 ~ 6\uc2dc\uac04 30\ubd84)\n///         - Good (\ud83d\udfe2): 390~450\ubd84 (6\uc2dc\uac04 30\ubd84 ~ 7\uc2dc\uac04 30\ubd84)\n///         - Excellent (\ud83d\udd35): 450~540\ubd84 (7\uc2dc\uac04 30\ubd84 ~ 9\uc2dc\uac04)\n///         - Oversleep (\ud83d\udfe0): 540\ubd84 \ucd08\uacfc (9\uc2dc\uac04 \ucd08\uacfc)\n///\n/// - Note: \uc218\uba74 \uae30\ub85d \uc785\ub825 \uc2dc DailyLog\uc758 sleepDuration, sleepStatus\uac00 \uc790\ub3d9\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ub429\ub2c8\ub2e4.\n///\n/// - Example:\n/// ```swift\n/// let sleepRecord = SleepRecord(\n///     id: UUID(),\n///     userId: user.id,\n///     date: Date(),\n///     duration: 420,\n///     status: .good,\n///     createdAt: Date(),\n///     updatedAt: Date()\n/// )\n/// ```\nstruct SleepRecord {\n    // MARK: - Primary Key\n\n    /// \uace0\uc720 \uc2dd\ubcc4\uc790\n    let id: UUID\n\n    // MARK: - Foreign Key\n\n    /// User \ucc38\uc870\n    let userId: UUID\n\n    // MARK: - Sleep Data\n\n    /// \uc218\uba74 \uae30\uc900\uc77c (02:00 \uae30\uc900)\n    ///\n    /// 02:00 ~ \uc775\uc77c 01:59\uae4c\uc9c0\ub97c \uac19\uc740 \ub0a0\ub85c \ucde8\uae09\ud569\ub2c8\ub2e4.\n    /// - 03:00\uc5d0 \uc785\ub825 \uc2dc: \ub2f9\uc77c \ub0a0\uc9dc\n    /// - 01:00\uc5d0 \uc785\ub825 \uc2dc: \uc804\ub0a0 \ub0a0\uc9dc\n    var date: Date\n\n    /// \uc218\uba74 \uc2dc\uac04 (\ubd84 \ub2e8\uc704)\n    ///\n    /// \ubc94\uc704: 0\ubd84 \uc774\uc0c1 (\ubc24\uc0d8 \uc2dc 0\ubd84\ub3c4 \ud5c8\uc6a9)\n    var duration: Int32\n\n    /// \uc218\uba74 \uc0c1\ud0dc (0: Bad, 1: Soso, 2: Good, 3: Excellent, 4: Oversleep)\n    ///\n    /// duration \uac12\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c \uacb0\uc815\ub429\ub2c8\ub2e4.\n    /// SleepStatus.from(durationMinutes:) \uba54\uc11c\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uacc4\uc0b0\ud569\ub2c8\ub2e4.\n    var status: SleepStatus\n\n    // MARK: - Metadata\n\n    /// \uc0dd\uc131\uc77c\uc2dc\n    let createdAt: Date\n\n    /// \uc218\uc815\uc77c\uc2dc\n    var updatedAt: Date\n}\n\n// MARK: - Identifiable\n\nextension SleepRecord: Identifiable {}\n\n// MARK: - Equatable\n\nextension SleepRecord: Equatable {\n    static func == (lhs: SleepRecord, rhs: SleepRecord) -> Bool {\n        lhs.id == rhs.id\n    }\n}\n\n// MARK: - Hashable\n\nextension SleepRecord: Hashable {\n    func hash(into hasher: inout Hasher) {\n        hasher.combine(id)\n    }\n}\n",
        "last_modified": "2026-01-14T22:57:13.076223"
      },
      "task_intent": {
        "title": "004-project-foundation-core-data-model",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-11T21:28:24.028561",
  "last_updated": "2026-01-14T13:34:17.870372"
}