{
  "file_path": "Bodii/Presentation/Features/Dashboard/MetabolismViewModel.swift",
  "main_branch_history": [],
  "task_views": {
    "003-body-composition-tracking-with-bmr-tdee": {
      "task_id": "003-body-composition-tracking-with-bmr-tdee",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "",
        "timestamp": "2026-01-13T07:46:22.394743"
      },
      "worktree_state": {
        "content": "//\n//  MetabolismViewModel.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dashboard-Focused ViewModel Pattern\n// \ub300\uc2dc\ubcf4\ub4dc\uc5d0\uc11c BMR/TDEE \ubc0f \uce7c\ub85c\ub9ac \uade0\ud615\uc744 \ud45c\uc2dc\ud558\uae30 \uc704\ud55c ViewModel\n// \ud83d\udca1 Java \ube44\uad50: Android\uc758 ViewModel\uacfc \uc720\uc0ac\ud558\uc9c0\ub9cc \ub300\uc2dc\ubcf4\ub4dc \uc804\uc6a9 \uc0c1\ud0dc \uad00\ub9ac\n\nimport Foundation\nimport SwiftUI\nimport Combine\n\n// MARK: - MetabolismViewModel\n\n/// \ub300\uc2dc\ubcf4\ub4dc\uc5d0\uc11c BMR/TDEE \ud45c\uc2dc\ub97c \uc704\ud55c ViewModel\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dashboard Data Management\n/// - \ud604\uc7ac BMR/TDEE \ub370\uc774\ud130 \uad00\ub9ac\n/// - \uce7c\ub85c\ub9ac \uc12d\ucde8/\uc18c\ube44 \ube44\uad50\n/// - \uce7c\ub85c\ub9ac \uc789\uc5ec/\uacb0\ud54d \uacc4\uc0b0\n/// - \uc2e0\uccb4 \uae30\ub85d \ubcc0\uacbd \uc2dc \uc790\ub3d9 \uc0c8\ub85c\uace0\uce68\n/// \ud83d\udca1 Java \ube44\uad50: Android ViewModel + Dashboard state management\n@MainActor\nclass MetabolismViewModel: ObservableObject {\n\n    // MARK: - Published Properties (View State)\n\n    /// \ud604\uc7ac \ub300\uc0ac\uc728 \ub370\uc774\ud130\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional State\n    /// - nil\uc774\uba74 \uc544\uc9c1 \ub370\uc774\ud130 \ub85c\ub4dc \uc548 \ub428 \ub610\ub294 \uae30\ub85d \uc5c6\uc74c\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \ub300\uc2dc\ubcf4\ub4dc\uc5d0 \ud45c\uc2dc\n    /// \ud83d\udca1 Java \ube44\uad50: LiveData<MetabolismData?>\uc640 \uc720\uc0ac\n    @Published var currentMetabolism: MetabolismData?\n\n    /// \ub85c\ub529 \uc0c1\ud0dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Loading State\n    /// - \ub370\uc774\ud130 \uc870\ud68c \uc911 \ub85c\ub529 \uc778\ub514\ucf00\uc774\ud130 \ud45c\uc2dc\n    @Published var isLoading: Bool = false\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error State\n    /// - nil\uc774\uba74 \uc5d0\ub7ec \uc5c6\uc74c\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \ud45c\uc2dc\n    @Published var errorMessage: String?\n\n    /// \uc77c\uc77c \uce7c\ub85c\ub9ac \uc12d\ucde8\ub7c9 (kcal)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: External Data Integration\n    /// - \ub2e4\uc774\uc5b4\ud2b8 \ubaa8\ub4c8\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uc12d\ucde8 \uce7c\ub85c\ub9ac\n    /// - \ub300\uc2dc\ubcf4\ub4dc\uc5d0\uc11c \uade0\ud615 \uacc4\uc0b0\uc5d0 \uc0ac\uc6a9\n    @Published var dailyCalorieIntake: Decimal = 0\n\n    /// \uc77c\uc77c \uce7c\ub85c\ub9ac \uc18c\ube44\ub7c9 (kcal)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: External Data Integration\n    /// - \uc6b4\ub3d9 \ubaa8\ub4c8\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uc18c\ube44 \uce7c\ub85c\ub9ac\n    /// - TDEE\uc5d0 \ucd94\uac00\ub418\uc5b4 \ucd1d \uc18c\ube44\ub7c9 \uacc4\uc0b0\n    @Published var dailyCalorieExpenditure: Decimal = 0\n\n    // MARK: - Private Properties\n\n    /// \uc2e0\uccb4 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// - Repository\ub97c \uc678\ubd80\uc5d0\uc11c \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9\n    /// - \ud14c\uc2a4\ud2b8 \uc2dc Mock\uc73c\ub85c \uad50\uccb4 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject\ub85c \uc8fc\uc785\ubc1b\ub294 Repository\uc640 \uc720\uc0ac\n    private let bodyRepository: BodyRepositoryProtocol\n\n    /// Combine \uad6c\ub3c5 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reactive Programming\n    /// - \ub370\uc774\ud130 \ubcc0\uacbd \uac10\uc9c0 \ubc0f \uc790\ub3d9 \uc0c8\ub85c\uace0\uce68\n    /// - \uba54\ubaa8\ub9ac \ub204\uc218 \ubc29\uc9c0\ub97c \uc704\ud55c \uad6c\ub3c5 \uad00\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: RxJava\uc758 CompositeDisposable\uacfc \uc720\uc0ac\n    private var cancellables = Set<AnyCancellable>()\n\n    /// \ub9c8\uc9c0\ub9c9 \uc0c8\ub85c\uace0\uce68 \uc2dc\uac04\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Refresh Tracking\n    /// - \uc911\ubcf5 \uc0c8\ub85c\uace0\uce68 \ubc29\uc9c0\n    /// - \uce90\uc2f1 \uc804\ub7b5\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\n    private var lastRefreshDate: Date?\n\n    // MARK: - Initialization\n\n    /// MetabolismViewModel \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection via Constructor\n    /// - \ubaa8\ub4e0 \uc758\uc874\uc131\uc744 \uc0dd\uc131\uc790\ub97c \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc74c\n    /// - \uc758\uc874\uc131 \uc5ed\uc804 \uc6d0\uce59 (Dependency Inversion Principle) \uc900\uc218\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject constructor\uc640 \uc720\uc0ac\n    ///\n    /// - Parameter bodyRepository: \uc2e0\uccb4 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    init(bodyRepository: BodyRepositoryProtocol) {\n        self.bodyRepository = bodyRepository\n\n        // \ucd08\uae30 \ub370\uc774\ud130 \ub85c\ub4dc\n        Task {\n            await loadCurrentMetabolism()\n        }\n    }\n\n    // MARK: - Computed Properties\n\n    /// BMR\uc774 \uc788\ub294\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property for State Check\n    /// - View\uc5d0\uc11c \ub370\uc774\ud130 \ud45c\uc2dc \uc5ec\ubd80 \uacb0\uc815\n    var hasBMR: Bool {\n        currentMetabolism != nil\n    }\n\n    /// \ud604\uc7ac BMR (kcal/day)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Property\n    /// - View\uc5d0\uc11c \uc9c1\uc811 \uc811\uadfc \uac00\ub2a5\ud55c \ud3b8\uc758 \uc18d\uc131\n    var bmr: Decimal? {\n        currentMetabolism?.bmr\n    }\n\n    /// \ud604\uc7ac TDEE (kcal/day)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Property\n    /// - View\uc5d0\uc11c \uc9c1\uc811 \uc811\uadfc \uac00\ub2a5\ud55c \ud3b8\uc758 \uc18d\uc131\n    var tdee: Decimal? {\n        currentMetabolism?.tdee\n    }\n\n    /// \ud65c\ub3d9 \uc218\uc900\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Property\n    var activityLevel: ActivityLevel? {\n        currentMetabolism?.activityLevel\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 (\uc12d\ucde8 - \uc18c\ube44)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Calorie Balance Calculation\n    /// - \uc591\uc218: \uce7c\ub85c\ub9ac \uc789\uc5ec (\uccb4\uc911 \uc99d\uac00 \uacbd\ud5a5)\n    /// - \uc74c\uc218: \uce7c\ub85c\ub9ac \uacb0\ud54d (\uccb4\uc911 \uac10\uc18c \uacbd\ud5a5)\n    /// - 0 \ub610\ub294 \uadfc\uc811: \uc720\uc9c0 \uc0c1\ud0dc\n    var calorieBalance: Decimal? {\n        guard let tdee = tdee else { return nil }\n        let totalExpenditure = tdee + dailyCalorieExpenditure\n        return dailyCalorieIntake - totalExpenditure\n    }\n\n    /// \uce7c\ub85c\ub9ac \uc789\uc5ec \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Classification\n    /// - View\uc5d0\uc11c \uc0c9\uc0c1\uc774\ub098 \uba54\uc2dc\uc9c0 \uacb0\uc815\uc5d0 \uc0ac\uc6a9\n    var isCalorieSurplus: Bool {\n        guard let balance = calorieBalance else { return false }\n        return balance > 0\n    }\n\n    /// \uce7c\ub85c\ub9ac \uacb0\ud54d \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778\n    var isCalorieDeficit: Bool {\n        guard let balance = calorieBalance else { return false }\n        return balance < 0\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 \uc0c1\ud0dc (\uc720\uc9c0)\uc778\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Tolerance Range\n    /// - \u00b1100 kcal \ubc94\uc704\ub294 \uc720\uc9c0 \uc0c1\ud0dc\ub85c \uac04\uc8fc\n    var isCalorieMaintenance: Bool {\n        guard let balance = calorieBalance else { return false }\n        return abs(balance as NSDecimalNumber).doubleValue <= 100\n    }\n\n    /// \ucd1d \uce7c\ub85c\ub9ac \uc18c\ube44\ub7c9 (TDEE + \uc6b4\ub3d9)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Total Expenditure\n    /// - TDEE (\uae30\ubcf8 \ub300\uc0ac\ub7c9 + \ud65c\ub3d9 \ub300\uc0ac\ub7c9) + \ucd94\uac00 \uc6b4\ub3d9\n    var totalCalorieExpenditure: Decimal? {\n        guard let tdee = tdee else { return nil }\n        return tdee + dailyCalorieExpenditure\n    }\n\n    /// \uc608\uc0c1 \uc8fc\uac04 \uccb4\uc911 \ubcc0\ud654 (kg/week)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Weight Change Prediction\n    /// - \ud604\uc7ac \uce7c\ub85c\ub9ac \uade0\ud615\uc744 \uae30\ubc18\uc73c\ub85c \uc608\uce21\n    var estimatedWeeklyWeightChange: Decimal? {\n        guard let metabolism = currentMetabolism else { return nil }\n        return metabolism.estimatedWeeklyWeightChange(calorieIntake: dailyCalorieIntake)\n    }\n\n    // MARK: - Public Methods\n\n    /// \ud604\uc7ac \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ub85c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async Data Loading\n    /// - Repository\uc5d0\uc11c \ucd5c\uc2e0 \ub370\uc774\ud130 \uc870\ud68c\n    /// - \ub85c\ub529 \uc0c1\ud0dc \ubc0f \uc5d0\ub7ec \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: Kotlin Coroutines\uc758 suspend function\uacfc \uc720\uc0ac\n    func loadCurrentMetabolism() async {\n        isLoading = true\n        errorMessage = nil\n\n        do {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Latest Record Query\n            // \uac00\uc7a5 \ucd5c\uadfc \uc2e0\uccb4 \uae30\ub85d\uc758 \ub300\uc0ac\uc728 \ub370\uc774\ud130 \uc870\ud68c\n            if let latestEntry = try await bodyRepository.fetchLatest() {\n                currentMetabolism = try await bodyRepository.fetchMetabolismData(for: latestEntry.id)\n                lastRefreshDate = Date()\n            } else {\n                // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: No Data State\n                // \uae30\ub85d\uc774 \uc5c6\ub294 \uacbd\uc6b0 nil\ub85c \uc124\uc815\n                currentMetabolism = nil\n            }\n\n        } catch let error as RepositoryError {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Specific Error Handling\n            // Repository\uc758 \ub3c4\uba54\uc778 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801 \uba54\uc2dc\uc9c0\ub85c \ubcc0\ud658\n            errorMessage = error.localizedDescription\n            currentMetabolism = nil\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Generic Error Handling\n            errorMessage = \"\ub300\uc0ac\uc728 \ub370\uc774\ud130 \ub85c\ub4dc \uc2e4\ud328: \\(error.localizedDescription)\"\n            currentMetabolism = nil\n        }\n\n        isLoading = false\n    }\n\n    /// \uce7c\ub85c\ub9ac \uc12d\ucde8\ub7c9 \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: External Data Update\n    /// - \ub2e4\uc774\uc5b4\ud2b8 \ubaa8\ub4c8\uc5d0\uc11c \ud638\ucd9c\n    /// - \uce7c\ub85c\ub9ac \uade0\ud615 \uc790\ub3d9 \uc7ac\uacc4\uc0b0 (computed property)\n    ///\n    /// - Parameter intake: \uc77c\uc77c \uce7c\ub85c\ub9ac \uc12d\ucde8\ub7c9 (kcal)\n    func updateCalorieIntake(_ intake: Decimal) {\n        dailyCalorieIntake = intake\n    }\n\n    /// \uce7c\ub85c\ub9ac \uc18c\ube44\ub7c9 \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: External Data Update\n    /// - \uc6b4\ub3d9 \ubaa8\ub4c8\uc5d0\uc11c \ud638\ucd9c\n    /// - \uce7c\ub85c\ub9ac \uade0\ud615 \uc790\ub3d9 \uc7ac\uacc4\uc0b0 (computed property)\n    ///\n    /// - Parameter expenditure: \ucd94\uac00 \uce7c\ub85c\ub9ac \uc18c\ube44\ub7c9 (kcal)\n    func updateCalorieExpenditure(_ expenditure: Decimal) {\n        dailyCalorieExpenditure = expenditure\n    }\n\n    /// \uc0c8\ub85c\uace0\uce68\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manual Refresh\n    /// - \uc2e0\uccb4 \uae30\ub85d \ucd94\uac00 \ud6c4 \ud638\ucd9c\n    /// - Pull-to-refresh \ub4f1\uc5d0\uc11c \uc0ac\uc6a9\n    func refresh() async {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Debounce Check\n        // \uc9e7\uc740 \uc2dc\uac04 \ub0b4 \uc911\ubcf5 \uc0c8\ub85c\uace0\uce68 \ubc29\uc9c0 (1\ucd08 \uc774\ub0b4)\n        if let lastRefresh = lastRefreshDate,\n           Date().timeIntervalSince(lastRefresh) < 1.0 {\n            return\n        }\n\n        await loadCurrentMetabolism()\n    }\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uac70\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Cleanup\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc5d0\ub7ec \ud655\uc778 \ud6c4 \ud638\ucd9c\n    func clearError() {\n        errorMessage = nil\n    }\n\n    // MARK: - Helper Methods\n\n    /// \uce7c\ub85c\ub9ac \uac12 \ud3ec\ub9f7\ud305 (\uc815\uc218)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Number Formatting\n    /// - Decimal\uc744 \uc77d\uae30 \uc26c\uc6b4 \ubb38\uc790\uc5f4\ub85c \ubcc0\ud658\n    /// - \uc18c\uc218\uc810 \uc5c6\uc774 \uc815\uc218\ub85c \ud45c\uc2dc\n    ///\n    /// - Parameter calories: \uce7c\ub85c\ub9ac \uac12\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"1,650\")\n    func formatCalories(_ calories: Decimal?) -> String {\n        guard let calories = calories else { return \"-\" }\n\n        let formatter = NumberFormatter()\n        formatter.numberStyle = .decimal\n        formatter.maximumFractionDigits = 0\n        formatter.minimumFractionDigits = 0\n\n        let number = NSDecimalNumber(decimal: calories)\n        return formatter.string(from: number) ?? \"\\(calories)\"\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 \ud3ec\ub9f7\ud305 (\ubd80\ud638 \ud3ec\ud568)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Signed Number Formatting\n    /// - \uc591\uc218\ub294 +, \uc74c\uc218\ub294 - \uae30\ud638 \ud3ec\ud568\n    /// - \uc0c9\uc0c1 \uacb0\uc815\uc5d0\ub3c4 \uc0ac\uc6a9 \uac00\ub2a5\n    ///\n    /// - Parameter balance: \uce7c\ub85c\ub9ac \uade0\ud615\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"+300 kcal\", \"-150 kcal\")\n    func formatCalorieBalance(_ balance: Decimal?) -> String {\n        guard let balance = balance else { return \"-\" }\n\n        let formatter = NumberFormatter()\n        formatter.numberStyle = .decimal\n        formatter.maximumFractionDigits = 0\n        formatter.minimumFractionDigits = 0\n        formatter.positivePrefix = \"+\"\n        formatter.negativePrefix = \"-\"\n\n        let number = NSDecimalNumber(decimal: balance)\n        return (formatter.string(from: number) ?? \"\\(balance)\") + \" kcal\"\n    }\n\n    /// \uccb4\uc911 \ubcc0\ud654 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Weight Change Formatting\n    /// - \uc8fc\uac04 \uc608\uc0c1 \uccb4\uc911 \ubcc0\ud654\ub97c \ud3ec\ub9f7\ud305\n    ///\n    /// - Parameter change: \uccb4\uc911 \ubcc0\ud654\ub7c9 (kg/week)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"+0.5 kg/week\", \"-0.3 kg/week\")\n    func formatWeightChange(_ change: Decimal?) -> String {\n        guard let change = change else { return \"-\" }\n\n        let formatter = NumberFormatter()\n        formatter.numberStyle = .decimal\n        formatter.maximumFractionDigits = 1\n        formatter.minimumFractionDigits = 1\n        formatter.positivePrefix = \"+\"\n\n        let number = NSDecimalNumber(decimal: change)\n        return (formatter.string(from: number) ?? \"\\(change)\") + \" kg/\uc8fc\"\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 \uc0c1\ud0dc \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Description\n    /// - \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud604\uc7ac \uc0c1\ud0dc\ub97c \uba85\ud655\ud788 \uc804\ub2ec\n    ///\n    /// - Returns: \uc0c1\ud0dc \ubb38\uc790\uc5f4 (\"\uc789\uc5ec\", \"\uacb0\ud54d\", \"\uc720\uc9c0\")\n    func calorieBalanceStatusText() -> String {\n        guard calorieBalance != nil else { return \"\ub370\uc774\ud130 \uc5c6\uc74c\" }\n\n        if isCalorieMaintenance {\n            return \"\uc720\uc9c0\"\n        } else if isCalorieSurplus {\n            return \"\uc789\uc5ec\"\n        } else {\n            return \"\uacb0\ud54d\"\n        }\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 \uc0c1\ud0dc \uc0c9\uc0c1\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UI State Mapping\n    /// - \uc0c1\ud0dc\uc5d0 \ub530\ub978 \uc0c9\uc0c1 \uc81c\uacf5\n    ///\n    /// - Returns: \uc0c1\ud0dc\uc5d0 \ub9de\ub294 \uc0c9\uc0c1\n    func calorieBalanceStatusColor() -> Color {\n        guard calorieBalance != nil else { return .gray }\n\n        if isCalorieMaintenance {\n            return .green\n        } else if isCalorieSurplus {\n            return .orange\n        } else {\n            return .blue\n        }\n    }\n\n    /// \uce7c\ub85c\ub9ac \uade0\ud615 \uc0c1\ud0dc \uc544\uc774\ucf58\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SF Symbols Integration\n    /// - \uc0c1\ud0dc\uc5d0 \ub530\ub978 \uc544\uc774\ucf58 \uc81c\uacf5\n    ///\n    /// - Returns: SF Symbol \uc774\ub984\n    func calorieBalanceStatusIcon() -> String {\n        guard calorieBalance != nil else { return \"questionmark.circle\" }\n\n        if isCalorieMaintenance {\n            return \"equal.circle.fill\"\n        } else if isCalorieSurplus {\n            return \"arrow.up.circle.fill\"\n        } else {\n            return \"arrow.down.circle.fill\"\n        }\n    }\n\n    /// BMR/TDEE \ucc28\uc774 \uc124\uba85 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Educational Content\n    /// - \uc0ac\uc6a9\uc790\uc5d0\uac8c BMR\uacfc TDEE\uc758 \ucc28\uc774 \uc124\uba85\n    ///\n    /// - Returns: \uc124\uba85 \ubb38\uc790\uc5f4\n    func metabolismExplanation() -> String {\n        guard let metabolism = currentMetabolism else {\n            return \"\uc2e0\uccb4 \uae30\ub85d\uc744 \ucd94\uac00\ud558\uba74 BMR\uacfc TDEE\uac00 \uc790\ub3d9\uc73c\ub85c \uacc4\uc0b0\ub429\ub2c8\ub2e4.\"\n        }\n\n        let activityCalories = metabolism.activityCalories\n        return \"\ud65c\ub3d9\uc73c\ub85c \uc778\ud55c \ucd94\uac00 \uc18c\ube44: \\(formatCalories(activityCalories)) kcal/\uc77c\"\n    }\n}\n\n// MARK: - Preview Support\n\n#if DEBUG\nextension MetabolismViewModel {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview Helper\n    /// SwiftUI Preview\ub97c \uc704\ud55c Mock ViewModel\n    /// \ud83d\udca1 Java \ube44\uad50: Test fixture\uc640 \uc720\uc0ac\n    static func makePreview() -> MetabolismViewModel {\n        // Mock Repository \uc0dd\uc131 (\uc2e4\uc81c \uad6c\ud604 \ud544\uc694)\n        fatalError(\"Preview support not yet implemented. Need to create MockBodyRepository.\")\n    }\n\n    /// \uc0d8\ud50c \ub370\uc774\ud130\uac00 \uc788\ub294 ViewModel\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sample Data for Preview\n    /// - \ub300\uc2dc\ubcf4\ub4dc \ubbf8\ub9ac\ubcf4\uae30\ub97c \uc704\ud55c \uc0d8\ud50c \ub370\uc774\ud130 \ud3ec\ud568\n    static func makePreviewWithData(repository: BodyRepositoryProtocol) -> MetabolismViewModel {\n        let viewModel = MetabolismViewModel(bodyRepository: repository)\n\n        // \uc0d8\ud50c \ub370\uc774\ud130 \uc124\uc815\n        viewModel.currentMetabolism = MetabolismData.sample\n        viewModel.dailyCalorieIntake = Decimal(2000)\n        viewModel.dailyCalorieExpenditure = Decimal(300)\n\n        return viewModel\n    }\n}\n#endif\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dashboard ViewModel Pattern \uc774\ud574\n///\n/// MetabolismViewModel\uc758 \uc5ed\ud560:\n/// - BMR/TDEE \ud45c\uc2dc: \ucd5c\uc2e0 \ub300\uc0ac\uc728 \ub370\uc774\ud130 \uc870\ud68c \ubc0f \ud45c\uc2dc\n/// - \uce7c\ub85c\ub9ac \uade0\ud615 \uacc4\uc0b0: \uc12d\ucde8 vs \uc18c\ube44 \ube44\uad50\n/// - \uc0c1\ud0dc \ubd84\ub958: \uc789\uc5ec/\uacb0\ud54d/\uc720\uc9c0 \uc0c1\ud0dc \ud310\ub2e8\n/// - \uc790\ub3d9 \uc0c8\ub85c\uace0\uce68: \uc2e0\uccb4 \uae30\ub85d \ucd94\uac00 \uc2dc \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8\n/// - UI \ud5ec\ud37c: \ud3ec\ub9f7\ud305, \uc0c9\uc0c1, \uc544\uc774\ucf58 \uc81c\uacf5\n///\n/// \uc8fc\uc694 \uae30\ub2a5:\n/// 1. \ucd5c\uc2e0 BMR/TDEE \ub85c\ub4dc\n/// 2. \uce7c\ub85c\ub9ac \uc12d\ucde8/\uc18c\ube44 \ucd94\uc801\n/// 3. \uce7c\ub85c\ub9ac \uade0\ud615 \uacc4\uc0b0 (\uc790\ub3d9)\n/// 4. \uc608\uc0c1 \uccb4\uc911 \ubcc0\ud654 \uacc4\uc0b0\n/// 5. \uc0c1\ud0dc\ubcc4 \uc2dc\uac01\uc801 \ud53c\ub4dc\ubc31 (\uc0c9\uc0c1, \uc544\uc774\ucf58)\n///\n/// \ub370\uc774\ud130 \ud750\ub984:\n/// - BodyRepository \u2192 \ucd5c\uc2e0 MetabolismData \uc870\ud68c\n/// - DietModule \u2192 dailyCalorieIntake \uc5c5\ub370\uc774\ud2b8\n/// - ExerciseModule \u2192 dailyCalorieExpenditure \uc5c5\ub370\uc774\ud2b8\n/// - Computed Properties \u2192 calorieBalance, estimatedWeightChange \uc790\ub3d9 \uacc4\uc0b0\n///\n/// \uc0c1\ud0dc \uad00\ub9ac:\n/// - @Published: \uac12 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c View \uc5c5\ub370\uc774\ud2b8\n/// - @MainActor: \ubaa8\ub4e0 \uba54\uc11c\ub4dc\uac00 \uba54\uc778 \uc2a4\ub808\ub4dc\uc5d0\uc11c \uc2e4\ud589\n/// - Computed Properties: BMR/TDEE \uae30\ubc18 \uc2e4\uc2dc\uac04 \uacc4\uc0b0\n///\n/// \uc758\uc874\uc131:\n/// - BodyRepositoryProtocol: \ub300\uc0ac\uc728 \ub370\uc774\ud130 \uc870\ud68c\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// struct DashboardView: View {\n///     @StateObject private var viewModel = MetabolismViewModel(\n///         bodyRepository: repository\n///     )\n///\n///     var body: some View {\n///         VStack {\n///             // BMR/TDEE \uce74\ub4dc\n///             if let bmr = viewModel.bmr, let tdee = viewModel.tdee {\n///                 HStack {\n///                     VStack {\n///                         Text(\"BMR\")\n///                         Text(\"\\(viewModel.formatCalories(bmr)) kcal\")\n///                     }\n///                     VStack {\n///                         Text(\"TDEE\")\n///                         Text(\"\\(viewModel.formatCalories(tdee)) kcal\")\n///                     }\n///                 }\n///             }\n///\n///             // \uce7c\ub85c\ub9ac \uade0\ud615\n///             if let balance = viewModel.calorieBalance {\n///                 HStack {\n///                     Image(systemName: viewModel.calorieBalanceStatusIcon())\n///                         .foregroundColor(viewModel.calorieBalanceStatusColor())\n///                     Text(viewModel.calorieBalanceStatusText())\n///                     Text(viewModel.formatCalorieBalance(balance))\n///                 }\n///             }\n///\n///             // \uc608\uc0c1 \uccb4\uc911 \ubcc0\ud654\n///             if let change = viewModel.estimatedWeeklyWeightChange {\n///                 Text(\"\uc608\uc0c1 \uccb4\uc911 \ubcc0\ud654: \\(viewModel.formatWeightChange(change))\")\n///             }\n///         }\n///         .task {\n///             await viewModel.loadCurrentMetabolism()\n///         }\n///     }\n/// }\n/// ```\n///\n/// \ud83d\udca1 Android ViewModel\uacfc\uc758 \ube44\uad50:\n/// - Android: ViewModel + StateFlow + Dashboard data\n/// - SwiftUI: ObservableObject + @Published + Dashboard data\n/// - Android: combine\uc73c\ub85c \uc5ec\ub7ec Flow \uacb0\ud569\n/// - SwiftUI: Computed properties\ub85c \uc5ec\ub7ec \uc0c1\ud0dc \uacb0\ud569\n///\n",
        "last_modified": "2026-01-14T22:58:13.159025"
      },
      "task_intent": {
        "title": "Body Composition Tracking with BMR/TDEE",
        "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
        "from_plan": true
      },
      "commits_behind_main": 1,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:04.746320",
  "last_updated": "2026-01-13T07:46:22.987165"
}