{
  "file_path": "Bodii/Domain/UseCases/Exercise/AddExerciseRecordUseCase.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  AddExerciseRecordUseCase.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\nimport Foundation\n\n/// \uc6b4\ub3d9 \uae30\ub85d \ucd94\uac00 \uc720\uc2a4\ucf00\uc774\uc2a4\n///\n/// \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc0dd\uc131\ud558\uace0, \uce7c\ub85c\ub9ac\ub97c \uacc4\uc0b0\ud558\uc5ec DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n///\n/// ## \ucc45\uc784\n/// - \uc6b4\ub3d9 \uc785\ub825\uac12 \uac80\uc99d (duration \ucd5c\uc18c 1\ubd84)\n/// - \uc0ac\uc6a9\uc790 \uccb4\uc911 \ud655\uc778 (MET \uacc4\uc0b0\uc5d0 \ud544\uc694)\n/// - MET \uae30\ubc18 \uce7c\ub85c\ub9ac \uacc4\uc0b0\n/// - ExerciseRecord \uc0dd\uc131 \ubc0f \uc800\uc7a5\n/// - DailyLog \uc5c5\ub370\uc774\ud2b8\n///\n/// ## \uc758\uc874\uc131\n/// - ExerciseRecordRepository: \uc6b4\ub3d9 \uae30\ub85d \uc800\uc7a5\n/// - DailyLogService: DailyLog \uc5c5\ub370\uc774\ud2b8\n///\n/// ## \uc0ac\uc6a9 \uc2dc\ub098\ub9ac\uc624\n/// ```swift\n/// let useCase = AddExerciseRecordUseCase(\n///     exerciseRepository: exerciseRepository,\n///     dailyLogService: dailyLogService\n/// )\n///\n/// let record = try await useCase.execute(\n///     userId: userId,\n///     date: Date(),\n///     exerciseType: .running,\n///     duration: 30,\n///     intensity: .high,\n///     note: \"\uc544\uce68 \uc870\uae45\",\n///     userWeight: user.currentWeight ?? 70.0,\n///     userBMR: user.currentBMR ?? 1650,\n///     userTDEE: user.currentTDEE ?? 2310\n/// )\n/// ```\n///\n/// ## \uc5d0\ub7ec \ucf00\uc774\uc2a4\n/// - duration < 1\ubd84: ValidationError\n/// - userWeight\uac00 nil: InsufficientDataError\nfinal class AddExerciseRecordUseCase {\n\n    // MARK: - Properties\n\n    /// \uc6b4\ub3d9 \uae30\ub85d \uc800\uc7a5\uc18c\n    private let exerciseRepository: ExerciseRecordRepository\n\n    /// DailyLog \uad00\ub9ac \uc11c\ube44\uc2a4\n    private let dailyLogService: DailyLogService\n\n    // MARK: - Initialization\n\n    /// AddExerciseRecordUseCase \ucd08\uae30\ud654\n    ///\n    /// - Parameters:\n    ///   - exerciseRepository: \uc6b4\ub3d9 \uae30\ub85d \uc800\uc7a5\uc18c\n    ///   - dailyLogService: DailyLog \uad00\ub9ac \uc11c\ube44\uc2a4\n    init(\n        exerciseRepository: ExerciseRecordRepository,\n        dailyLogService: DailyLogService\n    ) {\n        self.exerciseRepository = exerciseRepository\n        self.dailyLogService = dailyLogService\n    }\n\n    // MARK: - Public Methods\n\n    /// \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uae30\ub85d\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.\n    ///\n    /// ## \uc2e4\ud589 \uc21c\uc11c\n    /// 1. \uc785\ub825\uac12 \uac80\uc99d (duration \u2265 1\ubd84)\n    /// 2. MET \uae30\ubc18 \uce7c\ub85c\ub9ac \uacc4\uc0b0\n    /// 3. ExerciseRecord \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\n    /// 4. ExerciseRecordRepository\ub97c \ud1b5\ud574 \uc800\uc7a5\n    /// 5. DailyLogService\ub97c \ud1b5\ud574 DailyLog \uc5c5\ub370\uc774\ud2b8\n    ///\n    /// - Parameters:\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - date: \uc6b4\ub3d9\uc77c\n    ///   - exerciseType: \uc6b4\ub3d9 \uc885\ub958\n    ///   - duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    ///   - intensity: \uc6b4\ub3d9 \uac15\ub3c4\n    ///   - note: \uba54\ubaa8 (\uc120\ud0dd\uc0ac\ud56d)\n    ///   - userWeight: \uc0ac\uc6a9\uc790 \uccb4\uc911 (kg) - MET \uacc4\uc0b0\uc5d0 \uc0ac\uc6a9\n    ///   - userBMR: \uc0ac\uc6a9\uc790 BMR - DailyLog \uc0dd\uc131 \uc2dc \uc0ac\uc6a9\n    ///   - userTDEE: \uc0ac\uc6a9\uc790 TDEE - DailyLog \uc0dd\uc131 \uc2dc \uc0ac\uc6a9\n    ///\n    /// - Throws:\n    ///   - ValidationError: \uc785\ub825\uac12\uc774 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc744 \ub54c\n    ///   - InsufficientDataError: \ud544\uc218 \ub370\uc774\ud130(\uccb4\uc911)\uac00 \uc5c6\uc744 \ub54c\n    ///   - RepositoryError: \uc800\uc7a5 \uc2e4\ud328 \uc2dc\n    ///\n    /// - Returns: \uc0dd\uc131\ub41c ExerciseRecord\n    ///\n    /// - Example:\n    /// ```swift\n    /// do {\n    ///     let record = try await useCase.execute(\n    ///         userId: user.id,\n    ///         date: Date(),\n    ///         exerciseType: .running,\n    ///         duration: 30,\n    ///         intensity: .high,\n    ///         note: \"\uc544\uce68 \uc870\uae45\",\n    ///         userWeight: user.currentWeight ?? 70.0,\n    ///         userBMR: user.currentBMR ?? 1650,\n    ///         userTDEE: user.currentTDEE ?? 2310\n    ///     )\n    ///     print(\"\uc6b4\ub3d9 \uae30\ub85d \uc0dd\uc131: \\(record.caloriesBurned)kcal\")\n    /// } catch {\n    ///     print(\"\uc6b4\ub3d9 \uae30\ub85d \uc2e4\ud328: \\(error)\")\n    /// }\n    /// ```\n    func execute(\n        userId: UUID,\n        date: Date,\n        exerciseType: ExerciseType,\n        duration: Int32,\n        intensity: Intensity,\n        note: String? = nil,\n        userWeight: Decimal,\n        userBMR: Decimal,\n        userTDEE: Decimal\n    ) async throws -> ExerciseRecord {\n        // 1. \uc785\ub825\uac12 \uac80\uc99d\n        try validateInput(duration: duration)\n\n        // 2. MET \uae30\ubc18 \uce7c\ub85c\ub9ac \uacc4\uc0b0\n        let caloriesBurned = ExerciseCalcService.calculateCalories(\n            exerciseType: exerciseType,\n            duration: duration,\n            intensity: intensity,\n            weight: userWeight\n        )\n\n        // 3. ExerciseRecord \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\n        let record = ExerciseRecord(\n            id: UUID(),\n            userId: userId,\n            date: date,\n            exerciseType: exerciseType,\n            duration: duration,\n            intensity: intensity,\n            caloriesBurned: caloriesBurned,\n            createdAt: Date()\n        )\n\n        // 4. ExerciseRecord \uc800\uc7a5\n        let savedRecord = try await exerciseRepository.create(record)\n\n        // 5. DailyLog \uc5c5\ub370\uc774\ud2b8\n        try await dailyLogService.addExercise(\n            date: savedRecord.date,\n            userId: userId,\n            calories: savedRecord.caloriesBurned,\n            duration: savedRecord.duration,\n            userBMR: userBMR,\n            userTDEE: userTDEE\n        )\n\n        return savedRecord\n    }\n\n    // MARK: - Private Methods\n\n    /// \uc785\ub825\uac12\uc744 \uac80\uc99d\ud569\ub2c8\ub2e4.\n    ///\n    /// ## \uac80\uc99d \uaddc\uce59\n    /// - duration: \ucd5c\uc18c 1\ubd84 \uc774\uc0c1\n    ///\n    /// - Parameter duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: ValidationError - \uac80\uc99d \uc2e4\ud328 \uc2dc\n    private func validateInput(duration: Int32) throws {\n        // \uc6b4\ub3d9 \uc2dc\uac04\uc740 \ucd5c\uc18c 1\ubd84 \uc774\uc0c1\n        guard duration >= 1 else {\n            throw ValidationError.invalidDuration(\"\ucd5c\uc18c 1\ubd84 \uc774\uc0c1 \uc785\ub825\ud574\uc8fc\uc138\uc694\")\n        }\n    }\n}\n\n// MARK: - Error Types\n\n/// \uac80\uc99d \uc5d0\ub7ec\nenum ValidationError: LocalizedError {\n    case invalidDuration(String)\n\n    var errorDescription: String? {\n        switch self {\n        case .invalidDuration(let message):\n            return message\n        }\n    }\n}\n\n// MARK: - UseCase Pattern \uc124\uba85\n\n/// ## UseCase Pattern\uc774\ub780?\n///\n/// UseCase\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \ucea1\uc290\ud654\ud558\uace0 \uc5ec\ub7ec Repository\uc640 Service\ub97c \uc870\uc815\ud558\ub294 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4.\n///\n/// ### UseCase vs Service vs Repository\n///\n/// **Repository**:\n/// - \ub2e8\uc77c \uc5d4\ud2f0\ud2f0\uc758 CRUD \uc791\uc5c5\n/// - \ub370\uc774\ud130 \uc601\uc18d\uc131\uc5d0 \uc9d1\uc911\n/// - \uc608: ExerciseRecordRepository (ExerciseRecord\ub9cc \uad00\ub9ac)\n///\n/// **Service**:\n/// - \ub3c4\uba54\uc778 \ub85c\uc9c1 \ucea1\uc290\ud654\n/// - \uc5ec\ub7ec \uc5d4\ud2f0\ud2f0 \uac04 \uc870\uc815\n/// - \uc608: DailyLogService (DailyLog \uc0dd\uc131 \ubc0f \uc5c5\ub370\uc774\ud2b8)\n///\n/// **UseCase**:\n/// - \uc0ac\uc6a9\uc790 \uc561\uc158\uc5d0 \ub300\ud55c \ube44\uc988\ub2c8\uc2a4 \ud50c\ub85c\uc6b0 \uc815\uc758\n/// - \uc5ec\ub7ec Repository\uc640 Service\ub97c \uc870\uc728\n/// - \uc785\ub825 \uac80\uc99d \ubc0f \uc5d0\ub7ec \ucc98\ub9ac\n/// - \uc608: AddExerciseRecordUseCase (\uc6b4\ub3d9 \uae30\ub85d \ucd94\uac00 \uc804\uccb4 \ud50c\ub85c\uc6b0)\n///\n/// ### \uc0ac\uc6a9 \uc608\uc2dc\n///\n/// ```swift\n/// // ViewModel\uc5d0\uc11c UseCase \uc0ac\uc6a9\n/// final class ExerciseInputViewModel: ObservableObject {\n///     let addExerciseUseCase: AddExerciseRecordUseCase\n///\n///     func saveExercise() async {\n///         do {\n///             // UseCase\uac00 \ubaa8\ub4e0 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ucc98\ub9ac\n///             let record = try await addExerciseUseCase.execute(\n///                 userId: currentUser.id,\n///                 date: selectedDate,\n///                 exerciseType: selectedType,\n///                 duration: duration,\n///                 intensity: intensity,\n///                 note: note,\n///                 userWeight: currentUser.currentWeight ?? 70.0,\n///                 userBMR: currentUser.currentBMR ?? 1650,\n///                 userTDEE: currentUser.currentTDEE ?? 2310\n///             )\n///             // UI \uc5c5\ub370\uc774\ud2b8\ub9cc \ub2f4\ub2f9\n///             self.isSuccess = true\n///         } catch {\n///             self.errorMessage = error.localizedDescription\n///         }\n///     }\n/// }\n/// ```\n///\n/// ### \uc65c UseCase\uac00 \ud544\uc694\ud55c\uac00?\n///\n/// 1. **\ub2e8\uc77c \ucc45\uc784 \uc6d0\uce59**:\n///    - ViewModel\uc740 UI \ub85c\uc9c1\uc5d0\ub9cc \uc9d1\uc911\n///    - UseCase\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc5d0\ub9cc \uc9d1\uc911\n///\n/// 2. **\uc7ac\uc0ac\uc6a9\uc131**:\n///    - AddExerciseRecordUseCase\ub294 \uc5ec\ub7ec ViewModel\uc5d0\uc11c \uc7ac\uc0ac\uc6a9 \uac00\ub2a5\n///    - \uc704\uc82f, \ubc31\uadf8\ub77c\uc6b4\ub4dc \uc791\uc5c5, Siri Shortcut \ub4f1 \ub2e4\uc591\ud55c \uc9c4\uc785\uc810\uc5d0\uc11c \uc0ac\uc6a9\n///\n/// 3. **\ud14c\uc2a4\ud2b8 \uc6a9\uc774\uc131**:\n///    - UseCase \ub2e8\uc704\ub85c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ud14c\uc2a4\ud2b8 \uac00\ub2a5\n///    - Repository\uc640 Service\ub97c Mock\uc73c\ub85c \ub300\uccb4\ud558\uc5ec \uaca9\ub9ac\ub41c \ud14c\uc2a4\ud2b8\n///\n/// 4. **\ubcc0\uacbd \uaca9\ub9ac**:\n///    - \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ubcc0\uacbd \uc2dc UseCase\ub9cc \uc218\uc815\n///    - ViewModel\uacfc UI\ub294 \uc601\ud5a5 \ubc1b\uc9c0 \uc54a\uc74c\n///\n/// 5. **\ubcf5\uc7a1\ub3c4 \uad00\ub9ac**:\n///    - \ubcf5\uc7a1\ud55c \ud50c\ub85c\uc6b0\ub97c UseCase\uc5d0 \ucea1\uc290\ud654\n///    - ViewModel\uc740 \uac04\uacb0\ud558\uac8c \uc720\uc9c0\n///\n/// ### Clean Architecture \uacc4\uce35\n///\n/// ```\n/// [Presentation]     ViewModel \u2192 UseCase\ub97c \ud638\ucd9c\n///       \u2193\n/// [Domain]          UseCase \u2192 Repository/Service \uc870\uc728\n///       \u2193\n/// [Data]            Repository \u2192 DataSource \ud638\ucd9c\n/// ```\n",
        "last_modified": "2026-01-14T22:54:09.702110"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:06.176075",
  "last_updated": "2026-01-14T11:45:41.923424"
}