{
  "file_path": "BodiiTests/DailyLogServiceTests.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  DailyLogServiceTests.swift\n//  BodiiTests\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\nimport XCTest\n@testable import Bodii\n\n/// Unit tests for DailyLogService exercise updates\n///\n/// DailyLogService \uc6b4\ub3d9 \ub370\uc774\ud130 \uc5c5\ub370\uc774\ud2b8\uc5d0 \ub300\ud55c \ub2e8\uc704 \ud14c\uc2a4\ud2b8\nfinal class DailyLogServiceTests: XCTestCase {\n\n    // MARK: - Properties\n\n    var service: DailyLogService!\n    var mockRepository: MockDailyLogRepository!\n    let testUserId = UUID()\n    let testDate = Date()\n\n    // MARK: - Setup & Teardown\n\n    override func setUp() {\n        super.setUp()\n        mockRepository = MockDailyLogRepository()\n        service = DailyLogService(repository: mockRepository)\n    }\n\n    override func tearDown() {\n        service = nil\n        mockRepository = nil\n        super.tearDown()\n    }\n\n    // MARK: - Add Exercise Tests\n\n    /// Test: Adding exercise updates totals correctly\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \ucd94\uac00 \uc2dc \ud569\uacc4\uac00 \uc62c\ubc14\ub974\uac8c \uc5c5\ub370\uc774\ud2b8\ub428\n    func testAddExercise_ValidData_UpdatesTotalsCorrectly() async throws {\n        // Given: Initial DailyLog with zero exercise data\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 0,\n            exerciseMinutes: 0,\n            exerciseCount: 0\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Adding exercise (350 kcal, 30 minutes)\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 350,\n            duration: 30,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Totals should be incremented\n        XCTAssertEqual(\n            mockRepository.lastAddedCalories,\n            350,\n            \"Should add 350 kcal to totalCaloriesOut\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastAddedDuration,\n            30,\n            \"Should add 30 minutes to exerciseMinutes\"\n        )\n        XCTAssertTrue(\n            mockRepository.addExerciseCalled,\n            \"addExercise should be called on repository\"\n        )\n    }\n\n    /// Test: Adding multiple exercises accumulates correctly\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc5ec\ub7ec \uc6b4\ub3d9 \ucd94\uac00 \uc2dc \ub204\uc801 \uacc4\uc0b0\uc774 \uc62c\ubc14\ub984\n    func testAddExercise_MultipleExercises_AccumulatesCorrectly() async throws {\n        // Given: Initial DailyLog with some exercise data\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 200,\n            exerciseMinutes: 20,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Adding first exercise (150 kcal, 15 minutes)\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 150,\n            duration: 15,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // When: Adding second exercise (280 kcal, 30 minutes)\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 280,\n            duration: 30,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Should have called addExercise twice\n        XCTAssertEqual(\n            mockRepository.addExerciseCallCount,\n            2,\n            \"addExercise should be called twice\"\n        )\n    }\n\n    /// Test: Adding exercise with high calorie burn\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uace0\uce7c\ub85c\ub9ac \uc6b4\ub3d9 \ucd94\uac00\n    func testAddExercise_HighCalorieBurn_UpdatesCorrectly() async throws {\n        // Given: Initial DailyLog with zero exercise data\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 0,\n            exerciseMinutes: 0,\n            exerciseCount: 0\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Adding intense exercise (800 kcal, 90 minutes - long run)\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 800,\n            duration: 90,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Should add large values correctly\n        XCTAssertEqual(\n            mockRepository.lastAddedCalories,\n            800,\n            \"Should add 800 kcal to totalCaloriesOut\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastAddedDuration,\n            90,\n            \"Should add 90 minutes to exerciseMinutes\"\n        )\n    }\n\n    /// Test: Adding exercise creates DailyLog if not exists\n    ///\n    /// \ud14c\uc2a4\ud2b8: DailyLog\uac00 \uc5c6\uc744 \ub54c \uc790\ub3d9 \uc0dd\uc131 \ud6c4 \uc6b4\ub3d9 \ucd94\uac00\n    func testAddExercise_NoDailyLog_CreatesAndAdds() async throws {\n        // Given: No existing DailyLog\n        mockRepository.dailyLog = nil\n\n        // When: Adding exercise\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 250,\n            duration: 25,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Should create DailyLog first, then add exercise\n        XCTAssertTrue(\n            mockRepository.getOrCreateCalled,\n            \"getOrCreate should be called to create DailyLog\"\n        )\n        XCTAssertTrue(\n            mockRepository.addExerciseCalled,\n            \"addExercise should be called after creation\"\n        )\n    }\n\n    // MARK: - Remove Exercise Tests\n\n    /// Test: Removing exercise decrements totals correctly\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc \ud569\uacc4\uac00 \uc62c\ubc14\ub974\uac8c \uac10\uc18c\ud568\n    func testRemoveExercise_ValidData_DecrementsTotalsCorrectly() async throws {\n        // Given: DailyLog with existing exercise data\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 500,\n            exerciseMinutes: 60,\n            exerciseCount: 2\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Removing exercise (250 kcal, 30 minutes)\n        try await service.removeExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 250,\n            duration: 30\n        )\n\n        // Then: Totals should be decremented\n        XCTAssertEqual(\n            mockRepository.lastRemovedCalories,\n            250,\n            \"Should remove 250 kcal from totalCaloriesOut\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastRemovedDuration,\n            30,\n            \"Should remove 30 minutes from exerciseMinutes\"\n        )\n        XCTAssertTrue(\n            mockRepository.removeExerciseCalled,\n            \"removeExercise should be called on repository\"\n        )\n    }\n\n    /// Test: Removing exercise decrements exerciseCount by 1\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc exerciseCount\uac00 1 \uac10\uc18c\n    func testRemoveExercise_DecrementCount_ReducesByOne() async throws {\n        // Given: DailyLog with 3 exercises\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 900,\n            exerciseMinutes: 90,\n            exerciseCount: 3\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Removing one exercise\n        try await service.removeExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 300,\n            duration: 30\n        )\n\n        // Then: Count should be decremented\n        XCTAssertTrue(\n            mockRepository.removeExerciseCalled,\n            \"removeExercise should be called\"\n        )\n    }\n\n    /// Test: Removing all exercises leaves zero totals\n    ///\n    /// \ud14c\uc2a4\ud2b8: \ubaa8\ub4e0 \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc \ud569\uacc4\uac00 0\uc774 \ub428\n    func testRemoveExercise_RemoveAll_LeavesZeroTotals() async throws {\n        // Given: DailyLog with one exercise (280 kcal, 30 minutes, 1 count)\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 280,\n            exerciseMinutes: 30,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Removing the only exercise\n        try await service.removeExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 280,\n            duration: 30\n        )\n\n        // Then: Should attempt to remove all values\n        XCTAssertEqual(\n            mockRepository.lastRemovedCalories,\n            280,\n            \"Should remove 280 kcal\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastRemovedDuration,\n            30,\n            \"Should remove 30 minutes\"\n        )\n    }\n\n    /// Test: Removing exercise with low values\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc791\uc740 \uac12\uc758 \uc6b4\ub3d9 \uc0ad\uc81c\n    func testRemoveExercise_LowValues_RemovesCorrectly() async throws {\n        // Given: DailyLog with minimal exercise (10 kcal, 5 minutes)\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 10,\n            exerciseMinutes: 5,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Removing the minimal exercise\n        try await service.removeExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 10,\n            duration: 5\n        )\n\n        // Then: Should remove small values correctly\n        XCTAssertEqual(\n            mockRepository.lastRemovedCalories,\n            10,\n            \"Should remove 10 kcal\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastRemovedDuration,\n            5,\n            \"Should remove 5 minutes\"\n        )\n    }\n\n    // MARK: - Update Exercise Tests\n\n    /// Test: Updating exercise adjusts difference correctly\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc \ucc28\uc774\uac12\uc774 \uc62c\ubc14\ub974\uac8c \uc801\uc6a9\ub428\n    func testUpdateExercise_IncreasedValues_AdjustsDifferenceCorrectly() async throws {\n        // Given: DailyLog with existing exercise\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 350,\n            exerciseMinutes: 30,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating exercise (old: 350 kcal, 30 min \u2192 new: 500 kcal, 45 min)\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 350,\n            newCalories: 500,\n            oldDuration: 30,\n            newDuration: 45\n        )\n\n        // Then: Should add the difference (+150 kcal, +15 min)\n        XCTAssertEqual(\n            mockRepository.lastOldCalories,\n            350,\n            \"Should store old calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewCalories,\n            500,\n            \"Should store new calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastOldDuration,\n            30,\n            \"Should store old duration\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewDuration,\n            45,\n            \"Should store new duration\"\n        )\n        XCTAssertTrue(\n            mockRepository.updateExerciseCalled,\n            \"updateExercise should be called on repository\"\n        )\n    }\n\n    /// Test: Updating exercise with decreased values\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc \uac12\uc774 \uac10\uc18c\ud55c \uacbd\uc6b0\n    func testUpdateExercise_DecreasedValues_AdjustsDifferenceCorrectly() async throws {\n        // Given: DailyLog with existing exercise\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 500,\n            exerciseMinutes: 60,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating exercise (old: 500 kcal, 60 min \u2192 new: 300 kcal, 40 min)\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 500,\n            newCalories: 300,\n            oldDuration: 60,\n            newDuration: 40\n        )\n\n        // Then: Should subtract the difference (-200 kcal, -20 min)\n        XCTAssertEqual(\n            mockRepository.lastOldCalories,\n            500,\n            \"Should store old calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewCalories,\n            300,\n            \"Should store new calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastOldDuration,\n            60,\n            \"Should store old duration\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewDuration,\n            40,\n            \"Should store new duration\"\n        )\n    }\n\n    /// Test: Updating exercise with same values (no change)\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc \uac12\uc774 \ub3d9\uc77c\ud55c \uacbd\uc6b0 (\ubcc0\uacbd \uc5c6\uc74c)\n    func testUpdateExercise_SameValues_AdjustsZeroDifference() async throws {\n        // Given: DailyLog with existing exercise\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 400,\n            exerciseMinutes: 45,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating exercise with same values (old == new)\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 400,\n            newCalories: 400,\n            oldDuration: 45,\n            newDuration: 45\n        )\n\n        // Then: Should apply zero difference (no actual change)\n        XCTAssertEqual(\n            mockRepository.lastOldCalories,\n            400,\n            \"Should store old calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewCalories,\n            400,\n            \"Should store new calories\"\n        )\n        XCTAssertTrue(\n            mockRepository.updateExerciseCalled,\n            \"updateExercise should still be called\"\n        )\n    }\n\n    /// Test: Updating exercise only changes calories\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc \uce7c\ub85c\ub9ac\ub9cc \ubcc0\uacbd\n    func testUpdateExercise_OnlyCaloriesChanged_AdjustsCorrectly() async throws {\n        // Given: DailyLog with existing exercise\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 300,\n            exerciseMinutes: 30,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating only calories (duration unchanged)\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 300,\n            newCalories: 450,\n            oldDuration: 30,\n            newDuration: 30\n        )\n\n        // Then: Should adjust only calories (+150 kcal, +0 min)\n        XCTAssertEqual(\n            mockRepository.lastOldCalories,\n            300,\n            \"Should store old calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewCalories,\n            450,\n            \"Should store new calories\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastOldDuration,\n            30,\n            \"Duration should remain same\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewDuration,\n            30,\n            \"Duration should remain same\"\n        )\n    }\n\n    /// Test: Updating exercise only changes duration\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc \uc2dc\uac04\ub9cc \ubcc0\uacbd\n    func testUpdateExercise_OnlyDurationChanged_AdjustsCorrectly() async throws {\n        // Given: DailyLog with existing exercise\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 350,\n            exerciseMinutes: 30,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating only duration (calories unchanged)\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 350,\n            newCalories: 350,\n            oldDuration: 30,\n            newDuration: 45\n        )\n\n        // Then: Should adjust only duration (+0 kcal, +15 min)\n        XCTAssertEqual(\n            mockRepository.lastOldCalories,\n            350,\n            \"Calories should remain same\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewCalories,\n            350,\n            \"Calories should remain same\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastOldDuration,\n            30,\n            \"Should store old duration\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastNewDuration,\n            45,\n            \"Should store new duration\"\n        )\n    }\n\n    /// Test: Updating exercise does not change exerciseCount\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc218\uc815 \uc2dc exerciseCount\ub294 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc74c\n    func testUpdateExercise_DoesNotChangeCount() async throws {\n        // Given: DailyLog with 2 exercises\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 600,\n            exerciseMinutes: 60,\n            exerciseCount: 2\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Updating one exercise\n        try await service.updateExercise(\n            date: testDate,\n            userId: testUserId,\n            oldCalories: 300,\n            newCalories: 400,\n            oldDuration: 30,\n            newDuration: 40\n        )\n\n        // Then: exerciseCount should not be passed to updateExercise\n        // (updateExercise only takes calories and duration, not count)\n        XCTAssertTrue(\n            mockRepository.updateExerciseCalled,\n            \"updateExercise should be called\"\n        )\n        // Note: The repository method signature confirms count is not modified\n    }\n\n    // MARK: - ExerciseCount Tests\n\n    /// Test: Adding exercise increments exerciseCount\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \ucd94\uac00 \uc2dc exerciseCount \uc99d\uac00 \ud655\uc778\n    func testAddExercise_IncrementsExerciseCount() async throws {\n        // Given: DailyLog with 2 exercises\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 500,\n            exerciseMinutes: 50,\n            exerciseCount: 2\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Adding a new exercise\n        try await service.addExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 280,\n            duration: 30,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Repository should receive the add request\n        // (exerciseCount incrementation happens in repository/data source)\n        XCTAssertTrue(\n            mockRepository.addExerciseCalled,\n            \"addExercise should be called (count incremented in repository)\"\n        )\n    }\n\n    /// Test: Removing exercise decrements exerciseCount\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc exerciseCount \uac10\uc18c \ud655\uc778\n    func testRemoveExercise_DecrementsExerciseCount() async throws {\n        // Given: DailyLog with 3 exercises\n        let initialLog = createDailyLog(\n            totalCaloriesOut: 750,\n            exerciseMinutes: 75,\n            exerciseCount: 3\n        )\n        mockRepository.dailyLog = initialLog\n\n        // When: Removing one exercise\n        try await service.removeExercise(\n            date: testDate,\n            userId: testUserId,\n            calories: 250,\n            duration: 25\n        )\n\n        // Then: Repository should receive the remove request\n        // (exerciseCount decrementation happens in repository/data source)\n        XCTAssertTrue(\n            mockRepository.removeExerciseCalled,\n            \"removeExercise should be called (count decremented in repository)\"\n        )\n    }\n\n    // MARK: - GetOrCreate Tests\n\n    /// Test: getOrCreate returns existing DailyLog\n    ///\n    /// \ud14c\uc2a4\ud2b8: getOrCreate\uac00 \uae30\uc874 DailyLog\ub97c \ubc18\ud658\n    func testGetOrCreate_ExistingLog_ReturnsExisting() async throws {\n        // Given: Existing DailyLog\n        let existingLog = createDailyLog(\n            totalCaloriesOut: 300,\n            exerciseMinutes: 30,\n            exerciseCount: 1\n        )\n        mockRepository.dailyLog = existingLog\n\n        // When: Calling getOrCreate\n        let result = try await service.getOrCreate(\n            for: testDate,\n            userId: testUserId,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Should return existing log\n        XCTAssertEqual(\n            result.id,\n            existingLog.id,\n            \"Should return existing DailyLog\"\n        )\n        XCTAssertTrue(\n            mockRepository.getOrCreateCalled,\n            \"getOrCreate should be called on repository\"\n        )\n    }\n\n    /// Test: getOrCreate creates new DailyLog when not exists\n    ///\n    /// \ud14c\uc2a4\ud2b8: getOrCreate\uac00 \uc5c6\uc744 \ub54c \uc0c8\ub85c \uc0dd\uc131\n    func testGetOrCreate_NoLog_CreatesNew() async throws {\n        // Given: No existing DailyLog\n        mockRepository.dailyLog = nil\n        mockRepository.shouldCreateNew = true\n\n        // When: Calling getOrCreate\n        let result = try await service.getOrCreate(\n            for: testDate,\n            userId: testUserId,\n            userBMR: 1650,\n            userTDEE: 2310\n        )\n\n        // Then: Should create new DailyLog\n        XCTAssertNotNil(result, \"Should create new DailyLog\")\n        XCTAssertTrue(\n            mockRepository.getOrCreateCalled,\n            \"getOrCreate should be called on repository\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastCreatedBMR,\n            1650,\n            \"Should use provided BMR\"\n        )\n        XCTAssertEqual(\n            mockRepository.lastCreatedTDEE,\n            2310,\n            \"Should use provided TDEE\"\n        )\n    }\n\n    // MARK: - Helper Methods\n\n    /// Creates a test DailyLog with specified exercise data\n    ///\n    /// \ud14c\uc2a4\ud2b8\uc6a9 DailyLog \uc0dd\uc131\n    private func createDailyLog(\n        totalCaloriesOut: Int32,\n        exerciseMinutes: Int32,\n        exerciseCount: Int16\n    ) -> DailyLog {\n        return DailyLog(\n            id: UUID(),\n            userId: testUserId,\n            date: testDate,\n            totalCaloriesIn: 0,\n            totalCarbs: 0,\n            totalProtein: 0,\n            totalFat: 0,\n            carbsRatio: nil,\n            proteinRatio: nil,\n            fatRatio: nil,\n            bmr: 1650,\n            tdee: 2310,\n            netCalories: -2310,\n            totalCaloriesOut: totalCaloriesOut,\n            exerciseMinutes: exerciseMinutes,\n            exerciseCount: exerciseCount,\n            steps: nil,\n            weight: nil,\n            bodyFatPct: nil,\n            sleepDuration: nil,\n            sleepStatus: nil,\n            createdAt: Date(),\n            updatedAt: Date()\n        )\n    }\n}\n\n// MARK: - MockDailyLogRepository\n\n/// Mock implementation of DailyLogRepository for testing\n///\n/// \ud14c\uc2a4\ud2b8\uc6a9 DailyLogRepository Mock \uad6c\ud604\nclass MockDailyLogRepository: DailyLogRepository {\n\n    // MARK: - Test Data\n\n    var dailyLog: DailyLog?\n    var shouldCreateNew = false\n\n    // MARK: - Call Tracking\n\n    var getOrCreateCalled = false\n    var addExerciseCalled = false\n    var removeExerciseCalled = false\n    var updateExerciseCalled = false\n\n    var addExerciseCallCount = 0\n\n    // MARK: - Captured Parameters\n\n    var lastCreatedBMR: Int32?\n    var lastCreatedTDEE: Int32?\n\n    var lastAddedCalories: Int32?\n    var lastAddedDuration: Int32?\n\n    var lastRemovedCalories: Int32?\n    var lastRemovedDuration: Int32?\n\n    var lastOldCalories: Int32?\n    var lastNewCalories: Int32?\n    var lastOldDuration: Int32?\n    var lastNewDuration: Int32?\n\n    // MARK: - DailyLogRepository Implementation\n\n    func getOrCreate(for date: Date, userId: UUID, bmr: Int32, tdee: Int32) async throws -> DailyLog {\n        getOrCreateCalled = true\n        lastCreatedBMR = bmr\n        lastCreatedTDEE = tdee\n\n        if let existing = dailyLog {\n            return existing\n        }\n\n        if shouldCreateNew {\n            // Create new DailyLog for test\n            let newLog = DailyLog(\n                id: UUID(),\n                userId: userId,\n                date: date,\n                totalCaloriesIn: 0,\n                totalCarbs: 0,\n                totalProtein: 0,\n                totalFat: 0,\n                carbsRatio: nil,\n                proteinRatio: nil,\n                fatRatio: nil,\n                bmr: bmr,\n                tdee: tdee,\n                netCalories: -tdee,\n                totalCaloriesOut: 0,\n                exerciseMinutes: 0,\n                exerciseCount: 0,\n                steps: nil,\n                weight: nil,\n                bodyFatPct: nil,\n                sleepDuration: nil,\n                sleepStatus: nil,\n                createdAt: Date(),\n                updatedAt: Date()\n            )\n            dailyLog = newLog\n            return newLog\n        }\n\n        throw NSError(domain: \"MockRepository\", code: 404, userInfo: [NSLocalizedDescriptionKey: \"Not found\"])\n    }\n\n    func fetch(for date: Date, userId: UUID) async throws -> DailyLog? {\n        return dailyLog\n    }\n\n    func update(_ dailyLog: DailyLog) async throws -> DailyLog {\n        self.dailyLog = dailyLog\n        return dailyLog\n    }\n\n    func addExercise(date: Date, userId: UUID, calories: Int32, duration: Int32) async throws {\n        addExerciseCalled = true\n        addExerciseCallCount += 1\n        lastAddedCalories = calories\n        lastAddedDuration = duration\n\n        // Simulate repository behavior: increment totals\n        if var log = dailyLog {\n            log.totalCaloriesOut += calories\n            log.exerciseMinutes += duration\n            log.exerciseCount += 1\n            dailyLog = log\n        }\n    }\n\n    func removeExercise(date: Date, userId: UUID, calories: Int32, duration: Int32) async throws {\n        removeExerciseCalled = true\n        lastRemovedCalories = calories\n        lastRemovedDuration = duration\n\n        // Simulate repository behavior: decrement totals\n        if var log = dailyLog {\n            log.totalCaloriesOut = max(0, log.totalCaloriesOut - calories)\n            log.exerciseMinutes = max(0, log.exerciseMinutes - duration)\n            log.exerciseCount = max(0, log.exerciseCount - 1)\n            dailyLog = log\n        }\n    }\n\n    func updateExercise(\n        date: Date,\n        userId: UUID,\n        oldCalories: Int32,\n        newCalories: Int32,\n        oldDuration: Int32,\n        newDuration: Int32\n    ) async throws {\n        updateExerciseCalled = true\n        lastOldCalories = oldCalories\n        lastNewCalories = newCalories\n        lastOldDuration = oldDuration\n        lastNewDuration = newDuration\n\n        // Simulate repository behavior: adjust difference\n        if var log = dailyLog {\n            let caloriesDiff = newCalories - oldCalories\n            let durationDiff = newDuration - oldDuration\n\n            log.totalCaloriesOut += caloriesDiff\n            log.exerciseMinutes += durationDiff\n            // Note: exerciseCount is NOT modified during update\n            dailyLog = log\n        }\n    }\n}\n",
        "last_modified": "2026-01-14T22:54:09.705967"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:06.081069",
  "last_updated": "2026-01-14T11:45:41.964443"
}