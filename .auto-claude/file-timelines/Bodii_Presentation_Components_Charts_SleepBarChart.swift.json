{
  "file_path": "Bodii/Presentation/Components/Charts/SleepBarChart.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepBarChart.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Swift Charts Bar Chart with Status-Based Coloring\n// Swift Charts \ud504\ub808\uc784\uc6cc\ud06c\ub97c \uc0ac\uc6a9\ud55c \uc218\uba74 \uc2dc\uac04 \ubc14 \ucc28\ud2b8 + \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \uad6c\ubd84\n// \ud83d\udca1 Java \ube44\uad50: Android\uc758 MPAndroidChart, iOS Charts\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \uad6c\ubd84 \uae30\ub2a5 \ud3ec\ud568\n\nimport SwiftUI\nimport Charts\n\n// MARK: - SleepBarChart\n\n/// \uc218\uba74 \uc2dc\uac04\uc744 \ud45c\uc2dc\ud558\ub294 \ubc14 \ucc28\ud2b8 \ucef4\ud3ec\ub10c\ud2b8\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Swift Charts Integration with Status Colors\n/// - Swift Charts\ub97c \uc0ac\uc6a9\ud55c \ubc14 \uadf8\ub798\ud504\n/// - \uc218\uba74 \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \ud45c\uc2dc (bad, soso, good, excellent, oversleep)\n/// - \ud3c9\uade0\uc120 \ud45c\uc2dc \uc9c0\uc6d0\n/// - \uc778\ud130\ub799\ud2f0\ube0c \uc120\ud0dd \uae30\ub2a5\n/// - \ube48 \uc0c1\ud0dc \ucc98\ub9ac\n/// \ud83d\udca1 Java \ube44\uad50: MPAndroidChart BarChart + Custom Colors\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc \ub354 \uc120\uc5b8\uc801\nstruct SleepBarChart: View {\n\n    // MARK: - Properties\n\n    /// \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Input\n    /// - FetchSleepStatsUseCase.SleepDataPoint \ubc30\uc5f4\n    /// - \ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c\ub418\uc5b4 \uc788\uc74c\n    let dataPoints: [FetchSleepStatsUseCase.SleepDataPoint]\n\n    /// \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Average Line\n    /// - nil\uc774\uba74 \ud3c9\uade0\uc120 \ud45c\uc2dc \uc548 \ud568\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \uc810\uc120\uc73c\ub85c \ud45c\uc2dc\n    let averageDuration: Int32?\n\n    /// \uc120\ud0dd\ub41c \ud1b5\uacc4 \uae30\uac04\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Period Context\n    /// - \ucc28\ud2b8 \uc81c\ubaa9 \ubc0f X\ucd95 \ub808\uc774\ube14 \uacb0\uc815\n    let period: FetchSleepStatsUseCase.StatsPeriod\n\n    /// \uc778\ud130\ub799\uc158 \ud65c\uc131\ud654 \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Interactive Feature Toggle\n    /// - true: \ud0ed\ud558\uc5ec \uc0c1\uc138 \uc815\ubcf4 \ud45c\uc2dc\n    /// - false: \uc815\uc801 \ucc28\ud2b8\n    let isInteractive: Bool\n\n    /// \ucc28\ud2b8 \ub192\uc774\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Customizable Height\n    /// - \ub300\uc2dc\ubcf4\ub4dc\uc5d0\uc11c\ub294 \uc791\uac8c, \uc0c1\uc138 \ud654\uba74\uc5d0\uc11c\ub294 \ud06c\uac8c\n    let height: CGFloat\n\n    /// \uc0c1\ud0dc \ubc94\ub840 \ud45c\uc2dc \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Legend\n    /// - true: \ucc28\ud2b8 \ud558\ub2e8\uc5d0 \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \ubc94\ub840 \ud45c\uc2dc\n    /// - false: \ubc94\ub840 \uc228\uae40\n    let showStatusLegend: Bool\n\n    // MARK: - State\n\n    /// \uc120\ud0dd\ub41c \ub0a0\uc9dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart Selection State\n    /// - \uc0ac\uc6a9\uc790\uac00 \ud0ed\ud55c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\uc758 \ub0a0\uc9dc\n    /// - nil\uc774\uba74 \uc120\ud0dd \uc5c6\uc74c\n    /// \ud83d\udca1 Java \ube44\uad50: selectedEntry in MPAndroidChart\n    @State private var selectedDate: Date?\n\n    /// \uc120\ud0dd\ub41c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property for Selection\n    /// - selectedDate\ub97c \uae30\ubc18\uc73c\ub85c \uc2e4\uc81c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uc870\ud68c\n    private var selectedDataPoint: FetchSleepStatsUseCase.SleepDataPoint? {\n        guard let date = selectedDate else { return nil }\n        // \ub0a0\uc9dc\uac00 \uac00\uc7a5 \uac00\uae4c\uc6b4 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \ucc3e\uae30\n        return dataPoints.min(by: { abs($0.date.timeIntervalSince(date)) < abs($1.date.timeIntervalSince(date)) })\n    }\n\n    // MARK: - Computed Properties\n\n    /// \ub370\uc774\ud130\uac00 \ube44\uc5b4\uc788\ub294\uc9c0 \ud655\uc778\n    private var isEmpty: Bool {\n        dataPoints.isEmpty\n    }\n\n    /// Y\ucd95 \ucd5c\uc18c\uac12 (\uc2dc\uac04 \ub2e8\uc704)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart Scale Calculation\n    /// - \ucd5c\uc18c \uc218\uba74 \uc2dc\uac04\ubcf4\ub2e4 \uc57d\uac04 \uc791\uc740 \uac12 (\uc5ec\ubc31)\n    /// - 0\uc2dc\uac04 \uc774\ud558\ub85c\ub294 \ub0b4\ub824\uac00\uc9c0 \uc54a\uc74c\n    private var yAxisMinimum: Double {\n        guard !isEmpty else { return 0 }\n        let minDuration = dataPoints.map { $0.duration }.min() ?? 0\n        // \ubd84\uc744 \uc2dc\uac04\uc73c\ub85c \ubcc0\ud658\ud558\uace0 1\uc2dc\uac04 \ub2e8\uc704\ub85c \ub0b4\ub9bc\n        let minHours = Double(minDuration) / 60.0\n        return max(0, floor(minHours / 1.0) * 1.0)\n    }\n\n    /// Y\ucd95 \ucd5c\ub300\uac12 (\uc2dc\uac04 \ub2e8\uc704)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart Scale Calculation\n    /// - \ucd5c\ub300 \uc218\uba74 \uc2dc\uac04\ubcf4\ub2e4 \uc57d\uac04 \ud070 \uac12 (\uc5ec\ubc31)\n    /// - \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04\ub3c4 \uace0\ub824\n    private var yAxisMaximum: Double {\n        guard !isEmpty else { return 10 }\n        let maxDuration = dataPoints.map { $0.duration }.max() ?? 480\n        let avgDuration = averageDuration ?? maxDuration\n        let maximum = max(maxDuration, avgDuration)\n        // \ubd84\uc744 \uc2dc\uac04\uc73c\ub85c \ubcc0\ud658\ud558\uace0 1\uc2dc\uac04 \ub2e8\uc704\ub85c \uc62c\ub9bc\n        let maxHours = Double(maximum) / 60.0\n        return ceil(maxHours / 1.0) * 1.0\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 (\uccab \uae30\ub85d \ub300\ube44 \ub9c8\uc9c0\ub9c9 \uae30\ub85d)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Trend Calculation\n    /// - \uc591\uc218: \uc218\uba74 \uc2dc\uac04 \uc99d\uac00\n    /// - \uc74c\uc218: \uc218\uba74 \uc2dc\uac04 \uac10\uc18c\n    private var durationChange: Int32? {\n        guard let first = dataPoints.first?.duration,\n              let last = dataPoints.last?.duration else {\n            return nil\n        }\n        return last - first\n    }\n\n    // MARK: - Initialization\n\n    /// SleepBarChart \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Flexible Initializer\n    /// - \uae30\ubcf8\uac12\uc744 \uc81c\uacf5\ud558\uc5ec \ud3b8\ub9ac\ud558\uac8c \uc0ac\uc6a9\n    ///\n    /// - Parameters:\n    ///   - dataPoints: \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    ///   - averageDuration: \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04 (\uae30\ubcf8\uac12: nil)\n    ///   - period: \uc120\ud0dd\ub41c \uae30\uac04 (\uae30\ubcf8\uac12: .week)\n    ///   - isInteractive: \uc778\ud130\ub799\uc158 \ud65c\uc131\ud654 (\uae30\ubcf8\uac12: true)\n    ///   - height: \ucc28\ud2b8 \ub192\uc774 (\uae30\ubcf8\uac12: 300)\n    ///   - showStatusLegend: \uc0c1\ud0dc \ubc94\ub840 \ud45c\uc2dc \uc5ec\ubd80 (\uae30\ubcf8\uac12: true)\n    init(\n        dataPoints: [FetchSleepStatsUseCase.SleepDataPoint],\n        averageDuration: Int32? = nil,\n        period: FetchSleepStatsUseCase.StatsPeriod = .week,\n        isInteractive: Bool = true,\n        height: CGFloat = 300,\n        showStatusLegend: Bool = true\n    ) {\n        self.dataPoints = dataPoints\n        self.averageDuration = averageDuration\n        self.period = period\n        self.isInteractive = isInteractive\n        self.height = height\n        self.showStatusLegend = showStatusLegend\n    }\n\n    // MARK: - Body\n\n    var body: some View {\n        VStack(alignment: .leading, spacing: 12) {\n            // \ucc28\ud2b8 \ud5e4\ub354\n            chartHeader\n\n            if isEmpty {\n                // \ube48 \uc0c1\ud0dc\n                emptyStateView\n            } else {\n                // \ucc28\ud2b8\n                chartView\n\n                // \ubc94\ub840\n                if showStatusLegend {\n                    chartLegend\n                }\n\n                // \uc120\ud0dd\ub41c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uc0c1\uc138 \uc815\ubcf4\n                if let selected = selectedDataPoint {\n                    selectedDataPointDetail(selected)\n                }\n            }\n        }\n    }\n\n    // MARK: - Subviews\n\n    /// \ucc28\ud2b8 \ud5e4\ub354\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Header with Statistics\n    /// - \uc81c\ubaa9, \uae30\uac04, \ubcc0\ud654\ub7c9 \ud45c\uc2dc\n    private var chartHeader: some View {\n        HStack(alignment: .top) {\n            VStack(alignment: .leading, spacing: 4) {\n                // \uc81c\ubaa9\n                HStack(spacing: 6) {\n                    Image(systemName: \"chart.bar.fill\")\n                        .font(.title3)\n                        .foregroundStyle(.purple)\n\n                    Text(\"\uc218\uba74 \uc2dc\uac04 \ud2b8\ub80c\ub4dc\")\n                        .font(.headline)\n                        .fontWeight(.semibold)\n                        .foregroundStyle(.primary)\n                }\n\n                // \uae30\uac04\n                Text(period.displayName)\n                    .font(.caption)\n                    .foregroundStyle(.secondary)\n            }\n\n            Spacer()\n\n            // \ubcc0\ud654\ub7c9 \ud45c\uc2dc\n            if let change = durationChange {\n                durationChangeBadge(change)\n            }\n        }\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 \ubc43\uc9c0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Visual Indicator\n    /// - \uc99d\uac00\ub294 \ucd08\ub85d (\uae0d\uc815\uc801), \uac10\uc18c\ub294 \uc8fc\ud669 (\ubd80\uc815\uc801)\n    ///\n    /// - Parameter change: \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 (\ubd84)\n    /// - Returns: \ubc43\uc9c0 \ubdf0\n    private func durationChangeBadge(_ change: Int32) -> some View {\n        let isIncrease = change > 0\n        let color: Color = isIncrease ? .green : .orange\n        let icon = isIncrease ? \"arrow.up.right\" : \"arrow.down.right\"\n\n        return HStack(spacing: 4) {\n            Image(systemName: icon)\n                .font(.caption2)\n\n            Text(formatDurationChange(change))\n                .font(.caption)\n                .fontWeight(.semibold)\n        }\n        .foregroundStyle(color)\n        .padding(.horizontal, 10)\n        .padding(.vertical, 6)\n        .background(color.opacity(0.15))\n        .cornerRadius(8)\n    }\n\n    /// \ucc28\ud2b8 \ubdf0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Swift Charts Implementation with Bar Marks\n    /// - Chart { } \ube14\ub85d \ub0b4\uc5d0 Mark \uc815\uc758\n    /// - BarMark: \ubc14 \uadf8\ub798\ud504\n    /// - RuleMark: \ud3c9\uade0\uc120 \ud45c\uc2dc\n    private var chartView: some View {\n        Chart {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: ForEach in Chart\n            // \uac01 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\ub97c BarMark\ub85c \ubcc0\ud658\n            ForEach(dataPoints) { dataPoint in\n                // \ubc14 \uadf8\ub798\ud504\n                BarMark(\n                    x: .value(\"\ub0a0\uc9dc\", dataPoint.date, unit: .day),\n                    y: .value(\"\uc218\uba74 \uc2dc\uac04\", Double(dataPoint.duration) / 60.0) // \ubd84\uc744 \uc2dc\uac04\uc73c\ub85c \ubcc0\ud658\n                )\n                .foregroundStyle(dataPoint.status.color)\n                .cornerRadius(4)\n            }\n\n            // \ud3c9\uade0\uc120 \ud45c\uc2dc\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: RuleMark for Average Line\n            if let avg = averageDuration {\n                RuleMark(\n                    y: .value(\"\ud3c9\uade0\", Double(avg) / 60.0) // \ubd84\uc744 \uc2dc\uac04\uc73c\ub85c \ubcc0\ud658\n                )\n                .foregroundStyle(.gray)\n                .lineStyle(StrokeStyle(lineWidth: 2, dash: [5, 5])) // \uc810\uc120\n                .annotation(position: .top, alignment: .trailing) {\n                    Text(\"\ud3c9\uade0: \\(formatDuration(avg))\")\n                        .font(.caption2)\n                        .foregroundStyle(.gray)\n                        .padding(.horizontal, 8)\n                        .padding(.vertical, 4)\n                        .background(Color.gray.opacity(0.1))\n                        .cornerRadius(6)\n                }\n            }\n\n            // \uc120\ud0dd\ub41c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uac15\uc870\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Selection Indicator\n            if let selected = selectedDataPoint {\n                RuleMark(\n                    x: .value(\"\ub0a0\uc9dc\", selected.date)\n                )\n                .foregroundStyle(.gray.opacity(0.3))\n                .lineStyle(StrokeStyle(lineWidth: 2, dash: [3, 3]))\n\n                // \uc120\ud0dd\ub41c \ubc14 \uac15\uc870\n                BarMark(\n                    x: .value(\"\ub0a0\uc9dc\", selected.date, unit: .day),\n                    y: .value(\"\uc218\uba74 \uc2dc\uac04\", Double(selected.duration) / 60.0)\n                )\n                .foregroundStyle(selected.status.color.opacity(0.3))\n                .cornerRadius(4)\n                .overlay(\n                    RoundedRectangle(cornerRadius: 4)\n                        .stroke(selected.status.color, lineWidth: 3)\n                )\n            }\n        }\n        .chartXAxis {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom X Axis\n            // \ub0a0\uc9dc \ub808\uc774\ube14 \ud45c\uc2dc\n            AxisMarks(values: .automatic) { value in\n                AxisGridLine()\n                AxisTick()\n                AxisValueLabel(format: .dateTime.month(.abbreviated).day())\n            }\n        }\n        .chartYAxis {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Y Axis\n            // \uc218\uba74 \uc2dc\uac04 \ub808\uc774\ube14 \ud45c\uc2dc (\uc2dc\uac04 \ub2e8\uc704)\n            AxisMarks(position: .leading) { value in\n                AxisGridLine()\n                AxisTick()\n                AxisValueLabel {\n                    if let doubleValue = value.as(Double.self) {\n                        Text(\"\\(Int(doubleValue))h\")\n                            .font(.caption)\n                            .foregroundStyle(.secondary)\n                    }\n                }\n            }\n        }\n        .chartYScale(domain: yAxisMinimum...yAxisMaximum)\n        .chartXSelection(value: $selectedDate)\n        .frame(height: height)\n        .padding(.vertical, 8)\n        .disabled(!isInteractive) // \uc778\ud130\ub799\uc158 \ube44\ud65c\uc131\ud654 \uc2dc \ud0ed \ubd88\uac00\n    }\n\n    /// \ubc94\ub840\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Legend Component with Status Colors\n    /// - \ucc28\ud2b8 \uc694\uc18c \uc124\uba85\n    /// - \uc218\uba74 \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \ud45c\uc2dc\n    private var chartLegend: some View {\n        VStack(alignment: .leading, spacing: 8) {\n            HStack(spacing: 20) {\n                // \ud3c9\uade0\uc120\n                if averageDuration != nil {\n                    HStack(spacing: 6) {\n                        Rectangle()\n                            .fill(.gray)\n                            .frame(width: 20, height: 2)\n\n                        Text(\"\ud3c9\uade0\")\n                            .font(.caption)\n                            .foregroundStyle(.secondary)\n                    }\n                }\n            }\n\n            // \uc218\uba74 \uc0c1\ud0dc \ubc94\ub840\n            Divider()\n                .padding(.vertical, 4)\n\n            Text(\"\uc218\uba74 \uc0c1\ud0dc\")\n                .font(.caption2)\n                .foregroundStyle(.secondary)\n                .fontWeight(.semibold)\n\n            LazyVGrid(columns: [\n                GridItem(.flexible()),\n                GridItem(.flexible()),\n                GridItem(.flexible())\n            ], spacing: 8) {\n                ForEach(SleepStatus.allCases) { status in\n                    statusLegendItem(status)\n                }\n            }\n        }\n    }\n\n    /// \uc218\uba74 \uc0c1\ud0dc \ubc94\ub840 \uc544\uc774\ud15c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reusable Legend Item\n    ///\n    /// - Parameter status: \uc218\uba74 \uc0c1\ud0dc\n    /// - Returns: \ubc94\ub840 \uc544\uc774\ud15c \ubdf0\n    private func statusLegendItem(_ status: SleepStatus) -> some View {\n        HStack(spacing: 4) {\n            RoundedRectangle(cornerRadius: 2)\n                .fill(status.color)\n                .frame(width: 12, height: 12)\n\n            Text(status.displayName)\n                .font(.caption2)\n                .foregroundStyle(.secondary)\n        }\n        .frame(maxWidth: .infinity, alignment: .leading)\n    }\n\n    /// \uc120\ud0dd\ub41c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uc0c1\uc138 \uc815\ubcf4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Selection Detail\n    /// - \uc120\ud0dd\ud55c \ud3ec\uc778\ud2b8\uc758 \uc815\ubcf4\ub97c \uce74\ub4dc\ub85c \ud45c\uc2dc\n    ///\n    /// - Parameter dataPoint: \uc120\ud0dd\ub41c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// - Returns: \uc0c1\uc138 \uc815\ubcf4 \ubdf0\n    private func selectedDataPointDetail(_ dataPoint: FetchSleepStatsUseCase.SleepDataPoint) -> some View {\n        VStack(alignment: .leading, spacing: 12) {\n            // \ub0a0\uc9dc\n            HStack {\n                Image(systemName: \"calendar\")\n                    .font(.caption)\n                    .foregroundStyle(.purple)\n\n                Text(formatDate(dataPoint.date))\n                    .font(.subheadline)\n                    .fontWeight(.medium)\n                    .foregroundStyle(.primary)\n\n                Spacer()\n\n                // \uc120\ud0dd \ud574\uc81c \ubc84\ud2bc\n                Button(action: {\n                    selectedDate = nil\n                }) {\n                    Image(systemName: \"xmark.circle.fill\")\n                        .font(.caption)\n                        .foregroundStyle(.gray)\n                }\n            }\n\n            Divider()\n\n            // \uce21\uc815 \uac12\n            HStack(spacing: 24) {\n                // \uc218\uba74 \uc2dc\uac04\n                measurementItem(\n                    icon: \"moon.fill\",\n                    label: \"\uc218\uba74 \uc2dc\uac04\",\n                    value: formatDuration(dataPoint.duration),\n                    color: .purple\n                )\n\n                // \uc218\uba74 \uc0c1\ud0dc\n                VStack(alignment: .leading, spacing: 4) {\n                    HStack(spacing: 4) {\n                        Image(systemName: dataPoint.status.iconName)\n                            .font(.caption2)\n                            .foregroundStyle(dataPoint.status.color)\n\n                        Text(\"\uc218\uba74 \uc0c1\ud0dc\")\n                            .font(.caption)\n                            .foregroundStyle(.secondary)\n                    }\n\n                    HStack(spacing: 4) {\n                        Text(dataPoint.status.displayName)\n                            .font(.subheadline)\n                            .fontWeight(.semibold)\n                            .foregroundStyle(.primary)\n\n                        Circle()\n                            .fill(dataPoint.status.color)\n                            .frame(width: 8, height: 8)\n                    }\n                }\n                .frame(maxWidth: .infinity, alignment: .leading)\n            }\n\n            // \ud3c9\uade0\uacfc\uc758 \ube44\uad50\n            if let avg = averageDuration {\n                Divider()\n\n                let diff = dataPoint.duration - avg\n                let isAboveAverage = diff >= 0\n\n                HStack(spacing: 6) {\n                    Image(systemName: isAboveAverage ? \"arrow.up.circle.fill\" : \"arrow.down.circle.fill\")\n                        .font(.caption)\n                        .foregroundStyle(isAboveAverage ? .green : .orange)\n\n                    Text(\"\ud3c9\uade0\ubcf4\ub2e4 \\(formatDurationChange(diff)) \\(isAboveAverage ? \"\ub9ce\uc74c\" : \"\uc801\uc74c\")\")\n                        .font(.caption)\n                        .foregroundStyle(.secondary)\n                }\n            }\n        }\n        .padding(16)\n        .background(\n            RoundedRectangle(cornerRadius: 12)\n                .fill(Color(.secondarySystemBackground))\n        )\n        .transition(.opacity.combined(with: .move(edge: .bottom)))\n        .animation(.easeInOut(duration: 0.2), value: selectedDate)\n    }\n\n    /// \uce21\uc815 \uac12 \uc544\uc774\ud15c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reusable Component Function\n    /// - \ubc18\ubcf5\ub418\ub294 \uce21\uc815\uac12 \ud45c\uc2dc \ud328\ud134\uc744 \uc7ac\uc0ac\uc6a9\n    ///\n    /// - Parameters:\n    ///   - icon: SF Symbol \uc544\uc774\ucf58 \uc774\ub984\n    ///   - label: \ub808\uc774\ube14 \ud14d\uc2a4\ud2b8\n    ///   - value: \uce21\uc815 \uac12\n    ///   - color: \uac15\uc870 \uc0c9\uc0c1\n    /// - Returns: \uce21\uc815 \uac12 \ud45c\uc2dc \ubdf0\n    private func measurementItem(\n        icon: String,\n        label: String,\n        value: String,\n        color: Color\n    ) -> some View {\n        VStack(alignment: .leading, spacing: 4) {\n            HStack(spacing: 4) {\n                Image(systemName: icon)\n                    .font(.caption2)\n                    .foregroundStyle(color)\n\n                Text(label)\n                    .font(.caption)\n                    .foregroundStyle(.secondary)\n            }\n\n            Text(value)\n                .font(.subheadline)\n                .fontWeight(.semibold)\n                .foregroundStyle(.primary)\n        }\n        .frame(maxWidth: .infinity, alignment: .leading)\n    }\n\n    /// \ube48 \uc0c1\ud0dc \ubdf0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Empty State UI\n    /// - \ub370\uc774\ud130\uac00 \uc5c6\uc744 \ub54c \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc548\ub0b4\n    private var emptyStateView: some View {\n        VStack(spacing: 16) {\n            Image(systemName: \"chart.bar\")\n                .font(.system(size: 60))\n                .foregroundStyle(.gray.opacity(0.3))\n\n            VStack(spacing: 8) {\n                Text(\"\uc218\uba74 \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4\")\n                    .font(.headline)\n                    .foregroundStyle(.primary)\n\n                Text(\"\uc218\uba74 \uae30\ub85d\uc744 \uc785\ub825\ud558\uba74\\n\uc218\uba74 \uc2dc\uac04 \ud2b8\ub80c\ub4dc\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4\")\n                    .font(.subheadline)\n                    .foregroundStyle(.secondary)\n                    .multilineTextAlignment(.center)\n            }\n        }\n        .frame(height: height)\n        .frame(maxWidth: .infinity)\n    }\n\n    // MARK: - Helper Methods\n\n    /// \ub0a0\uc9dc \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Formatting\n    /// - \"2026\ub144 1\uc6d4 14\uc77c (\ud654)\" \ud615\uc2dd\n    ///\n    /// - Parameter date: \ub0a0\uc9dc\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4\n    private func formatDate(_ date: Date) -> String {\n        let formatter = DateFormatter()\n        formatter.dateFormat = \"yyyy\ub144 M\uc6d4 d\uc77c (E)\"\n        formatter.locale = Locale(identifier: \"ko_KR\")\n        return formatter.string(from: date)\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Duration Formatting\n    /// - \ubd84 \ub2e8\uc704\ub97c \uc2dc\uac04:\ubd84 \ud615\uc2dd\uc73c\ub85c \ubcc0\ud658\n    ///\n    /// - Parameter minutes: \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"7\uc2dc\uac04 30\ubd84\")\n    private func formatDuration(_ minutes: Int32) -> String {\n        let hours = Int(minutes) / 60\n        let mins = Int(minutes) % 60\n        if mins == 0 {\n            return \"\\(hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(hours)\uc2dc\uac04 \\(mins)\ubd84\"\n        }\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Signed Number Formatting\n    /// - \uc591\uc218\ub294 +, \uc74c\uc218\ub294 - \uae30\ud638 \ud3ec\ud568\n    ///\n    /// - Parameter change: \ubcc0\ud654\ub7c9 (\ubd84)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"+30\ubd84\", \"-1\uc2dc\uac04\")\n    private func formatDurationChange(_ change: Int32) -> String {\n        let hours = abs(change) / 60\n        let mins = abs(change) % 60\n        let sign = change >= 0 ? \"+\" : \"-\"\n\n        if hours == 0 {\n            return \"\\(sign)\\(mins)\ubd84\"\n        } else if mins == 0 {\n            return \"\\(sign)\\(hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(sign)\\(hours)\uc2dc\uac04 \\(mins)\ubd84\"\n        }\n    }\n}\n\n// MARK: - Convenience Initializers\n\nextension SleepBarChart {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Initializer with ViewModel\n    /// - SleepTrendsViewModel\uc5d0\uc11c \uc9c1\uc811 \uac12\uc744 \uac00\uc838\uc624\ub294 \ud3b8\uc758 \uc0dd\uc131\uc790\n    /// - View\uc5d0\uc11c \uc27d\uac8c \uc0ac\uc6a9 \uac00\ub2a5\n    ///\n    /// - Parameters:\n    ///   - viewModel: SleepTrendsViewModel \uc778\uc2a4\ud134\uc2a4\n    ///   - isInteractive: \uc778\ud130\ub799\uc158 \ud65c\uc131\ud654 (\uae30\ubcf8\uac12: true)\n    ///   - height: \ucc28\ud2b8 \ub192\uc774 (\uae30\ubcf8\uac12: 300)\n    ///   - showStatusLegend: \uc0c1\ud0dc \ubc94\ub840 \ud45c\uc2dc \uc5ec\ubd80 (\uae30\ubcf8\uac12: true)\n    init(\n        viewModel: SleepTrendsViewModel,\n        isInteractive: Bool = true,\n        height: CGFloat = 300,\n        showStatusLegend: Bool = true\n    ) {\n        self.dataPoints = viewModel.dataPoints\n        self.averageDuration = viewModel.averageDurationMinutes\n        self.period = viewModel.selectedPeriod\n        self.isInteractive = isInteractive\n        self.height = height\n        self.showStatusLegend = showStatusLegend\n    }\n}\n\n// MARK: - Preview\n\n#Preview(\"7\uc77c \ub370\uc774\ud130\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n            averageDuration: FetchSleepStatsUseCase.sampleOutput().averageDuration,\n            period: .week\n        )\n        .padding()\n    }\n}\n\n#Preview(\"7\uc77c \ub370\uc774\ud130 + \ud3c9\uade0\uc120\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n            averageDuration: 420, // 7\uc2dc\uac04\n            period: .week\n        )\n        .padding()\n    }\n}\n\n#Preview(\"\ubc94\ub840 \uc228\uae40\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n            averageDuration: FetchSleepStatsUseCase.sampleOutput().averageDuration,\n            period: .week,\n            showStatusLegend: false\n        )\n        .padding()\n    }\n}\n\n#Preview(\"\ube48 \uc0c1\ud0dc\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: [],\n            period: .week\n        )\n        .padding()\n    }\n}\n\n#Preview(\"\uc778\ud130\ub799\uc158 \ube44\ud65c\uc131\ud654\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n            period: .week,\n            isInteractive: false,\n            height: 200,\n            showStatusLegend: false\n        )\n        .padding()\n    }\n}\n\n#Preview(\"\ub2e4\ud06c \ubaa8\ub4dc\") {\n    ScrollView {\n        SleepBarChart(\n            dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n            averageDuration: 420,\n            period: .month\n        )\n        .padding()\n    }\n    .preferredColorScheme(.dark)\n}\n\n#Preview(\"\ub300\uc2dc\ubcf4\ub4dc \ud06c\uae30 (\uc791\uac8c)\") {\n    ScrollView {\n        VStack(spacing: 16) {\n            Text(\"\ub300\uc2dc\ubcf4\ub4dc \uce74\ub4dc \ud06c\uae30 \uc608\uc2dc\")\n                .font(.headline)\n\n            SleepBarChart(\n                dataPoints: FetchSleepStatsUseCase.sampleOutput().dataPoints,\n                period: .week,\n                isInteractive: false,\n                height: 180,\n                showStatusLegend: false\n            )\n            .padding()\n            .background(\n                RoundedRectangle(cornerRadius: 12)\n                    .fill(Color(.systemBackground))\n                    .shadow(color: .black.opacity(0.05), radius: 8)\n            )\n        }\n        .padding()\n    }\n}\n\n#Preview(\"30\uc77c \ub370\uc774\ud130 - \ub2e4\uc591\ud55c \uc0c1\ud0dc\") {\n    ScrollView {\n        let now = Date()\n        let dataPoints = stride(from: -29, through: 0, by: 3).map { dayOffset in\n            // \ub2e4\uc591\ud55c \uc218\uba74 \uc2dc\uac04\uacfc \uc0c1\ud0dc \ud45c\uc2dc\n            let progress = Double(dayOffset + 29) / 29.0\n            let duration = Int32(300 + progress * 180) // 5\uc2dc\uac04 \u2192 8\uc2dc\uac04\uc73c\ub85c \uc810\uc9c4\uc801 \uc99d\uac00\n\n            return FetchSleepStatsUseCase.SleepDataPoint(\n                id: UUID(),\n                date: Calendar.current.date(byAdding: .day, value: dayOffset, to: now)!,\n                duration: duration,\n                status: SleepStatus.from(durationMinutes: duration)\n            )\n        }\n\n        SleepBarChart(\n            dataPoints: dataPoints,\n            averageDuration: 420, // 7\uc2dc\uac04\n            period: .month\n        )\n        .padding()\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepBarChart \uc0ac\uc6a9\ubc95\n///\n/// ViewModel\uacfc \ud568\uaed8 \uc0ac\uc6a9 (\uad8c\uc7a5):\n/// ```swift\n/// struct SleepTrendsView: View {\n///     @StateObject private var viewModel: SleepTrendsViewModel\n///\n///     var body: some View {\n///         SleepBarChart(\n///             viewModel: viewModel,\n///             height: 300,\n///             showStatusLegend: true\n///         )\n///     }\n/// }\n/// ```\n///\n/// \ub370\uc774\ud130 \uc9c1\uc811 \uc804\ub2ec:\n/// ```swift\n/// struct MyView: View {\n///     let dataPoints: [FetchSleepStatsUseCase.SleepDataPoint]\n///\n///     var body: some View {\n///         SleepBarChart(\n///             dataPoints: dataPoints,\n///             averageDuration: 420,\n///             period: .month,\n///             isInteractive: true,\n///             height: 300,\n///             showStatusLegend: true\n///         )\n///     }\n/// }\n/// ```\n///\n/// \ub300\uc2dc\ubcf4\ub4dc \ud06c\uae30 (\ubc94\ub840 \uc228\uae40):\n/// ```swift\n/// SleepBarChart(\n///     dataPoints: dataPoints,\n///     period: .week,\n///     isInteractive: false,\n///     height: 180,\n///     showStatusLegend: false\n/// )\n/// ```\n///\n/// \uc8fc\uc694 \uae30\ub2a5:\n/// - Swift Charts \uae30\ubc18 \ubc14 \ucc28\ud2b8\n/// - \uc218\uba74 \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 \uad6c\ubd84 (bad=\ube68\uac15, soso=\ub178\ub791, good=\ucd08\ub85d, excellent=\ud30c\ub791, oversleep=\uc8fc\ud669)\n/// - \ud3c9\uade0\uc120 \ud45c\uc2dc (\uc810\uc120)\n/// - \uc778\ud130\ub799\ud2f0\ube0c \uc120\ud0dd (\ud0ed\ud558\uc5ec \uc0c1\uc138 \uc815\ubcf4 \ud45c\uc2dc)\n/// - \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 \ubc43\uc9c0\n/// - \uc0c1\ud0dc\ubcc4 \ubc94\ub840 \ud45c\uc2dc (\uc120\ud0dd\uc801)\n/// - \ube48 \uc0c1\ud0dc \ucc98\ub9ac\n/// - \ub77c\uc774\ud2b8/\ub2e4\ud06c \ubaa8\ub4dc \uc790\ub3d9 \ub300\uc751\n/// - \ucee4\uc2a4\ud130\ub9c8\uc774\uc988 \uac00\ub2a5\ud55c \ub192\uc774\n///\n/// \ucc28\ud2b8 \uad6c\uc131 \uc694\uc18c:\n/// - BarMark: \uc77c\ubcc4 \uc218\uba74 \uc2dc\uac04 \ubc14 (\uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1)\n/// - RuleMark: \ud3c9\uade0\uc120 \ubc0f \uc120\ud0dd \uc778\ub514\ucf00\uc774\ud130\n///\n/// \uc218\uba74 \uc0c1\ud0dc\uc640 \uc0c9\uc0c1:\n/// - bad (\ub098\uc068): \ube68\uac15 - 5\uc2dc\uac04 30\ubd84 \ubbf8\ub9cc\n/// - soso (\ubcf4\ud1b5): \ub178\ub791 - 5\uc2dc\uac04 30\ubd84 ~ 6\uc2dc\uac04 30\ubd84\n/// - good (\uc88b\uc74c): \ucd08\ub85d - 6\uc2dc\uac04 30\ubd84 ~ 7\uc2dc\uac04 30\ubd84\n/// - excellent (\ub9e4\uc6b0 \uc88b\uc74c): \ud30c\ub791 - 7\uc2dc\uac04 30\ubd84 ~ 9\uc2dc\uac04\n/// - oversleep (\uacfc\ub2e4 \uc218\uba74): \uc8fc\ud669 - 9\uc2dc\uac04 \ucd08\uacfc\n///\n/// \uc778\ud130\ub799\uc158 \uae30\ub2a5:\n/// - \ubc14 \ud0ed\ud558\uc5ec \uc120\ud0dd\n/// - \uc120\ud0dd\ud55c \ub0a0\uc9dc\uc758 \uc0c1\uc138 \uc815\ubcf4 \ud45c\uc2dc (\uc218\uba74 \uc2dc\uac04, \uc0c1\ud0dc, \ud3c9\uade0\uacfc\uc758 \ube44\uad50)\n/// - \uc120\ud0dd \ud574\uc81c \ubc84\ud2bc\n///\n/// \ud83d\udca1 Android \ube44\uad50:\n/// - Android: MPAndroidChart BarChart + Custom Colors\n/// - SwiftUI: Swift Charts BarMark + status.color\n/// - Android: BarDataSet + custom colors\n/// - SwiftUI: ForEach + BarMark (\uc120\uc5b8\uc801)\n/// - Android: setOnChartValueSelectedListener\n/// - SwiftUI: @State + chartXSelection\n///\n/// \uc131\ub2a5 \ucd5c\uc801\ud654:\n/// - \ucd5c\ub300 90\uc77c \ub370\uc774\ud130 \uad8c\uc7a5 (StatsPeriod.quarter)\n/// - \ubc94\ub840 \ud45c\uc2dc\ub294 \uc120\ud0dd\uc801 (showStatusLegend)\n/// - \uc778\ud130\ub799\uc158 \ube44\ud65c\uc131\ud654 \uc2dc \ub354 \uac00\ubccd\uac8c \ub80c\ub354\ub9c1\n/// - \ub0a0\uc9dc\uc21c \uc815\ub82c\ub41c \ub370\uc774\ud130 \uc0ac\uc6a9 (Use Case\uc5d0\uc11c \ucc98\ub9ac)\n///\n/// WeightTrendChart\uc640\uc758 \ucc28\uc774:\n/// - WeightTrendChart: LineMark (\ub77c\uc778 \ucc28\ud2b8)\n/// - SleepBarChart: BarMark (\ubc14 \ucc28\ud2b8)\n/// - WeightTrendChart: \ub2e8\uc77c \uc0c9\uc0c1 (\ud30c\ub791)\n/// - SleepBarChart: \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1 (5\uac00\uc9c0)\n/// - WeightTrendChart: \uccb4\uc911 \ub370\uc774\ud130 (\uc5f0\uc18d\uc801)\n/// - SleepBarChart: \uc218\uba74 \ub370\uc774\ud130 (\uc77c\ubcc4 \ub3c5\ub9bd\uc801)\n///\n",
        "last_modified": "2026-01-18T17:07:01.341889"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:05.309868",
  "last_updated": "2026-01-14T21:03:40.765784"
}