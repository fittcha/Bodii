{
  "file_path": "Bodii/Infrastructure/Network/NetworkManager.swift",
  "main_branch_history": [],
  "task_views": {
    "005-korean-food-database-integration": {
      "task_id": "005-korean-food-database-integration",
      "branch_point": {
        "commit_hash": "c44bfbcd7c1699b176a8bb155e8c35f43ebd4ad9",
        "content": "",
        "timestamp": "2026-01-13T07:46:23.878686"
      },
      "worktree_state": {
        "content": "//\n//  NetworkManager.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Network Manager\n// HTTP \ub124\ud2b8\uc6cc\ud06c \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub294 \uc911\uc559 \uad00\ub9ac \ud074\ub798\uc2a4\n// \ud83d\udca1 Java \ube44\uad50: Retrofit\uc758 RestClient\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport Foundation\n\n/// HTTP \ub124\ud2b8\uc6cc\ud06c \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub294 \ub9e4\ub2c8\uc800 \ud074\ub798\uc2a4\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Actor vs Class for Network Layer\n/// URLSession\uc740 thread-safe\ud558\ubbc0\ub85c class \uc0ac\uc6a9 \uac00\ub2a5\n/// \ud83d\udca1 Java \ube44\uad50: Singleton pattern\uc758 OkHttpClient\uc640 \uc720\uc0ac\n///\n/// **Features:**\n/// - GET/POST \uc694\uccad \uc9c0\uc6d0\n/// - Async/await \uae30\ubc18 \ube44\ub3d9\uae30 \ucc98\ub9ac\n/// - \uc790\ub3d9 JSON \ub514\ucf54\ub529\n/// - \ud0c0\uc784\uc544\uc6c3 \uc124\uc815\n/// - \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1\n/// - \uc0c1\uc138\ud55c \uc5d0\ub7ec \ucc98\ub9ac\n///\n/// **Usage:**\n/// ```swift\n/// let networkManager = NetworkManager()\n///\n/// // GET \uc694\uccad\n/// struct Food: Decodable {\n///     let name: String\n///     let calories: Int\n/// }\n///\n/// let foods: [Food] = try await networkManager.request(\n///     url: \"https://api.example.com/foods\",\n///     method: .get\n/// )\n///\n/// // POST \uc694\uccad\n/// struct LoginRequest: Encodable {\n///     let email: String\n///     let password: String\n/// }\n///\n/// let response: AuthResponse = try await networkManager.request(\n///     url: \"https://api.example.com/login\",\n///     method: .post,\n///     body: LoginRequest(email: \"user@example.com\", password: \"password\")\n/// )\n/// ```\nfinal class NetworkManager {\n\n    // MARK: - Properties\n\n    /// URLSession \uc778\uc2a4\ud134\uc2a4\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: URLSession\n    /// iOS\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub294 \uae30\ubcf8 API\n    /// \ud83d\udca1 Java \ube44\uad50: HttpClient\uc640 \uc720\uc0ac\n    private let session: URLSession\n\n    /// JSON \ub514\ucf54\ub354\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: JSONDecoder\n    /// JSON \ub370\uc774\ud130\ub97c Swift \ud0c0\uc785\uc73c\ub85c \uc790\ub3d9 \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Gson, Jackson\uacfc \uc720\uc0ac\n    private let decoder: JSONDecoder\n\n    /// JSON \uc778\ucf54\ub354\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: JSONEncoder\n    /// Swift \ud0c0\uc785\uc744 JSON \ub370\uc774\ud130\ub85c \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Gson, Jackson\uc758 serializer\uc640 \uc720\uc0ac\n    private let encoder: JSONEncoder\n\n    /// \uae30\ubcf8 \ud0c0\uc784\uc544\uc6c3 \uc2dc\uac04 (\ucd08)\n    ///\n    /// \uc694\uccad\uc774 \uc774 \uc2dc\uac04 \ub0b4\uc5d0 \uc644\ub8cc\ub418\uc9c0 \uc54a\uc73c\uba74 timeout \uc5d0\ub7ec \ubc1c\uc0dd\n    private let defaultTimeout: TimeInterval\n\n    /// \ucd5c\ub300 \uc7ac\uc2dc\ub3c4 \ud69f\uc218\n    ///\n    /// \ub124\ud2b8\uc6cc\ud06c \uc5d0\ub7ec \ubc1c\uc0dd \uc2dc \uc790\ub3d9\uc73c\ub85c \uc7ac\uc2dc\ub3c4\ud560 \ucd5c\ub300 \ud69f\uc218\n    private let maxRetries: Int\n\n    // MARK: - Initialization\n\n    /// NetworkManager \ucd08\uae30\ud654\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// URLSession\uc744 \uc8fc\uc785\ubc1b\uc544 \ud14c\uc2a4\ud2b8 \uc2dc Mock\uc73c\ub85c \uad50\uccb4 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: Constructor Injection \ud328\ud134\n    ///\n    /// - Parameters:\n    ///   - session: URLSession \uc778\uc2a4\ud134\uc2a4 (\uae30\ubcf8\uac12: .shared)\n    ///   - timeout: \ud0c0\uc784\uc544\uc6c3 \uc2dc\uac04 (\uae30\ubcf8\uac12: 30\ucd08)\n    ///   - maxRetries: \ucd5c\ub300 \uc7ac\uc2dc\ub3c4 \ud69f\uc218 (\uae30\ubcf8\uac12: 2)\n    init(\n        session: URLSession = .shared,\n        timeout: TimeInterval = 30,\n        maxRetries: Int = 2\n    ) {\n        self.session = session\n        self.defaultTimeout = timeout\n        self.maxRetries = maxRetries\n\n        // JSONDecoder \uc124\uc815\n        self.decoder = JSONDecoder()\n        // API \uc751\ub2f5\uc758 snake_case\ub97c Swift\uc758 camelCase\ub85c \uc790\ub3d9 \ubcc0\ud658\n        self.decoder.keyDecodingStrategy = .convertFromSnakeCase\n\n        // JSONEncoder \uc124\uc815\n        self.encoder = JSONEncoder()\n        // Swift\uc758 camelCase\ub97c API\uc758 snake_case\ub85c \uc790\ub3d9 \ubcc0\ud658\n        self.encoder.keyEncodingStrategy = .convertToSnakeCase\n    }\n\n    // MARK: - Public Methods\n\n    /// HTTP \uc694\uccad\uc744 \uc218\ud589\ud558\uace0 \uacb0\uacfc\ub97c \ub514\ucf54\ub529\ud569\ub2c8\ub2e4\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async/Await\n    /// \ube44\ub3d9\uae30 \uc791\uc5c5\uc744 \ub3d9\uae30 \ucf54\ub4dc\ucc98\ub7fc \uc791\uc131 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: CompletableFuture\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc \ub354 \uac04\uacb0\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Generics\n    /// \ub2e4\uc591\ud55c \uc751\ub2f5 \ud0c0\uc785\uc744 \ud558\ub098\uc758 \ud568\uc218\ub85c \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: <T extends Decodable>\uc640 \ub3d9\uc77c\n    ///\n    /// - Parameters:\n    ///   - url: \uc694\uccad\ud560 URL \ubb38\uc790\uc5f4\n    ///   - method: HTTP \uba54\uc11c\ub4dc (GET, POST \ub4f1)\n    ///   - headers: HTTP \ud5e4\ub354 (\uae30\ubcf8\uac12: nil)\n    ///   - body: POST \uc694\uccad \ubc14\ub514 (\uae30\ubcf8\uac12: nil)\n    ///   - timeout: \ud0c0\uc784\uc544\uc6c3 \uc2dc\uac04 (\uae30\ubcf8\uac12: defaultTimeout)\n    ///   - retries: \ud604\uc7ac \uc7ac\uc2dc\ub3c4 \ud69f\uc218 (\ub0b4\ubd80\uc6a9, \uae30\ubcf8\uac12: 0)\n    ///\n    /// - Returns: \ub514\ucf54\ub529\ub41c \uc751\ub2f5 \ub370\uc774\ud130\n    ///\n    /// - Throws: NetworkError\n    ///\n    /// - Example:\n    /// ```swift\n    /// // GET \uc694\uccad\n    /// let foods: [Food] = try await networkManager.request(\n    ///     url: \"https://api.example.com/foods\",\n    ///     method: .get\n    /// )\n    ///\n    /// // POST \uc694\uccad with body\n    /// let response: AuthResponse = try await networkManager.request(\n    ///     url: \"https://api.example.com/login\",\n    ///     method: .post,\n    ///     body: LoginRequest(email: \"test@example.com\", password: \"pass\")\n    /// )\n    /// ```\n    func request<T: Decodable, B: Encodable>(\n        url urlString: String,\n        method: HTTPMethod,\n        headers: [String: String]? = nil,\n        body: B? = nil,\n        timeout: TimeInterval? = nil,\n        retries: Int = 0\n    ) async throws -> T {\n\n        // URL \uac80\uc99d\n        guard let url = URL(string: urlString) else {\n            throw NetworkError.invalidURL(urlString)\n        }\n\n        // URLRequest \uc0dd\uc131\n        var request = URLRequest(url: url)\n        request.httpMethod = method.rawValue\n        request.timeoutInterval = timeout ?? defaultTimeout\n\n        // \ud5e4\ub354 \uc124\uc815\n        request.setValue(\"application/json\", forHTTPHeaderField: \"Content-Type\")\n        request.setValue(\"application/json\", forHTTPHeaderField: \"Accept\")\n\n        // \ucd94\uac00 \ud5e4\ub354 \uc124\uc815\n        headers?.forEach { key, value in\n            request.setValue(value, forHTTPHeaderField: key)\n        }\n\n        // POST \ubc14\ub514 \uc124\uc815\n        if let body = body {\n            do {\n                request.httpBody = try encoder.encode(body)\n            } catch {\n                throw NetworkError.decodingFailed(error)\n            }\n        }\n\n        // \uc694\uccad \uc218\ud589\n        do {\n            let (data, response) = try await session.data(for: request)\n\n            // HTTP \uc751\ub2f5 \uac80\uc99d\n            guard let httpResponse = response as? HTTPURLResponse else {\n                throw NetworkError.invalidResponse\n            }\n\n            // HTTP \uc0c1\ud0dc \ucf54\ub4dc \uac80\uc99d\n            guard (200...299).contains(httpResponse.statusCode) else {\n                let message = HTTPURLResponse.localizedString(forStatusCode: httpResponse.statusCode)\n                throw NetworkError.httpError(statusCode: httpResponse.statusCode, message: message)\n            }\n\n            // \ub370\uc774\ud130 \uac80\uc99d\n            guard !data.isEmpty else {\n                throw NetworkError.noData\n            }\n\n            // JSON \ub514\ucf54\ub529\n            do {\n                let decodedData = try decoder.decode(T.self, from: data)\n                return decodedData\n            } catch {\n                throw NetworkError.decodingFailed(error)\n            }\n\n        } catch let error as NetworkError {\n            // NetworkError\ub294 \uadf8\ub300\ub85c throw\n            throw error\n\n        } catch let error as URLError {\n            // URLError \ucc98\ub9ac\n            return try await handleURLError(\n                error,\n                urlString: urlString,\n                method: method,\n                headers: headers,\n                body: body,\n                timeout: timeout,\n                retries: retries\n            )\n\n        } catch {\n            // \uae30\ud0c0 \uc5d0\ub7ec\n            throw NetworkError.unknown(error)\n        }\n    }\n\n    /// \ubc14\ub514\uac00 \uc5c6\ub294 GET \uc694\uccad\uc744 \uc704\ud55c \ud3b8\uc758 \uba54\uc11c\ub4dc\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Method Overloading\n    /// \uac19\uc740 \uc774\ub984\uc758 \ud568\uc218\ub97c \ub2e4\ub978 \ud30c\ub77c\ubbf8\ud130\ub85c \uc5ec\ub7ec \uac1c \uc815\uc758\n    /// \ud83d\udca1 Java \ube44\uad50: Method overloading\uacfc \ub3d9\uc77c\n    ///\n    /// - Parameters:\n    ///   - url: \uc694\uccad\ud560 URL \ubb38\uc790\uc5f4\n    ///   - method: HTTP \uba54\uc11c\ub4dc (\uae30\ubcf8\uac12: .get)\n    ///   - headers: HTTP \ud5e4\ub354 (\uae30\ubcf8\uac12: nil)\n    ///   - timeout: \ud0c0\uc784\uc544\uc6c3 \uc2dc\uac04 (\uae30\ubcf8\uac12: nil)\n    ///\n    /// - Returns: \ub514\ucf54\ub529\ub41c \uc751\ub2f5 \ub370\uc774\ud130\n    ///\n    /// - Throws: NetworkError\n    func request<T: Decodable>(\n        url urlString: String,\n        method: HTTPMethod = .get,\n        headers: [String: String]? = nil,\n        timeout: TimeInterval? = nil\n    ) async throws -> T {\n        return try await request(\n            url: urlString,\n            method: method,\n            headers: headers,\n            body: EmptyBody?.none,\n            timeout: timeout\n        )\n    }\n\n    // MARK: - Private Methods\n\n    /// URLError \ucc98\ub9ac \ubc0f \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Handling & Retry Logic\n    /// \uc77c\uc2dc\uc801 \ub124\ud2b8\uc6cc\ud06c \uc624\ub958\ub294 \uc790\ub3d9\uc73c\ub85c \uc7ac\uc2dc\ub3c4\n    /// \ud83d\udca1 Java \ube44\uad50: Retrofit\uc758 Retry Interceptor\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - error: URLError\n    ///   - urlString: \uc694\uccad URL\n    ///   - method: HTTP \uba54\uc11c\ub4dc\n    ///   - headers: HTTP \ud5e4\ub354\n    ///   - body: \uc694\uccad \ubc14\ub514\n    ///   - timeout: \ud0c0\uc784\uc544\uc6c3\n    ///   - retries: \ud604\uc7ac \uc7ac\uc2dc\ub3c4 \ud69f\uc218\n    ///\n    /// - Returns: \uc7ac\uc2dc\ub3c4 \uc131\uacf5 \uc2dc \ub514\ucf54\ub529\ub41c \uc751\ub2f5\n    ///\n    /// - Throws: NetworkError\n    private func handleURLError<T: Decodable, B: Encodable>(\n        _ error: URLError,\n        urlString: String,\n        method: HTTPMethod,\n        headers: [String: String]?,\n        body: B?,\n        timeout: TimeInterval?,\n        retries: Int\n    ) async throws -> T {\n\n        // \ud0c0\uc784\uc544\uc6c3 \uc5d0\ub7ec \ucc98\ub9ac\n        if error.code == .timedOut {\n            throw NetworkError.timeout\n        }\n\n        // \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \uc5d0\ub7ec \ucc98\ub9ac\n        if error.code == .notConnectedToInternet ||\n           error.code == .networkConnectionLost ||\n           error.code == .cannotConnectToHost {\n\n            // \uc7ac\uc2dc\ub3c4 \uac00\ub2a5\ud55c \uacbd\uc6b0\n            if retries < maxRetries {\n                // \uc9c0\uc218 \ubc31\uc624\ud504: 1\ucd08, 2\ucd08, 4\ucd08...\n                let delay = pow(2.0, Double(retries))\n                try await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))\n\n                // \uc7ac\uc2dc\ub3c4\n                return try await request(\n                    url: urlString,\n                    method: method,\n                    headers: headers,\n                    body: body,\n                    timeout: timeout,\n                    retries: retries + 1\n                )\n            }\n\n            throw NetworkError.networkUnavailable\n        }\n\n        // \uae30\ud0c0 URLError\n        throw NetworkError.unknown(error)\n    }\n}\n\n// MARK: - Supporting Types\n\n/// HTTP \uba54\uc11c\ub4dc \uc5f4\uac70\ud615\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: String RawValue Enum\n/// rawValue\ub97c \ud1b5\ud574 \ubb38\uc790\uc5f4\uacfc enum\uc744 \uc27d\uac8c \ubcc0\ud658\n/// \ud83d\udca1 Java \ube44\uad50: Enum with String value\uc640 \ub3d9\uc77c\nenum HTTPMethod: String {\n    case get = \"GET\"\n    case post = \"POST\"\n    case put = \"PUT\"\n    case patch = \"PATCH\"\n    case delete = \"DELETE\"\n}\n\n/// \ube48 \uc694\uccad \ubc14\ub514\ub97c \uc704\ud55c \ud0c0\uc785\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Empty Encodable Type\n/// GET \uc694\uccad\ucc98\ub7fc \ubc14\ub514\uac00 \uc5c6\ub294 \uacbd\uc6b0\ub97c \uc704\ud55c \ud0c0\uc785\nprivate struct EmptyBody: Encodable {}\n",
        "last_modified": "2026-01-14T22:55:39.266506"
      },
      "task_intent": {
        "title": "005-korean-food-database-integration",
        "description": "Integrate Korean Food & Drug Administration (\uc2dd\uc57d\ucc98) food nutrition database API as primary source, with USDA FoodData Central as fallback for international foods. Prioritize Korean dishes (kimchi jjigae, bibimbap, tteokbokki) that are poorly covered by competitors.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:31.573921",
  "last_updated": "2026-01-13T07:46:23.922774"
}