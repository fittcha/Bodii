{
  "file_path": "Bodii/Domain/Services/DailyLogService.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  DailyLogService.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\nimport Foundation\n\n/// DailyLog \uad00\ub9ac \uc11c\ube44\uc2a4\n///\n/// DailyLog\uc758 \uc0dd\uc131, \uc870\ud68c \ubc0f \uc6b4\ub3d9 \ub370\uc774\ud130 \uc5c5\ub370\uc774\ud2b8\ub97c \ub2f4\ub2f9\ud569\ub2c8\ub2e4.\n///\n/// ## \ucc45\uc784\n/// - DailyLog \uc870\ud68c \ub610\ub294 \uc0dd\uc131 (getOrCreate)\n/// - \uc6b4\ub3d9 \ucd94\uac00 \uc2dc DailyLog \uc5c5\ub370\uc774\ud2b8\n/// - \uc6b4\ub3d9 \uc218\uc815 \uc2dc DailyLog \uc5c5\ub370\uc774\ud2b8\n/// - \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc DailyLog \uc5c5\ub370\uc774\ud2b8\n///\n/// ## \uc758\uc874\uc131\n/// - DailyLogRepository: DailyLog \ub370\uc774\ud130 \uc601\uc18d\uc131\n///\n/// ## \uc0ac\uc6a9 \uc2dc\ub098\ub9ac\uc624\n/// 1. **\uc6b4\ub3d9 \ucd94\uac00**: AddExerciseRecordUseCase\uc5d0\uc11c \uc6b4\ub3d9 \uae30\ub85d \uc0dd\uc131 \ud6c4 `addExercise` \ud638\ucd9c\n/// 2. **\uc6b4\ub3d9 \uc218\uc815**: UpdateExerciseRecordUseCase\uc5d0\uc11c \uc6b4\ub3d9 \uae30\ub85d \uc218\uc815 \ud6c4 `updateExercise` \ud638\ucd9c\n/// 3. **\uc6b4\ub3d9 \uc0ad\uc81c**: DeleteExerciseRecordUseCase\uc5d0\uc11c \uc6b4\ub3d9 \uae30\ub85d \uc0ad\uc81c \ud6c4 `removeExercise` \ud638\ucd9c\n///\n/// - Example:\n/// ```swift\n/// let service = DailyLogService(repository: dailyLogRepository)\n///\n/// // DailyLog \uc0dd\uc131 \ub610\ub294 \uc870\ud68c (User\uc758 \ud604\uc7ac BMR/TDEE \uc0ac\uc6a9)\n/// let dailyLog = try await service.getOrCreate(\n///     for: Date(),\n///     userId: userId,\n///     userBMR: user.currentBMR ?? 1650,\n///     userTDEE: user.currentTDEE ?? 2310\n/// )\n///\n/// // \uc6b4\ub3d9 \ucd94\uac00 (ExerciseRecord \uc0dd\uc131 \ud6c4 \ud638\ucd9c)\n/// try await service.addExercise(\n///     date: exerciseRecord.date,\n///     userId: userId,\n///     calories: exerciseRecord.caloriesBurned,\n///     duration: exerciseRecord.duration,\n///     userBMR: user.currentBMR ?? 1650,\n///     userTDEE: user.currentTDEE ?? 2310\n/// )\n/// ```\nfinal class DailyLogService {\n\n    // MARK: - Properties\n\n    /// DailyLog \uc800\uc7a5\uc18c\n    private let repository: DailyLogRepository\n\n    // MARK: - Initialization\n\n    /// DailyLogService \ucd08\uae30\ud654\n    ///\n    /// - Parameter repository: DailyLog \uc800\uc7a5\uc18c\n    init(repository: DailyLogRepository) {\n        self.repository = repository\n    }\n\n    // MARK: - Public Methods\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 DailyLog\ub97c \uc870\ud68c\ud558\uac70\ub098 \uc5c6\uc73c\uba74 \uc0dd\uc131\ud569\ub2c8\ub2e4.\n    ///\n    /// DailyLog\uac00 \uc5c6\uc744 \uacbd\uc6b0, \uc0ac\uc6a9\uc790\uc758 \ud604\uc7ac BMR/TDEE \uac12\uc73c\ub85c \uc0c8\ub85c \uc0dd\uc131\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - userBMR: \uc0ac\uc6a9\uc790\uc758 \ud604\uc7ac BMR (User.currentBMR)\n    ///   - userTDEE: \uc0ac\uc6a9\uc790\uc758 \ud604\uc7ac TDEE (User.currentTDEE)\n    /// - Throws: \ub370\uc774\ud130 \uc791\uc5c5 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub418\uac70\ub098 \uc0dd\uc131\ub41c DailyLog\n    ///\n    /// - Note: userBMR\uacfc userTDEE\ub294 User.currentBMR, User.currentTDEE\uc5d0\uc11c \uac00\uc838\uc640\uc57c \ud569\ub2c8\ub2e4.\n    ///         \uac12\uc774 \uc5c6\ub294 \uacbd\uc6b0 \uae30\ubcf8\uac12(BMR: 1650, TDEE: 2310)\uc744 \uc0ac\uc6a9\ud558\uc138\uc694.\n    func getOrCreate(\n        for date: Date,\n        userId: UUID,\n        userBMR: Decimal,\n        userTDEE: Decimal\n    ) async throws -> DailyLog {\n        // Decimal \u2192 Int32 \ubcc0\ud658\n        let bmr = Int32(truncating: userBMR as NSNumber)\n        let tdee = Int32(truncating: userTDEE as NSNumber)\n\n        return try await repository.getOrCreate(\n            for: date,\n            userId: userId,\n            bmr: bmr,\n            tdee: tdee\n        )\n    }\n\n    /// \uc6b4\ub3d9 \ucd94\uac00 \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// totalCaloriesOut, exerciseMinutes, exerciseCount\ub97c \uc99d\uac00\uc2dc\ud0b5\ub2c8\ub2e4.\n    /// DailyLog\uac00 \uc5c6\uc73c\uba74 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ud55c \ud6c4 \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - calories: \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    ///   - userBMR: \uc0ac\uc6a9\uc790\uc758 \ud604\uc7ac BMR (User.currentBMR)\n    ///   - userTDEE: \uc0ac\uc6a9\uc790\uc758 \ud604\uc7ac TDEE (User.currentTDEE)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    ///\n    /// - Note: UseCase\uc5d0\uc11c ExerciseRecord \uc0dd\uc131 \ud6c4 \uc774 \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud574\uc57c \ud569\ub2c8\ub2e4.\n    ///\n    /// - Example:\n    /// ```swift\n    /// // ExerciseRecord \uc0dd\uc131 \ud6c4\n    /// try await dailyLogService.addExercise(\n    ///     date: exerciseRecord.date,\n    ///     userId: userId,\n    ///     calories: exerciseRecord.caloriesBurned,\n    ///     duration: exerciseRecord.duration,\n    ///     userBMR: user.currentBMR ?? 1650,\n    ///     userTDEE: user.currentTDEE ?? 2310\n    /// )\n    /// ```\n    func addExercise(\n        date: Date,\n        userId: UUID,\n        calories: Int32,\n        duration: Int32,\n        userBMR: Decimal,\n        userTDEE: Decimal\n    ) async throws {\n        // DailyLog\uac00 \uc5c6\uc73c\uba74 \uc0dd\uc131\n        _ = try await getOrCreate(\n            for: date,\n            userId: userId,\n            userBMR: userBMR,\n            userTDEE: userTDEE\n        )\n\n        // \uc6b4\ub3d9 \ub370\uc774\ud130 \ucd94\uac00\n        try await repository.addExercise(\n            date: date,\n            userId: userId,\n            calories: calories,\n            duration: duration\n        )\n    }\n\n    /// \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// totalCaloriesOut, exerciseMinutes, exerciseCount\ub97c \uac10\uc18c\uc2dc\ud0b5\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - calories: \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    ///\n    /// - Note: UseCase\uc5d0\uc11c ExerciseRecord \uc0ad\uc81c \uc804 \uc774 \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud574\uc57c \ud569\ub2c8\ub2e4.\n    ///\n    /// - Example:\n    /// ```swift\n    /// // ExerciseRecord \uc0ad\uc81c \uc804\n    /// try await dailyLogService.removeExercise(\n    ///     date: exerciseRecord.date,\n    ///     userId: userId,\n    ///     calories: exerciseRecord.caloriesBurned,\n    ///     duration: exerciseRecord.duration\n    /// )\n    /// // ExerciseRecord \uc0ad\uc81c\n    /// try await exerciseRepository.delete(id: recordId, userId: userId)\n    /// ```\n    func removeExercise(\n        date: Date,\n        userId: UUID,\n        calories: Int32,\n        duration: Int32\n    ) async throws {\n        try await repository.removeExercise(\n            date: date,\n            userId: userId,\n            calories: calories,\n            duration: duration\n        )\n    }\n\n    /// \uc6b4\ub3d9 \uc218\uc815 \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// \uc774\uc804 \uac12\uacfc \uc0c8 \uac12\uc758 \ucc28\uc774\ub9cc\ud07c \uc870\uc815\ud569\ub2c8\ub2e4.\n    /// exerciseCount\ub294 \ubcc0\uacbd\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4 (\uac1c\uc218\ub294 \uadf8\ub300\ub85c).\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - oldCalories: \uc774\uc804 \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - newCalories: \uc0c8\ub85c\uc6b4 \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - oldDuration: \uc774\uc804 \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    ///   - newDuration: \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    ///\n    /// - Note: UseCase\uc5d0\uc11c ExerciseRecord \uc218\uc815 \ud6c4 \uc774 \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud574\uc57c \ud569\ub2c8\ub2e4.\n    ///\n    /// - Example:\n    /// ```swift\n    /// // ExerciseRecord \uc218\uc815 \ud6c4\n    /// try await dailyLogService.updateExercise(\n    ///     date: exerciseRecord.date,\n    ///     userId: userId,\n    ///     oldCalories: oldRecord.caloriesBurned,\n    ///     newCalories: newRecord.caloriesBurned,\n    ///     oldDuration: oldRecord.duration,\n    ///     newDuration: newRecord.duration\n    /// )\n    /// ```\n    func updateExercise(\n        date: Date,\n        userId: UUID,\n        oldCalories: Int32,\n        newCalories: Int32,\n        oldDuration: Int32,\n        newDuration: Int32\n    ) async throws {\n        try await repository.updateExercise(\n            date: date,\n            userId: userId,\n            oldCalories: oldCalories,\n            newCalories: newCalories,\n            oldDuration: oldDuration,\n            newDuration: newDuration\n        )\n    }\n}\n\n// MARK: - Service Pattern \uc124\uba85\n\n/// ## Service Pattern\uc774\ub780?\n///\n/// Service\ub294 \ub3c4\uba54\uc778 \ub85c\uc9c1\uc744 \ucea1\uc290\ud654\ud558\uace0 \uc5ec\ub7ec Repository\ub97c \uc870\uc815\ud558\ub294 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4.\n///\n/// ### Repository vs Service\n///\n/// **Repository**:\n/// - \ub2e8\uc77c \uc5d4\ud2f0\ud2f0\uc758 CRUD \uc791\uc5c5\n/// - \ub370\uc774\ud130 \uc601\uc18d\uc131\uc5d0 \uc9d1\uc911\n/// - \uc608: ExerciseRecordRepository, DailyLogRepository\n///\n/// **Service**:\n/// - \uc5ec\ub7ec \uc5d4\ud2f0\ud2f0 \uac04 \uc870\uc815\n/// - \ub3c4\uba54\uc778 \ub85c\uc9c1 \ucea1\uc290\ud654\n/// - \ud2b8\ub79c\uc7ad\uc158 \uacbd\uacc4 \uad00\ub9ac\n/// - \uc608: DailyLogService (DailyLog \uc0dd\uc131 \ubc0f \uc6b4\ub3d9 \ub370\uc774\ud130 \ub3d9\uae30\ud654)\n///\n/// ### \uc0ac\uc6a9 \uc608\uc2dc\n///\n/// ```swift\n/// // UseCase\uc5d0\uc11c Service \uc0ac\uc6a9\n/// final class AddExerciseRecordUseCase {\n///     let exerciseRepository: ExerciseRecordRepository\n///     let dailyLogService: DailyLogService\n///     let exerciseCalcService: ExerciseCalcService\n///\n///     func execute(...) async throws {\n///         // 1. \uce7c\ub85c\ub9ac \uacc4\uc0b0\n///         let calories = exerciseCalcService.calculateCalories(...)\n///\n///         // 2. ExerciseRecord \uc0dd\uc131\n///         let record = ExerciseRecord(...)\n///         let created = try await exerciseRepository.create(record)\n///\n///         // 3. DailyLog \uc5c5\ub370\uc774\ud2b8 (Service\uac00 \ucc98\ub9ac)\n///         try await dailyLogService.addExercise(\n///             date: created.date,\n///             userId: userId,\n///             calories: created.caloriesBurned,\n///             duration: created.duration,\n///             userBMR: user.currentBMR ?? 1650,\n///             userTDEE: user.currentTDEE ?? 2310\n///         )\n///     }\n/// }\n/// ```\n///\n/// ### \uc65c Service\uac00 \ud544\uc694\ud55c\uac00?\n///\n/// 1. **\ubcf5\uc7a1\ud55c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ucea1\uc290\ud654**:\n///    - DailyLog\uac00 \uc5c6\uc73c\uba74 \uc0dd\uc131\ud558\uace0, \uc788\uc73c\uba74 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ub85c\uc9c1\uc744 Service\uc5d0 \ucea1\uc290\ud654\n///    - UseCase\ub294 \"\uc6b4\ub3d9 \ucd94\uac00 \uc2dc DailyLog \uc5c5\ub370\uc774\ud2b8\"\ub77c\ub294 \uace0\uc218\uc900 \uc791\uc5c5\ub9cc \ud638\ucd9c\n///\n/// 2. **\uc7ac\uc0ac\uc6a9\uc131**:\n///    - AddExerciseRecordUseCase, UpdateExerciseRecordUseCase, DeleteExerciseRecordUseCase\n///      \ubaa8\ub450 DailyLogService\ub97c \uc7ac\uc0ac\uc6a9\n///\n/// 3. **\ud14c\uc2a4\ud2b8 \uc6a9\uc774\uc131**:\n///    - DailyLogService\ub97c Mock\uc73c\ub85c \ub300\uccb4\ud558\uc5ec UseCase \ud14c\uc2a4\ud2b8 \uac00\ub2a5\n///\n/// 4. **\ubcc0\uacbd \uaca9\ub9ac**:\n///    - DailyLog \uc5c5\ub370\uc774\ud2b8 \ub85c\uc9c1\uc774 \ubcc0\uacbd\ub418\uc5b4\ub3c4 Service\ub9cc \uc218\uc815\ud558\uba74 \ub428\n///    - \ubaa8\ub4e0 UseCase\ub294 \uc601\ud5a5 \ubc1b\uc9c0 \uc54a\uc74c\n",
        "last_modified": "2026-01-14T22:54:09.701541"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:06.021344",
  "last_updated": "2026-01-14T11:45:41.847196"
}