{
  "file_path": "BodiiTests/Data/Repositories/SleepRepositoryTests.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepRepositoryTests.swift\n//  BodiiTests\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Integration Testing for Sleep Repository\n// Repository\uc640 Data Source\uc758 \ud1b5\ud569 \ud14c\uc2a4\ud2b8\n// \ud83d\udca1 Java \ube44\uad50: @DataJpaTest\uc640 \uc720\uc0ac\ud55c \ud1b5\ud569 \ud14c\uc2a4\ud2b8\n\nimport XCTest\nimport CoreData\n@testable import Bodii\n\n/// SleepRepository\uc640 SleepLocalDataSource\uc758 \ud1b5\ud569 \ud14c\uc2a4\ud2b8\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Integration Test\n/// - Unit Test: \uac1c\ubcc4 \ucef4\ud3ec\ub10c\ud2b8\ub97c Mock\uacfc \ud568\uaed8 \ud14c\uc2a4\ud2b8\n/// - Integration Test: \uc5ec\ub7ec \ucef4\ud3ec\ub10c\ud2b8\uac00 \ud568\uaed8 \uc791\ub3d9\ud558\ub294\uc9c0 \ud14c\uc2a4\ud2b8\n/// \ud83d\udca1 Java \ube44\uad50: JUnit + @DataJpaTest\uc640 \uc720\uc0ac\nfinal class SleepRepositoryTests: XCTestCase {\n\n    // MARK: - Properties\n\n    /// \ud14c\uc2a4\ud2b8 \ub300\uc0c1 Repository\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: System Under Test (SUT)\n    var sut: SleepRepository!\n\n    /// \ud14c\uc2a4\ud2b8\uc6a9 Data Source\n    var dataSource: SleepLocalDataSource!\n\n    /// \ud14c\uc2a4\ud2b8\uc6a9 Persistence Controller (\uc778\uba54\ubaa8\ub9ac)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: In-Memory Core Data Stack\n    /// - \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uace0 \uba54\ubaa8\ub9ac\uc5d0\uc11c\ub9cc \ub3d9\uc791\n    /// - \ud14c\uc2a4\ud2b8 \uac04 \uaca9\ub9ac \ubcf4\uc7a5 (\ub3c5\ub9bd\uc131)\n    /// - \ube60\ub978 \uc2e4\ud589 \uc18d\ub3c4\n    var testPersistenceController: PersistenceController!\n\n    // MARK: - Setup & Teardown\n\n    /// \uac01 \ud14c\uc2a4\ud2b8 \uc2e4\ud589 \uc804 \ud638\ucd9c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Setup\n    /// - \uac01 \ud14c\uc2a4\ud2b8\ub9c8\ub2e4 \uae68\ub057\ud55c \uc0c1\ud0dc\ub85c \uc2dc\uc791\n    /// - \ud14c\uc2a4\ud2b8 \uac04 \uc758\uc874\uc131 \uc81c\uac70\n    override func setUp() {\n        super.setUp()\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: In-Memory Store for Testing\n        // \uc778\uba54\ubaa8\ub9ac Core Data \uc2a4\ud0dd \uc0dd\uc131\n        testPersistenceController = PersistenceController(inMemory: true)\n\n        // \ub370\uc774\ud130 \uc18c\uc2a4\uc640 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac \ucd08\uae30\ud654\n        dataSource = SleepLocalDataSource(persistenceController: testPersistenceController)\n        sut = SleepRepository(localDataSource: dataSource)\n    }\n\n    /// \uac01 \ud14c\uc2a4\ud2b8 \uc2e4\ud589 \ud6c4 \ud638\ucd9c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Teardown\n    /// - \uba54\ubaa8\ub9ac \uc815\ub9ac\n    /// - \ub2e4\uc74c \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc900\ube44\n    override func tearDown() {\n        sut = nil\n        dataSource = nil\n        testPersistenceController = nil\n        super.tearDown()\n    }\n\n    // MARK: - Helper Methods\n\n    /// \ud14c\uc2a4\ud2b8\uc6a9 SleepRecord \uc0dd\uc131\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Helper Method\n    /// - \ud14c\uc2a4\ud2b8 \ub370\uc774\ud130 \uc0dd\uc131 \ub85c\uc9c1\uc744 \uc7ac\uc0ac\uc6a9\n    /// - \uac00\ub3c5\uc131 \ud5a5\uc0c1\n    private func makeTestSleepRecord(\n        id: UUID = UUID(),\n        userId: UUID = UUID(),\n        date: Date = Date(),\n        duration: Int32 = 420,  // 7\uc2dc\uac04 (good)\n        status: SleepStatus = .good,\n        createdAt: Date = Date(),\n        updatedAt: Date = Date()\n    ) -> Bodii.SleepRecord {\n        return Bodii.SleepRecord(\n            id: id,\n            userId: userId,\n            date: date,\n            duration: duration,\n            status: status,\n            createdAt: createdAt,\n            updatedAt: updatedAt\n        )\n    }\n\n    // MARK: - Create Tests\n\n    /// \uc800\uc7a5 - \uc815\uc0c1 \ucf00\uc774\uc2a4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async Test\n    /// - async/await\ub97c \uc0ac\uc6a9\ud558\ub294 \uba54\uc11c\ub4dc \ud14c\uc2a4\ud2b8\n    /// - XCTest\uc758 async throws \uc9c0\uc6d0\n    func testSave_ValidData_SavesSuccessfully() async throws {\n        // Given: \uc720\ud6a8\ud55c \uc218\uba74 \uae30\ub85d \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord()\n\n        // When: \uc800\uc7a5 \uc2e4\ud589\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // Then: \uc800\uc7a5 \uc131\uacf5\n        XCTAssertNotNil(savedRecord, \"\uc800\uc7a5\ub41c \ub808\ucf54\ub4dc\uac00 nil\uc774 \uc544\ub2c8\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(savedRecord.duration, sleepRecord.duration, \"duration\uc774 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(savedRecord.status, sleepRecord.status, \"status\uac00 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc800\uc7a5 \ud6c4 \uc870\ud68c - \ub370\uc774\ud130 \uc601\uc18d\uc131 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Persistence Verification\n    /// - \uc800\uc7a5\ub41c \ub370\uc774\ud130\uac00 \uc2e4\uc81c\ub85c \uc870\ud68c\ub418\ub294\uc9c0 \ud655\uc778\n    func testSave_ThenFetch_DataPersists() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord(duration: 480, status: .excellent)\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: ID\ub85c \uc870\ud68c\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n        // Then: \uc870\ud68c \uc131\uacf5 \ubc0f \ub370\uc774\ud130 \uc77c\uce58\n        XCTAssertNotNil(fetchedRecord, \"\uc800\uc7a5\ub41c \ub370\uc774\ud130\ub97c \uc870\ud68c\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(fetchedRecord?.id, savedRecord.id, \"ID\uac00 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(fetchedRecord?.duration, 480, \"duration\uc774 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(fetchedRecord?.status, .excellent, \"status\uac00 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc800\uc7a5 - \ub2e4\uc591\ud55c sleep status \uac12\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Enum Value Testing\n    /// - \ubaa8\ub4e0 SleepStatus \ucf00\uc774\uc2a4\uac00 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub418\ub294\uc9c0 \ud655\uc778\n    func testSave_AllStatusValues_SavesCorrectly() async throws {\n        // Given: \ubaa8\ub4e0 status \uac12\uc5d0 \ub300\ud55c \ud14c\uc2a4\ud2b8 \ucf00\uc774\uc2a4\n        let testCases: [(duration: Int32, status: SleepStatus, description: String)] = [\n            (240, .bad, \"bad\"),\n            (360, .soso, \"soso\"),\n            (420, .good, \"good\"),\n            (480, .excellent, \"excellent\"),\n            (600, .oversleep, \"oversleep\")\n        ]\n\n        // When/Then: \uac01 status \uac12\uc774 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub428\n        for testCase in testCases {\n            let sleepRecord = makeTestSleepRecord(\n                duration: testCase.duration,\n                status: testCase.status\n            )\n            let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n            XCTAssertEqual(\n                savedRecord.status,\n                testCase.status,\n                \"\\(testCase.description) status\uac00 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\"\n            )\n            XCTAssertEqual(\n                savedRecord.duration,\n                testCase.duration,\n                \"\\(testCase.description) duration\uc774 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\"\n            )\n        }\n    }\n\n    /// \uc800\uc7a5 - 0\ubd84 \uc218\uba74 \uc2dc\uac04 (\ubc24\uc0d8)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Edge Case Testing\n    /// - \ucd5c\uc18c\uac12 \uacbd\uacc4 \uc870\uac74 \ud14c\uc2a4\ud2b8\n    func testSave_ZeroDuration_SavesSuccessfully() async throws {\n        // Given: 0\ubd84 \uc218\uba74 \uc2dc\uac04 (\ubc24\uc0d8)\n        let sleepRecord = makeTestSleepRecord(duration: 0, status: .bad)\n\n        // When: \uc800\uc7a5\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // Then: 0\ubd84\ub3c4 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub428\n        XCTAssertEqual(savedRecord.duration, 0, \"duration\uc774 0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(savedRecord.status, .bad, \"0\ubd84\uc740 bad status\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc800\uc7a5 - \ub9e4\uc6b0 \uae34 \uc218\uba74 \uc2dc\uac04\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Large Value Testing\n    func testSave_LargeDuration_SavesSuccessfully() async throws {\n        // Given: \ub9e4\uc6b0 \uae34 \uc218\uba74 \uc2dc\uac04 (12\uc2dc\uac04)\n        let sleepRecord = makeTestSleepRecord(duration: 720, status: .oversleep)\n\n        // When: \uc800\uc7a5\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // Then: \ud070 \uac12\ub3c4 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub428\n        XCTAssertEqual(savedRecord.duration, 720, \"duration\uc774 720\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(savedRecord.status, .oversleep, \"oversleep status\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Read Tests (Single)\n\n    /// ID\ub85c \uc870\ud68c - \uc874\uc7ac\ud558\ub294 \ub370\uc774\ud130\n    func testFetchById_ExistingData_ReturnsRecord() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord()\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: ID\ub85c \uc870\ud68c\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n        // Then: \ub370\uc774\ud130 \ubc18\ud658\n        XCTAssertNotNil(fetchedRecord)\n        XCTAssertEqual(fetchedRecord?.id, savedRecord.id)\n    }\n\n    /// ID\ub85c \uc870\ud68c - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130\n    func testFetchById_NonExistingData_ReturnsNil() async throws {\n        // Given: \uc800\uc7a5\ub418\uc9c0 \uc54a\uc740 ID\n        let nonExistingId = UUID()\n\n        // When: \uc870\ud68c\n        let fetchedRecord = try await sut.fetch(by: nonExistingId)\n\n        // Then: nil \ubc18\ud658\n        XCTAssertNil(fetchedRecord, \"\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 ID\ub294 nil\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub0a0\uc9dc\ub85c \uc870\ud68c - \ud574\ub2f9 \ub0a0\uc9dc \ub370\uc774\ud130 \uc874\uc7ac\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date-based Query\n    /// - 02:00 \uacbd\uacc4 \ub85c\uc9c1 \uc801\uc6a9\ub41c \ub0a0\uc9dc\ub85c \uc870\ud68c\n    func testFetchByDate_ExistingData_ReturnsRecord() async throws {\n        // Given: \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ub370\uc774\ud130 \uc800\uc7a5\n        let calendar = Calendar.current\n        let testDate = calendar.startOfDay(for: Date())\n        let sleepRecord = makeTestSleepRecord(date: testDate, duration: 420, status: .good)\n\n        _ = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: \ub0a0\uc9dc\ub85c \uc870\ud68c\n        let fetchedRecord = try await sut.fetch(for: testDate)\n\n        // Then: \ub370\uc774\ud130 \ubc18\ud658\n        XCTAssertNotNil(fetchedRecord, \"\ud574\ub2f9 \ub0a0\uc9dc\uc758 \ub370\uc774\ud130\ub97c \ucc3e\uc744 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Comparison\n        // \uac19\uc740 \ub0a0\uc9dc\uc778\uc9c0 \ud655\uc778 (\uc2dc\uac04 \ubd80\ubd84 \uc81c\uc678)\n        let fetchedDateComponents = calendar.dateComponents([.year, .month, .day], from: fetchedRecord!.date)\n        let testDateComponents = calendar.dateComponents([.year, .month, .day], from: testDate)\n        XCTAssertEqual(fetchedDateComponents, testDateComponents, \"\ub0a0\uc9dc\uac00 \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub0a0\uc9dc\ub85c \uc870\ud68c - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub0a0\uc9dc\n    func testFetchByDate_NonExistingDate_ReturnsNil() async throws {\n        // Given: \ub370\uc774\ud130\uac00 \uc5c6\ub294 \ub0a0\uc9dc\n        let calendar = Calendar.current\n        let futureDate = calendar.date(byAdding: .day, value: 30, to: Date())!\n\n        // When: \uc870\ud68c\n        let fetchedRecord = try await sut.fetch(for: futureDate)\n\n        // Then: nil \ubc18\ud658\n        XCTAssertNil(fetchedRecord, \"\ub370\uc774\ud130\uac00 \uc5c6\ub294 \ub0a0\uc9dc\ub294 nil\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ucd5c\uc2e0 \ub370\uc774\ud130 \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Latest Record Query\n    /// - \ub300\uc2dc\ubcf4\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ud575\uc2ec \ucffc\ub9ac\n    func testFetchLatest_MultipleRecords_ReturnsLatest() async throws {\n        // Given: \uc5ec\ub7ec \ub0a0\uc9dc\uc758 \ub370\uc774\ud130 \uc800\uc7a5\n        let calendar = Calendar.current\n        let today = Date()\n\n        // 3\uc77c \uc804 \ub370\uc774\ud130\n        let threeDaysAgo = calendar.date(byAdding: .day, value: -3, to: today)!\n        let record1 = makeTestSleepRecord(date: threeDaysAgo, duration: 360, status: .soso)\n        _ = try await sut.save(sleepRecord: record1)\n\n        // 1\uc77c \uc804 \ub370\uc774\ud130\n        let oneDayAgo = calendar.date(byAdding: .day, value: -1, to: today)!\n        let record2 = makeTestSleepRecord(date: oneDayAgo, duration: 420, status: .good)\n        _ = try await sut.save(sleepRecord: record2)\n\n        // \uc624\ub298 \ub370\uc774\ud130 (\uac00\uc7a5 \ucd5c\uc2e0)\n        let record3 = makeTestSleepRecord(date: today, duration: 480, status: .excellent)\n        _ = try await sut.save(sleepRecord: record3)\n\n        // When: \ucd5c\uc2e0 \ub370\uc774\ud130 \uc870\ud68c\n        let latestRecord = try await sut.fetchLatest()\n\n        // Then: \uac00\uc7a5 \ucd5c\uc2e0 \ub370\uc774\ud130 \ubc18\ud658\n        XCTAssertNotNil(latestRecord, \"\ucd5c\uc2e0 \ub370\uc774\ud130\ub97c \uc870\ud68c\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(latestRecord?.duration, 480, \"\uac00\uc7a5 \ucd5c\uc2e0 \ub370\uc774\ud130\uac00 \ubc18\ud658\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(latestRecord?.status, .excellent, \"\uac00\uc7a5 \ucd5c\uc2e0 status\uac00 \ubc18\ud658\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ucd5c\uc2e0 \ub370\uc774\ud130 \uc870\ud68c - \ub370\uc774\ud130 \uc5c6\uc74c\n    func testFetchLatest_NoData_ReturnsNil() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130 \uc5c6\uc74c\n\n        // When: \ucd5c\uc2e0 \ub370\uc774\ud130 \uc870\ud68c\n        let latestRecord = try await sut.fetchLatest()\n\n        // Then: nil \ubc18\ud658\n        XCTAssertNil(latestRecord, \"\ub370\uc774\ud130\uac00 \uc5c6\uc73c\uba74 nil\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Read Tests (Multiple)\n\n    /// \ubaa8\ub4e0 \ub370\uc774\ud130 \uc870\ud68c\n    func testFetchAll_MultipleRecords_ReturnsAll() async throws {\n        // Given: \uc5ec\ub7ec \ub370\uc774\ud130 \uc800\uc7a5\n        let record1 = makeTestSleepRecord(duration: 360, status: .soso)\n        let record2 = makeTestSleepRecord(duration: 420, status: .good)\n        let record3 = makeTestSleepRecord(duration: 480, status: .excellent)\n\n        _ = try await sut.save(sleepRecord: record1)\n        _ = try await sut.save(sleepRecord: record2)\n        _ = try await sut.save(sleepRecord: record3)\n\n        // When: \ubaa8\ub4e0 \ub370\uc774\ud130 \uc870\ud68c\n        let allRecords = try await sut.fetchAll()\n\n        // Then: 3\uac1c\uc758 \ub370\uc774\ud130 \ubc18\ud658\n        XCTAssertEqual(allRecords.count, 3, \"3\uac1c\uc758 \ub370\uc774\ud130\ub97c \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ubaa8\ub4e0 \ub370\uc774\ud130 \uc870\ud68c - \ub370\uc774\ud130 \uc5c6\uc74c\n    func testFetchAll_NoData_ReturnsEmptyArray() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130 \uc5c6\uc74c\n\n        // When: \ubaa8\ub4e0 \ub370\uc774\ud130 \uc870\ud68c\n        let allRecords = try await sut.fetchAll()\n\n        // Then: \ube48 \ubc30\uc5f4 \ubc18\ud658\n        XCTAssertTrue(allRecords.isEmpty, \"\ub370\uc774\ud130\uac00 \uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub0a0\uc9dc \ubc94\uc704 \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Range Query Testing\n    /// - \ud2b8\ub80c\ub4dc \ucc28\ud2b8\uc758 \ud575\uc2ec \uae30\ub2a5\n    func testFetchDateRange_ReturnsRecordsInRange() async throws {\n        // Given: 7\uc77c\uac04\uc758 \ub370\uc774\ud130 \uc800\uc7a5\n        let calendar = Calendar.current\n        let today = Date()\n\n        for daysAgo in 0..<7 {\n            let date = calendar.date(byAdding: .day, value: -daysAgo, to: today)!\n            let record = makeTestSleepRecord(\n                date: date,\n                duration: Int32(360 + daysAgo * 30)  // 6\uc2dc\uac04\ubd80\ud130 \uc810\uc9c4\uc801 \uc99d\uac00\n            )\n            _ = try await sut.save(sleepRecord: record)\n        }\n\n        // When: \ucd5c\uadfc 3\uc77c\uac04\uc758 \ub370\uc774\ud130 \uc870\ud68c\n        let startDate = calendar.date(byAdding: .day, value: -2, to: today)!\n        let endDate = today\n        let records = try await sut.fetch(from: startDate, to: endDate)\n\n        // Then: 3\uac1c\uc758 \ub370\uc774\ud130 \ubc18\ud658 (0\uc77c \uc804, 1\uc77c \uc804, 2\uc77c \uc804)\n        XCTAssertEqual(records.count, 3, \"3\uc77c\uac04\uc758 \ub370\uc774\ud130\ub97c \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c \ud655\uc778\n        // Swift Charts\uc5d0\uc11c \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 \uc624\ub984\ucc28\uc21c \uc815\ub82c \ud544\uc694\n        for i in 0..<(records.count - 1) {\n            XCTAssertLessThanOrEqual(records[i].date, records[i + 1].date,\n                                    \"\ub0a0\uc9dc\uac00 \uc624\ub984\ucc28\uc21c\uc73c\ub85c \uc815\ub82c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \ub0a0\uc9dc \ubc94\uc704 \uc870\ud68c - \ube48 \uacb0\uacfc\n    func testFetchDateRange_NoRecordsInRange_ReturnsEmptyArray() async throws {\n        // Given: \uc624\ub298 \ub370\uc774\ud130\ub9cc \uc800\uc7a5\n        let today = Date()\n        let record = makeTestSleepRecord(date: today)\n        _ = try await sut.save(sleepRecord: record)\n\n        // When: \uacfc\uac70 \ub0a0\uc9dc \ubc94\uc704\ub85c \uc870\ud68c (\ub370\uc774\ud130 \uc5c6\uc74c)\n        let calendar = Calendar.current\n        let startDate = calendar.date(byAdding: .day, value: -30, to: today)!\n        let endDate = calendar.date(byAdding: .day, value: -10, to: today)!\n        let records = try await sut.fetch(from: startDate, to: endDate)\n\n        // Then: \ube48 \ubc30\uc5f4 \ubc18\ud658\n        XCTAssertTrue(records.isEmpty, \"\ubc94\uc704 \ub0b4\uc5d0 \ub370\uc774\ud130\uac00 \uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ucd5c\uadfc N\uc77c \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Recent Days Query\n    /// - \ud788\uc2a4\ud1a0\ub9ac \ubdf0\uc5d0\uc11c \uc790\uc8fc \uc0ac\uc6a9\ud558\ub294 \ucffc\ub9ac\n    func testFetchRecent_ReturnsDaysOfData() async throws {\n        // Given: 30\uc77c\uac04\uc758 \ub370\uc774\ud130 \uc800\uc7a5\n        let calendar = Calendar.current\n        let today = Date()\n\n        for daysAgo in 0..<30 {\n            let date = calendar.date(byAdding: .day, value: -daysAgo, to: today)!\n            let record = makeTestSleepRecord(date: date)\n            _ = try await sut.save(sleepRecord: record)\n        }\n\n        // When: \ucd5c\uadfc 7\uc77c \uc870\ud68c\n        let recentRecords = try await sut.fetchRecent(days: 7)\n\n        // Then: 7\uc77c \uc774\ub0b4\uc758 \ub370\uc774\ud130\ub9cc \ubc18\ud658\n        XCTAssertLessThanOrEqual(recentRecords.count, 8, \"\ucd5c\ub300 7-8\uc77c\uc758 \ub370\uc774\ud130\ub97c \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n\n        // \ubaa8\ub4e0 \ub370\uc774\ud130\uac00 7\uc77c \uc774\ub0b4\uc778\uc9c0 \ud655\uc778\n        let sevenDaysAgo = calendar.date(byAdding: .day, value: -7, to: today)!\n        for record in recentRecords {\n            XCTAssertGreaterThanOrEqual(record.date, sevenDaysAgo,\n                                       \"\ubaa8\ub4e0 \ub370\uc774\ud130\uac00 7\uc77c \uc774\ub0b4\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \ucd5c\uadfc N\uc77c \uc870\ud68c - \ub370\uc774\ud130 \ubd80\uc871\n    func testFetchRecent_LessThanRequestedDays_ReturnsAvailableData() async throws {\n        // Given: 3\uc77c \ub370\uc774\ud130\ub9cc \uc800\uc7a5\n        let calendar = Calendar.current\n        let today = Date()\n\n        for daysAgo in 0..<3 {\n            let date = calendar.date(byAdding: .day, value: -daysAgo, to: today)!\n            let record = makeTestSleepRecord(date: date)\n            _ = try await sut.save(sleepRecord: record)\n        }\n\n        // When: \ucd5c\uadfc 7\uc77c \uc870\ud68c (\uc2e4\uc81c\ub85c\ub294 3\uc77c\ub9cc \uc788\uc74c)\n        let recentRecords = try await sut.fetchRecent(days: 7)\n\n        // Then: \uc0ac\uc6a9 \uac00\ub2a5\ud55c 3\uc77c \ub370\uc774\ud130\ub9cc \ubc18\ud658\n        XCTAssertEqual(recentRecords.count, 3, \"\uc0ac\uc6a9 \uac00\ub2a5\ud55c \ub370\uc774\ud130\ub9cc \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Update Tests\n\n    /// \uc5c5\ub370\uc774\ud2b8 - \uc815\uc0c1 \ucf00\uc774\uc2a4\n    func testUpdate_ExistingRecord_UpdatesSuccessfully() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord(duration: 360, status: .soso)\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: duration\uacfc status \uc218\uc815\n        var updatedRecord = savedRecord\n        updatedRecord.duration = 480\n        updatedRecord.status = .excellent\n\n        let result = try await sut.update(sleepRecord: updatedRecord)\n\n        // Then: \uc5c5\ub370\uc774\ud2b8 \uc131\uacf5\n        XCTAssertEqual(result.duration, 480, \"duration\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(result.status, .excellent, \"status\uac00 \uc5c5\ub370\uc774\ud2b8\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // \uc870\ud68c\ud558\uc5ec \ud655\uc778\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n        XCTAssertEqual(fetchedRecord?.duration, 480, \"\uc870\ud68c\ud55c \ub370\uc774\ud130\ub3c4 \uc5c5\ub370\uc774\ud2b8\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(fetchedRecord?.status, .excellent, \"\uc870\ud68c\ud55c status\ub3c4 \uc5c5\ub370\uc774\ud2b8\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc5c5\ub370\uc774\ud2b8 - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Case Testing\n    /// - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 ID \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc5d0\ub7ec \ubc1c\uc0dd\n    func testUpdate_NonExistingRecord_ThrowsError() async throws {\n        // Given: \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 ID\n        let nonExistingRecord = makeTestSleepRecord()\n\n        // When/Then: \uc5d0\ub7ec \ubc1c\uc0dd\n        do {\n            _ = try await sut.update(sleepRecord: nonExistingRecord)\n            XCTFail(\"\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        } catch let error as RepositoryError {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Type Checking\n            // \ud2b9\uc815 \uc5d0\ub7ec \ud0c0\uc785\uc774 \ubc1c\uc0dd\ud558\ub294\uc9c0 \ud655\uc778\n            if case .notFound = error {\n                // \uc608\uc0c1\ub41c \uc5d0\ub7ec\n            } else if case .updateFailed = error {\n                // updateFailed\ub3c4 \ud5c8\uc6a9 (\uad6c\ud604\uc5d0 \ub530\ub77c)\n            } else {\n                XCTFail(\"notFound \ub610\ub294 updateFailed \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n            }\n        } catch {\n            XCTFail(\"RepositoryError \ud0c0\uc785\uc758 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \uc5c5\ub370\uc774\ud2b8 - \ub2e4\uc591\ud55c status\ub85c \ubcc0\uacbd\n    func testUpdate_ChangeStatus_UpdatesSuccessfully() async throws {\n        // Given: bad status \ub808\ucf54\ub4dc \uc800\uc7a5\n        let sleepRecord = makeTestSleepRecord(duration: 240, status: .bad)\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: excellent status\ub85c \ubcc0\uacbd\n        var updatedRecord = savedRecord\n        updatedRecord.duration = 480\n        updatedRecord.status = .excellent\n\n        let result = try await sut.update(sleepRecord: updatedRecord)\n\n        // Then: status\uac00 \ubcc0\uacbd\ub428\n        XCTAssertEqual(result.status, .excellent, \"status\uac00 excellent\ub85c \ubcc0\uacbd\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(result.duration, 480, \"duration\ub3c4 \ubcc0\uacbd\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Delete Tests\n\n    /// \uc0ad\uc81c - \uc815\uc0c1 \ucf00\uc774\uc2a4\n    func testDelete_ExistingRecord_DeletesSuccessfully() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord()\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // When: \uc0ad\uc81c\n        try await sut.delete(by: savedRecord.id)\n\n        // Then: \uc870\ud68c \uc2dc nil \ubc18\ud658\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n        XCTAssertNil(fetchedRecord, \"\uc0ad\uc81c\ub41c \ub370\uc774\ud130\ub294 \uc870\ud68c\ub418\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc0ad\uc81c - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130\n    func testDelete_NonExistingRecord_ThrowsError() async throws {\n        // Given: \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 ID\n        let nonExistingId = UUID()\n\n        // When/Then: \uc5d0\ub7ec \ubc1c\uc0dd\n        do {\n            try await sut.delete(by: nonExistingId)\n            XCTFail(\"\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130 \uc0ad\uc81c \uc2dc \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        } catch let error as RepositoryError {\n            if case .notFound = error {\n                // \uc608\uc0c1\ub41c \uc5d0\ub7ec\n            } else if case .deleteFailed = error {\n                // deleteFailed\ub3c4 \ud5c8\uc6a9 (\uad6c\ud604\uc5d0 \ub530\ub77c)\n            } else {\n                XCTFail(\"notFound \ub610\ub294 deleteFailed \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n            }\n        } catch {\n            XCTFail(\"RepositoryError \ud0c0\uc785\uc758 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \uc804\uccb4 \uc0ad\uc81c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Bulk Delete Testing\n    func testDeleteAll_RemovesAllRecords() async throws {\n        // Given: \uc5ec\ub7ec \ub370\uc774\ud130 \uc800\uc7a5\n        for i in 0..<5 {\n            let record = makeTestSleepRecord(duration: Int32(360 + i * 30))\n            _ = try await sut.save(sleepRecord: record)\n        }\n\n        // \uc800\uc7a5 \ud655\uc778\n        let allRecordsBeforeDelete = try await sut.fetchAll()\n        XCTAssertEqual(allRecordsBeforeDelete.count, 5, \"5\uac1c\uc758 \ub370\uc774\ud130\uac00 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uc804\uccb4 \uc0ad\uc81c\n        try await sut.deleteAll()\n\n        // Then: \ubaa8\ub4e0 \ub370\uc774\ud130 \uc0ad\uc81c\n        let allRecordsAfterDelete = try await sut.fetchAll()\n        XCTAssertTrue(allRecordsAfterDelete.isEmpty, \"\ubaa8\ub4e0 \ub370\uc774\ud130\uac00 \uc0ad\uc81c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc0ad\uc81c \ud6c4 \ub2e4\uc2dc \uc870\ud68c - \ub370\uc774\ud130 \ubd88\uc77c\uce58 \uac80\uc99d\n    func testDelete_ThenFetch_ReturnsNil() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130\n        let sleepRecord = makeTestSleepRecord()\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n\n        // \uc800\uc7a5 \ud655\uc778\n        let beforeDelete = try await sut.fetch(by: savedRecord.id)\n        XCTAssertNotNil(beforeDelete, \"\uc0ad\uc81c \uc804\uc5d0\ub294 \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud574\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uc0ad\uc81c\n        try await sut.delete(by: savedRecord.id)\n\n        // Then: \uc870\ud68c \uc2dc nil\n        let afterDelete = try await sut.fetch(by: savedRecord.id)\n        XCTAssertNil(afterDelete, \"\uc0ad\uc81c \ud6c4\uc5d0\ub294 nil\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Data Integrity Tests\n\n    /// \ub370\uc774\ud130 \ubb34\uacb0\uc131 - Int32 \uac12 \ubcf4\uc874\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Type Precision Testing\n    func testDataIntegrity_PreservesInt32Values() async throws {\n        // Given: \ub2e4\uc591\ud55c duration \uac12 (Int32)\n        let testCases: [Int32] = [0, 60, 240, 360, 420, 480, 600, 720]\n\n        for duration in testCases {\n            // When: \uc800\uc7a5 \ud6c4 \uc870\ud68c\n            let record = makeTestSleepRecord(duration: duration)\n            let savedRecord = try await sut.save(sleepRecord: record)\n            let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n            // Then: \uac12 \ubcf4\uc874\n            XCTAssertEqual(fetchedRecord?.duration, duration,\n                          \"duration \\(duration)\uc774 \ubcf4\uc874\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \ub370\uc774\ud130 \ubb34\uacb0\uc131 - \ub0a0\uc9dc \uc815\ud655\ub3c4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Precision Testing\n    func testDataIntegrity_PreservesDateAccuracy() async throws {\n        // Given: \ud2b9\uc815 \uc2dc\uac04\uc758 \ub370\uc774\ud130\n        let calendar = Calendar.current\n        let testDate = calendar.date(from: DateComponents(\n            year: 2026, month: 1, day: 14,\n            hour: 14, minute: 30, second: 0\n        ))!\n\n        let sleepRecord = makeTestSleepRecord(date: testDate)\n\n        // When: \uc800\uc7a5 \ud6c4 \uc870\ud68c\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n        // Then: \ub0a0\uc9dc \uc815\ud655\ub3c4 \uc720\uc9c0 (\ubd84 \ub2e8\uc704\uae4c\uc9c0)\n        XCTAssertNotNil(fetchedRecord)\n\n        let savedComponents = calendar.dateComponents(\n            [.year, .month, .day, .hour, .minute],\n            from: fetchedRecord!.date\n        )\n        let testComponents = calendar.dateComponents(\n            [.year, .month, .day, .hour, .minute],\n            from: testDate\n        )\n        XCTAssertEqual(savedComponents, testComponents, \"\ub0a0\uc9dc \uc815\ud655\ub3c4\uac00 \uc720\uc9c0\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub370\uc774\ud130 \ubb34\uacb0\uc131 - UUID \ubcf4\uc874\n    func testDataIntegrity_PreservesUUIDs() async throws {\n        // Given: \ud2b9\uc815 UUID\ub97c \uac00\uc9c4 \ub808\ucf54\ub4dc\n        let recordId = UUID()\n        let userId = UUID()\n        let sleepRecord = makeTestSleepRecord(id: recordId, userId: userId)\n\n        // When: \uc800\uc7a5 \ud6c4 \uc870\ud68c\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n        // Then: UUID \ubcf4\uc874\n        XCTAssertEqual(fetchedRecord?.id, recordId, \"record ID\uac00 \ubcf4\uc874\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(fetchedRecord?.userId, userId, \"user ID\uac00 \ubcf4\uc874\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub370\uc774\ud130 \ubb34\uacb0\uc131 - \ub3d9\uc2dc\uc131 \ud14c\uc2a4\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Concurrent Access Testing\n    func testDataIntegrity_HandlesMultipleConcurrentSaves() async throws {\n        // Given: \uc5ec\ub7ec \uc800\uc7a5 \uc791\uc5c5\uc744 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\n\n        // When: 5\uac1c\uc758 \uc800\uc7a5 \uc791\uc5c5\uc744 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\n        await withTaskGroup(of: Void.self) { group in\n            for i in 0..<5 {\n                group.addTask {\n                    let record = self.makeTestSleepRecord(duration: Int32(360 + i * 30))\n                    _ = try? await self.sut.save(sleepRecord: record)\n                }\n            }\n        }\n\n        // Then: \ubaa8\ub4e0 \ub370\uc774\ud130\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \uc800\uc7a5\ub428\n        let allRecords = try await sut.fetchAll()\n        XCTAssertEqual(allRecords.count, 5, \"5\uac1c\uc758 \ub370\uc774\ud130\uac00 \ubaa8\ub450 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub370\uc774\ud130 \ubb34\uacb0\uc131 - createdAt/updatedAt \ud0c0\uc784\uc2a4\ud0ec\ud504\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Timestamp Testing\n    func testDataIntegrity_PreservesTimestamps() async throws {\n        // Given: \ud2b9\uc815 \ud0c0\uc784\uc2a4\ud0ec\ud504\ub97c \uac00\uc9c4 \ub808\ucf54\ub4dc\n        let createdAt = Date()\n        let updatedAt = Date()\n        let sleepRecord = makeTestSleepRecord(createdAt: createdAt, updatedAt: updatedAt)\n\n        // When: \uc800\uc7a5 \ud6c4 \uc870\ud68c\n        let savedRecord = try await sut.save(sleepRecord: sleepRecord)\n        let fetchedRecord = try await sut.fetch(by: savedRecord.id)\n\n        // Then: \ud0c0\uc784\uc2a4\ud0ec\ud504 \ubcf4\uc874\n        XCTAssertNotNil(fetchedRecord?.createdAt, \"createdAt\uc774 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertNotNil(fetchedRecord?.updatedAt, \"updatedAt\uc774 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Edge Case Tests\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - \uac19\uc740 \ub0a0\uc9dc\uc5d0 \uc5ec\ub7ec \ub808\ucf54\ub4dc \uc800\uc7a5 \uc2dc\ub3c4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Business Rule Testing\n    /// - \ud558\ub8e8\uc5d0 \ud558\ub098\uc758 \uc218\uba74 \uae30\ub85d\ub9cc \uc800\uc7a5 \uac00\ub2a5 (DailyLog \uc81c\uc57d)\n    func testEdgeCase_MultipleSavesOnSameDate_LastOneWins() async throws {\n        // Given: \uac19\uc740 \ub0a0\uc9dc\uc758 \ub808\ucf54\ub4dc 2\uac1c\n        let calendar = Calendar.current\n        let testDate = calendar.startOfDay(for: Date())\n\n        let record1 = makeTestSleepRecord(date: testDate, duration: 360, status: .soso)\n        let record2 = makeTestSleepRecord(date: testDate, duration: 480, status: .excellent)\n\n        // When: \uac19\uc740 \ub0a0\uc9dc\uc5d0 2\ubc88 \uc800\uc7a5\n        _ = try await sut.save(sleepRecord: record1)\n        _ = try await sut.save(sleepRecord: record2)\n\n        // Then: \ub0a0\uc9dc\ub85c \uc870\ud68c \uc2dc \ub9c8\uc9c0\ub9c9 \uc800\uc7a5\uc774 \uc801\uc6a9\ub428\n        let fetchedRecord = try await sut.fetch(for: testDate)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uad6c\ud604\uc5d0 \ub530\ub77c \ub2e4\ub97c \uc218 \uc788\uc74c\n        // - \uc635\uc158 1: \ub9c8\uc9c0\ub9c9 \uc800\uc7a5\uc774 \ub36e\uc5b4\uc500 (DailyLog \uc5c5\ub370\uc774\ud2b8)\n        // - \uc635\uc158 2: \ub458 \ub2e4 \uc800\uc7a5\ub428 (\ubcc4\ub3c4 \ub808\ucf54\ub4dc\ub85c)\n        // \uc5ec\uae30\uc11c\ub294 2\uac1c \ub808\ucf54\ub4dc\uac00 \ubaa8\ub450 \uc800\uc7a5\ub418\uc9c0\ub9cc \ub0a0\uc9dc\ub85c \uc870\ud68c\ub294 \uccab\ubc88\uc9f8 \ubc18\ud658\n        XCTAssertNotNil(fetchedRecord, \"\ub808\ucf54\ub4dc\uac00 \uc874\uc7ac\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - \ube48 \ubc30\uc5f4\uc5d0\uc11c fetchLatest\n    func testEdgeCase_FetchLatestFromEmpty_ReturnsNil() async throws {\n        // Given: \uc800\uc7a5\ub41c \ub370\uc774\ud130 \uc5c6\uc74c\n\n        // When: fetchLatest \ud638\ucd9c\n        let latest = try await sut.fetchLatest()\n\n        // Then: nil \ubc18\ud658\n        XCTAssertNil(latest, \"\ub370\uc774\ud130\uac00 \uc5c6\uc73c\uba74 nil\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - \ub0a0\uc9dc \ubc94\uc704\uac00 \uc5ed\uc21c\uc77c \ub54c\n    func testEdgeCase_ReverseDateRange_ReturnsEmptyOrError() async throws {\n        // Given: startDate > endDate (\uc5ed\uc21c)\n        let calendar = Calendar.current\n        let today = Date()\n        let startDate = today\n        let endDate = calendar.date(byAdding: .day, value: -7, to: today)!\n\n        // When: \uc5ed\uc21c \ub0a0\uc9dc \ubc94\uc704\ub85c \uc870\ud68c\n        let records = try await sut.fetch(from: startDate, to: endDate)\n\n        // Then: \ube48 \ubc30\uc5f4 \ubc18\ud658 (\ub610\ub294 \uc5d0\ub7ec, \uad6c\ud604\uc5d0 \ub530\ub77c)\n        XCTAssertTrue(records.isEmpty, \"\uc5ed\uc21c \ub0a0\uc9dc \ubc94\uc704\ub294 \ube48 \ubc30\uc5f4\uc744 \ubc18\ud658\ud574\uc57c \ud569\ub2c8\ub2e4\")\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepRepository Integration Test \uc791\uc131 \uac00\uc774\ub4dc\n///\n/// Integration Test\uc758 \ubaa9\uc801:\n/// - Repository\uc640 Data Source\uac00 \ud568\uaed8 \uc791\ub3d9\ud558\ub294\uc9c0 \ud655\uc778\n/// - \uc2e4\uc81c Core Data \uc791\uc5c5\uc774 \uc62c\ubc14\ub974\uac8c \uc218\ud589\ub418\ub294\uc9c0 \uac80\uc99d\n/// - 02:00 \uacbd\uacc4 \ub85c\uc9c1\uacfc DailyLog \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8 \ub3d9\uc791 \ud655\uc778\n///\n/// \ud14c\uc2a4\ud2b8 \uc804\ub7b5:\n/// 1. CRUD \uc791\uc5c5 \ud14c\uc2a4\ud2b8\n///    - Create: \uc800\uc7a5 \uae30\ub2a5\uacfc \ub370\uc774\ud130 \uc601\uc18d\uc131, \ub2e4\uc591\ud55c SleepStatus \uac12\n///    - Read: \ub2e8\uc77c/\ub2e4\uc911 \uc870\ud68c, \ub0a0\uc9dc \ubc94\uc704 \ucffc\ub9ac, \ucd5c\uc2e0 \ub808\ucf54\ub4dc \uc870\ud68c\n///    - Update: \uc218\uc815 \uae30\ub2a5\uacfc \uc5c5\ub370\uc774\ud2b8 \uac80\uc99d\n///    - Delete: \uc0ad\uc81c \uae30\ub2a5\uacfc cascade delete\n///\n/// 2. \ub370\uc774\ud130 \ubb34\uacb0\uc131 \ud14c\uc2a4\ud2b8\n///    - Int32 \uac12 \ubcf4\uc874 (duration)\n///    - \ub0a0\uc9dc \uc815\ud655\ub3c4 \uc720\uc9c0\n///    - UUID \ubcf4\uc874\n///    - \ud0c0\uc784\uc2a4\ud0ec\ud504 \ubcf4\uc874\n///    - \ub3d9\uc2dc\uc131 \ucc98\ub9ac\n///\n/// 3. \uc5e3\uc9c0 \ucf00\uc774\uc2a4 \ud14c\uc2a4\ud2b8\n///    - 0\ubd84 \uc218\uba74 \uc2dc\uac04 (\ubc24\uc0d8)\n///    - \ub9e4\uc6b0 \uae34 \uc218\uba74 \uc2dc\uac04 (12\uc2dc\uac04+)\n///    - \uac19\uc740 \ub0a0\uc9dc \uc5ec\ub7ec \ub808\ucf54\ub4dc\n///    - \ube48 \ub370\uc774\ud130\uc14b\n///    - \uc5ed\uc21c \ub0a0\uc9dc \ubc94\uc704\n///\n/// 4. \uc5d0\ub7ec \ucf00\uc774\uc2a4 \ud14c\uc2a4\ud2b8\n///    - \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ub370\uc774\ud130 \uc870\ud68c/\uc218\uc815/\uc0ad\uc81c\n///    - RepositoryError \ud0c0\uc785 \uac80\uc99d\n///\n/// In-Memory Core Data \uc0ac\uc6a9:\n/// - \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uc74c\n/// - \ud14c\uc2a4\ud2b8 \uac04 \uaca9\ub9ac \ubcf4\uc7a5\n/// - \ube60\ub978 \uc2e4\ud589 \uc18d\ub3c4\n/// - setUp/tearDown\uc73c\ub85c \uae68\ub057\ud55c \uc0c1\ud0dc \uc720\uc9c0\n///\n/// SleepRepository vs BodyRepository \ucc28\uc774\uc810:\n/// - SleepRepository: \ub2e8\uc77c \uc5d4\ud2f0\ud2f0 (SleepRecord)\ub9cc \uad00\ub9ac\n/// - BodyRepository: \ub450 \uc5d4\ud2f0\ud2f0 (BodyRecord + MetabolismSnapshot) \uad00\ub9ac\n/// - SleepRepository: 02:00 \uacbd\uacc4 \ub85c\uc9c1 \uc801\uc6a9\n/// - SleepRepository: DailyLog \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8 (Data Source\uc5d0\uc11c \ucc98\ub9ac)\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - \uac01 \ud14c\uc2a4\ud2b8\ub294 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589 \uac00\ub2a5\ud574\uc57c \ud568\n/// - Given-When-Then \ud328\ud134\uc73c\ub85c \uac00\ub3c5\uc131 \ud5a5\uc0c1\n/// - \ud14c\uc2a4\ud2b8 \uc2e4\ud328 \uc2dc \uba85\ud655\ud55c \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n/// - Edge case\uc640 Error case \ubaa8\ub450 \ud14c\uc2a4\ud2b8\n/// - Helper \uba54\uc11c\ub4dc\ub85c \ud14c\uc2a4\ud2b8 \ub370\uc774\ud130 \uc0dd\uc131 \ub85c\uc9c1 \uc7ac\uc0ac\uc6a9\n///\n/// \ud83d\udca1 Java \ube44\uad50:\n/// - JUnit + @DataJpaTest: Spring Boot\uc758 \ub370\uc774\ud130 \ub808\uc774\uc5b4 \ud14c\uc2a4\ud2b8\n/// - @Transactional: \uac01 \ud14c\uc2a4\ud2b8 \ud6c4 \ub864\ubc31 (Swift\ub294 In-Memory \uc0ac\uc6a9)\n/// - TestEntityManager: Swift\uc758 PersistenceController\uc640 \uc720\uc0ac\n/// - assertThrows()\uc640 \uc720\uc0ac\ud55c XCTAssertThrowsError\n///\n/// \ud14c\uc2a4\ud2b8 \ucee4\ubc84\ub9ac\uc9c0:\n/// - Save: 5\uac1c \ud14c\uc2a4\ud2b8 (\uc815\uc0c1, \uc601\uc18d\uc131, \ubaa8\ub4e0 status, \uacbd\uacc4\uac12)\n/// - Fetch: 8\uac1c \ud14c\uc2a4\ud2b8 (ID/\ub0a0\uc9dc/latest/all/range/recent)\n/// - Update: 3\uac1c \ud14c\uc2a4\ud2b8 (\uc815\uc0c1, \uc5d0\ub7ec, status \ubcc0\uacbd)\n/// - Delete: 4\uac1c \ud14c\uc2a4\ud2b8 (\uc815\uc0c1, \uc5d0\ub7ec, deleteAll, \uc7ac\uc870\ud68c)\n/// - Data Integrity: 5\uac1c \ud14c\uc2a4\ud2b8 (\ud0c0\uc785, \ub0a0\uc9dc, UUID, \ub3d9\uc2dc\uc131, \ud0c0\uc784\uc2a4\ud0ec\ud504)\n/// - Edge Cases: 3\uac1c \ud14c\uc2a4\ud2b8 (\uac19\uc740 \ub0a0\uc9dc, \ube48 \ub370\uc774\ud130, \uc5ed\uc21c \ubc94\uc704)\n/// \ucd1d: 28\uac1c \ud14c\uc2a4\ud2b8\n///\n",
        "last_modified": "2026-01-18T17:07:01.349879"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:05.323270",
  "last_updated": "2026-01-14T21:03:40.813415"
}