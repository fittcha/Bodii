{
  "file_path": "Bodii/Data/DataSources/Local/DailyLogLocalDataSource.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  DailyLogLocalDataSource.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data CRUD \uc791\uc5c5\n// LocalDataSource\ub294 Core Data\uc640 \uc9c1\uc811 \uc0c1\ud638\uc791\uc6a9\ud558\ub294 \uacc4\uce35\n// \ud83d\udca1 Java \ube44\uad50: DAO(Data Access Object) \ud328\ud134\uacfc \uc720\uc0ac\n\nimport Foundation\nimport CoreData\n\n// MARK: - DailyLogLocalDataSource\n\n/// DailyLog\uc758 Core Data \uc791\uc5c5\uc744 \ub2f4\ub2f9\ud558\ub294 \ub85c\uceec \ub370\uc774\ud130 \uc18c\uc2a4\n///\n/// ## \ucc45\uc784\n/// - Core Data\uc758 DailyLog \uc5d4\ud2f0\ud2f0 CRUD \uc791\uc5c5\n/// - NSManagedObject \u2194 Domain Entity \ub9e4\ud551\n/// - \ub0a0\uc9dc \uae30\ubc18 \uc870\ud68c\n/// - \uc6b4\ub3d9 \ub370\uc774\ud130 \uc99d\uac10 \ucc98\ub9ac\n///\n/// ## \uc758\uc874\uc131\n/// - NSManagedObjectContext: Core Data \ucee8\ud14d\uc2a4\ud2b8\n///\n/// - Example:\n/// ```swift\n/// let context = PersistenceController.shared.viewContext\n/// let dataSource = DailyLogLocalDataSource(context: context)\n///\n/// // DailyLog \uc870\ud68c \ub610\ub294 \uc0dd\uc131\n/// let dailyLog = try await dataSource.getOrCreate(\n///     for: Date(),\n///     userId: userId,\n///     bmr: 1650,\n///     tdee: 2310\n/// )\n/// ```\nfinal class DailyLogLocalDataSource {\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectContext\n    // Core Data\uc758 \uc791\uc5c5 \uacf5\uac04 - \uc5d4\ud2f0\ud2f0\uc758 CRUD \uc791\uc5c5\uc744 \ucd94\uc801\ud558\uace0 \uad00\ub9ac\n    // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n    private let context: NSManagedObjectContext\n\n    // MARK: - Initialization\n\n    /// LocalDataSource \ucd08\uae30\ud654\n    /// - Parameter context: Core Data \ucee8\ud14d\uc2a4\ud2b8\n    init(context: NSManagedObjectContext) {\n        self.context = context\n    }\n\n    // MARK: - Get or Create\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 DailyLog\ub97c \uc870\ud68c\ud558\uac70\ub098 \uc5c6\uc73c\uba74 \uc0dd\uc131\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - bmr: \uae30\ucd08\ub300\uc0ac\ub7c9 (kcal), DailyLog \uc0dd\uc131 \uc2dc \uc0ac\uc6a9\n    ///   - tdee: \ud65c\ub3d9\ub300\uc0ac\ub7c9 (kcal), DailyLog \uc0dd\uc131 \uc2dc \uc0ac\uc6a9\n    /// - Throws: Core Data \uc791\uc5c5 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub418\uac70\ub098 \uc0dd\uc131\ub41c DailyLog\n    func getOrCreate(\n        for date: Date,\n        userId: UUID,\n        bmr: Int32,\n        tdee: Int32\n    ) async throws -> Domain.DailyLog {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: async/await with Core Data\n        // context.perform\uc744 \uc0ac\uc6a9\ud558\uc5ec Core Data\uc758 \uc2a4\ub808\ub4dc \uc548\uc804\uc131 \ubcf4\uc7a5\n        // \ud83d\udca1 Java \ube44\uad50: @Transactional \uc5b4\ub178\ud14c\uc774\uc158\uacfc \uc720\uc0ac\ud55c \uc5ed\ud560\n\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \ud574\ub2f9 \ub0a0\uc9dc\uc758 DailyLog\uac00 \uc774\ubbf8 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778\n            if let existing = try self.fetchDailyLog(for: date, userId: userId) {\n                return existing\n            }\n\n            // \uc5c6\uc73c\uba74 \uc0c8\ub85c \uc0dd\uc131\n            return try self.createDailyLog(date: date, userId: userId, bmr: bmr, tdee: tdee)\n        }\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 DailyLog\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub41c DailyLog, \uc5c6\uc73c\uba74 nil\n    func fetch(for date: Date, userId: UUID) async throws -> Domain.DailyLog? {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            return try self.fetchDailyLog(for: date, userId: userId)\n        }\n    }\n\n    // MARK: - Update\n\n    /// DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter dailyLog: \uc5c5\ub370\uc774\ud2b8\ud560 DailyLog\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc5c5\ub370\uc774\ud2b8\ub41c DailyLog\n    func update(_ dailyLog: Domain.DailyLog) async throws -> Domain.DailyLog {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \uae30\uc874 \ub808\ucf54\ub4dc \uc870\ud68c\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"DailyLog\")\n            request.predicate = NSPredicate(\n                format: \"id == %@ AND user.id == %@\",\n                dailyLog.id as CVarArg,\n                dailyLog.userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \u2192 Core Data \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n            self.mapToManagedObject(from: dailyLog, to: managedObject)\n\n            try self.context.save()\n\n            return self.mapToDomainEntity(from: managedObject)\n        }\n    }\n\n    // MARK: - Exercise Updates\n\n    /// \uc6b4\ub3d9 \ucd94\uac00 \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - calories: \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    func addExercise(\n        date: Date,\n        userId: UUID,\n        calories: Int32,\n        duration: Int32\n    ) async throws {\n        try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ub0a0\uc9dc \ubc94\uc704 \uacc4\uc0b0\n            // \ud574\ub2f9 \ub0a0\uc9dc\uc758 00:00:00 ~ 23:59:59 \ubc94\uc704 \uacc4\uc0b0\n            let calendar = Calendar.current\n            guard let startOfDay = calendar.startOfDay(for: date) as Date? else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"DailyLog\")\n            request.predicate = NSPredicate(\n                format: \"date == %@ AND user.id == %@\",\n                startOfDay as CVarArg,\n                userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uac12 \uc99d\uac00\n            // \uae30\uc874 \uac12\uc5d0 \uc0c8\ub85c\uc6b4 \uac12\uc744 \ub354\ud568\n            let currentCaloriesOut = managedObject.value(forKey: \"totalCaloriesOut\") as! Int32\n            let currentMinutes = managedObject.value(forKey: \"exerciseMinutes\") as! Int32\n            let currentCount = managedObject.value(forKey: \"exerciseCount\") as! Int16\n\n            managedObject.setValue(currentCaloriesOut + calories, forKey: \"totalCaloriesOut\")\n            managedObject.setValue(currentMinutes + duration, forKey: \"exerciseMinutes\")\n            managedObject.setValue(currentCount + 1, forKey: \"exerciseCount\")\n\n            // updatedAt \uac31\uc2e0\n            managedObject.setValue(Date(), forKey: \"updatedAt\")\n\n            try self.context.save()\n        }\n    }\n\n    /// \uc6b4\ub3d9 \uc0ad\uc81c \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - calories: \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - duration: \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    func removeExercise(\n        date: Date,\n        userId: UUID,\n        calories: Int32,\n        duration: Int32\n    ) async throws {\n        try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let calendar = Calendar.current\n            guard let startOfDay = calendar.startOfDay(for: date) as Date? else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"DailyLog\")\n            request.predicate = NSPredicate(\n                format: \"date == %@ AND user.id == %@\",\n                startOfDay as CVarArg,\n                userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uac12 \uac10\uc18c\n            // \uae30\uc874 \uac12\uc5d0\uc11c \uac12\uc744 \ube8c (\uc74c\uc218\uac00 \ub418\uc9c0 \uc54a\ub3c4\ub85d max(0, ...) \uc0ac\uc6a9)\n            let currentCaloriesOut = managedObject.value(forKey: \"totalCaloriesOut\") as! Int32\n            let currentMinutes = managedObject.value(forKey: \"exerciseMinutes\") as! Int32\n            let currentCount = managedObject.value(forKey: \"exerciseCount\") as! Int16\n\n            managedObject.setValue(max(0, currentCaloriesOut - calories), forKey: \"totalCaloriesOut\")\n            managedObject.setValue(max(0, currentMinutes - duration), forKey: \"exerciseMinutes\")\n            managedObject.setValue(max(0, currentCount - 1), forKey: \"exerciseCount\")\n\n            // updatedAt \uac31\uc2e0\n            managedObject.setValue(Date(), forKey: \"updatedAt\")\n\n            try self.context.save()\n        }\n    }\n\n    /// \uc6b4\ub3d9 \uc218\uc815 \uc2dc DailyLog\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc6b4\ub3d9 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - oldCalories: \uc774\uc804 \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - newCalories: \uc0c8\ub85c\uc6b4 \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    ///   - oldDuration: \uc774\uc804 \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    ///   - newDuration: \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    func updateExercise(\n        date: Date,\n        userId: UUID,\n        oldCalories: Int32,\n        newCalories: Int32,\n        oldDuration: Int32,\n        newDuration: Int32\n    ) async throws {\n        try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let calendar = Calendar.current\n            guard let startOfDay = calendar.startOfDay(for: date) as Date? else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"DailyLog\")\n            request.predicate = NSPredicate(\n                format: \"date == %@ AND user.id == %@\",\n                startOfDay as CVarArg,\n                userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ucc28\uc774\uac12 \uc801\uc6a9\n            // \uc774\uc804 \uac12\uc744 \ube7c\uace0 \uc0c8 \uac12\uc744 \ub354\ud568\n            let currentCaloriesOut = managedObject.value(forKey: \"totalCaloriesOut\") as! Int32\n            let currentMinutes = managedObject.value(forKey: \"exerciseMinutes\") as! Int32\n\n            let caloriesDiff = newCalories - oldCalories\n            let durationDiff = newDuration - oldDuration\n\n            managedObject.setValue(currentCaloriesOut + caloriesDiff, forKey: \"totalCaloriesOut\")\n            managedObject.setValue(currentMinutes + durationDiff, forKey: \"exerciseMinutes\")\n\n            // updatedAt \uac31\uc2e0\n            managedObject.setValue(Date(), forKey: \"updatedAt\")\n\n            try self.context.save()\n        }\n    }\n}\n\n// MARK: - Private Helpers\n\nextension DailyLogLocalDataSource {\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 DailyLog\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4 (\ub0b4\ubd80\uc6a9)\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub41c DailyLog, \uc5c6\uc73c\uba74 nil\n    private func fetchDailyLog(for date: Date, userId: UUID) throws -> Domain.DailyLog? {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ub0a0\uc9dc \uc815\uaddc\ud654\n        // DailyLog\ub294 \ub0a0\uc9dc\uc758 00:00:00\uc73c\ub85c \uc800\uc7a5\ub418\ubbc0\ub85c startOfDay\ub85c \uc815\uaddc\ud654\n        let calendar = Calendar.current\n        guard let startOfDay = calendar.startOfDay(for: date) as Date? else {\n            throw DataSourceError.invalidDate\n        }\n\n        let request = NSFetchRequest<NSManagedObject>(entityName: \"DailyLog\")\n        request.predicate = NSPredicate(\n            format: \"date == %@ AND user.id == %@\",\n            startOfDay as CVarArg,\n            userId as CVarArg\n        )\n        request.fetchLimit = 1\n\n        let results = try context.fetch(request)\n        return results.first.map { mapToDomainEntity(from: $0) }\n    }\n\n    /// \uc0c8\ub85c\uc6b4 DailyLog\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4 (\ub0b4\ubd80\uc6a9)\n    ///\n    /// - Parameters:\n    ///   - date: \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - bmr: \uae30\ucd08\ub300\uc0ac\ub7c9 (kcal)\n    ///   - tdee: \ud65c\ub3d9\ub300\uc0ac\ub7c9 (kcal)\n    /// - Throws: Core Data \uc0dd\uc131 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc0dd\uc131\ub41c DailyLog\n    private func createDailyLog(\n        date: Date,\n        userId: UUID,\n        bmr: Int32,\n        tdee: Int32\n    ) throws -> Domain.DailyLog {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSEntityDescription\uc73c\ub85c \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\n        // Core Data \uc5d4\ud2f0\ud2f0\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\n        guard let entity = NSEntityDescription.entity(\n            forEntityName: \"DailyLog\",\n            in: context\n        ) else {\n            throw DataSourceError.entityNotFound(\"DailyLog\")\n        }\n\n        let managedObject = NSManagedObject(entity: entity, insertInto: context)\n\n        // \ub0a0\uc9dc \uc815\uaddc\ud654 (00:00:00\uc73c\ub85c)\n        let calendar = Calendar.current\n        guard let startOfDay = calendar.startOfDay(for: date) as Date? else {\n            throw DataSourceError.invalidDate\n        }\n\n        // \uae30\ubcf8 \uac12 \uc124\uc815\n        let now = Date()\n        managedObject.setValue(UUID(), forKey: \"id\")\n        managedObject.setValue(startOfDay, forKey: \"date\")\n        managedObject.setValue(bmr, forKey: \"bmr\")\n        managedObject.setValue(tdee, forKey: \"tdee\")\n        managedObject.setValue(0, forKey: \"totalCaloriesIn\")\n        managedObject.setValue(0, forKey: \"totalCaloriesOut\")\n        managedObject.setValue(0, forKey: \"exerciseMinutes\")\n        managedObject.setValue(Int16(0), forKey: \"exerciseCount\")\n        managedObject.setValue(Decimal(0), forKey: \"totalCarbs\")\n        managedObject.setValue(Decimal(0), forKey: \"totalProtein\")\n        managedObject.setValue(Decimal(0), forKey: \"totalFat\")\n        managedObject.setValue(-tdee, forKey: \"netCalories\") // \ucd08\uae30\uac12: 0(\uc12d\ucde8) - tdee\n        managedObject.setValue(now, forKey: \"createdAt\")\n        managedObject.setValue(now, forKey: \"updatedAt\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Relationship \uc124\uc815\n        // User\uc640\uc758 \uad00\uacc4 \uc124\uc815 (user.id\ub85c User \uc5d4\ud2f0\ud2f0 \uc870\ud68c \ud6c4 \uc5f0\uacb0)\n        let userRequest = NSFetchRequest<NSManagedObject>(entityName: \"User\")\n        userRequest.predicate = NSPredicate(format: \"id == %@\", userId as CVarArg)\n        userRequest.fetchLimit = 1\n\n        if let user = try? context.fetch(userRequest).first {\n            managedObject.setValue(user, forKey: \"user\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \uc800\uc7a5\n        // context.save()\ub97c \ud638\ucd9c\ud558\uc5ec \ubcc0\uacbd\uc0ac\ud56d\uc744 \uc601\uad6c \uc800\uc7a5\uc18c\uc5d0 \ucee4\ubc0b\n        // \u26a0\ufe0f \uc8fc\uc758: save() \ud638\ucd9c \uc804\uc5d0\ub294 \uba54\ubaa8\ub9ac\uc5d0\ub9cc \uc874\uc7ac\n        try context.save()\n\n        return mapToDomainEntity(from: managedObject)\n    }\n\n    /// \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \u2192 Core Data \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n    ///\n    /// - Parameters:\n    ///   - domain: \ub3c4\uba54\uc778 DailyLog\n    ///   - managedObject: Core Data NSManagedObject\n    private func mapToManagedObject(from domain: Domain.DailyLog, to managedObject: NSManagedObject) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: setValue\ub97c \uc0ac\uc6a9\ud55c \ub3d9\uc801 \uc18d\uc131 \uc124\uc815\n        // Core Data\ub294 \ub7f0\ud0c0\uc784\uc5d0 \uc18d\uc131\uc744 \uc124\uc815\ud558\ubbc0\ub85c setValue \uc0ac\uc6a9\n        // \u26a0\ufe0f \uc8fc\uc758: \uc18d\uc131 \uc774\ub984\uc774 \uc815\ud655\ud574\uc57c \ud568 (\uc624\ud0c0 \uc2dc \ub7f0\ud0c0\uc784 \uc5d0\ub7ec)\n\n        managedObject.setValue(domain.id, forKey: \"id\")\n        managedObject.setValue(domain.date, forKey: \"date\")\n        managedObject.setValue(domain.totalCaloriesIn, forKey: \"totalCaloriesIn\")\n        managedObject.setValue(domain.totalCarbs, forKey: \"totalCarbs\")\n        managedObject.setValue(domain.totalProtein, forKey: \"totalProtein\")\n        managedObject.setValue(domain.totalFat, forKey: \"totalFat\")\n        managedObject.setValue(domain.carbsRatio, forKey: \"carbsRatio\")\n        managedObject.setValue(domain.proteinRatio, forKey: \"proteinRatio\")\n        managedObject.setValue(domain.fatRatio, forKey: \"fatRatio\")\n        managedObject.setValue(domain.bmr, forKey: \"bmr\")\n        managedObject.setValue(domain.tdee, forKey: \"tdee\")\n        managedObject.setValue(domain.netCalories, forKey: \"netCalories\")\n        managedObject.setValue(domain.totalCaloriesOut, forKey: \"totalCaloriesOut\")\n        managedObject.setValue(domain.exerciseMinutes, forKey: \"exerciseMinutes\")\n        managedObject.setValue(domain.exerciseCount, forKey: \"exerciseCount\")\n        managedObject.setValue(domain.steps, forKey: \"steps\")\n        managedObject.setValue(domain.weight, forKey: \"weight\")\n        managedObject.setValue(domain.bodyFatPct, forKey: \"bodyFatPct\")\n        managedObject.setValue(domain.sleepDuration, forKey: \"sleepDuration\")\n        managedObject.setValue(domain.sleepStatus?.rawValue, forKey: \"sleepStatus\")\n        managedObject.setValue(domain.createdAt, forKey: \"createdAt\")\n        managedObject.setValue(domain.updatedAt, forKey: \"updatedAt\")\n\n        // Relationship \uc124\uc815\n        let userRequest = NSFetchRequest<NSManagedObject>(entityName: \"User\")\n        userRequest.predicate = NSPredicate(format: \"id == %@\", domain.userId as CVarArg)\n        userRequest.fetchLimit = 1\n\n        if let user = try? context.fetch(userRequest).first {\n            managedObject.setValue(user, forKey: \"user\")\n        }\n    }\n\n    /// Core Data \uc5d4\ud2f0\ud2f0 \u2192 \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n    ///\n    /// - Parameter managedObject: Core Data NSManagedObject\n    /// - Returns: \ub3c4\uba54\uc778 DailyLog\n    private func mapToDomainEntity(from managedObject: NSManagedObject) -> Domain.DailyLog {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: value(forKey:)\ub85c \uc18d\uc131 \uc77d\uae30\n        // Core Data\uc5d0\uc11c \uac12\uc744 \uc77d\uc744 \ub54c \ud0c0\uc785 \uce90\uc2a4\ud305 \ud544\uc694\n        // \u26a0\ufe0f \uc8fc\uc758: \uac15\uc81c \uc5b8\ub798\ud551(!) \uc0ac\uc6a9 \uc2dc nil\uc774\uba74 \ud06c\ub798\uc2dc\n\n        let id = managedObject.value(forKey: \"id\") as! UUID\n        let date = managedObject.value(forKey: \"date\") as! Date\n        let totalCaloriesIn = managedObject.value(forKey: \"totalCaloriesIn\") as! Int32\n        let totalCarbs = managedObject.value(forKey: \"totalCarbs\") as! Decimal\n        let totalProtein = managedObject.value(forKey: \"totalProtein\") as! Decimal\n        let totalFat = managedObject.value(forKey: \"totalFat\") as! Decimal\n        let carbsRatio = managedObject.value(forKey: \"carbsRatio\") as? Decimal\n        let proteinRatio = managedObject.value(forKey: \"proteinRatio\") as? Decimal\n        let fatRatio = managedObject.value(forKey: \"fatRatio\") as? Decimal\n        let bmr = managedObject.value(forKey: \"bmr\") as! Int32\n        let tdee = managedObject.value(forKey: \"tdee\") as! Int32\n        let netCalories = managedObject.value(forKey: \"netCalories\") as! Int32\n        let totalCaloriesOut = managedObject.value(forKey: \"totalCaloriesOut\") as! Int32\n        let exerciseMinutes = managedObject.value(forKey: \"exerciseMinutes\") as! Int32\n        let exerciseCount = managedObject.value(forKey: \"exerciseCount\") as! Int16\n        let steps = managedObject.value(forKey: \"steps\") as? Int32\n        let weight = managedObject.value(forKey: \"weight\") as? Decimal\n        let bodyFatPct = managedObject.value(forKey: \"bodyFatPct\") as? Decimal\n        let sleepDuration = managedObject.value(forKey: \"sleepDuration\") as? Int32\n        let sleepStatusRaw = managedObject.value(forKey: \"sleepStatus\") as? Int16\n        let createdAt = managedObject.value(forKey: \"createdAt\") as! Date\n        let updatedAt = managedObject.value(forKey: \"updatedAt\") as! Date\n\n        // Relationship\uc5d0\uc11c userId \ucd94\ucd9c\n        let user = managedObject.value(forKey: \"user\") as! NSManagedObject\n        let userId = user.value(forKey: \"id\") as! UUID\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: rawValue\ub97c \uc0ac\uc6a9\ud55c Enum \ubcc0\ud658\n        // Int16\uc744 Enum\uc73c\ub85c \ubcc0\ud658\n        let sleepStatus = sleepStatusRaw.flatMap { SleepStatus(rawValue: $0) }\n\n        return Domain.DailyLog(\n            id: id,\n            userId: userId,\n            date: date,\n            totalCaloriesIn: totalCaloriesIn,\n            totalCarbs: totalCarbs,\n            totalProtein: totalProtein,\n            totalFat: totalFat,\n            carbsRatio: carbsRatio,\n            proteinRatio: proteinRatio,\n            fatRatio: fatRatio,\n            bmr: bmr,\n            tdee: tdee,\n            netCalories: netCalories,\n            totalCaloriesOut: totalCaloriesOut,\n            exerciseMinutes: exerciseMinutes,\n            exerciseCount: exerciseCount,\n            steps: steps,\n            weight: weight,\n            bodyFatPct: bodyFatPct,\n            sleepDuration: sleepDuration,\n            sleepStatus: sleepStatus,\n            createdAt: createdAt,\n            updatedAt: updatedAt\n        )\n    }\n}\n\n// MARK: - Domain Namespace\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Namespace\ub97c \uc0ac\uc6a9\ud55c \uc774\ub984 \ucda9\ub3cc \ubc29\uc9c0\n// Core Data\uc758 DailyLog(NSManagedObject)\uc640 Domain\uc758 DailyLog \uad6c\ubd84\n// \ud83d\udca1 Java \ube44\uad50: package\ub97c \uc0ac\uc6a9\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\nenum Domain {\n    typealias DailyLog = Bodii.DailyLog\n}\n",
        "last_modified": "2026-01-14T22:54:09.699901"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:06.140008",
  "last_updated": "2026-01-14T11:45:41.810449"
}