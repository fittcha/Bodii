{
  "file_path": "BodiiTests/Utils/NutritionCalculatorTests.swift",
  "main_branch_history": [],
  "task_views": {
    "005-korean-food-database-integration": {
      "task_id": "005-korean-food-database-integration",
      "branch_point": {
        "commit_hash": "c44bfbcd7c1699b176a8bb155e8c35f43ebd4ad9",
        "content": "",
        "timestamp": "2026-01-13T07:46:23.878686"
      },
      "worktree_state": {
        "content": "//\n//  NutritionCalculatorTests.swift\n//  BodiiTests\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\nimport XCTest\n@testable import Bodii\n\n/// Unit tests for NutritionCalculator utility\n///\n/// NutritionCalculator\uc758 \uc601\uc591\uc18c \uacc4\uc0b0 \ubc0f \ub2e4\ub7c9 \uc601\uc591\uc18c \ube44\uc728 \uacc4\uc0b0 \ub2e8\uc704 \ud14c\uc2a4\ud2b8\nfinal class NutritionCalculatorTests: XCTestCase {\n\n    // MARK: - Test Data\n\n    /// Sample food for testing\n    /// \ud14c\uc2a4\ud2b8\uc6a9 \uc0d8\ud50c \uc74c\uc2dd (\ud604\ubbf8\ubc25)\n    var sampleFood: Food!\n\n    // MARK: - Setup & Teardown\n\n    override func setUp() {\n        super.setUp()\n\n        // \ud604\ubbf8\ubc25: 210g \uae30\uc900\n        sampleFood = Food(\n            id: UUID(),\n            name: \"\ud604\ubbf8\ubc25\",\n            calories: 330,\n            carbohydrates: Decimal(string: \"73.4\")!,\n            protein: Decimal(string: \"6.8\")!,\n            fat: Decimal(string: \"2.5\")!,\n            sodium: Decimal(5),\n            fiber: Decimal(3.0),\n            sugar: Decimal(0.5),\n            servingSize: Decimal(210),\n            servingUnit: \"1\uacf5\uae30\",\n            source: .governmentAPI,\n            apiCode: \"D000001\",\n            createdByUserId: nil,\n            createdAt: Date()\n        )\n    }\n\n    override func tearDown() {\n        sampleFood = nil\n        super.tearDown()\n    }\n\n    // MARK: - Serving-Based Calculation Tests\n\n    /// Test: 1 serving calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 1\uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_OneServing_ReturnsBaseline() {\n        // Given: 1 serving\n        let quantity: Decimal = 1.0\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should match original food values\n        XCTAssertEqual(result.quantity, 1.0, \"Quantity should be 1.0\")\n        XCTAssertEqual(result.unit, .serving, \"Unit should be serving\")\n        XCTAssertEqual(result.calories, 330, \"Calories should match baseline\")\n        XCTAssertEqual(result.carbohydrates, Decimal(string: \"73.4\"), \"Carbs should match baseline\")\n        XCTAssertEqual(result.protein, Decimal(string: \"6.8\"), \"Protein should match baseline\")\n        XCTAssertEqual(result.fat, Decimal(string: \"2.5\"), \"Fat should match baseline\")\n        XCTAssertEqual(result.sodium, Decimal(5), \"Sodium should match baseline\")\n        XCTAssertEqual(result.fiber, Decimal(3.0), \"Fiber should match baseline\")\n        XCTAssertEqual(result.sugar, Decimal(0.5), \"Sugar should match baseline\")\n    }\n\n    /// Test: 1.5 servings calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 1.5\uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_OneAndHalfServings_ReturnsMultiplied() {\n        // Given: 1.5 servings\n        let quantity: Decimal = 1.5\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should multiply all values by 1.5\n        XCTAssertEqual(result.quantity, 1.5, \"Quantity should be 1.5\")\n        XCTAssertEqual(result.unit, .serving, \"Unit should be serving\")\n        XCTAssertEqual(result.calories, 495, \"Calories should be 330 * 1.5 = 495\")\n        XCTAssertEqual(result.carbohydrates, Decimal(string: \"110.1\"), \"Carbs should be 73.4 * 1.5 = 110.1\")\n        XCTAssertEqual(result.protein, Decimal(string: \"10.2\"), \"Protein should be 6.8 * 1.5 = 10.2\")\n        XCTAssertEqual(result.fat, Decimal(string: \"3.8\"), \"Fat should be 2.5 * 1.5 = 3.75 \u2248 3.8\")\n        XCTAssertEqual(result.sodium, Decimal(string: \"7.5\"), \"Sodium should be 5 * 1.5 = 7.5\")\n        XCTAssertEqual(result.fiber, Decimal(4.5), \"Fiber should be 3.0 * 1.5 = 4.5\")\n        XCTAssertEqual(result.sugar, Decimal(string: \"0.8\"), \"Sugar should be 0.5 * 1.5 = 0.75 \u2248 0.8\")\n    }\n\n    /// Test: 2 servings calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 2\uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_TwoServings_ReturnsDoubled() {\n        // Given: 2 servings\n        let quantity: Decimal = 2.0\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should double all values\n        XCTAssertEqual(result.quantity, 2.0, \"Quantity should be 2.0\")\n        XCTAssertEqual(result.unit, .serving, \"Unit should be serving\")\n        XCTAssertEqual(result.calories, 660, \"Calories should be 330 * 2 = 660\")\n        XCTAssertEqual(result.carbohydrates, Decimal(string: \"146.8\"), \"Carbs should be 73.4 * 2 = 146.8\")\n        XCTAssertEqual(result.protein, Decimal(string: \"13.6\"), \"Protein should be 6.8 * 2 = 13.6\")\n        XCTAssertEqual(result.fat, Decimal(5.0), \"Fat should be 2.5 * 2 = 5.0\")\n        XCTAssertEqual(result.sodium, Decimal(10), \"Sodium should be 5 * 2 = 10\")\n        XCTAssertEqual(result.fiber, Decimal(6.0), \"Fiber should be 3.0 * 2 = 6.0\")\n        XCTAssertEqual(result.sugar, Decimal(1.0), \"Sugar should be 0.5 * 2 = 1.0\")\n    }\n\n    /// Test: 0.5 serving calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 0.5\uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_HalfServing_ReturnsHalved() {\n        // Given: 0.5 serving\n        let quantity: Decimal = 0.5\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should halve all values\n        XCTAssertEqual(result.quantity, 0.5, \"Quantity should be 0.5\")\n        XCTAssertEqual(result.unit, .serving, \"Unit should be serving\")\n        XCTAssertEqual(result.calories, 165, \"Calories should be 330 * 0.5 = 165\")\n        XCTAssertEqual(result.carbohydrates, Decimal(string: \"36.7\"), \"Carbs should be 73.4 * 0.5 = 36.7\")\n        XCTAssertEqual(result.protein, Decimal(string: \"3.4\"), \"Protein should be 6.8 * 0.5 = 3.4\")\n        XCTAssertEqual(result.fat, Decimal(string: \"1.3\"), \"Fat should be 2.5 * 0.5 = 1.25 \u2248 1.3\")\n        XCTAssertEqual(result.sodium, Decimal(string: \"2.5\"), \"Sodium should be 5 * 0.5 = 2.5\")\n        XCTAssertEqual(result.fiber, Decimal(1.5), \"Fiber should be 3.0 * 0.5 = 1.5\")\n        XCTAssertEqual(result.sugar, Decimal(string: \"0.3\"), \"Sugar should be 0.5 * 0.5 = 0.25 \u2248 0.3\")\n    }\n\n    // MARK: - Gram-Based Calculation Tests\n\n    /// Test: Same gram as serving size\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc11c\ube59 \uc0ac\uc774\uc988\uc640 \ub3d9\uc77c\ud55c \uadf8\ub7a8 (210g)\n    func testCalculate_SameGramsAsServingSize_ReturnsBaseline() {\n        // Given: 210g (same as serving size)\n        let quantity: Decimal = 210\n        let unit: QuantityUnit = .grams\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should match original food values (210g / 210g = 1.0x)\n        XCTAssertEqual(result.quantity, 210, \"Quantity should be 210\")\n        XCTAssertEqual(result.unit, .grams, \"Unit should be grams\")\n        XCTAssertEqual(result.calories, 330, \"Calories should match baseline\")\n        XCTAssertEqual(result.carbohydrates, Decimal(string: \"73.4\"), \"Carbs should match baseline\")\n        XCTAssertEqual(result.protein, Decimal(string: \"6.8\"), \"Protein should match baseline\")\n        XCTAssertEqual(result.fat, Decimal(string: \"2.5\"), \"Fat should match baseline\")\n    }\n\n    /// Test: 300g calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 300g \uacc4\uc0b0 (210g \uc11c\ube59 \uc0ac\uc774\uc988 \uae30\uc900)\n    func testCalculate_300Grams_ReturnsScaled() {\n        // Given: 300g (300 / 210 = 1.4286x)\n        let quantity: Decimal = 300\n        let unit: QuantityUnit = .grams\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should scale by (300 / 210)\n        let multiplier = Decimal(300) / Decimal(210) // 1.4286\n\n        XCTAssertEqual(result.quantity, 300, \"Quantity should be 300\")\n        XCTAssertEqual(result.unit, .grams, \"Unit should be grams\")\n\n        // 330 * 1.4286 = 471.43 \u2248 471\n        XCTAssertEqual(result.calories, 471, \"Calories should be 330 * (300/210) \u2248 471\")\n\n        // 73.4 * 1.4286 = 104.86 \u2248 104.9\n        let expectedCarbs = (Decimal(string: \"73.4\")! * multiplier).rounded1\n        XCTAssertEqual(result.carbohydrates, expectedCarbs, \"Carbs should be 73.4 * (300/210)\")\n\n        // 6.8 * 1.4286 = 9.71 \u2248 9.7\n        let expectedProtein = (Decimal(string: \"6.8\")! * multiplier).rounded1\n        XCTAssertEqual(result.protein, expectedProtein, \"Protein should be 6.8 * (300/210)\")\n\n        // 2.5 * 1.4286 = 3.57 \u2248 3.6\n        let expectedFat = (Decimal(string: \"2.5\")! * multiplier).rounded1\n        XCTAssertEqual(result.fat, expectedFat, \"Fat should be 2.5 * (300/210)\")\n    }\n\n    /// Test: 100g calculation (less than serving size)\n    ///\n    /// \ud14c\uc2a4\ud2b8: 100g \uacc4\uc0b0 (\uc11c\ube59 \uc0ac\uc774\uc988\ubcf4\ub2e4 \uc801\uc74c)\n    func testCalculate_100Grams_ReturnsScaled() {\n        // Given: 100g (100 / 210 = 0.4762x)\n        let quantity: Decimal = 100\n        let unit: QuantityUnit = .grams\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should scale by (100 / 210)\n        let multiplier = Decimal(100) / Decimal(210) // 0.4762\n\n        XCTAssertEqual(result.quantity, 100, \"Quantity should be 100\")\n        XCTAssertEqual(result.unit, .grams, \"Unit should be grams\")\n\n        // 330 * 0.4762 = 157.14 \u2248 157\n        XCTAssertEqual(result.calories, 157, \"Calories should be 330 * (100/210) \u2248 157\")\n\n        // 73.4 * 0.4762 = 34.95 \u2248 35.0\n        let expectedCarbs = (Decimal(string: \"73.4\")! * multiplier).rounded1\n        XCTAssertEqual(result.carbohydrates, expectedCarbs, \"Carbs should be 73.4 * (100/210)\")\n\n        // 6.8 * 0.4762 = 3.24 \u2248 3.2\n        let expectedProtein = (Decimal(string: \"6.8\")! * multiplier).rounded1\n        XCTAssertEqual(result.protein, expectedProtein, \"Protein should be 6.8 * (100/210)\")\n    }\n\n    // MARK: - Decimal Precision Tests\n\n    /// Test: Calorie rounding (Int32)\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uce7c\ub85c\ub9ac \ubc18\uc62c\ub9bc (\uc815\uc218)\n    func testCalculate_CaloriesRounding_ReturnsInt32() {\n        // Given: 1.3 servings (330 * 1.3 = 429)\n        let quantity: Decimal = 1.3\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Calories should be rounded to Int32\n        XCTAssertEqual(result.calories, 429, \"Calories should be rounded to Int32: 330 * 1.3 = 429\")\n    }\n\n    /// Test: Macro rounding (1 decimal place)\n    ///\n    /// \ud14c\uc2a4\ud2b8: \ub2e4\ub7c9 \uc601\uc591\uc18c \ubc18\uc62c\ub9bc (\uc18c\uc218\uc810 1\uc790\ub9ac)\n    func testCalculate_MacroRounding_ReturnsOneDecimalPlace() {\n        // Given: 1.33 servings (should produce decimal values)\n        let quantity: Decimal = 1.33\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Macros should be rounded to 1 decimal place\n        // 73.4 * 1.33 = 97.622 \u2248 97.6\n        let expectedCarbs = (Decimal(string: \"73.4\")! * quantity).rounded1\n        XCTAssertEqual(result.carbohydrates, expectedCarbs, \"Carbs should be rounded to 1 decimal place\")\n\n        // 6.8 * 1.33 = 9.044 \u2248 9.0\n        let expectedProtein = (Decimal(string: \"6.8\")! * quantity).rounded1\n        XCTAssertEqual(result.protein, expectedProtein, \"Protein should be rounded to 1 decimal place\")\n\n        // 2.5 * 1.33 = 3.325 \u2248 3.3\n        let expectedFat = (Decimal(string: \"2.5\")! * quantity).rounded1\n        XCTAssertEqual(result.fat, expectedFat, \"Fat should be rounded to 1 decimal place\")\n    }\n\n    // MARK: - Edge Case Tests\n\n    /// Test: 0 serving calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: 0\uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_ZeroServing_ReturnsZero() {\n        // Given: 0 servings\n        let quantity: Decimal = 0\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: All nutrition values should be 0\n        XCTAssertEqual(result.quantity, 0, \"Quantity should be 0\")\n        XCTAssertEqual(result.calories, 0, \"Calories should be 0\")\n        XCTAssertEqual(result.carbohydrates, 0, \"Carbs should be 0\")\n        XCTAssertEqual(result.protein, 0, \"Protein should be 0\")\n        XCTAssertEqual(result.fat, 0, \"Fat should be 0\")\n        XCTAssertEqual(result.sodium, 0, \"Sodium should be 0\")\n        XCTAssertEqual(result.fiber, 0, \"Fiber should be 0\")\n        XCTAssertEqual(result.sugar, 0, \"Sugar should be 0\")\n    }\n\n    /// Test: Very large serving calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: \ub9e4\uc6b0 \ud070 \uc778\ubd84 \uacc4\uc0b0\n    func testCalculate_VeryLargeServing_ReturnsScaled() {\n        // Given: 10 servings (large but realistic)\n        let quantity: Decimal = 10\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should scale correctly\n        XCTAssertEqual(result.quantity, 10, \"Quantity should be 10\")\n        XCTAssertEqual(result.calories, 3300, \"Calories should be 330 * 10 = 3300\")\n        XCTAssertEqual(result.carbohydrates, Decimal(734), \"Carbs should be 73.4 * 10 = 734\")\n        XCTAssertEqual(result.protein, Decimal(68), \"Protein should be 6.8 * 10 = 68\")\n        XCTAssertEqual(result.fat, Decimal(25), \"Fat should be 2.5 * 10 = 25\")\n    }\n\n    /// Test: Food without optional nutrients\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc120\ud0dd\uc801 \uc601\uc591\uc18c\uac00 \uc5c6\ub294 \uc74c\uc2dd\n    func testCalculate_FoodWithoutOptionalNutrients_ReturnsNilForOptionals() {\n        // Given: Food without sodium, fiber, sugar\n        let minimalFood = Food(\n            id: UUID(),\n            name: \"\ub2e8\uc21c \uc74c\uc2dd\",\n            calories: 100,\n            carbohydrates: Decimal(20),\n            protein: Decimal(5),\n            fat: Decimal(3),\n            sodium: nil,\n            fiber: nil,\n            sugar: nil,\n            servingSize: Decimal(100),\n            servingUnit: nil,\n            source: .userDefined,\n            apiCode: nil,\n            createdByUserId: UUID(),\n            createdAt: Date()\n        )\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: minimalFood,\n            quantity: 2.0,\n            unit: .serving\n        )\n\n        // Then: Required nutrients should be calculated, optional should be nil\n        XCTAssertEqual(result.calories, 200, \"Calories should be calculated\")\n        XCTAssertEqual(result.carbohydrates, Decimal(40), \"Carbs should be calculated\")\n        XCTAssertEqual(result.protein, Decimal(10), \"Protein should be calculated\")\n        XCTAssertEqual(result.fat, Decimal(6), \"Fat should be calculated\")\n        XCTAssertNil(result.sodium, \"Sodium should be nil\")\n        XCTAssertNil(result.fiber, \"Fiber should be nil\")\n        XCTAssertNil(result.sugar, \"Sugar should be nil\")\n    }\n\n    /// Test: Zero serving size edge case\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc11c\ube59 \uc0ac\uc774\uc988\uac00 0\uc778 \uacbd\uc6b0 (\uc5e3\uc9c0 \ucf00\uc774\uc2a4)\n    func testCalculate_ZeroServingSize_ReturnsZeroForGrams() {\n        // Given: Food with 0 serving size (edge case, should not happen in reality)\n        let zeroServingFood = Food(\n            id: UUID(),\n            name: \"\uc81c\ub85c \uc11c\ube59\",\n            calories: 100,\n            carbohydrates: Decimal(20),\n            protein: Decimal(5),\n            fat: Decimal(3),\n            servingSize: Decimal(0), // Edge case\n            servingUnit: nil,\n            source: .userDefined,\n            apiCode: nil,\n            createdByUserId: UUID(),\n            createdAt: Date()\n        )\n\n        // When: Calculate with grams (division by zero scenario)\n        let result = NutritionCalculator.calculate(\n            from: zeroServingFood,\n            quantity: 100,\n            unit: .grams\n        )\n\n        // Then: Should return 0 for all values (safe handling)\n        XCTAssertEqual(result.calories, 0, \"Calories should be 0 when serving size is 0\")\n        XCTAssertEqual(result.carbohydrates, 0, \"Carbs should be 0 when serving size is 0\")\n        XCTAssertEqual(result.protein, 0, \"Protein should be 0 when serving size is 0\")\n        XCTAssertEqual(result.fat, 0, \"Fat should be 0 when serving size is 0\")\n    }\n\n    // MARK: - Macro Ratio Calculation Tests\n\n    /// Test: Macro ratio calculation\n    ///\n    /// \ud14c\uc2a4\ud2b8: \ub2e4\ub7c9 \uc601\uc591\uc18c \ube44\uc728 \uacc4\uc0b0\n    func testCalculateMacroRatios_ValidValues_ReturnsPercentages() {\n        // Given: Sample macro values\n        // Carbs: 50g * 4 kcal/g = 200 kcal\n        // Protein: 25g * 4 kcal/g = 100 kcal\n        // Fat: 10g * 9 kcal/g = 90 kcal\n        // Total: 390 kcal\n        // Percentages: 51.3%, 25.6%, 23.1%\n        let carbs = Decimal(50)\n        let protein = Decimal(25)\n        let fat = Decimal(10)\n\n        // When: Calculate ratios\n        let ratios = NutritionCalculator.calculateMacroRatios(\n            carbs: carbs,\n            protein: protein,\n            fat: fat\n        )\n\n        // Then: Should return correct percentages\n        XCTAssertEqual(ratios.carbs, Decimal(string: \"51.3\"), \"Carbs percentage should be 51.3%\")\n        XCTAssertEqual(ratios.protein, Decimal(string: \"25.6\"), \"Protein percentage should be 25.6%\")\n        XCTAssertEqual(ratios.fat, Decimal(string: \"23.1\"), \"Fat percentage should be 23.1%\")\n\n        // Verify sum is approximately 100% (may have small rounding differences)\n        let sum = ratios.carbs + ratios.protein + ratios.fat\n        XCTAssertEqual(sum, Decimal(100), accuracy: Decimal(0.5), \"Sum should be approximately 100%\")\n    }\n\n    /// Test: Macro ratio calculation with zero values\n    ///\n    /// \ud14c\uc2a4\ud2b8: \ubaa8\ub4e0 \uac12\uc774 0\uc77c \ub54c \ube44\uc728 \uacc4\uc0b0\n    func testCalculateMacroRatios_ZeroValues_ReturnsZero() {\n        // Given: All zero values\n        let carbs = Decimal(0)\n        let protein = Decimal(0)\n        let fat = Decimal(0)\n\n        // When: Calculate ratios\n        let ratios = NutritionCalculator.calculateMacroRatios(\n            carbs: carbs,\n            protein: protein,\n            fat: fat\n        )\n\n        // Then: All percentages should be 0\n        XCTAssertEqual(ratios.carbs, Decimal(0), \"Carbs percentage should be 0%\")\n        XCTAssertEqual(ratios.protein, Decimal(0), \"Protein percentage should be 0%\")\n        XCTAssertEqual(ratios.fat, Decimal(0), \"Fat percentage should be 0%\")\n    }\n\n    /// Test: Macro ratios in calculated nutrition\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uacc4\uc0b0\ub41c \uc601\uc591 \uc815\ubcf4\uc5d0 \ud3ec\ud568\ub41c \ube44\uc728 \uac80\uc99d\n    func testCalculate_IncludesMacroRatios() {\n        // Given: 1 serving of sample food\n        let quantity: Decimal = 1.0\n        let unit: QuantityUnit = .serving\n\n        // When: Calculate nutrition\n        let result = NutritionCalculator.calculate(\n            from: sampleFood,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // Then: Should include macro ratios\n        // Carbs: 73.4g * 4 = 293.6 kcal\n        // Protein: 6.8g * 4 = 27.2 kcal\n        // Fat: 2.5g * 9 = 22.5 kcal\n        // Total: 343.3 kcal\n        let totalCalories = Decimal(string: \"73.4\")! * 4 + Decimal(string: \"6.8\")! * 4 + Decimal(string: \"2.5\")! * 9\n\n        let expectedCarbsPct = ((Decimal(string: \"73.4\")! * 4) / totalCalories * 100).rounded1\n        let expectedProteinPct = ((Decimal(string: \"6.8\")! * 4) / totalCalories * 100).rounded1\n        let expectedFatPct = ((Decimal(string: \"2.5\")! * 9) / totalCalories * 100).rounded1\n\n        XCTAssertEqual(result.carbsPercentage, expectedCarbsPct, \"Carbs percentage should be calculated\")\n        XCTAssertEqual(result.proteinPercentage, expectedProteinPct, \"Protein percentage should be calculated\")\n        XCTAssertEqual(result.fatPercentage, expectedFatPct, \"Fat percentage should be calculated\")\n    }\n\n    // MARK: - Convenience Method Tests\n\n    /// Test: calculateForServings convenience method\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc778\ubd84 \uacc4\uc0b0 \ud3b8\uc758 \uba54\uc11c\ub4dc\n    func testCalculateForServings_ReturnsCorrectResult() {\n        // Given: 1.5 servings\n        let servings: Decimal = 1.5\n\n        // When: Use convenience method\n        let result = NutritionCalculator.calculateForServings(\n            from: sampleFood,\n            servings: servings\n        )\n\n        // Then: Should match full method with serving unit\n        XCTAssertEqual(result.quantity, 1.5, \"Quantity should be 1.5\")\n        XCTAssertEqual(result.unit, .serving, \"Unit should be serving\")\n        XCTAssertEqual(result.calories, 495, \"Calories should be 330 * 1.5 = 495\")\n    }\n\n    /// Test: calculateForGrams convenience method\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uadf8\ub7a8 \uacc4\uc0b0 \ud3b8\uc758 \uba54\uc11c\ub4dc\n    func testCalculateForGrams_ReturnsCorrectResult() {\n        // Given: 300g\n        let grams: Decimal = 300\n\n        // When: Use convenience method\n        let result = NutritionCalculator.calculateForGrams(\n            from: sampleFood,\n            grams: grams\n        )\n\n        // Then: Should match full method with grams unit\n        XCTAssertEqual(result.quantity, 300, \"Quantity should be 300\")\n        XCTAssertEqual(result.unit, .grams, \"Unit should be grams\")\n\n        // 330 * (300/210) = 471.43 \u2248 471\n        XCTAssertEqual(result.calories, 471, \"Calories should be 330 * (300/210) \u2248 471\")\n    }\n\n    // MARK: - Integration Tests\n\n    /// Test: Full workflow - serving to FoodRecord\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc804\uccb4 \ud750\ub984 - \uc778\ubd84 \uacc4\uc0b0 \ud6c4 FoodRecord \ubcc0\ud658\n    func testCalculate_ToFoodRecord_Integration() {\n        // Given: Calculate nutrition for 1.5 servings\n        let nutrition = NutritionCalculator.calculateForServings(\n            from: sampleFood,\n            servings: 1.5\n        )\n\n        // When: Convert to FoodRecord\n        let userId = UUID()\n        let date = Date()\n        let mealType = MealType.breakfast\n\n        let record = nutrition.toFoodRecord(\n            foodId: sampleFood.id,\n            userId: userId,\n            date: date,\n            mealType: mealType\n        )\n\n        // Then: FoodRecord should have correct values\n        XCTAssertEqual(record.foodId, sampleFood.id, \"Food ID should match\")\n        XCTAssertEqual(record.userId, userId, \"User ID should match\")\n        XCTAssertEqual(record.mealType, mealType, \"Meal type should match\")\n        XCTAssertEqual(record.quantity, 1.5, \"Quantity should match\")\n        XCTAssertEqual(record.quantityUnit, .serving, \"Unit should match\")\n        XCTAssertEqual(record.calculatedCalories, 495, \"Calculated calories should match\")\n        XCTAssertEqual(record.calculatedCarbs, Decimal(string: \"110.1\"), \"Calculated carbs should match\")\n        XCTAssertEqual(record.calculatedProtein, Decimal(string: \"10.2\"), \"Calculated protein should match\")\n        XCTAssertEqual(record.calculatedFat, Decimal(string: \"3.8\"), \"Calculated fat should match\")\n    }\n\n    /// Test: Comparison between serving and gram calculations\n    ///\n    /// \ud14c\uc2a4\ud2b8: \uc778\ubd84\uacfc \uadf8\ub7a8 \uacc4\uc0b0 \ube44\uad50\n    func testCalculate_ServingVsGrams_ProducesSameResult() {\n        // Given: 1 serving = 210g\n        let servingResult = NutritionCalculator.calculateForServings(\n            from: sampleFood,\n            servings: 1.0\n        )\n\n        let gramsResult = NutritionCalculator.calculateForGrams(\n            from: sampleFood,\n            grams: 210\n        )\n\n        // Then: Both should produce same nutrition values\n        XCTAssertEqual(servingResult.calories, gramsResult.calories, \"Calories should match\")\n        XCTAssertEqual(servingResult.carbohydrates, gramsResult.carbohydrates, \"Carbs should match\")\n        XCTAssertEqual(servingResult.protein, gramsResult.protein, \"Protein should match\")\n        XCTAssertEqual(servingResult.fat, gramsResult.fat, \"Fat should match\")\n        XCTAssertEqual(servingResult.sodium, gramsResult.sodium, \"Sodium should match\")\n        XCTAssertEqual(servingResult.fiber, gramsResult.fiber, \"Fiber should match\")\n        XCTAssertEqual(servingResult.sugar, gramsResult.sugar, \"Sugar should match\")\n    }\n}\n",
        "last_modified": "2026-01-14T22:55:39.271539"
      },
      "task_intent": {
        "title": "005-korean-food-database-integration",
        "description": "Integrate Korean Food & Drug Administration (\uc2dd\uc57d\ucc98) food nutrition database API as primary source, with USDA FoodData Central as fallback for international foods. Prioritize Korean dishes (kimchi jjigae, bibimbap, tteokbokki) that are poorly covered by competitors.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:31.777210",
  "last_updated": "2026-01-13T07:46:23.944006"
}