{
  "file_path": "BodiiTests/Presentation/SleepPromptManagerTests.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepPromptManagerTests.swift\n//  BodiiTests\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepPromptManager Unit Testing\n// \ud504\ub86c\ud504\ud2b8 \ub85c\uc9c1\uacfc \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uad00\ub9ac \ud14c\uc2a4\ud2b8\n// \ud83d\udca1 Java \ube44\uad50: JUnit Manager Class Test\uc640 \uc720\uc0ac\n\nimport XCTest\n@testable import Bodii\n\n/// SleepPromptManager\uc5d0 \ub300\ud55c \ub2e8\uc704 \ud14c\uc2a4\ud2b8\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Prompt Timing vs Sleep Boundary\n/// - promptHour (6 AM): \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud504\ub86c\ud504\ud2b8\ub97c \ubcf4\uc5ec\uc8fc\ub294 \uc2dc\uac04\n/// - boundaryHour (2 AM): \uc218\uba74 \ub0a0\uc9dc\ub97c \uacc4\uc0b0\ud558\ub294 \uacbd\uacc4 \uc2dc\uac04\n/// - These are separate concerns and use different constants\n///\n/// \ud14c\uc2a4\ud2b8 \uc2dc \uc8fc\uc758\uc0ac\ud56d:\n/// - checkShouldShow()\ub294 DateUtils.shouldShowSleepPopup()\uc744 \uc0ac\uc6a9\n/// - shouldShowSleepPopup()\ub294 promptHour (6 AM)\uc744 \uc0ac\uc6a9\n/// - 06:00 \uc774\uc804\uc5d0\ub294 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc544\uc57c \ud568\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manager Testing\n/// - \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \ub85c\uc9c1 \uac80\uc99d\n/// - \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc601\uc18d\uc131 \ud14c\uc2a4\ud2b8\n/// - \ub0a0\uc9dc\ubcc4 \ub3c5\ub9bd\uc801\uc778 \ud69f\uc218 \uad00\ub9ac \ud655\uc778\n/// - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc804\ud658 \uac80\uc99d\n/// \ud83d\udca1 Java \ube44\uad50: Mockito + JUnit\uc73c\ub85c Manager \ud14c\uc2a4\ud2b8\ud558\ub294 \uac83\uacfc \uc720\uc0ac\n@MainActor\nfinal class SleepPromptManagerTests: XCTestCase {\n\n    // MARK: - Properties\n\n    /// \ud14c\uc2a4\ud2b8 \ub300\uc0c1 Manager\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: System Under Test (SUT)\n    var sut: SleepPromptManager!\n\n    /// Mock Repository\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Double - Mock\n    /// - \uc2e4\uc81c Repository \ub300\uc2e0 \ud14c\uc2a4\ud2b8\uc6a9 Mock \uc0ac\uc6a9\n    /// - \uc218\uba74 \uae30\ub85d \uc874\uc7ac \uc5ec\ubd80\ub97c \uc81c\uc5b4 \uac00\ub2a5\n    var mockRepository: MockSleepRepository!\n\n    /// Test UserDefaults\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test-specific UserDefaults\n    /// - \uc2e4\uc81c UserDefaults \ub300\uc2e0 \ud14c\uc2a4\ud2b8\uc6a9 \uc778\uc2a4\ud134\uc2a4 \uc0ac\uc6a9\n    /// - \uac01 \ud14c\uc2a4\ud2b8\uac00 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ub418\ub3c4\ub85d \ubcf4\uc7a5\n    var testUserDefaults: UserDefaults!\n\n    // MARK: - Setup & Teardown\n\n    /// \uac01 \ud14c\uc2a4\ud2b8 \uba54\uc11c\ub4dc \uc2e4\ud589 \uc804\uc5d0 \ud638\ucd9c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Setup\n    /// \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc744 \ucd08\uae30\ud654\ud558\uc5ec \uac01 \ud14c\uc2a4\ud2b8\uac00 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc2e4\ud589\ub418\ub3c4\ub85d \ubcf4\uc7a5\n    /// \ud83d\udca1 Java \ube44\uad50: JUnit\uc758 @Before \ub610\ub294 @BeforeEach\uc640 \uc720\uc0ac\n    override func setUp() {\n        super.setUp()\n        mockRepository = MockSleepRepository()\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test-specific UserDefaults\n        // \uac01 \ud14c\uc2a4\ud2b8\ub9c8\ub2e4 \uace0\uc720\ud55c suite name \uc0ac\uc6a9\ud558\uc5ec \uaca9\ub9ac\n        let suiteName = \"test_\\(UUID().uuidString)\"\n        testUserDefaults = UserDefaults(suiteName: suiteName)!\n\n        sut = SleepPromptManager(\n            sleepRepository: mockRepository,\n            userDefaults: testUserDefaults\n        )\n    }\n\n    /// \uac01 \ud14c\uc2a4\ud2b8 \uba54\uc11c\ub4dc \uc2e4\ud589 \ud6c4\uc5d0 \ud638\ucd9c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Teardown\n    /// \ud14c\uc2a4\ud2b8 \ud6c4 \uc815\ub9ac \uc791\uc5c5 \uc218\ud589\n    /// \ud83d\udca1 Java \ube44\uad50: JUnit\uc758 @After \ub610\ub294 @AfterEach\uc640 \uc720\uc0ac\n    override func tearDown() {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UserDefaults Cleanup\n        // \ud14c\uc2a4\ud2b8 \ub370\uc774\ud130 \uc815\ub9ac\n        if let suiteName = testUserDefaults.dictionaryRepresentation().keys.first {\n            testUserDefaults.removePersistentDomain(forName: suiteName)\n        }\n\n        sut = nil\n        mockRepository = nil\n        testUserDefaults = nil\n        super.tearDown()\n    }\n\n    // MARK: - Skip Count Persistence Tests\n\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc800\uc7a5 \ubc0f \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UserDefaults Persistence Testing\n    /// UserDefaults\uc5d0 \uac12\uc774 \uc62c\ubc14\ub974\uac8c \uc800\uc7a5\ub418\uace0 \uc870\ud68c\ub418\ub294\uc9c0 \ud655\uc778\n    func testIncrementSkipCount_IncreasesCountByOne() {\n        // Given: \ucd08\uae30 \uc0c1\ud0dc (\uac74\ub108\ub6f0\uae30 0\ud68c)\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0,\n                      \"\ucd08\uae30 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 1\ud68c\n        sut.incrementSkipCount()\n\n        // Then: \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 1\uc774\uc5b4\uc57c \ud568\n        XCTAssertEqual(sut.getCurrentSkipCount(), 1,\n                      \"\uac74\ub108\ub6f0\uae30 \ud6c4 \ud69f\uc218\ub294 1\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ub2e4\uc911 \uc99d\uac00\n    func testIncrementSkipCount_MultipleIncrements_CountsCorrectly() {\n        // Given: \ucd08\uae30 \uc0c1\ud0dc\n\n        // When: \uac74\ub108\ub6f0\uae30 3\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n\n        // Then: \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 3\uc774\uc5b4\uc57c \ud568\n        XCTAssertEqual(sut.getCurrentSkipCount(), 3,\n                      \"3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 \ud69f\uc218\ub294 3\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reset Logic Testing\n    /// \uc218\uba74 \uae30\ub85d \uc800\uc7a5 \ud6c4 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 0\uc73c\ub85c \ucd08\uae30\ud654\ub418\ub294\uc9c0 \ud655\uc778\n    func testResetSkipCount_SetsCountToZero() {\n        // Given: \uac74\ub108\ub6f0\uae30 3\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 3)\n\n        // When: \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n        sut.resetSkipCount()\n\n        // Then: \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 0\uc774\uc5b4\uc57c \ud568\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0,\n                      \"\ucd08\uae30\ud654 \ud6c4 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertFalse(sut.isForceEntry,\n                      \"\ucd08\uae30\ud654 \ud6c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\ub294 false\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub0a0\uc9dc\ubcc4 \ub3c5\ub9bd\uc801\uc778 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date-based Key Testing\n    /// \uac01 \ub0a0\uc9dc\uac00 \ub3c5\ub9bd\uc801\uc778 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub97c \uac00\uc9c0\ub294\uc9c0 \ud655\uc778\n    func testSkipCount_DifferentDates_AreIndependent() {\n        // Given: \uc624\ub298 \uac74\ub108\ub6f0\uae30 2\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2)\n\n        // When: UserDefaults\uc5d0 \ub2e4\ub978 \ub0a0\uc9dc\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc124\uc815\n        let yesterday = Calendar.current.date(byAdding: .day, value: -1, to: Date())!\n        let yesterdayKey = makeSkipCountKey(for: yesterday)\n        testUserDefaults.set(5, forKey: yesterdayKey)\n\n        // Then: \uc624\ub298 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \uc5ec\uc804\ud788 2\uc5ec\uc57c \ud568\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2,\n                      \"\uc624\ub298\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \ub2e4\ub978 \ub0a0\uc9dc\uc5d0 \uc601\ud5a5\ubc1b\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n\n        // Then: \uc5b4\uc81c \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 5\uc5ec\uc57c \ud568\n        XCTAssertEqual(testUserDefaults.integer(forKey: yesterdayKey), 5,\n                      \"\uc5b4\uc81c\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc720\uc9c0\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Force Entry Mode Tests\n\n    /// \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc - 3\ud68c \uac74\ub108\ub6f0\uae30 \uc804\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Force Entry Logic Testing\n    /// 3\ud68c \ubbf8\ub9cc \uac74\ub108\ub6f0\uae30 \uc2dc \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \uc544\ub2cc\uc9c0 \ud655\uc778\n    func testIsForceEntry_Before3Skips_IsFalse() {\n        // Given & When: \uac74\ub108\ub6f0\uae30 0\ud68c\n        XCTAssertFalse(sut.isForceEntry,\n                      \"\ucd08\uae30 \uc0c1\ud0dc\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \uc544\ub2c8\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 1\ud68c\n        sut.incrementSkipCount()\n        // Then: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc544\ub2d8\n        XCTAssertFalse(sut.isForceEntry,\n                      \"1\ud68c \uac74\ub108\ub6f0\uae30\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \uc544\ub2c8\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 2\ud68c\n        sut.incrementSkipCount()\n        // Then: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc544\ub2d8\n        XCTAssertFalse(sut.isForceEntry,\n                      \"2\ud68c \uac74\ub108\ub6f0\uae30\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \uc544\ub2c8\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc - 3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4\n    func testIsForceEntry_After3Skips_IsTrue() {\n        // Given: \uac74\ub108\ub6f0\uae30 2\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n\n        // When: 3\ud68c\uc9f8 \uac74\ub108\ub6f0\uae30\n        sut.incrementSkipCount()\n\n        // Then: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \ud65c\uc131\ud654\n        XCTAssertTrue(sut.isForceEntry,\n                     \"3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(sut.getCurrentSkipCount(), 3,\n                      \"\uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 3\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc - 3\ud68c \ucd08\uacfc \uac74\ub108\ub6f0\uae30\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Edge Case Testing\n    /// 3\ud68c \uc774\uc0c1 \uac74\ub108\ub6f0\uae30 \uc2dc\uc5d0\ub3c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc720\uc9c0\ub418\ub294\uc9c0 \ud655\uc778\n    func testIsForceEntry_MoreThan3Skips_RemainsTrue() {\n        // Given: \uac74\ub108\ub6f0\uae30 3\ud68c (\uac15\uc81c \uc785\ub825 \ubaa8\ub4dc)\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertTrue(sut.isForceEntry)\n\n        // When: \ucd94\uac00 \uac74\ub108\ub6f0\uae30 (4\ud68c\uc9f8)\n        sut.incrementSkipCount()\n\n        // Then: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc720\uc9c0\n        XCTAssertTrue(sut.isForceEntry,\n                     \"3\ud68c \ucd08\uacfc \uac74\ub108\ub6f0\uae30\ub3c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(sut.getCurrentSkipCount(), 4,\n                      \"\uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 4\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ub0a8\uc740 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uacc4\uc0b0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Method Testing\n    /// UI\uc5d0 \ud45c\uc2dc\ud560 \ub0a8\uc740 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \uc62c\ubc14\ub974\uac8c \uacc4\uc0b0\ub418\ub294\uc9c0 \ud655\uc778\n    func testGetRemainingSkips_ReturnsCorrectValue() {\n        // Given & Then: \ucd08\uae30 \uc0c1\ud0dc (3\ud68c \ub0a8\uc74c)\n        XCTAssertEqual(sut.getRemainingSkips(), 3,\n                      \"\ucd08\uae30 \uc0c1\ud0dc\ub294 3\ud68c \ub0a8\uc544\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 1\ud68c\n        sut.incrementSkipCount()\n        // Then: 2\ud68c \ub0a8\uc74c\n        XCTAssertEqual(sut.getRemainingSkips(), 2,\n                      \"1\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 2\ud68c \ub0a8\uc544\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 1\ud68c \ub354\n        sut.incrementSkipCount()\n        // Then: 1\ud68c \ub0a8\uc74c\n        XCTAssertEqual(sut.getRemainingSkips(), 1,\n                      \"2\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 1\ud68c \ub0a8\uc544\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \uac74\ub108\ub6f0\uae30 1\ud68c \ub354\n        sut.incrementSkipCount()\n        // Then: 0\ud68c \ub0a8\uc74c\n        XCTAssertEqual(sut.getRemainingSkips(), 0,\n                      \"3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 0\ud68c \ub0a8\uc544\uc57c \ud569\ub2c8\ub2e4\")\n\n        // When: \ucd94\uac00 \uac74\ub108\ub6f0\uae30 (4\ud68c\uc9f8)\n        sut.incrementSkipCount()\n        // Then: 0\ud68c \ub0a8\uc74c (\uc74c\uc218\uac00 \ub418\uc9c0 \uc54a\uc74c)\n        XCTAssertEqual(sut.getRemainingSkips(), 0,\n                      \"3\ud68c \ucd08\uacfc \uac74\ub108\ub6f0\uae30\ub3c4 0\ud68c \ub0a8\uc74c\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Prompt Logic Tests\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc - \uc2dc\uac04 \uc870\uac74 \ubbf8\ucda9\uc871 (06:00 \uc774\uc804)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Time-based Logic Testing\n    /// 06:00 \uc774\uc804\uc5d0\ub294 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\ub294\uc9c0 \ud655\uc778\n    /// Note: \uc774 \ud14c\uc2a4\ud2b8\ub294 \uc2e4\uc81c \uc2dc\uac04\uc5d0 \uc758\uc874\ud558\ubbc0\ub85c DateUtils.shouldShowSleepPopup\uc774 false\ub97c \ubc18\ud658\ud558\ub294 \uacbd\uc6b0\ub97c \uc2dc\ubbac\ub808\uc774\uc158\n    func testCheckShouldShow_Before6AM_DoesNotShowPrompt() async {\n        // Given: \uc2dc\uac04 \uc870\uac74 \ud655\uc778\uc740 DateUtils\uc5d0 \uc758\uc874\n        // Note: \uc774 \ud14c\uc2a4\ud2b8\ub294 DateUtils.shouldShowSleepPopup() == true\uc778 \uc2dc\uac04\uc5d0 \uc2e4\ud589\ub418\uba74 \uc2e4\ud328\ud560 \uc218 \uc788\uc74c\n        // \uc2e4\uc81c \ud504\ub85c\ub355\uc158 \ucf54\ub4dc\uc5d0\uc11c\ub294 DateUtils\ub97c \uc8fc\uc785\ubc1b\uc544 Mock\uc73c\ub85c \ub300\uccb4\ud558\ub294 \uac83\uc774 \uc774\uc0c1\uc801\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778 (\uc2dc\uac04\uc774 06:00 \uc774\ud6c4\ub77c\uba74)\n        await sut.checkShouldShow()\n\n        // Then: DateUtils.shouldShowSleepPopup()\uc758 \ubc18\ud658\uac12\uc5d0 \ub530\ub77c \uacb0\uacfc\uac00 \ub2ec\ub77c\uc9d0\n        // \uc774 \ud14c\uc2a4\ud2b8\ub294 \uc2e4\uc81c \uc2dc\uac04\uc5d0 \uc758\uc874\ud558\ubbc0\ub85c \uc8fc\uc11d \ucc98\ub9ac\n        // \uc2e4\ubb34\uc5d0\uc11c\ub294 DateUtils\ub97c Protocol\ub85c \ub9cc\ub4e4\uc5b4 Mock \uc8fc\uc785\n        print(\"\u26a0\ufe0f Time-dependent test: shouldShowPrompt = \\(sut.shouldShowPrompt)\")\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc - \uc624\ub298 \uae30\ub85d\uc774 \uc774\ubbf8 \uc874\uc7ac\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data-based Logic Testing\n    /// \uc624\ub298 \uc218\uba74 \uae30\ub85d\uc774 \uc788\uc73c\uba74 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\ub294\uc9c0 \ud655\uc778\n    func testCheckShouldShow_RecordExists_DoesNotShowPrompt() async {\n        // Given: \uc624\ub298 \uc218\uba74 \uae30\ub85d \uc874\uc7ac (Mock Repository \uc124\uc815)\n        let todayRecord = SleepRecord.sample()\n        mockRepository.recordToReturn = todayRecord\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778\n        await sut.checkShouldShow()\n\n        // Then: \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc544\uc57c \ud568\n        XCTAssertFalse(sut.shouldShowPrompt,\n                      \"\uc624\ub298 \uae30\ub85d\uc774 \uc788\uc73c\uba74 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc - \uae30\ub85d \uc5c6\uace0 \uac74\ub108\ub6f0\uae30 2\ud68c \uc774\ud558\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Integrated Logic Testing\n    /// \uc870\uac74\uc774 \ubaa8\ub450 \ucda9\uc871\ub418\uba74 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\ub294\uc9c0 \ud655\uc778\n    func testCheckShouldShow_NoRecordAndNotForceEntry_ShowsPrompt() async {\n        // Given: \uc624\ub298 \uae30\ub85d \uc5c6\uc74c (Mock Repository\uac00 nil \ubc18\ud658)\n        mockRepository.recordToReturn = nil\n\n        // Given: \uac74\ub108\ub6f0\uae30 1\ud68c (\uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc544\ub2d8)\n        sut.incrementSkipCount()\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778 (06:00 \uc774\ud6c4 \uc2dc\uac04\ub300\uc5d0\uc11c \uc2e4\ud589 \uac00\uc815)\n        await sut.checkShouldShow()\n\n        // Then: \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\ub418\uc5b4\uc57c \ud568 (\uc2dc\uac04 \uc870\uac74\uc774 \ucda9\uc871\ub41c\ub2e4\uba74)\n        // Note: DateUtils.shouldShowSleepPopup()\uc774 true\ub97c \ubc18\ud658\ud560 \ub54c\ub9cc \ud1b5\uacfc\n        if DateUtils.shouldShowSleepPopup() {\n            XCTAssertTrue(sut.shouldShowPrompt,\n                         \"\uae30\ub85d\uc774 \uc5c6\uc73c\uba74 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n            XCTAssertFalse(sut.isForceEntry,\n                          \"2\ud68c \uc774\ud558 \uac74\ub108\ub6f0\uae30\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \uc544\ub2c8\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc (3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4)\n    func testCheckShouldShow_After3Skips_ShowsForceEntryPrompt() async {\n        // Given: \uc624\ub298 \uae30\ub85d \uc5c6\uc74c\n        mockRepository.recordToReturn = nil\n\n        // Given: \uac74\ub108\ub6f0\uae30 3\ud68c (\uac15\uc81c \uc785\ub825 \ubaa8\ub4dc)\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778\n        await sut.checkShouldShow()\n\n        // Then: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\ub85c \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\n        if DateUtils.shouldShowSleepPopup() {\n            XCTAssertTrue(sut.shouldShowPrompt,\n                         \"\uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5d0\uc11c \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n            XCTAssertTrue(sut.isForceEntry,\n                         \"3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc - \uae30\ub85d \uc874\uc7ac \uc2dc \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Auto-reset Logic Testing\n    /// \uae30\ub85d\uc774 \uc788\uc73c\uba74 \uc790\ub3d9\uc73c\ub85c \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \ucd08\uae30\ud654\ub418\ub294\uc9c0 \ud655\uc778\n    func testCheckShouldShow_RecordExists_ResetsSkipCount() async {\n        // Given: \uac74\ub108\ub6f0\uae30 2\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2)\n\n        // Given: \uc624\ub298 \uae30\ub85d \uc874\uc7ac\n        mockRepository.recordToReturn = SleepRecord.sample()\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778\n        await sut.checkShouldShow()\n\n        // Then: \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0,\n                      \"\uae30\ub85d\uc774 \uc788\uc73c\uba74 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \ucd08\uae30\ud654\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertFalse(sut.shouldShowPrompt,\n                      \"\ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \uc218\ub3d9 \ub2eb\uae30\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manual Dismiss Testing\n    /// \ud504\ub86c\ud504\ud2b8\ub97c \ud504\ub85c\uadf8\ub798\ubc0d \ubc29\uc2dd\uc73c\ub85c \ub2eb\uc744 \uc218 \uc788\ub294\uc9c0 \ud655\uc778\n    func testDismissPrompt_SetsShowPromptToFalse() {\n        // Given: \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc911\n        sut.shouldShowPrompt = true\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ub2eb\uae30\n        sut.dismissPrompt()\n\n        // Then: \ud504\ub86c\ud504\ud2b8\uac00 \ub2eb\ud600\uc57c \ud568\n        XCTAssertFalse(sut.shouldShowPrompt,\n                      \"dismissPrompt \ud638\ucd9c \ud6c4 \ud504\ub86c\ud504\ud2b8\uac00 \ub2eb\ud600\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \uc218\ub3d9 \ub2eb\uae30 - \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc720\uc9c0\n    func testDismissPrompt_PreservesSkipCount() {\n        // Given: \uac74\ub108\ub6f0\uae30 2\ud68c\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n\n        // Given: \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc911\n        sut.shouldShowPrompt = true\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ub2eb\uae30\n        sut.dismissPrompt()\n\n        // Then: \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc720\uc9c0\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2,\n                      \"dismissPrompt\ub294 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Repository Error Handling Tests\n\n    /// Repository \uc5d0\ub7ec \ucc98\ub9ac - \uc870\ud68c \uc2e4\ud328 \uc2dc\uc5d0\ub3c4 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Handling Testing\n    /// Repository\uc5d0\uc11c \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud574\ub3c4 \uc548\uc804\ud558\uac8c \ucc98\ub9ac\ud558\ub294\uc9c0 \ud655\uc778\n    func testCheckShouldShow_RepositoryError_ShowsPrompt() async {\n        // Given: Repository\uac00 \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0a4\ub3c4\ub85d \uc124\uc815\n        mockRepository.shouldFail = true\n\n        // When: \ud504\ub86c\ud504\ud2b8 \ud655\uc778\n        await sut.checkShouldShow()\n\n        // Then: \ubcf4\uc218\uc801\uc73c\ub85c \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc (\uc5d0\ub7ec \uc2dc\uc5d0\ub3c4 \uae30\ub85d \uc548 \ud558\ub294 \uac83\ubcf4\ub2e4 \uc548\uc804)\n        if DateUtils.shouldShowSleepPopup() {\n            XCTAssertTrue(sut.shouldShowPrompt,\n                         \"Repository \uc5d0\ub7ec \uc2dc\uc5d0\ub3c4 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        }\n    }\n\n    // MARK: - Cleanup Tests\n\n    /// \uc624\ub798\ub41c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130 \uc815\ub9ac\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Cleanup Testing\n    /// 7\uc77c \uc774\uc0c1 \uc9c0\ub09c \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \uc0ad\uc81c\ub418\ub294\uc9c0 \ud655\uc778\n    func testCleanupOldSkipCounts_RemovesOldData() {\n        // Given: \uc624\ub298 \uac74\ub108\ub6f0\uae30 1\ud68c\n        sut.incrementSkipCount()\n\n        // Given: 8\uc77c \uc804 \ub370\uc774\ud130 \ucd94\uac00\n        let eightDaysAgo = Calendar.current.date(byAdding: .day, value: -8, to: Date())!\n        let oldKey = makeSkipCountKey(for: eightDaysAgo)\n        testUserDefaults.set(2, forKey: oldKey)\n\n        // Given: 5\uc77c \uc804 \ub370\uc774\ud130 \ucd94\uac00 (\ucd5c\uadfc \ub370\uc774\ud130)\n        let fiveDaysAgo = Calendar.current.date(byAdding: .day, value: -5, to: Date())!\n        let recentKey = makeSkipCountKey(for: fiveDaysAgo)\n        testUserDefaults.set(3, forKey: recentKey)\n\n        // When: \uc815\ub9ac \uc2e4\ud589\n        sut.cleanupOldSkipCounts()\n\n        // Then: 8\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ub428\n        XCTAssertEqual(testUserDefaults.integer(forKey: oldKey), 0,\n                      \"8\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // Then: 5\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub428\n        XCTAssertEqual(testUserDefaults.integer(forKey: recentKey), 3,\n                      \"5\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // Then: \uc624\ub298 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub428\n        XCTAssertEqual(sut.getCurrentSkipCount(), 1,\n                      \"\uc624\ub298 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc815\ub9ac - \uc815\ud655\ud788 7\uc77c \uc804 \ub370\uc774\ud130 (\uacbd\uacc4\uac12)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Boundary Testing for Cleanup\n    /// \uc815\ud655\ud788 7\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub418\ub294\uc9c0 \ud655\uc778\n    func testCleanupOldSkipCounts_PreservesSevenDayOldData() {\n        // Given: \uc815\ud655\ud788 7\uc77c \uc804 \ub370\uc774\ud130\n        let sevenDaysAgo = Calendar.current.date(byAdding: .day, value: -7, to: Date())!\n        let boundaryKey = makeSkipCountKey(for: sevenDaysAgo)\n        testUserDefaults.set(2, forKey: boundaryKey)\n\n        // When: \uc815\ub9ac \uc2e4\ud589\n        sut.cleanupOldSkipCounts()\n\n        // Then: 7\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub428 (\uacbd\uacc4\uac12 \ud3ec\ud568)\n        XCTAssertEqual(testUserDefaults.integer(forKey: boundaryKey), 2,\n                      \"\uc815\ud655\ud788 7\uc77c \uc804 \ub370\uc774\ud130\ub294 \uc720\uc9c0\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc815\ub9ac - \ub2e4\ub978 UserDefaults \ud0a4\ub294 \ubcf4\uc874\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Selective Cleanup Testing\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \uc544\ub2cc \ub2e4\ub978 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ub418\uc9c0 \uc54a\ub294\uc9c0 \ud655\uc778\n    func testCleanupOldSkipCounts_PreservesNonSleepKeys() {\n        // Given: \ub2e4\ub978 UserDefaults \ud0a4\n        let otherKey = \"some_other_setting\"\n        testUserDefaults.set(\"important_value\", forKey: otherKey)\n\n        // Given: \uc624\ub798\ub41c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130\n        let oldDate = Calendar.current.date(byAdding: .day, value: -10, to: Date())!\n        let oldKey = makeSkipCountKey(for: oldDate)\n        testUserDefaults.set(1, forKey: oldKey)\n\n        // When: \uc815\ub9ac \uc2e4\ud589\n        sut.cleanupOldSkipCounts()\n\n        // Then: \ub2e4\ub978 \ud0a4\ub294 \uc720\uc9c0\ub428\n        XCTAssertEqual(testUserDefaults.string(forKey: otherKey), \"important_value\",\n                      \"\ub2e4\ub978 UserDefaults \ud0a4\ub294 \ubcf4\uc874\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        // Then: \uc624\ub798\ub41c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ub428\n        XCTAssertEqual(testUserDefaults.integer(forKey: oldKey), 0,\n                      \"\uc624\ub798\ub41c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Edge Case Tests\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - \uc5f0\uc18d \uc99d\uac00 \ud6c4 \ucd08\uae30\ud654 \ubc18\ubcf5\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repeated Operations Testing\n    /// \uc99d\uac00/\ucd08\uae30\ud654\ub97c \ubc18\ubcf5\ud574\ub3c4 \uc62c\ubc14\ub974\uac8c \ub3d9\uc791\ud558\ub294\uc9c0 \ud655\uc778\n    func testSkipCount_RepeatedIncrementAndReset_WorksCorrectly() {\n        // Given & When: \uccab \ubc88\uc9f8 \uc0ac\uc774\ud074\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2)\n        sut.resetSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0)\n\n        // When: \ub450 \ubc88\uc9f8 \uc0ac\uc774\ud074\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 1)\n        sut.resetSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0)\n\n        // When: \uc138 \ubc88\uc9f8 \uc0ac\uc774\ud074\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 3)\n        XCTAssertTrue(sut.isForceEntry)\n        sut.resetSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0)\n        XCTAssertFalse(sut.isForceEntry)\n\n        // Then: \ubaa8\ub4e0 \uc0ac\uc774\ud074\uc774 \ub3c5\ub9bd\uc801\uc73c\ub85c \ub3d9\uc791\n        print(\"\u2705 Repeated increment/reset cycles work correctly\")\n    }\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - \ucd08\uae30\ud654 \uc5c6\uc774 \ub9ce\uc740 \uac74\ub108\ub6f0\uae30\n    func testSkipCount_ManyIncrementsWithoutReset_CountsCorrectly() {\n        // Given & When: 10\ud68c \uac74\ub108\ub6f0\uae30\n        for i in 1...10 {\n            sut.incrementSkipCount()\n            XCTAssertEqual(sut.getCurrentSkipCount(), i,\n                          \"\\(i)\ubc88\uc9f8 \uac74\ub108\ub6f0\uae30 \ud6c4 \ud69f\uc218\ub294 \\(i)\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n\n            // 3\ud68c \uc774\uc0c1\ubd80\ud130\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\n            if i >= 3 {\n                XCTAssertTrue(sut.isForceEntry,\n                            \"\\(i)\ud68c \uac74\ub108\ub6f0\uae30\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5ec\uc57c \ud569\ub2c8\ub2e4\")\n            }\n        }\n\n        // Then: \ucd5c\uc885 \ud69f\uc218 \ud655\uc778\n        XCTAssertEqual(sut.getCurrentSkipCount(), 10,\n                      \"10\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 \ud69f\uc218\ub294 10\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    /// \uc5e3\uc9c0 \ucf00\uc774\uc2a4 - UserDefaults \ud0a4 \ud615\uc2dd \uac80\uc99d\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Key Format Testing\n    /// UserDefaults \ud0a4\uac00 \uc62c\ubc14\ub978 \ud615\uc2dd\uc73c\ub85c \uc0dd\uc131\ub418\ub294\uc9c0 \ud655\uc778\n    func testSkipCountKey_GeneratesCorrectFormat() {\n        // Given: \ud2b9\uc815 \ub0a0\uc9dc\n        let calendar = Calendar.current\n        let date = calendar.date(from: DateComponents(\n            year: 2026,\n            month: 1,\n            day: 15\n        ))!\n\n        // When: \ud0a4 \uc0dd\uc131\n        let key = makeSkipCountKey(for: date)\n\n        // Then: ISO 8601 \ud615\uc2dd \ud655\uc778\n        XCTAssertTrue(key.hasPrefix(\"sleep_skip_count_\"),\n                     \"\ud0a4\ub294 'sleep_skip_count_' \uc811\ub450\uc0ac\ub85c \uc2dc\uc791\ud574\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertTrue(key.contains(\"2026-01-15\"),\n                     \"\ud0a4\uc5d0 ISO 8601 \ub0a0\uc9dc \ud615\uc2dd\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n    }\n\n    // MARK: - Integration Tests\n\n    /// \ud1b5\ud569 \ud14c\uc2a4\ud2b8 - \uc804\uccb4 \uc6cc\ud06c\ud50c\ub85c\uc6b0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: End-to-End Testing\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\ubd80\ud130 \uae30\ub85d \uc800\uc7a5\uae4c\uc9c0 \uc804\uccb4 \ud750\ub984 \uac80\uc99d\n    func testFullWorkflow_SkipAndRecord_WorksCorrectly() async {\n        // Day 1: \uccab \ubc88\uc9f8 \uac74\ub108\ub6f0\uae30\n        await sut.checkShouldShow()\n        if DateUtils.shouldShowSleepPopup() {\n            XCTAssertTrue(sut.shouldShowPrompt)\n            XCTAssertFalse(sut.isForceEntry)\n        }\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 1)\n\n        // Day 2: \ub450 \ubc88\uc9f8 \uac74\ub108\ub6f0\uae30\n        await sut.checkShouldShow()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 2)\n        XCTAssertFalse(sut.isForceEntry)\n\n        // Day 3: \uc138 \ubc88\uc9f8 \uac74\ub108\ub6f0\uae30\n        await sut.checkShouldShow()\n        sut.incrementSkipCount()\n        XCTAssertEqual(sut.getCurrentSkipCount(), 3)\n        XCTAssertTrue(sut.isForceEntry)\n\n        // Day 4: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5d0\uc11c \uae30\ub85d \uc800\uc7a5\n        mockRepository.recordToReturn = SleepRecord.sample()\n        await sut.checkShouldShow()\n        XCTAssertFalse(sut.shouldShowPrompt,\n                      \"\uae30\ub85d\uc774 \uc788\uc73c\uba74 \ud504\ub86c\ud504\ud2b8\uac00 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertEqual(sut.getCurrentSkipCount(), 0,\n                      \"\uae30\ub85d \uc800\uc7a5 \ud6c4 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uac00 \ucd08\uae30\ud654\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n        XCTAssertFalse(sut.isForceEntry,\n                      \"\ucd08\uae30\ud654 \ud6c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uac00 \ud574\uc81c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4\")\n\n        print(\"\u2705 Full workflow test completed\")\n    }\n\n    // MARK: - Helper Methods\n\n    /// UserDefaults \ud0a4 \uc0dd\uc131 \ud5ec\ud37c \uba54\uc11c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Helper\n    /// SleepPromptManager\uc758 private \uba54\uc11c\ub4dc\uc640 \ub3d9\uc77c\ud55c \ub85c\uc9c1\n    /// \ud14c\uc2a4\ud2b8\uc5d0\uc11c \ud0a4\ub97c \uc0dd\uc131\ud560 \ub54c \uc0ac\uc6a9\n    private func makeSkipCountKey(for date: Date) -> String {\n        let dateFormatter = ISO8601DateFormatter()\n        dateFormatter.formatOptions = [.withFullDate]\n        let dateString = dateFormatter.string(from: date)\n        return \"sleep_skip_count_\" + dateString\n    }\n}\n\n// MARK: - Mock Repository\n\n/// Mock Sleep Repository\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Test Double - Mock\n/// - \uc2e4\uc81c Repository \ub3d9\uc791\uc744 \uc2dc\ubbac\ub808\uc774\uc158\n/// - \ud14c\uc2a4\ud2b8\uc5d0\uc11c \ud638\ucd9c \uc5ec\ubd80\uc640 \uc804\ub2ec\ub41c \uac12\uc744 \uac80\uc99d \uac00\ub2a5\n/// - \uc5d0\ub7ec \ucf00\uc774\uc2a4\ub3c4 \uc27d\uac8c \uc2dc\ubbac\ub808\uc774\uc158 \uac00\ub2a5\n/// \ud83d\udca1 Java \ube44\uad50: Mockito\uc758 @Mock\uacfc \uc720\uc0ac\nclass MockSleepRepository: SleepRepositoryProtocol {\n\n    // MARK: - Properties\n\n    /// \ubc18\ud658\ud560 \ub808\ucf54\ub4dc (\uc124\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 nil \ubc18\ud658)\n    var recordToReturn: SleepRecord?\n\n    /// \uc5d0\ub7ec \ubc1c\uc0dd \ud50c\ub798\uadf8\n    var shouldFail = false\n\n    /// fetch \uba54\uc11c\ub4dc \ud638\ucd9c \uc5ec\ubd80\n    var fetchCalled = false\n\n    // MARK: - SleepRepositoryProtocol Implementation\n\n    func save(sleepRecord: SleepRecord) async throws -> SleepRecord {\n        if shouldFail {\n            throw RepositoryError.saveFailed\n        }\n        return sleepRecord\n    }\n\n    func fetch(by id: UUID) async throws -> SleepRecord? {\n        fetchCalled = true\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn\n    }\n\n    func fetch(for date: Date) async throws -> SleepRecord? {\n        fetchCalled = true\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn\n    }\n\n    func fetchLatest() async throws -> SleepRecord? {\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn\n    }\n\n    func fetchAll() async throws -> [SleepRecord] {\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn != nil ? [recordToReturn!] : []\n    }\n\n    func fetch(from startDate: Date, to endDate: Date) async throws -> [SleepRecord] {\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn != nil ? [recordToReturn!] : []\n    }\n\n    func fetchRecent(days: Int) async throws -> [SleepRecord] {\n        if shouldFail {\n            throw RepositoryError.fetchFailed\n        }\n        return recordToReturn != nil ? [recordToReturn!] : []\n    }\n\n    func update(sleepRecord: SleepRecord) async throws -> SleepRecord {\n        if shouldFail {\n            throw RepositoryError.updateFailed\n        }\n        return sleepRecord\n    }\n\n    func delete(by id: UUID) async throws {\n        if shouldFail {\n            throw RepositoryError.deleteFailed\n        }\n    }\n\n    func deleteAll() async throws {\n        if shouldFail {\n            throw RepositoryError.deleteFailed\n        }\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepPromptManager \ud14c\uc2a4\ud2b8 \uc804\ub7b5\n///\n/// \ud14c\uc2a4\ud2b8 \ucee4\ubc84\ub9ac\uc9c0:\n/// 1. \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc601\uc18d\uc131 \ud14c\uc2a4\ud2b8\n///    - \uc99d\uac00, \uc870\ud68c, \ucd08\uae30\ud654\n///    - \ub0a0\uc9dc\ubcc4 \ub3c5\ub9bd\uc801\uc778 \uad00\ub9ac\n///    - UserDefaults \uc800\uc7a5/\ub85c\ub4dc\n///\n/// 2. \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \ud14c\uc2a4\ud2b8\n///    - 3\ud68c \ubbf8\ub9cc: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc544\ub2d8\n///    - 3\ud68c \uc774\uc0c1: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \ud65c\uc131\ud654\n///    - \ub0a8\uc740 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uacc4\uc0b0\n///\n/// 3. \ud504\ub86c\ud504\ud2b8 \ub85c\uc9c1 \ud14c\uc2a4\ud2b8\n///    - \uc2dc\uac04 \uc870\uac74 \ud655\uc778 (06:00 \ud504\ub86c\ud504\ud2b8 \uacbd\uacc4, 02:00 \uc218\uba74 \uacbd\uacc4\ub294 \ub3c5\ub9bd\uc801)\n///    - \uae30\ub85d \uc874\uc7ac \uc5ec\ubd80 \ud655\uc778\n///    - \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uc5d0 \ub530\ub978 \ub3d9\uc791\n///    - \uc790\ub3d9 \ucd08\uae30\ud654 \ub85c\uc9c1\n///\n/// 4. \ub370\uc774\ud130 \uc815\ub9ac \ud14c\uc2a4\ud2b8\n///    - 7\uc77c \uc774\uc0c1 \uc9c0\ub09c \ub370\uc774\ud130 \uc0ad\uc81c\n///    - \ucd5c\uadfc \ub370\uc774\ud130 \ubcf4\uc874\n///    - \ub2e4\ub978 UserDefaults \ud0a4 \ubcf4\uc874\n///\n/// 5. \uc5d0\ub7ec \ucc98\ub9ac \ud14c\uc2a4\ud2b8\n///    - Repository \uc5d0\ub7ec \uc2dc \uc548\uc804\ud55c \ucc98\ub9ac\n///    - \ubcf4\uc218\uc801 \uc811\uadfc (\uc5d0\ub7ec \uc2dc\uc5d0\ub3c4 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc)\n///\n/// 6. \uc5e3\uc9c0 \ucf00\uc774\uc2a4 \ud14c\uc2a4\ud2b8\n///    - \ubc18\ubcf5\uc801\uc778 \uc99d\uac00/\ucd08\uae30\ud654\n///    - \ub9ce\uc740 \uac74\ub108\ub6f0\uae30\n///    - \ud0a4 \ud615\uc2dd \uac80\uc99d\n///\n/// 7. \ud1b5\ud569 \ud14c\uc2a4\ud2b8\n///    - \uc804\uccb4 \uc6cc\ud06c\ud50c\ub85c\uc6b0 \uac80\uc99d\n///    - \uac74\ub108\ub6f0\uae30\ubd80\ud130 \uae30\ub85d \uc800\uc7a5\uae4c\uc9c0\n///\n/// Mock \uc0ac\uc6a9 \uc774\uc720:\n/// - Core Data \uc758\uc874\uc131 \uc81c\uac70\n/// - \ube60\ub978 \ud14c\uc2a4\ud2b8 \uc2e4\ud589\n/// - \uc608\uce21 \uac00\ub2a5\ud55c \uacb0\uacfc\n/// - \uc5d0\ub7ec \uc2dc\ub098\ub9ac\uc624 \ud14c\uc2a4\ud2b8 \uc6a9\uc774\n/// - UserDefaults \uaca9\ub9ac\n///\n/// Test-specific UserDefaults:\n/// - \uac01 \ud14c\uc2a4\ud2b8\ub9c8\ub2e4 \ub3c5\ub9bd\uc801\uc778 UserDefaults \uc0ac\uc6a9\n/// - \ud14c\uc2a4\ud2b8 \uac04 \uac04\uc12d \ubc29\uc9c0\n/// - \uc815\ub9ac(cleanup) \uc6a9\uc774\n///\n/// \uc2dc\uac04 \uc758\uc874\uc131 \uc8fc\uc758\uc0ac\ud56d:\n/// - DateUtils.shouldShowSleepPopup()\uc740 \uc2e4\uc81c \uc2dc\uac04\uc5d0 \uc758\uc874\n/// - 06:00 \uc774\uc804\uc5d0 \ud14c\uc2a4\ud2b8 \uc2e4\ud589 \uc2dc \uc77c\ubd80 \ud14c\uc2a4\ud2b8 \uc2e4\ud328 \uac00\ub2a5\n/// - \uc2e4\ubb34\uc5d0\uc11c\ub294 DateUtils\ub97c Protocol\ub85c \ub9cc\ub4e4\uc5b4 Mock \uc8fc\uc785 \uad8c\uc7a5\n///\n/// \ud504\ub86c\ud504\ud2b8 vs \uc218\uba74 \uacbd\uacc4:\n/// - promptHour (6 AM): \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc2dc\uac04 (\uc0ac\uc6a9\uc790 UX)\n/// - boundaryHour (2 AM): \uc218\uba74 \ub0a0\uc9dc \uacc4\uc0b0 \uacbd\uacc4 (\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1)\n/// - \uc774 \ub450 \uac12\uc740 \ub3c5\ub9bd\uc801\uc774\uba70 \uc11c\ub85c \ub2e4\ub978 \ubaa9\uc801\uc744 \uac00\uc9d0\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - Manager \ud14c\uc2a4\ud2b8\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc5d0 \uc9d1\uc911\n/// - \uc678\ubd80 \uc758\uc874\uc131\uc740 Mock\uc73c\ub85c \ub300\uccb4\n/// - Given-When-Then \ud328\ud134\uc73c\ub85c \uac00\ub3c5\uc131 \ud5a5\uc0c1\n/// - \uc5e3\uc9c0 \ucf00\uc774\uc2a4\uc640 \uacbd\uacc4\uac12 \ud14c\uc2a4\ud2b8 \ud544\uc218\n/// - \ud1b5\ud569 \ud14c\uc2a4\ud2b8\ub85c \uc804\uccb4 \ud750\ub984 \uac80\uc99d\n/// - UserDefaults\ub294 \ud14c\uc2a4\ud2b8\ubcc4\ub85c \uaca9\ub9ac\n///\n",
        "last_modified": "2026-01-18T17:07:01.351974"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:05.008379",
  "last_updated": "2026-01-14T21:03:40.743370"
}