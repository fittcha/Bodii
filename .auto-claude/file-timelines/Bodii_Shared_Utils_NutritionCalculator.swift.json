{
  "file_path": "Bodii/Shared/Utils/NutritionCalculator.swift",
  "main_branch_history": [],
  "task_views": {
    "005-korean-food-database-integration": {
      "task_id": "005-korean-food-database-integration",
      "branch_point": {
        "commit_hash": "c44bfbcd7c1699b176a8bb155e8c35f43ebd4ad9",
        "content": "",
        "timestamp": "2026-01-13T07:46:23.878686"
      },
      "worktree_state": {
        "content": "//\n//  NutritionCalculator.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\nimport Foundation\n\n/// \uc601\uc591 \uacc4\uc0b0 \uc720\ud2f8\ub9ac\ud2f0\n///\n/// \uc12d\ucde8\ub7c9\uc5d0 \ub530\ub978 \uc601\uc591\uc18c \uacc4\uc0b0\uacfc \ub2e4\ub7c9 \uc601\uc591\uc18c \ube44\uc728\uc744 \uacc4\uc0b0\ud558\ub294 \uc720\ud2f8\ub9ac\ud2f0\uc785\ub2c8\ub2e4.\n///\n/// **\ud575\uc2ec \uae30\ub2a5:**\n/// - \uc778\ubd84(serving) \ub610\ub294 \uadf8\ub7a8(grams) \ub2e8\uc704\ub85c \uc601\uc591\uc18c \uacc4\uc0b0\n/// - \uce7c\ub85c\ub9ac, \ud0c4\uc218\ud654\ubb3c, \ub2e8\ubc31\uc9c8, \uc9c0\ubc29, \ub098\ud2b8\ub968, \uc2dd\uc774\uc12c\uc720, \ub2f9\ub958 \uacc4\uc0b0\n/// - \ub2e4\ub7c9 \uc601\uc591\uc18c(\ud0c4\ub2e8\uc9c0) \ube44\uc728 \uacc4\uc0b0\n///\n/// **\uacc4\uc0b0 \ub85c\uc9c1:**\n/// - `.serving` \ub2e8\uc704: `quantity * \uc601\uc591\uc18c\uac12` (Food\uc758 servingSize\uac00 \uae30\uc900)\n/// - `.grams` \ub2e8\uc704: `(quantity / servingSize) * \uc601\uc591\uc18c\uac12`\n///\n/// **Example:**\n/// ```swift\n/// let food = Food(\n///     id: UUID(),\n///     name: \"\ud604\ubbf8\ubc25\",\n///     calories: 330,\n///     carbohydrates: 73.4,\n///     protein: 6.8,\n///     fat: 2.5,\n///     servingSize: 210.0,\n///     ...\n/// )\n///\n/// // 1.5\uc778\ubd84 \uacc4\uc0b0\n/// let nutrition1 = NutritionCalculator.calculate(\n///     from: food,\n///     quantity: 1.5,\n///     unit: .serving\n/// )\n/// // nutrition1.calories == 495 (330 * 1.5)\n///\n/// // 300g \uacc4\uc0b0\n/// let nutrition2 = NutritionCalculator.calculate(\n///     from: food,\n///     quantity: 300,\n///     unit: .grams\n/// )\n/// // nutrition2.calories == 471 (330 * 300 / 210)\n/// ```\n///\n/// - Note: Java Spring\uc758 @Service \ub808\uc774\uc5b4\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc, Swift\uc5d0\uc11c\ub294 static utility\ub85c \uad6c\ud604\nenum NutritionCalculator {\n\n    // MARK: - Nutrition Calculation\n\n    /// \uc12d\ucde8\ub7c9\uc5d0 \ub530\ub978 \uc601\uc591\uc18c\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// Food\uc758 \uc601\uc591 \uc815\ubcf4\ub97c \uae30\ubc18\uc73c\ub85c \uc9c0\uc815\ub41c \uc12d\ucde8\ub7c9\uc5d0 \ub530\ub77c \uc601\uc591\uc18c\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - food: \uc74c\uc2dd \uc815\ubcf4\n    ///   - quantity: \uc12d\ucde8\ub7c9 (\uc778\ubd84 \ub610\ub294 \uadf8\ub7a8)\n    ///   - unit: \uc12d\ucde8\ub7c9 \ub2e8\uc704 (serving \ub610\ub294 grams)\n    /// - Returns: \uacc4\uc0b0\ub41c \uc601\uc591 \uc815\ubcf4\n    ///\n    /// - Note: `.serving` \ub2e8\uc704\ub294 Food\uc758 servingSize\ub97c \uae30\uc900\uc73c\ub85c \ubc30\uc218 \uacc4\uc0b0\n    /// - Note: `.grams` \ub2e8\uc704\ub294 \uadf8\ub7a8 \ub2e8\uc704 \uc9c1\uc811 \uacc4\uc0b0\n    ///\n    /// Example:\n    /// ```swift\n    /// let food = Food(name: \"\uae40\uce58\ucc0c\uac1c\", calories: 120, carbs: 10, protein: 8, fat: 5, servingSize: 250)\n    /// let nutrition = NutritionCalculator.calculate(from: food, quantity: 2.0, unit: .serving)\n    /// // nutrition.calories == 240, nutrition.protein == 16\n    /// ```\n    static func calculate(\n        from food: Food,\n        quantity: Decimal,\n        unit: QuantityUnit\n    ) -> CalculatedNutrition {\n        // \ubc30\uc728 \uacc4\uc0b0\n        let multiplier = calculateMultiplier(\n            servingSize: food.servingSize,\n            quantity: quantity,\n            unit: unit\n        )\n\n        // \uc601\uc591\uc18c \uacc4\uc0b0\n        let calories = calculateCalories(\n            baseCalories: food.calories,\n            multiplier: multiplier\n        )\n\n        let carbohydrates = calculateMacro(\n            baseMacro: food.carbohydrates,\n            multiplier: multiplier\n        )\n\n        let protein = calculateMacro(\n            baseMacro: food.protein,\n            multiplier: multiplier\n        )\n\n        let fat = calculateMacro(\n            baseMacro: food.fat,\n            multiplier: multiplier\n        )\n\n        let sodium = food.sodium.map { calculateMacro(baseMacro: $0, multiplier: multiplier) }\n        let fiber = food.fiber.map { calculateMacro(baseMacro: $0, multiplier: multiplier) }\n        let sugar = food.sugar.map { calculateMacro(baseMacro: $0, multiplier: multiplier) }\n\n        // \ub2e4\ub7c9 \uc601\uc591\uc18c \ube44\uc728 \uacc4\uc0b0\n        let macroRatios = calculateMacroRatios(\n            carbs: carbohydrates,\n            protein: protein,\n            fat: fat\n        )\n\n        return CalculatedNutrition(\n            quantity: quantity,\n            unit: unit,\n            calories: calories,\n            carbohydrates: carbohydrates,\n            protein: protein,\n            fat: fat,\n            sodium: sodium,\n            fiber: fiber,\n            sugar: sugar,\n            carbsPercentage: macroRatios.carbs,\n            proteinPercentage: macroRatios.protein,\n            fatPercentage: macroRatios.fat\n        )\n    }\n\n    // MARK: - Multiplier Calculation\n\n    /// \uc601\uc591\uc18c \uacc4\uc0b0\uc744 \uc704\ud55c \ubc30\uc728\uc744 \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// - Parameters:\n    ///   - servingSize: 1\ud68c \uc81c\uacf5\ub7c9 (\uadf8\ub7a8)\n    ///   - quantity: \uc12d\ucde8\ub7c9\n    ///   - unit: \uc12d\ucde8\ub7c9 \ub2e8\uc704\n    /// - Returns: \uc601\uc591\uc18c \uacc4\uc0b0 \ubc30\uc728\n    ///\n    /// - Note: `.serving`: quantity\ub97c \uadf8\ub300\ub85c \ubc30\uc728\ub85c \uc0ac\uc6a9 (1.5\uc778\ubd84 = 1.5\ubc30)\n    /// - Note: `.grams`: `quantity / servingSize`\ub85c \ubc30\uc728 \uacc4\uc0b0 (300g / 210g = 1.43\ubc30)\n    ///\n    /// Example:\n    /// ```swift\n    /// let multiplier1 = calculateMultiplier(servingSize: 210, quantity: 1.5, unit: .serving)\n    /// // Returns: 1.5\n    ///\n    /// let multiplier2 = calculateMultiplier(servingSize: 210, quantity: 300, unit: .grams)\n    /// // Returns: 1.4286 (300 / 210)\n    /// ```\n    private static func calculateMultiplier(\n        servingSize: Decimal,\n        quantity: Decimal,\n        unit: QuantityUnit\n    ) -> Decimal {\n        switch unit {\n        case .serving:\n            // \uc778\ubd84 \ub2e8\uc704: quantity\uac00 \ubc30\uc728\n            // \uc608: 1.5\uc778\ubd84 = 1.5\ubc30\n            return quantity\n\n        case .grams:\n            // \uadf8\ub7a8 \ub2e8\uc704: (\uc12d\ucde8\ub7c9 / 1\ud68c \uc81c\uacf5\ub7c9)\uc774 \ubc30\uc728\n            // \uc608: 300g \uc12d\ucde8, servingSize 210g = 300/210 = 1.43\ubc30\n            guard servingSize > 0 else { return 0 }\n            return quantity / servingSize\n        }\n    }\n\n    // MARK: - Nutrient Calculation Helpers\n\n    /// \uce7c\ub85c\ub9ac\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// - Parameters:\n    ///   - baseCalories: \uae30\uc900 \uce7c\ub85c\ub9ac (Food\uc758 servingSize \uae30\uc900)\n    ///   - multiplier: \ubc30\uc728\n    /// - Returns: \uacc4\uc0b0\ub41c \uce7c\ub85c\ub9ac (Int32, \ubc18\uc62c\ub9bc)\n    ///\n    /// Example:\n    /// ```swift\n    /// let calories = calculateCalories(baseCalories: 330, multiplier: 1.5)\n    /// // Returns: 495 (330 * 1.5)\n    /// ```\n    private static func calculateCalories(\n        baseCalories: Int32,\n        multiplier: Decimal\n    ) -> Int32 {\n        let calculated = Decimal(baseCalories) * multiplier\n        return calculated.rounded0.toInt32()\n    }\n\n    /// \ub2e4\ub7c9 \uc601\uc591\uc18c(\ud0c4\uc218\ud654\ubb3c, \ub2e8\ubc31\uc9c8, \uc9c0\ubc29)\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// - Parameters:\n    ///   - baseMacro: \uae30\uc900 \uc601\uc591\uc18c \uac12 (Food\uc758 servingSize \uae30\uc900)\n    ///   - multiplier: \ubc30\uc728\n    /// - Returns: \uacc4\uc0b0\ub41c \uc601\uc591\uc18c \uac12 (Decimal, \uc18c\uc218\uc810 1\uc790\ub9ac \ubc18\uc62c\ub9bc)\n    ///\n    /// Example:\n    /// ```swift\n    /// let protein = calculateMacro(baseMacro: 6.8, multiplier: 1.5)\n    /// // Returns: 10.2 (6.8 * 1.5)\n    /// ```\n    private static func calculateMacro(\n        baseMacro: Decimal,\n        multiplier: Decimal\n    ) -> Decimal {\n        let calculated = baseMacro * multiplier\n        return calculated.rounded1\n    }\n\n    // MARK: - Macro Ratio Calculation\n\n    /// \ub2e4\ub7c9 \uc601\uc591\uc18c(\ud0c4\ub2e8\uc9c0) \ube44\uc728\uc744 \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// \uce7c\ub85c\ub9ac \uae30\uc900\uc73c\ub85c \ud0c4\uc218\ud654\ubb3c, \ub2e8\ubc31\uc9c8, \uc9c0\ubc29\uc758 \ube44\uc728\uc744 \ubc31\ubd84\uc728\ub85c \uacc4\uc0b0\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - carbs: \ud0c4\uc218\ud654\ubb3c (g)\n    ///   - protein: \ub2e8\ubc31\uc9c8 (g)\n    ///   - fat: \uc9c0\ubc29 (g)\n    /// - Returns: \ud0c4\ub2e8\uc9c0 \ube44\uc728 (\uac01\uac01 0-100%)\n    ///\n    /// - Note: \ud0c4\uc218\ud654\ubb3c = 4 kcal/g, \ub2e8\ubc31\uc9c8 = 4 kcal/g, \uc9c0\ubc29 = 9 kcal/g\n    ///\n    /// Example:\n    /// ```swift\n    /// let ratios = calculateMacroRatios(carbs: 50, protein: 25, fat: 10)\n    /// // \ud0c4\uc218\ud654\ubb3c: 50 * 4 = 200 kcal\n    /// // \ub2e8\ubc31\uc9c8: 25 * 4 = 100 kcal\n    /// // \uc9c0\ubc29: 10 * 9 = 90 kcal\n    /// // \ucd1d: 390 kcal\n    /// // \ube44\uc728: 51.3%, 25.6%, 23.1%\n    /// ```\n    static func calculateMacroRatios(\n        carbs: Decimal,\n        protein: Decimal,\n        fat: Decimal\n    ) -> MacroRatios {\n        // \uac01 \uc601\uc591\uc18c\uc758 \uce7c\ub85c\ub9ac \uacc4\uc0b0\n        // \ud0c4\uc218\ud654\ubb3c: 4 kcal/g\n        // \ub2e8\ubc31\uc9c8: 4 kcal/g\n        // \uc9c0\ubc29: 9 kcal/g\n        let carbCalories = carbs * Constants.MacroNutrients.carbsCaloriesPerGram\n        let proteinCalories = protein * Constants.MacroNutrients.proteinCaloriesPerGram\n        let fatCalories = fat * Constants.MacroNutrients.fatCaloriesPerGram\n\n        let totalCalories = carbCalories + proteinCalories + fatCalories\n\n        // \ucd1d \uce7c\ub85c\ub9ac\uac00 0\uc774\uba74 \ubaa8\ub450 0% \ubc18\ud658\n        guard totalCalories > 0 else {\n            return MacroRatios(carbs: 0, protein: 0, fat: 0)\n        }\n\n        // \ubc31\ubd84\uc728 \uacc4\uc0b0 (\uc18c\uc218\uc810 1\uc790\ub9ac)\n        let carbsPercentage = (carbCalories / totalCalories * 100).rounded1\n        let proteinPercentage = (proteinCalories / totalCalories * 100).rounded1\n        let fatPercentage = (fatCalories / totalCalories * 100).rounded1\n\n        return MacroRatios(\n            carbs: carbsPercentage,\n            protein: proteinPercentage,\n            fat: fatPercentage\n        )\n    }\n\n    // MARK: - Convenience Calculation Methods\n\n    /// \uc778\ubd84 \ub2e8\uc704\ub85c \uc601\uc591\uc18c\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// - Parameters:\n    ///   - food: \uc74c\uc2dd \uc815\ubcf4\n    ///   - servings: \uc778\ubd84 \uc218\n    /// - Returns: \uacc4\uc0b0\ub41c \uc601\uc591 \uc815\ubcf4\n    ///\n    /// Example:\n    /// ```swift\n    /// let nutrition = NutritionCalculator.calculateForServings(from: food, servings: 1.5)\n    /// // 1.5\uc778\ubd84 \uc601\uc591\uc18c \uacc4\uc0b0\n    /// ```\n    static func calculateForServings(\n        from food: Food,\n        servings: Decimal\n    ) -> CalculatedNutrition {\n        calculate(from: food, quantity: servings, unit: .serving)\n    }\n\n    /// \uadf8\ub7a8 \ub2e8\uc704\ub85c \uc601\uc591\uc18c\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4\n    ///\n    /// - Parameters:\n    ///   - food: \uc74c\uc2dd \uc815\ubcf4\n    ///   - grams: \uadf8\ub7a8 \uc218\n    /// - Returns: \uacc4\uc0b0\ub41c \uc601\uc591 \uc815\ubcf4\n    ///\n    /// Example:\n    /// ```swift\n    /// let nutrition = NutritionCalculator.calculateForGrams(from: food, grams: 300)\n    /// // 300g \uc601\uc591\uc18c \uacc4\uc0b0\n    /// ```\n    static func calculateForGrams(\n        from food: Food,\n        grams: Decimal\n    ) -> CalculatedNutrition {\n        calculate(from: food, quantity: grams, unit: .grams)\n    }\n}\n\n// MARK: - Supporting Types\n\n/// \uacc4\uc0b0\ub41c \uc601\uc591 \uc815\ubcf4\n///\n/// NutritionCalculator\uac00 \uacc4\uc0b0\ud55c \uc601\uc591\uc18c \uc815\ubcf4\ub97c \ub2f4\ub294 \uad6c\uc870\uccb4\uc785\ub2c8\ub2e4.\n///\n/// - Note: FoodRecord \uc0dd\uc131 \uc2dc \uc774 \uc815\ubcf4\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4\nstruct CalculatedNutrition {\n    /// \uc12d\ucde8\ub7c9\n    let quantity: Decimal\n\n    /// \uc12d\ucde8\ub7c9 \ub2e8\uc704\n    let unit: QuantityUnit\n\n    // MARK: - Calculated Nutrition Values\n\n    /// \uacc4\uc0b0\ub41c \uce7c\ub85c\ub9ac (kcal)\n    let calories: Int32\n\n    /// \uacc4\uc0b0\ub41c \ud0c4\uc218\ud654\ubb3c (g)\n    let carbohydrates: Decimal\n\n    /// \uacc4\uc0b0\ub41c \ub2e8\ubc31\uc9c8 (g)\n    let protein: Decimal\n\n    /// \uacc4\uc0b0\ub41c \uc9c0\ubc29 (g)\n    let fat: Decimal\n\n    /// \uacc4\uc0b0\ub41c \ub098\ud2b8\ub968 (mg)\n    let sodium: Decimal?\n\n    /// \uacc4\uc0b0\ub41c \uc2dd\uc774\uc12c\uc720 (g)\n    let fiber: Decimal?\n\n    /// \uacc4\uc0b0\ub41c \ub2f9\ub958 (g)\n    let sugar: Decimal?\n\n    // MARK: - Macro Ratios\n\n    /// \ud0c4\uc218\ud654\ubb3c \ube44\uc728 (%)\n    let carbsPercentage: Decimal\n\n    /// \ub2e8\ubc31\uc9c8 \ube44\uc728 (%)\n    let proteinPercentage: Decimal\n\n    /// \uc9c0\ubc29 \ube44\uc728 (%)\n    let fatPercentage: Decimal\n}\n\n// MARK: - CalculatedNutrition Extensions\n\nextension CalculatedNutrition {\n    /// FoodRecord \uc0dd\uc131\uc744 \uc704\ud55c \ud5ec\ud37c \uba54\uc11c\ub4dc\n    ///\n    /// CalculatedNutrition\uc744 \uae30\ubc18\uc73c\ub85c FoodRecord\ub97c \uc27d\uac8c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - foodId: \uc74c\uc2dd ID\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    ///   - date: \uc12d\ucde8 \uc77c\uc790\n    ///   - mealType: \ub07c\ub2c8 \uc885\ub958\n    /// - Returns: \uc0dd\uc131\ub41c FoodRecord\n    ///\n    /// Example:\n    /// ```swift\n    /// let nutrition = NutritionCalculator.calculate(from: food, quantity: 1.5, unit: .serving)\n    /// let record = nutrition.toFoodRecord(\n    ///     foodId: food.id,\n    ///     userId: currentUser.id,\n    ///     date: Date(),\n    ///     mealType: .breakfast\n    /// )\n    /// ```\n    func toFoodRecord(\n        foodId: UUID,\n        userId: UUID,\n        date: Date,\n        mealType: MealType\n    ) -> FoodRecord {\n        FoodRecord(\n            id: UUID(),\n            userId: userId,\n            foodId: foodId,\n            date: date,\n            mealType: mealType,\n            quantity: quantity,\n            quantityUnit: unit,\n            calculatedCalories: calories,\n            calculatedCarbs: carbohydrates,\n            calculatedProtein: protein,\n            calculatedFat: fat,\n            createdAt: Date()\n        )\n    }\n}\n\n/// \ub2e4\ub7c9 \uc601\uc591\uc18c \ube44\uc728\n///\n/// \ud0c4\uc218\ud654\ubb3c, \ub2e8\ubc31\uc9c8, \uc9c0\ubc29\uc758 \uce7c\ub85c\ub9ac \uae30\uc900 \ube44\uc728\uc744 \ub098\ud0c0\ub0c5\ub2c8\ub2e4.\n///\n/// - Note: \ucd1d \ud569\uacc4\ub294 \uc77c\ubc18\uc801\uc73c\ub85c 100%\uc774\uc9c0\ub9cc \ubc18\uc62c\ub9bc\uc73c\ub85c \uc778\ud574 \uc57d\uac04 \ub2e4\ub97c \uc218 \uc788\uc2b5\ub2c8\ub2e4\nstruct MacroRatios {\n    /// \ud0c4\uc218\ud654\ubb3c \ube44\uc728 (%)\n    let carbs: Decimal\n\n    /// \ub2e8\ubc31\uc9c8 \ube44\uc728 (%)\n    let protein: Decimal\n\n    /// \uc9c0\ubc29 \ube44\uc728 (%)\n    let fat: Decimal\n}\n\n// MARK: - Constants Extension\n\nextension Constants {\n    /// \ub2e4\ub7c9 \uc601\uc591\uc18c \uce7c\ub85c\ub9ac \ubcc0\ud658 \uc0c1\uc218\n    enum MacroNutrients {\n        /// \ud0c4\uc218\ud654\ubb3c 1g\ub2f9 \uce7c\ub85c\ub9ac (kcal/g)\n        static let carbsCaloriesPerGram: Decimal = 4\n\n        /// \ub2e8\ubc31\uc9c8 1g\ub2f9 \uce7c\ub85c\ub9ac (kcal/g)\n        static let proteinCaloriesPerGram: Decimal = 4\n\n        /// \uc9c0\ubc29 1g\ub2f9 \uce7c\ub85c\ub9ac (kcal/g)\n        static let fatCaloriesPerGram: Decimal = 9\n    }\n}\n",
        "last_modified": "2026-01-14T22:55:39.268022"
      },
      "task_intent": {
        "title": "005-korean-food-database-integration",
        "description": "Integrate Korean Food & Drug Administration (\uc2dd\uc57d\ucc98) food nutrition database API as primary source, with USDA FoodData Central as fallback for international foods. Prioritize Korean dishes (kimchi jjigae, bibimbap, tteokbokki) that are poorly covered by competitors.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:31.799184",
  "last_updated": "2026-01-13T07:46:23.900505"
}