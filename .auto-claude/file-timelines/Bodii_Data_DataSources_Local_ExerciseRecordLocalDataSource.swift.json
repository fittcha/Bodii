{
  "file_path": "Bodii/Data/DataSources/Local/ExerciseRecordLocalDataSource.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  ExerciseRecordLocalDataSource.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data CRUD \uc791\uc5c5\n// LocalDataSource\ub294 Core Data\uc640 \uc9c1\uc811 \uc0c1\ud638\uc791\uc6a9\ud558\ub294 \uacc4\uce35\n// \ud83d\udca1 Java \ube44\uad50: DAO(Data Access Object) \ud328\ud134\uacfc \uc720\uc0ac\n\nimport Foundation\nimport CoreData\n\n// MARK: - ExerciseRecordLocalDataSource\n\n/// ExerciseRecord\uc758 Core Data \uc791\uc5c5\uc744 \ub2f4\ub2f9\ud558\ub294 \ub85c\uceec \ub370\uc774\ud130 \uc18c\uc2a4\n///\n/// ## \ucc45\uc784\n/// - Core Data\uc758 ExerciseRecord \uc5d4\ud2f0\ud2f0 CRUD \uc791\uc5c5\n/// - NSManagedObject \u2194 Domain Entity \ub9e4\ud551\n/// - \ub0a0\uc9dc \uae30\ubc18 \uc870\ud68c \ubc0f \ud544\ud130\ub9c1\n///\n/// ## \uc758\uc874\uc131\n/// - NSManagedObjectContext: Core Data \ucee8\ud14d\uc2a4\ud2b8\n///\n/// - Example:\n/// ```swift\n/// let context = PersistenceController.shared.viewContext\n/// let dataSource = ExerciseRecordLocalDataSource(context: context)\n///\n/// // \uc6b4\ub3d9 \uae30\ub85d \uc0dd\uc131\n/// let record = ExerciseRecord(...)\n/// try await dataSource.create(record)\n///\n/// // \uc624\ub298 \uc6b4\ub3d9 \uc870\ud68c\n/// let records = try await dataSource.fetchByDate(Date(), userId: userId)\n/// ```\nfinal class ExerciseRecordLocalDataSource {\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectContext\n    // Core Data\uc758 \uc791\uc5c5 \uacf5\uac04 - \uc5d4\ud2f0\ud2f0\uc758 CRUD \uc791\uc5c5\uc744 \ucd94\uc801\ud558\uace0 \uad00\ub9ac\n    // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n    private let context: NSManagedObjectContext\n\n    // MARK: - Initialization\n\n    /// LocalDataSource \ucd08\uae30\ud654\n    /// - Parameter context: Core Data \ucee8\ud14d\uc2a4\ud2b8\n    init(context: NSManagedObjectContext) {\n        self.context = context\n    }\n\n    // MARK: - Create\n\n    /// \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter record: \uc0dd\uc131\ud560 \uc6b4\ub3d9 \uae30\ub85d\n    /// - Throws: Core Data \uc800\uc7a5 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc0dd\uc131\ub41c \uc6b4\ub3d9 \uae30\ub85d\n    func create(_ record: Domain.ExerciseRecord) async throws -> Domain.ExerciseRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: async/await with Core Data\n        // context.perform\uc744 \uc0ac\uc6a9\ud558\uc5ec Core Data\uc758 \uc2a4\ub808\ub4dc \uc548\uc804\uc131 \ubcf4\uc7a5\n        // \ud83d\udca1 Java \ube44\uad50: @Transactional \uc5b4\ub178\ud14c\uc774\uc158\uacfc \uc720\uc0ac\ud55c \uc5ed\ud560\n\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSEntityDescription\uc73c\ub85c \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\n            // Core Data \uc5d4\ud2f0\ud2f0\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\n            guard let entity = NSEntityDescription.entity(\n                forEntityName: \"ExerciseRecord\",\n                in: self.context\n            ) else {\n                throw DataSourceError.entityNotFound(\"ExerciseRecord\")\n            }\n\n            let managedObject = NSManagedObject(entity: entity, insertInto: self.context)\n\n            // \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \u2192 Core Data \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n            self.mapToManagedObject(from: record, to: managedObject)\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \uc800\uc7a5\n            // context.save()\ub97c \ud638\ucd9c\ud558\uc5ec \ubcc0\uacbd\uc0ac\ud56d\uc744 \uc601\uad6c \uc800\uc7a5\uc18c\uc5d0 \ucee4\ubc0b\n            // \u26a0\ufe0f \uc8fc\uc758: save() \ud638\ucd9c \uc804\uc5d0\ub294 \uba54\ubaa8\ub9ac\uc5d0\ub9cc \uc874\uc7ac\n            try self.context.save()\n\n            // Core Data \uc5d4\ud2f0\ud2f0 \u2192 \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\ud558\uc5ec \ubc18\ud658\n            return self.mapToDomainEntity(from: managedObject)\n        }\n    }\n\n    // MARK: - Read\n\n    /// ID\ub85c \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - id: \uc6b4\ub3d9 \uae30\ub85d \uace0\uc720 \uc2dd\ubcc4\uc790\n    ///   - userId: \uc0ac\uc6a9\uc790 ID (\uad8c\ud55c \ud655\uc778\uc6a9)\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub41c \uc6b4\ub3d9 \uae30\ub85d, \uc5c6\uc73c\uba74 nil\n    func fetchById(_ id: UUID, userId: UUID) async throws -> Domain.ExerciseRecord? {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSFetchRequest \uc0dd\uc131\n            // Core Data\uc5d0\uc11c \ub370\uc774\ud130\ub97c \uc870\ud68c\ud558\uae30 \uc704\ud55c \ucffc\ub9ac \uac1d\uccb4\n            // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 CriteriaQuery\uc640 \uc720\uc0ac\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSPredicate\ub85c \ud544\ud130\ub9c1\n            // SQL\uc758 WHERE \uc808\uacfc \uc720\uc0ac\ud55c \uc5ed\ud560\n            // \u26a0\ufe0f \uc8fc\uc758: user\ub294 relationship\uc774\ubbc0\ub85c user.id\ub85c \uc811\uadfc\n            request.predicate = NSPredicate(\n                format: \"id == %@ AND user.id == %@\",\n                id as CVarArg,\n                userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            let results = try self.context.fetch(request)\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Chaining\n            // results.first\ub294 Optional\uc774\ubbc0\ub85c map\uc73c\ub85c \ubcc0\ud658\n            return results.first.map { self.mapToDomainEntity(from: $0) }\n        }\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchByDate(_ date: Date, userId: UUID) async throws -> [Domain.ExerciseRecord] {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Calendar\ub97c \uc0ac\uc6a9\ud55c \ub0a0\uc9dc \ubc94\uc704 \uc0dd\uc131\n            // \ud574\ub2f9 \ub0a0\uc9dc\uc758 00:00:00 ~ 23:59:59 \ubc94\uc704 \uacc4\uc0b0\n            let calendar = Calendar.current\n            guard let startOfDay = calendar.startOfDay(for: date) as Date?,\n                  let endOfDay = calendar.date(byAdding: .day, value: 1, to: startOfDay) else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n\n            // \ub0a0\uc9dc \ubc94\uc704\uc640 \uc0ac\uc6a9\uc790 ID\ub85c \ud544\ud130\ub9c1\n            request.predicate = NSPredicate(\n                format: \"date >= %@ AND date < %@ AND user.id == %@\",\n                startOfDay as CVarArg,\n                endOfDay as CVarArg,\n                userId as CVarArg\n            )\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSSortDescriptor\ub85c \uc815\ub82c\n            // SQL\uc758 ORDER BY\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n            // ascending: false\ub85c \ucd5c\uc2e0\uc21c \uc815\ub82c\n            request.sortDescriptors = [\n                NSSortDescriptor(key: \"createdAt\", ascending: false)\n            ]\n\n            let results = try self.context.fetch(request)\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: map\uc744 \uc0ac\uc6a9\ud55c \uceec\ub809\uc158 \ubcc0\ud658\n            // \uac01 NSManagedObject\ub97c Domain Entity\ub85c \ubcc0\ud658\n            // \ud83d\udca1 Java \ube44\uad50: Stream API\uc758 map()\uacfc \ub3d9\uc77c\n            return results.map { self.mapToDomainEntity(from: $0) }\n        }\n    }\n\n    /// \ub0a0\uc9dc \ubc94\uc704 \ub0b4 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - startDate: \uc2dc\uc791 \ub0a0\uc9dc (\ud3ec\ud568)\n    ///   - endDate: \uc885\ub8cc \ub0a0\uc9dc (\ud3ec\ud568)\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchByDateRange(\n        startDate: Date,\n        endDate: Date,\n        userId: UUID\n    ) async throws -> [Domain.ExerciseRecord] {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let calendar = Calendar.current\n            guard let rangeStart = calendar.startOfDay(for: startDate) as Date?,\n                  let rangeEnd = calendar.date(byAdding: .day, value: 1, to: calendar.startOfDay(for: endDate)) else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n            request.predicate = NSPredicate(\n                format: \"date >= %@ AND date < %@ AND user.id == %@\",\n                rangeStart as CVarArg,\n                rangeEnd as CVarArg,\n                userId as CVarArg\n            )\n            request.sortDescriptors = [\n                NSSortDescriptor(key: \"date\", ascending: false),\n                NSSortDescriptor(key: \"createdAt\", ascending: false)\n            ]\n\n            let results = try self.context.fetch(request)\n            return results.map { self.mapToDomainEntity(from: $0) }\n        }\n    }\n\n    /// \uc0ac\uc6a9\uc790\uc758 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchAll(userId: UUID) async throws -> [Domain.ExerciseRecord] {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n            request.predicate = NSPredicate(format: \"user.id == %@\", userId as CVarArg)\n            request.sortDescriptors = [\n                NSSortDescriptor(key: \"date\", ascending: false),\n                NSSortDescriptor(key: \"createdAt\", ascending: false)\n            ]\n\n            let results = try self.context.fetch(request)\n            return results.map { self.mapToDomainEntity(from: $0) }\n        }\n    }\n\n    // MARK: - Update\n\n    /// \uae30\uc874 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc218\uc815\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter record: \uc218\uc815\ud560 \uc6b4\ub3d9 \uae30\ub85d (ID \ud544\uc218)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \ub610\ub294 \uad8c\ud55c \uc5c6\uc74c \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc218\uc815\ub41c \uc6b4\ub3d9 \uae30\ub85d\n    func update(_ record: Domain.ExerciseRecord) async throws -> Domain.ExerciseRecord {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            // \uae30\uc874 \ub808\ucf54\ub4dc \uc870\ud68c\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n            request.predicate = NSPredicate(\n                format: \"id == %@ AND user.id == %@\",\n                record.id as CVarArg,\n                record.userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \u2192 Core Data \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n            self.mapToManagedObject(from: record, to: managedObject)\n\n            try self.context.save()\n\n            return self.mapToDomainEntity(from: managedObject)\n        }\n    }\n\n    // MARK: - Delete\n\n    /// \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - id: \uc0ad\uc81c\ud560 \uc6b4\ub3d9 \uae30\ub85d ID\n    ///   - userId: \uc0ac\uc6a9\uc790 ID (\uad8c\ud55c \ud655\uc778\uc6a9)\n    /// - Throws: \uc0ad\uc81c \uc2e4\ud328 \ub610\ub294 \uad8c\ud55c \uc5c6\uc74c \uc2dc \uc5d0\ub7ec\n    func delete(id: UUID, userId: UUID) async throws {\n        try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n            request.predicate = NSPredicate(\n                format: \"id == %@ AND user.id == %@\",\n                id as CVarArg,\n                userId as CVarArg\n            )\n            request.fetchLimit = 1\n\n            guard let managedObject = try self.context.fetch(request).first else {\n                throw DataSourceError.recordNotFound\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \uc0ad\uc81c\n            // context.delete()\ub85c \uac1d\uccb4\ub97c \uc0ad\uc81c \ud45c\uc2dc\ud558\uace0 save()\ub85c \ucee4\ubc0b\n            self.context.delete(managedObject)\n            try self.context.save()\n        }\n    }\n\n    // MARK: - Utility\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \uc6b4\ub3d9 \uae30\ub85d \uac1c\uc218\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \uac1c\uc218\n    func count(forDate date: Date, userId: UUID) async throws -> Int {\n        return try await context.perform { [weak self] in\n            guard let self = self else {\n                throw DataSourceError.contextDeallocated\n            }\n\n            let calendar = Calendar.current\n            guard let startOfDay = calendar.startOfDay(for: date) as Date?,\n                  let endOfDay = calendar.date(byAdding: .day, value: 1, to: startOfDay) else {\n                throw DataSourceError.invalidDate\n            }\n\n            let request = NSFetchRequest<NSManagedObject>(entityName: \"ExerciseRecord\")\n            request.predicate = NSPredicate(\n                format: \"date >= %@ AND date < %@ AND user.id == %@\",\n                startOfDay as CVarArg,\n                endOfDay as CVarArg,\n                userId as CVarArg\n            )\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: count() \uba54\uc11c\ub4dc\n            // \uc2e4\uc81c \ub370\uc774\ud130\ub97c \uac00\uc838\uc624\uc9c0 \uc54a\uace0 \uac1c\uc218\ub9cc \ubc18\ud658 (\uc131\ub2a5 \ucd5c\uc801\ud654)\n            // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 COUNT \ucffc\ub9ac\uc640 \ub3d9\uc77c\n            return try self.context.count(for: request)\n        }\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ucd1d \uc6b4\ub3d9 \uc2dc\uac04(\ubd84)\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \ucd1d \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    func totalDuration(forDate date: Date, userId: UUID) async throws -> Int32 {\n        let records = try await fetchByDate(date, userId: userId)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: reduce\ub97c \uc0ac\uc6a9\ud55c \uc9d1\uacc4\n        // \ubc30\uc5f4\uc758 \ubaa8\ub4e0 \uc694\uc18c\ub97c \ud558\ub098\uc758 \uac12\uc73c\ub85c \ucd95\uc57d\n        // \ud83d\udca1 Java \ube44\uad50: Stream API\uc758 reduce()\uc640 \ub3d9\uc77c\n        return records.reduce(0) { $0 + $1.duration }\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ucd1d \uc18c\ubaa8 \uce7c\ub85c\ub9ac\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: Core Data \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \ucd1d \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    func totalCaloriesBurned(forDate date: Date, userId: UUID) async throws -> Int32 {\n        let records = try await fetchByDate(date, userId: userId)\n        return records.reduce(0) { $0 + $1.caloriesBurned }\n    }\n}\n\n// MARK: - Private Helpers (Mapping)\n\nextension ExerciseRecordLocalDataSource {\n\n    /// \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \u2192 Core Data \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n    ///\n    /// - Parameters:\n    ///   - domain: \ub3c4\uba54\uc778 ExerciseRecord\n    ///   - managedObject: Core Data NSManagedObject\n    private func mapToManagedObject(from domain: Domain.ExerciseRecord, to managedObject: NSManagedObject) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: setValue\ub97c \uc0ac\uc6a9\ud55c \ub3d9\uc801 \uc18d\uc131 \uc124\uc815\n        // Core Data\ub294 \ub7f0\ud0c0\uc784\uc5d0 \uc18d\uc131\uc744 \uc124\uc815\ud558\ubbc0\ub85c setValue \uc0ac\uc6a9\n        // \u26a0\ufe0f \uc8fc\uc758: \uc18d\uc131 \uc774\ub984\uc774 \uc815\ud655\ud574\uc57c \ud568 (\uc624\ud0c0 \uc2dc \ub7f0\ud0c0\uc784 \uc5d0\ub7ec)\n\n        managedObject.setValue(domain.id, forKey: \"id\")\n        managedObject.setValue(domain.date, forKey: \"date\")\n        managedObject.setValue(domain.exerciseType.rawValue, forKey: \"exerciseType\")\n        managedObject.setValue(domain.duration, forKey: \"duration\")\n        managedObject.setValue(domain.intensity.rawValue, forKey: \"intensity\")\n        managedObject.setValue(domain.caloriesBurned, forKey: \"caloriesBurned\")\n        managedObject.setValue(domain.createdAt, forKey: \"createdAt\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Relationship \uc124\uc815\n        // User\uc640\uc758 \uad00\uacc4 \uc124\uc815 (user.id\ub85c User \uc5d4\ud2f0\ud2f0 \uc870\ud68c \ud6c4 \uc5f0\uacb0)\n        let userRequest = NSFetchRequest<NSManagedObject>(entityName: \"User\")\n        userRequest.predicate = NSPredicate(format: \"id == %@\", domain.userId as CVarArg)\n        userRequest.fetchLimit = 1\n\n        if let user = try? context.fetch(userRequest).first {\n            managedObject.setValue(user, forKey: \"user\")\n        }\n    }\n\n    /// Core Data \uc5d4\ud2f0\ud2f0 \u2192 \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0 \ub9e4\ud551\n    ///\n    /// - Parameter managedObject: Core Data NSManagedObject\n    /// - Returns: \ub3c4\uba54\uc778 ExerciseRecord\n    private func mapToDomainEntity(from managedObject: NSManagedObject) -> Domain.ExerciseRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: value(forKey:)\ub85c \uc18d\uc131 \uc77d\uae30\n        // Core Data\uc5d0\uc11c \uac12\uc744 \uc77d\uc744 \ub54c \ud0c0\uc785 \uce90\uc2a4\ud305 \ud544\uc694\n        // \u26a0\ufe0f \uc8fc\uc758: \uac15\uc81c \uc5b8\ub798\ud551(!) \uc0ac\uc6a9 \uc2dc nil\uc774\uba74 \ud06c\ub798\uc2dc\n\n        let id = managedObject.value(forKey: \"id\") as! UUID\n        let date = managedObject.value(forKey: \"date\") as! Date\n        let exerciseTypeRaw = managedObject.value(forKey: \"exerciseType\") as! Int16\n        let duration = managedObject.value(forKey: \"duration\") as! Int32\n        let intensityRaw = managedObject.value(forKey: \"intensity\") as! Int16\n        let caloriesBurned = managedObject.value(forKey: \"caloriesBurned\") as! Int32\n        let createdAt = managedObject.value(forKey: \"createdAt\") as! Date\n\n        // Relationship\uc5d0\uc11c userId \ucd94\ucd9c\n        let user = managedObject.value(forKey: \"user\") as! NSManagedObject\n        let userId = user.value(forKey: \"id\") as! UUID\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: rawValue\ub97c \uc0ac\uc6a9\ud55c Enum \ubcc0\ud658\n        // Int16\uc744 Enum\uc73c\ub85c \ubcc0\ud658 (\uc2e4\ud328 \uc2dc \uae30\ubcf8\uac12 \uc0ac\uc6a9)\n        let exerciseType = ExerciseType(rawValue: exerciseTypeRaw) ?? .other\n        let intensity = Intensity(rawValue: intensityRaw) ?? .medium\n\n        return Domain.ExerciseRecord(\n            id: id,\n            userId: userId,\n            date: date,\n            exerciseType: exerciseType,\n            duration: duration,\n            intensity: intensity,\n            caloriesBurned: caloriesBurned,\n            createdAt: createdAt\n        )\n    }\n}\n\n// MARK: - Domain Namespace\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Namespace\ub97c \uc0ac\uc6a9\ud55c \uc774\ub984 \ucda9\ub3cc \ubc29\uc9c0\n// Core Data\uc758 ExerciseRecord(NSManagedObject)\uc640 Domain\uc758 ExerciseRecord \uad6c\ubd84\n// \ud83d\udca1 Java \ube44\uad50: package\ub97c \uc0ac\uc6a9\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\nenum Domain {\n    typealias ExerciseRecord = Bodii.ExerciseRecord\n}\n\n// MARK: - DataSourceError\n\n/// LocalDataSource\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \uc5d0\ub7ec\nenum DataSourceError: LocalizedError {\n    case contextDeallocated\n    case entityNotFound(String)\n    case recordNotFound\n    case invalidDate\n\n    var errorDescription: String? {\n        switch self {\n        case .contextDeallocated:\n            return \"Core Data context\uac00 \ud574\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\"\n        case .entityNotFound(let entityName):\n            return \"\uc5d4\ud2f0\ud2f0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4: \\(entityName)\"\n        case .recordNotFound:\n            return \"\ub808\ucf54\ub4dc\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\"\n        case .invalidDate:\n            return \"\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub0a0\uc9dc\uc785\ub2c8\ub2e4.\"\n        }\n    }\n}\n",
        "last_modified": "2026-01-14T22:54:09.700191"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:05.986358",
  "last_updated": "2026-01-14T11:45:42.027912"
}