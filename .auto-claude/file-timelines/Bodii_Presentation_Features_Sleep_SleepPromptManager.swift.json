{
  "file_path": "Bodii/Presentation/Features/Sleep/SleepPromptManager.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepPromptManager.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sleep Prompt Manager\n// \uc544\uce68 \uc218\uba74 \uae30\ub85d \ud504\ub86c\ud504\ud2b8 \ub85c\uc9c1\uacfc \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uad00\ub9ac\n// \ud83d\udca1 Java \ube44\uad50: Android\uc758 Preference Manager\uc640 \uc720\uc0ac\n\nimport Foundation\nimport SwiftUI\nimport Combine\n\n// MARK: - SleepPromptManager\n\n/// \uc218\uba74 \uae30\ub85d \ud504\ub86c\ud504\ud2b8 \uad00\ub9ac \ud074\ub798\uc2a4\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manager Pattern\n/// - \uc544\uce68 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc5ec\ubd80 \uacb0\uc815\n/// - \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd94\uc801 (\ub0a0\uc9dc\ubcc4)\n/// - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uad00\ub9ac (3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4)\n/// - UserDefaults\ub97c \uc0ac\uc6a9\ud55c \uc601\uc18d\uc131\n/// \ud83d\udca1 Java \ube44\uad50: SharedPreferences + Manager \ud074\ub798\uc2a4\uc640 \uc720\uc0ac\n@MainActor\nclass SleepPromptManager: ObservableObject {\n\n    // MARK: - Constants\n\n    /// UserDefaults \ud0a4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Constants for Keys\n    /// - \ud558\ub4dc\ucf54\ub529\ub41c \ubb38\uc790\uc5f4 \ub300\uc2e0 \uc0c1\uc218 \uc0ac\uc6a9\n    /// - \uc624\ud0c0 \ubc29\uc9c0 \ubc0f \ub9ac\ud329\ud1a0\ub9c1 \uc6a9\uc774\n    private enum Keys {\n        static let skipCountPrefix = \"sleep_skip_count_\"\n        static let lastPromptDate = \"sleep_last_prompt_date\"\n    }\n\n    /// \ucd5c\ub300 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Business Rule Constant\n    /// - 3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\n    private static let maxSkipCount = 3\n\n    /// \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130 \ubcf4\uad00 \uae30\uac04 (\uc77c \ub2e8\uc704)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Retention Policy Constant\n    /// - 7\uc77c \uc774\uc0c1 \uc9c0\ub09c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130\ub294 \uc790\ub3d9 \uc0ad\uc81c\n    private static let cleanupDaysThreshold = 7\n\n    // MARK: - Published Properties\n\n    /// \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: @Published\n    /// - \uac12\uc774 \ubcc0\uacbd\ub418\uba74 \uc790\ub3d9\uc73c\ub85c View \uc5c5\ub370\uc774\ud2b8\n    /// - Sheet \ud45c\uc2dc/\uc228\uae40\uc5d0 \uc0ac\uc6a9\n    /// \ud83d\udca1 Java \ube44\uad50: LiveData\uc640 \uc720\uc0ac\n    @Published var shouldShowPrompt: Bool = false\n\n    /// \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Force Entry Mode\n    /// - 3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4 true\n    /// - SleepInputSheet\uc758 canSkip \ud30c\ub77c\ubbf8\ud130\ub85c \uc804\ub2ec\n    @Published var isForceEntry: Bool = false\n\n    // MARK: - Private Properties\n\n    /// \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// - Repository\ub97c \uc678\ubd80\uc5d0\uc11c \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9\n    /// - \uc624\ub298 \uc218\uba74 \uae30\ub85d\uc774 \uc788\ub294\uc9c0 \ud655\uc778\uc5d0 \uc0ac\uc6a9\n    private let sleepRepository: SleepRepositoryProtocol\n\n    /// UserDefaults \uc778\uc2a4\ud134\uc2a4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UserDefaults for Persistence\n    /// - \uac04\ub2e8\ud55c Key-Value \uc800\uc7a5\uc18c\n    /// - \uc571 \uc885\ub8cc \ud6c4\uc5d0\ub3c4 \ub370\uc774\ud130 \uc720\uc9c0\n    /// \ud83d\udca1 Java \ube44\uad50: SharedPreferences\uc640 \uc720\uc0ac\n    private let userDefaults: UserDefaults\n\n    /// \uc624\ub298 \ub0a0\uc9dc (\uce90\uc2dc)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Caching\n    /// - \ubc18\ubcf5\uc801\uc778 Date() \ud638\ucd9c \ubc29\uc9c0\n    /// - \ub17c\ub9ac\uc801 \ub0a0\uc9dc (02:00 \uacbd\uacc4 \uc801\uc6a9)\n    private var today: Date {\n        DateUtils.getLogicalDate(for: Date())\n    }\n\n    // MARK: - Initialization\n\n    /// SleepPromptManager \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection via Constructor\n    /// - \ubaa8\ub4e0 \uc758\uc874\uc131\uc744 \uc0dd\uc131\uc790\ub97c \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc74c\n    /// - \ud14c\uc2a4\ud2b8 \uc2dc Mock Repository\uc640 UserDefaults \uc8fc\uc785 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject constructor\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - sleepRepository: \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    ///   - userDefaults: UserDefaults \uc778\uc2a4\ud134\uc2a4 (\uae30\ubcf8\uac12: .standard)\n    init(\n        sleepRepository: SleepRepositoryProtocol,\n        userDefaults: UserDefaults = .standard\n    ) {\n        self.sleepRepository = sleepRepository\n        self.userDefaults = userDefaults\n    }\n\n    // MARK: - Public Methods\n\n    /// \ud504\ub86c\ud504\ud2b8\ub97c \ud45c\uc2dc\ud574\uc57c \ud558\ub294\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Main Check Logic\n    /// - \uc2dc\uac04 \uc870\uac74 \ud655\uc778 (02:00 \uc774\ud6c4)\n    /// - \uc624\ub298 \uae30\ub85d \uc874\uc7ac \uc5ec\ubd80 \ud655\uc778\n    /// - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc5ec\ubd80 \ud655\uc778\n    /// - \uacb0\uacfc\ub97c @Published \ud504\ub85c\ud37c\ud2f0\uc5d0 \ubc18\uc601\n    ///\n    /// \ud638\ucd9c \uc2dc\uc810:\n    /// - \uc571 \uc2dc\uc791 \uc2dc (BodiiApp.onAppear)\n    /// - \uc571\uc774 \ud3ec\uadf8\ub77c\uc6b4\ub4dc\ub85c \ub3cc\uc544\uc62c \ub54c (onReceive ScenePhase)\n    func checkShouldShow() async {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Time-based Check\n        // 02:00 \uc774\uc804\uc5d0\ub294 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc548 \ud568\n        guard DateUtils.shouldShowSleepPopup() else {\n            shouldShowPrompt = false\n            return\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data-based Check\n        // \uc624\ub298 \uc218\uba74 \uae30\ub85d\uc774 \uc774\ubbf8 \uc788\uc73c\uba74 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc548 \ud568\n        do {\n            let todayRecord = try await sleepRepository.fetch(for: today)\n            if todayRecord != nil {\n                shouldShowPrompt = false\n                // \uae30\ub85d\uc774 \uc788\uc73c\uba74 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n                resetSkipCount()\n                return\n            }\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Handling\n            // \uc870\ud68c \uc2e4\ud328 \uc2dc\uc5d0\ub3c4 \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc (\ubcf4\uc218\uc801 \uc811\uadfc)\n            print(\"\u26a0\ufe0f Failed to fetch today's sleep record: \\(error.localizedDescription)\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Skip Count Check\n        // \uac74\ub108\ub6f0\uae30 \ud69f\uc218\uc5d0 \ub530\ub77c \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uacb0\uc815\n        let skipCount = getSkipCount(for: today)\n        isForceEntry = skipCount >= Self.maxSkipCount\n\n        // \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc\n        shouldShowPrompt = true\n    }\n\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc99d\uac00\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Skip Count Management\n    /// - \uc0ac\uc6a9\uc790\uac00 \uac74\ub108\ub6f0\uae30 \ubc84\ud2bc\uc744 \ud074\ub9ad\ud588\uc744 \ub54c \ud638\ucd9c\n    /// - \ub0a0\uc9dc\ubcc4\ub85c \ud69f\uc218 \uc800\uc7a5\n    /// - 3\ud68c\uc5d0 \ub3c4\ub2ec\ud558\uba74 \ub2e4\uc74c\ubc88\uc5d0 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\n    ///\n    /// \ud638\ucd9c \uc2dc\uc810:\n    /// - SleepInputSheet\uc758 onSkip \ucf5c\ubc31\uc5d0\uc11c \ud638\ucd9c\n    func incrementSkipCount() {\n        let currentCount = getSkipCount(for: today)\n        let newCount = currentCount + 1\n        setSkipCount(newCount, for: today)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Update\n        // \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc5ec\ubd80 \uc5c5\ub370\uc774\ud2b8\n        isForceEntry = newCount >= Self.maxSkipCount\n\n        print(\"\u2139\ufe0f Sleep prompt skipped. Count: \\(newCount)/\\(Self.maxSkipCount)\")\n    }\n\n    /// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reset Logic\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc218\uba74 \uae30\ub85d\uc744 \uc785\ub825\ud588\uc744 \ub54c \ud638\ucd9c\n    /// - \ub2e4\uc74c \ub0a0\ubd80\ud130 \ub2e4\uc2dc 3\ud68c \uac74\ub108\ub6f0\uae30 \uac00\ub2a5\n    ///\n    /// \ud638\ucd9c \uc2dc\uc810:\n    /// - \uc218\uba74 \uae30\ub85d \uc800\uc7a5 \uc131\uacf5 \uc2dc (SleepInputViewModel.saveSleep \uc644\ub8cc \ud6c4)\n    /// - \uc790\ub3d9\uc73c\ub85c \ud638\ucd9c\ub428 (checkShouldShow\uc5d0\uc11c \uae30\ub85d \ud655\uc778 \uc2dc)\n    func resetSkipCount() {\n        setSkipCount(0, for: today)\n        isForceEntry = false\n\n        print(\"\u2139\ufe0f Sleep prompt skip count reset for \\(DateUtils.formatKorean(today))\")\n    }\n\n    /// \ud504\ub86c\ud504\ud2b8 \ub2eb\uae30\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manual Dismiss\n    /// - \ud504\ub86c\ud504\ud2b8\ub97c \ud504\ub85c\uadf8\ub798\ubc0d \ubc29\uc2dd\uc73c\ub85c \ub2eb\uc744 \ub54c \uc0ac\uc6a9\n    /// - \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \uc720\uc9c0\n    func dismissPrompt() {\n        shouldShowPrompt = false\n    }\n\n    /// \uc624\ub298\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Public Query Method\n    /// - \uc678\ubd80\uc5d0\uc11c \ud604\uc7ac \uac74\ub108\ub6f0\uae30 \uc0c1\ud0dc \ud655\uc778 \uac00\ub2a5\n    /// - UI\uc5d0 \"\uc55e\uc73c\ub85c N\ud68c \uac74\ub108\ub6f0\uae30 \uac00\ub2a5\" \ud45c\uc2dc\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\n    ///\n    /// - Returns: \uc624\ub298\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 (0-3)\n    func getCurrentSkipCount() -> Int {\n        return getSkipCount(for: today)\n    }\n\n    /// \ub0a8\uc740 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Method\n    /// - \uc0ac\uc6a9\uc790\uc5d0\uac8c \uce5c\ud654\uc801\uc778 \uc815\ubcf4 \uc81c\uacf5\n    ///\n    /// - Returns: \ub0a8\uc740 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 (0-3)\n    func getRemainingSkips() -> Int {\n        let current = getSkipCount(for: today)\n        return max(0, Self.maxSkipCount - current)\n    }\n\n    // MARK: - Private Methods\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc870\ud68c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date-based UserDefaults Key\n    /// - \ub0a0\uc9dc\ub97c \ud0a4\uc5d0 \ud3ec\ud568\ud558\uc5ec \ub0a0\uc9dc\ubcc4 \uad00\ub9ac\n    /// - ISO 8601 \ud615\uc2dd\uc73c\ub85c \ub0a0\uc9dc \ud3ec\ub9f7\ud305 (yyyy-MM-dd)\n    ///\n    /// - Parameter date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    /// - Returns: \uac74\ub108\ub6f0\uae30 \ud69f\uc218 (0-3)\n    private func getSkipCount(for date: Date) -> Int {\n        let key = skipCountKey(for: date)\n        let count = userDefaults.integer(forKey: key)\n        return count\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc124\uc815\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UserDefaults Write\n    /// - integer(forKey:)\ub294 \uae30\ubcf8\uac12 0 \ubc18\ud658\n    /// - \uba85\uc2dc\uc801\uc73c\ub85c 0\uc744 \uc800\uc7a5\ud558\uc5ec \uc758\ub3c4 \uba85\ud655\ud654\n    ///\n    /// - Parameters:\n    ///   - count: \uc124\uc815\ud560 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\n    ///   - date: \ub300\uc0c1 \ub0a0\uc9dc\n    private func setSkipCount(_ count: Int, for date: Date) {\n        let key = skipCountKey(for: date)\n        userDefaults.set(count, forKey: key)\n    }\n\n    /// \ub0a0\uc9dc\uc5d0 \ub300\ud55c UserDefaults \ud0a4 \uc0dd\uc131\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Key Generation\n    /// - \ub0a0\uc9dc\ub97c \ubb38\uc790\uc5f4\ub85c \ubcc0\ud658\ud558\uc5ec \uace0\uc720 \ud0a4 \uc0dd\uc131\n    /// - ISO8601 \ud615\uc2dd \uc0ac\uc6a9 (yyyy-MM-dd)\n    ///\n    /// - Parameter date: \ub300\uc0c1 \ub0a0\uc9dc\n    /// - Returns: UserDefaults \ud0a4 (\uc608: \"sleep_skip_count_2026-01-14\")\n    private func skipCountKey(for date: Date) -> String {\n        let dateFormatter = ISO8601DateFormatter()\n        dateFormatter.formatOptions = [.withFullDate]\n        let dateString = dateFormatter.string(from: date)\n        return Keys.skipCountPrefix + dateString\n    }\n\n    /// \uc624\ub798\ub41c \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc815\ub9ac\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Cleanup\n    /// - cleanupDaysThreshold\uc77c \uc774\uc0c1 \uc9c0\ub09c \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \uc0ad\uc81c\n    /// - \uba54\ubaa8\ub9ac \ubc0f \uc800\uc7a5 \uacf5\uac04 \uad00\ub9ac\n    /// - \ubc31\uadf8\ub77c\uc6b4\ub4dc\uc5d0\uc11c \uc2e4\ud589 \uac00\ub2a5\n    ///\n    /// \ud638\ucd9c \uc2dc\uc810:\n    /// - \uc571 \uc2dc\uc791 \uc2dc (\uc120\ud0dd\uc801)\n    /// - \uc8fc\uae30\uc801\uc73c\ub85c (\uc608: \ud558\ub8e8\uc5d0 \ud55c \ubc88)\n    func cleanupOldSkipCounts() {\n        let calendar = Calendar.current\n        let cutoffDate = calendar.date(byAdding: .day, value: -Self.cleanupDaysThreshold, to: today) ?? today\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UserDefaults Key Iteration\n        // \ubaa8\ub4e0 \ud0a4\ub97c \uc21c\ud68c\ud558\uba70 \uc624\ub798\ub41c \ud56d\ubaa9 \uc0ad\uc81c\n        let allKeys = userDefaults.dictionaryRepresentation().keys\n        for key in allKeys {\n            if key.hasPrefix(Keys.skipCountPrefix) {\n                // \ub0a0\uc9dc \ucd94\ucd9c\n                let dateString = key.replacingOccurrences(of: Keys.skipCountPrefix, with: \"\")\n                let dateFormatter = ISO8601DateFormatter()\n                dateFormatter.formatOptions = [.withFullDate]\n\n                if let date = dateFormatter.date(from: dateString),\n                   date < cutoffDate {\n                    userDefaults.removeObject(forKey: key)\n                    print(\"\ud83d\uddd1\ufe0f Cleaned up old skip count for \\(dateString)\")\n                }\n            }\n        }\n    }\n}\n\n// MARK: - Preview Support\n\n#if DEBUG\nextension SleepPromptManager {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview Helper\n    /// SwiftUI Preview\ub97c \uc704\ud55c Mock Manager\n    /// \ud83d\udca1 Java \ube44\uad50: Test fixture\uc640 \uc720\uc0ac\n    static func makePreview(\n        shouldShowPrompt: Bool = false,\n        isForceEntry: Bool = false\n    ) -> SleepPromptManager {\n        // Mock Repository \ud544\uc694 (\uc2e4\uc81c\ub85c\ub294 DIContainer\uc5d0\uc11c \uc8fc\uc785)\n        fatalError(\"Preview support not yet implemented. Use DIContainer for real instance.\")\n    }\n}\n#endif\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepPromptManager \uc774\ud574\n///\n/// SleepPromptManager\uc758 \uc5ed\ud560:\n/// - \uc544\uce68 \uc218\uba74 \uae30\ub85d \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc5ec\ubd80 \uacb0\uc815\n/// - \ub0a0\uc9dc\ubcc4 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd94\uc801 \ubc0f \uad00\ub9ac\n/// - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \ud310\ub2e8 (3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4)\n/// - UserDefaults\ub97c \uc0ac\uc6a9\ud55c \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uc601\uc18d\ud654\n///\n/// \ube44\uc988\ub2c8\uc2a4 \uaddc\uce59:\n/// 1. \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc870\uac74:\n///    - \ud604\uc7ac \uc2dc\uac04\uc774 02:00 \uc774\ud6c4 (DateUtils.shouldShowSleepPopup)\n///    - \uc624\ub298 \ub0a0\uc9dc\uc758 \uc218\uba74 \uae30\ub85d\uc774 \uc5c6\uc74c\n///    - \uc571\uc774 \uc2e4\ud589\ub418\uac70\ub098 \ud3ec\uadf8\ub77c\uc6b4\ub4dc\ub85c \ub3cc\uc544\uc62c \ub54c\n///\n/// 2. \uac74\ub108\ub6f0\uae30 \ub85c\uc9c1:\n///    - \ud558\ub8e8\uc5d0 \ucd5c\ub300 3\ud68c\uae4c\uc9c0 \uac74\ub108\ub6f0\uae30 \uac00\ub2a5\n///    - 3\ud68c \uac74\ub108\ub6f0\uae30 \ud6c4\uc5d0\ub294 \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\n///    - \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc\uc5d0\uc11c\ub294 \uac74\ub108\ub6f0\uae30 \ubc84\ud2bc \uc228\uae40\n///    - \uc218\uba74 \uae30\ub85d\uc744 \uc785\ub825\ud558\uba74 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ucd08\uae30\ud654\n///\n/// 3. \ub0a0\uc9dc \uacbd\uacc4:\n///    - 02:00 \uacbd\uacc4 \ub85c\uc9c1 \uc801\uc6a9\n///    - 00:00-01:59\ub294 \uc804\ub0a0\ub85c \ucc98\ub9ac\n///    - DateUtils.getLogicalDate \uc0ac\uc6a9\n///\n/// 4. \ub370\uc774\ud130 \uc815\ub9ac:\n///    - 7\uc77c \uc774\uc0c1 \uc9c0\ub09c \uac74\ub108\ub6f0\uae30 \ub370\uc774\ud130\ub294 \uc790\ub3d9 \uc0ad\uc81c\n///    - cleanupOldSkipCounts() \uc8fc\uae30\uc801 \ud638\ucd9c \uad8c\uc7a5\n///\n/// UserDefaults \ud0a4 \uad6c\uc870:\n/// - \"sleep_skip_count_2026-01-14\" \u2192 \uc624\ub298\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\n/// - \"sleep_skip_count_2026-01-13\" \u2192 \uc5b4\uc81c\uc758 \uac74\ub108\ub6f0\uae30 \ud69f\uc218\n/// - ISO 8601 \ub0a0\uc9dc \ud615\uc2dd \uc0ac\uc6a9 (yyyy-MM-dd)\n///\n/// \uc0c1\ud0dc \uad00\ub9ac:\n/// - shouldShowPrompt: \ud504\ub86c\ud504\ud2b8 \ud45c\uc2dc \uc5ec\ubd80 (@Published)\n/// - isForceEntry: \uac15\uc81c \uc785\ub825 \ubaa8\ub4dc \uc5ec\ubd80 (@Published)\n/// - View\uc5d0\uc11c \uc774 \ud504\ub85c\ud37c\ud2f0\ub4e4\uc744 \uad00\ucc30\ud558\uc5ec UI \uc5c5\ub370\uc774\ud2b8\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// // BodiiApp.swift\n/// struct BodiiApp: App {\n///     @StateObject private var sleepPromptManager: SleepPromptManager\n///\n///     init() {\n///         let container = DIContainer.shared\n///         _sleepPromptManager = StateObject(wrappedValue: SleepPromptManager(\n///             sleepRepository: container.sleepRepository\n///         ))\n///     }\n///\n///     var body: some Scene {\n///         WindowGroup {\n///             ContentView()\n///                 .sheet(isPresented: $sleepPromptManager.shouldShowPrompt) {\n///                     SleepInputSheet(\n///                         viewModel: DIContainer.shared.makeSleepInputViewModel(),\n///                         canSkip: !sleepPromptManager.isForceEntry,\n///                         onSkip: {\n///                             sleepPromptManager.incrementSkipCount()\n///                         }\n///                     )\n///                 }\n///                 .onAppear {\n///                     Task {\n///                         await sleepPromptManager.checkShouldShow()\n///                     }\n///                 }\n///                 .onReceive(NotificationCenter.default.publisher(for: UIApplication.willEnterForegroundNotification)) { _ in\n///                     Task {\n///                         await sleepPromptManager.checkShouldShow()\n///                     }\n///                 }\n///         }\n///     }\n/// }\n/// ```\n///\n/// \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \ud45c\uc2dc \uc608\uc2dc:\n/// ```swift\n/// struct SleepPromptInfoView: View {\n///     @ObservedObject var manager: SleepPromptManager\n///\n///     var body: some View {\n///         if manager.isForceEntry {\n///             Text(\"\uc624\ub298\uc740 \uaf2d \uc785\ub825\ud574\uc8fc\uc138\uc694\")\n///                 .foregroundColor(.red)\n///         } else {\n///             Text(\"\uc55e\uc73c\ub85c \\(manager.getRemainingSkips())\ud68c \uac74\ub108\ub6f0\uae30 \uac00\ub2a5\")\n///                 .foregroundColor(.secondary)\n///         }\n///     }\n/// }\n/// ```\n///\n/// \uc218\ub3d9 \ud504\ub86c\ud504\ud2b8 \ud2b8\ub9ac\uac70:\n/// ```swift\n/// Button(\"\uc218\uba74 \uae30\ub85d \uc785\ub825\") {\n///     Task {\n///         await sleepPromptManager.checkShouldShow()\n///         sleepPromptManager.shouldShowPrompt = true\n///     }\n/// }\n/// ```\n///\n/// \ud83d\udca1 Android \ube44\uad50:\n/// - Android: SharedPreferences + Manager \ud074\ub798\uc2a4\n/// - SwiftUI: UserDefaults + ObservableObject\n/// - Android: SharedPreferences.Editor.apply()\n/// - SwiftUI: UserDefaults.set()\n/// - Android: SharedPreferences.getInt(key, defaultValue)\n/// - SwiftUI: UserDefaults.integer(forKey:) // \uae30\ubcf8\uac12 0\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - UserDefaults\ub294 \uac04\ub2e8\ud55c \ub370\uc774\ud130\uc5d0\ub9cc \uc0ac\uc6a9\n/// - \ubcf5\uc7a1\ud55c \ub370\uc774\ud130\ub294 Core Data \ub610\ub294 \ud30c\uc77c \uc2dc\uc2a4\ud15c \uc0ac\uc6a9\n/// - \ub0a0\uc9dc \uae30\ubc18 \ud0a4\ub294 ISO 8601 \ud615\uc2dd \uc0ac\uc6a9 \uad8c\uc7a5\n/// - \uc8fc\uae30\uc801\uc73c\ub85c \uc624\ub798\ub41c \ub370\uc774\ud130 \uc815\ub9ac\n/// - @Published\ub85c View\uc640 \uc790\ub3d9 \ub3d9\uae30\ud654\n/// - Repository \uc8fc\uc785\uc73c\ub85c \ud14c\uc2a4\ud2b8 \uac00\ub2a5\uc131 \ud655\ubcf4\n///\n/// \ubcf4\uc548 \uace0\ub824\uc0ac\ud56d:\n/// - UserDefaults\ub294 \uc554\ud638\ud654\ub418\uc9c0 \uc54a\uc74c\n/// - \ubbfc\uac10\ud55c \uc815\ubcf4\ub294 Keychain \uc0ac\uc6a9\n/// - \uac74\ub108\ub6f0\uae30 \ud69f\uc218\ub294 \ubbfc\uac10\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c UserDefaults \uc801\ud569\n///\n/// \ud14c\uc2a4\ud2b8 \uac00\ub2a5\uc131:\n/// - sleepRepository\ub97c Mock\uc73c\ub85c \uc8fc\uc785 \uac00\ub2a5\n/// - userDefaults\ub97c \ubcc4\ub3c4 \uc778\uc2a4\ud134\uc2a4\ub85c \uc8fc\uc785 \uac00\ub2a5\n/// - \ub0a0\uc9dc\ubcc4 \uac74\ub108\ub6f0\uae30 \ud69f\uc218 \uac80\uc99d \uac00\ub2a5\n///\n/// \ud5a5\ud6c4 \uac1c\uc120 \uc0ac\ud56d:\n/// - \uc0ac\uc6a9\uc790 \uc124\uc815\uc73c\ub85c \ud504\ub86c\ud504\ud2b8 \uc2dc\uac04 \uc870\uc815 \uac00\ub2a5 (\ud604\uc7ac 02:00 \uace0\uc815)\n/// - \uc8fc\ub9d0\uc5d0\ub294 \ud504\ub86c\ud504\ud2b8 \ube44\ud65c\uc131\ud654 \uc635\uc158\n/// - \ud504\ub86c\ud504\ud2b8 \uc54c\ub9bc (Local Notification)\n/// - \uc5f0\uc18d \uae30\ub85d \uc77c\uc218 \ucd94\uc801 \ubc0f \ubc30\uc9c0 \uc2dc\uc2a4\ud15c\n///\n",
        "last_modified": "2026-01-14T22:52:08.913676"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:04.946781",
  "last_updated": "2026-01-14T21:03:40.508888"
}