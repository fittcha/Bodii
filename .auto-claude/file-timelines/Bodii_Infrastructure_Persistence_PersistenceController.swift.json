{
  "file_path": "Bodii/Infrastructure/Persistence/PersistenceController.swift",
  "main_branch_history": [],
  "task_views": {
    "001-": {
      "task_id": "001-",
      "branch_point": {
        "commit_hash": "bffa4407a91d66f875164727541505e70fc173ed",
        "content": "",
        "timestamp": "2026-01-11T19:11:51.451495"
      },
      "worktree_state": {
        "content": "//\n//  PersistenceController.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-11.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data Stack \uad00\ub9ac\n// Core Data\uc758 \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8\uc778 NSPersistentContainer\ub97c \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager/EntityManagerFactory\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport CoreData\n\n// MARK: - PersistenceController\n\n/// Core Data \uc2a4\ud0dd\uc744 \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n/// - \uc571 \uc804\uccb4\uc5d0\uc11c \uacf5\uc720\ub418\ub294 \uc2f1\uae00\ud134 \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - SwiftUI Preview\uc6a9 \uc778\uba54\ubaa8\ub9ac \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - \uc790\ub3d9 \uacbd\ub7c9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc9c0\uc6d0\nfinal class PersistenceController {\n\n    // MARK: - Shared Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Singleton Pattern in Swift\n    // static let\uc73c\ub85c \uc120\uc5b8\ud558\uba74 lazy\ud558\uac8c \ucd08\uae30\ud654\ub418\uace0 thread-safe\n    // \ud83d\udca1 Java \ube44\uad50: synchronized singleton\uacfc \ub2ec\ub9ac \uc5b8\uc5b4 \ub808\ubca8\uc5d0\uc11c thread-safe \ubcf4\uc7a5\n    static let shared = PersistenceController()\n\n    // MARK: - Preview Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SwiftUI Preview\uc6a9 \uc778\uc2a4\ud134\uc2a4\n    // \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uace0 \uba54\ubaa8\ub9ac\uc5d0\uc11c\ub9cc \ub3d9\uc791\n    // Preview\uc5d0\uc11c \uc2e4\uc81c \ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uba74 \ud14c\uc2a4\ud2b8\uac00 \ub290\ub824\uc9c0\uace0 side effect \ubc1c\uc0dd\n    @MainActor\n    static let preview: PersistenceController = {\n        let controller = PersistenceController(inMemory: true)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview\uc6a9 \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131\n        // \uc2e4\uc81c \uc571\uc5d0\uc11c\ub294 \uc774 \ube14\ub85d\uc5d0\uc11c \uc0d8\ud50c \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc74c\n        // \ud604\uc7ac\ub294 \ube48 \uc0c1\ud0dc\ub85c \uc720\uc9c0 (\uc5d4\ud2f0\ud2f0 \uad6c\ud604 \ud6c4 \ucd94\uac00 \uc608\uc815)\n        let viewContext = controller.container.viewContext\n\n        // TODO: \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131 \ucf54\ub4dc \ucd94\uac00\n        // \uc608: User, DailyLog \ub4f1\uc758 \uc0d8\ud50c \ub370\uc774\ud130\n\n        do {\n            try viewContext.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: fatalError \uc0ac\uc6a9\n            // Preview/\uac1c\ubc1c \ud658\uacbd\uc5d0\uc11c\ub9cc \uc0ac\uc6a9 - \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc801\uc808\ud55c \uc5d0\ub7ec \ucc98\ub9ac \ud544\uc694\n            let nsError = error as NSError\n            fatalError(\"Failed to save preview context: \\(nsError), \\(nsError.userInfo)\")\n        }\n\n        return controller\n    }()\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSPersistentContainer\n    // Core Data \uc2a4\ud0dd\uc758 \ud575\uc2ec - \ubaa8\ub378, \ucee8\ud14d\uc2a4\ud2b8, \uc800\uc7a5\uc18c\ub97c \ubaa8\ub450 \uad00\ub9ac\n    // iOS 10+\uc5d0\uc11c \ub3c4\uc785\ub418\uc5b4 Core Data \uc124\uc815\uc744 \ud06c\uac8c \uac04\uc18c\ud654\n    let container: NSPersistentContainer\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectContext\n    // viewContext\ub294 main queue\uc5d0\uc11c \ub3d9\uc791\ud558\uba70 UI \uc5c5\ub370\uc774\ud2b8\uc5d0 \uc0ac\uc6a9\n    // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager\uc640 \uc720\uc0ac - \uc5d4\ud2f0\ud2f0\uc758 \uc0dd\uba85\uc8fc\uae30 \uad00\ub9ac\n    var viewContext: NSManagedObjectContext {\n        container.viewContext\n    }\n\n    // MARK: - Initialization\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Init with Default Parameters\n    // inMemory: true\ub85c \ud558\uba74 SQLite \ud30c\uc77c \ub300\uc2e0 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\n    // \ud14c\uc2a4\ud2b8\ub098 Preview\uc5d0\uc11c \uc720\uc6a9\n    init(inMemory: Bool = false) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Bundle\uc5d0\uc11c Core Data \ubaa8\ub378 \ub85c\ub4dc\n        // NSPersistentContainer\ub294 \uc790\ub3d9\uc73c\ub85c .xcdatamodeld \ud30c\uc77c\uc744 \ucc3e\uc74c\n        // \ud30c\uc77c\uba85\uc774 \"Bodii\"\uc774\uba74 Bodii.xcdatamodeld\ub97c \ucc3e\uc74c\n        container = NSPersistentContainer(name: \"Bodii\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Lightweight Migration \uc124\uc815\n        // \uc2a4\ud0a4\ub9c8 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc218\ud589\n        // \u26a0\ufe0f \uc8fc\uc758: \ubcf5\uc7a1\ud55c \ubcc0\uacbd\uc740 \uc218\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud544\uc694\n        let description = container.persistentStoreDescriptions.first\n        description?.setOption(true as NSNumber, forKey: NSMigratePersistentStoresAutomaticallyOption)\n        description?.setOption(true as NSNumber, forKey: NSInferMappingModelAutomaticallyOption)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc778\uba54\ubaa8\ub9ac \uc800\uc7a5\uc18c \uc124\uc815\n        // \ud14c\uc2a4\ud2b8/Preview\uc6a9 - \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc18c\uba78\n        if inMemory {\n            description?.url = URL(fileURLWithPath: \"/dev/null\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ube44\ub3d9\uae30 \uc800\uc7a5\uc18c \ub85c\ub4dc\n        // loadPersistentStores\ub294 \ube44\ub3d9\uae30\ub85c \ub3d9\uc791\ud558\uc9c0\ub9cc completion handler\uc5d0\uc11c \uc5d0\ub7ec \ucc98\ub9ac\n        container.loadPersistentStores { [weak self] storeDescription, error in\n            if let error = error as NSError? {\n                // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ub85c\ub4dc \uc2e4\ud328 \ucc98\ub9ac\n                // \u26a0\ufe0f \uc8fc\uc758: \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 fatalError \ub300\uc2e0 \uc801\uc808\ud55c \ubcf5\uad6c \ub85c\uc9c1 \ud544\uc694\n                // \uc608: \uc190\uc0c1\ub41c \uc800\uc7a5\uc18c \uc0ad\uc81c \ud6c4 \uc7ac\uc0dd\uc131, \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9bc \ub4f1\n                fatalError(\"Failed to load Core Data store: \\(error), \\(error.userInfo)\")\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Merge Policy \uc124\uc815\n            // \uc5ec\ub7ec \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \ub3d9\uc2dc\uc5d0 \ubcc0\uacbd \uc2dc \ucda9\ub3cc \ud574\uacb0 \uc815\ucc45\n            // mergeByPropertyObjectTrump: \uba54\ubaa8\ub9ac\uc758 \uac12\uc774 \uc800\uc7a5\uc18c \uac12\uc744 \ub36e\uc5b4\uc500\n            self?.container.viewContext.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc790\ub3d9 \ubcd1\ud569 \uc124\uc815\n            // \ubc31\uadf8\ub77c\uc6b4\ub4dc \ucee8\ud14d\uc2a4\ud2b8\uc758 \ubcc0\uacbd\uc0ac\ud56d\uc744 viewContext\uc5d0 \uc790\ub3d9 \ubc18\uc601\n            self?.container.viewContext.automaticallyMergesChangesFromParent = true\n\n            #if DEBUG\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n            // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n            self?.verifyModelLoaded()\n            #endif\n        }\n    }\n\n    // MARK: - Public Methods\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Context \uc800\uc7a5\n    // Core Data\ub294 \ubcc0\uacbd\uc0ac\ud56d\uc744 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\ub2e4\uac00 save() \ud638\ucd9c \uc2dc \ub514\uc2a4\ud06c\uc5d0 \uae30\ub85d\n    // \u26a0\ufe0f \uc8fc\uc758: save() \ud638\ucd9c\uc744 \uc78a\uc73c\uba74 \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc190\uc2e4\n    func save() {\n        let context = container.viewContext\n        guard context.hasChanges else { return }\n\n        do {\n            try context.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc5d0\ub7ec \ucc98\ub9ac\n            // \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9ac\uac70\ub098 \ub85c\uae45 \ud544\uc694\n            let nsError = error as NSError\n            assertionFailure(\"Failed to save context: \\(nsError), \\(nsError.userInfo)\")\n        }\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context \uc0dd\uc131\n    // \ub300\uc6a9\ub7c9 \ub370\uc774\ud130 \ucc98\ub9ac \uc2dc \uba54\uc778 \uc2a4\ub808\ub4dc \ube14\ub85c\ud0b9 \ubc29\uc9c0\n    // \ud83d\udca1 Java \ube44\uad50: \ubcc4\ub3c4 \uc2a4\ub808\ub4dc\uc5d0\uc11c EntityManager \uc0ac\uc6a9\ud558\ub294 \uac83\uacfc \uc720\uc0ac\n    func newBackgroundContext() -> NSManagedObjectContext {\n        let context = container.newBackgroundContext()\n        context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n        return context\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context\uc5d0\uc11c \uc791\uc5c5 \uc218\ud589\n    // \ud074\ub85c\uc800 \ub0b4\uc5d0\uc11c \ubc31\uadf8\ub77c\uc6b4\ub4dc \uc791\uc5c5 \uc218\ud589 \ud6c4 \uc790\ub3d9\uc73c\ub85c \uc800\uc7a5\n    func performBackgroundTask(_ block: @escaping (NSManagedObjectContext) -> Void) {\n        container.performBackgroundTask { context in\n            context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n            block(context)\n        }\n    }\n}\n\n// MARK: - Debug Helpers\n\n#if DEBUG\nextension PersistenceController {\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ud14c\uc2a4\ud2b8\uc6a9 \ud5ec\ud37c\n    // \uc778\uba54\ubaa8\ub9ac \ucee8\ud2b8\ub864\ub7ec\ub97c \ube60\ub974\uac8c \uc0dd\uc131\ud558\uc5ec \ub2e8\uc704 \ud14c\uc2a4\ud2b8\uc5d0 \ud65c\uc6a9\n    static func makeForTesting() -> PersistenceController {\n        PersistenceController(inMemory: true)\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc800\uc7a5\uc18c \uc704\uce58 \ub514\ubc84\uae45\n    // Core Data \ud30c\uc77c\uc774 \uc5b4\ub514\uc5d0 \uc800\uc7a5\ub418\ub294\uc9c0 \ud655\uc778\uc6a9\n    func printStoreLocation() {\n        guard let url = container.persistentStoreDescriptions.first?.url else {\n            print(\"No store URL found\")\n            return\n        }\n        print(\"Core Data store location: \\(url)\")\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n    // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n    // \ud83d\udca1 \uc774 \uba54\uc11c\ub4dc\ub294 DEBUG \ube4c\ub4dc\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub428\n    func verifyModelLoaded() {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectModel\n        // Core Data \ubaa8\ub378\uc758 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \uc811\uadfc\ud558\uc5ec \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d \ud655\uc778\n        guard let model = container.managedObjectModel as NSManagedObjectModel? else {\n            print(\"\u26a0\ufe0f [Core Data] Failed to access managed object model\")\n            return\n        }\n\n        // \uc571\uc5d0\uc11c \ud544\uc694\ud55c 9\uac1c \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d\n        let expectedEntities: Set<String> = [\n            \"User\",\n            \"BodyRecord\",\n            \"MetabolismSnapshot\",\n            \"Food\",\n            \"FoodRecord\",\n            \"ExerciseRecord\",\n            \"SleepRecord\",\n            \"DailyLog\",\n            \"Goal\"\n        ]\n\n        // \ubaa8\ub378\uc5d0\uc11c \ub85c\ub4dc\ub41c \uc5d4\ud2f0\ud2f0 \uc774\ub984 \ucd94\ucd9c\n        let loadedEntities = Set(model.entities.compactMap { $0.name })\n\n        // \uac80\uc99d: \ubaa8\ub4e0 \ud544\uc218 \uc5d4\ud2f0\ud2f0\uac00 \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n        let missingEntities = expectedEntities.subtracting(loadedEntities)\n        let extraEntities = loadedEntities.subtracting(expectedEntities)\n\n        if missingEntities.isEmpty {\n            print(\"\u2705 [Core Data] Model loaded successfully with all 9 entities:\")\n            for entity in expectedEntities.sorted() {\n                print(\"   - \\(entity)\")\n            }\n        } else {\n            print(\"\u274c [Core Data] Missing entities: \\(missingEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        if !extraEntities.isEmpty {\n            print(\"\u2139\ufe0f [Core Data] Additional entities found: \\(extraEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        // \uac01 \uc5d4\ud2f0\ud2f0\uc758 \uc18d\uc131 \uc218 \ucd9c\ub825 (\ubaa8\ub378 \uad6c\uc870 \ud655\uc778\uc6a9)\n        print(\"\ud83d\udcca [Core Data] Entity details:\")\n        for entityName in expectedEntities.sorted() {\n            if let entity = model.entitiesByName[entityName] {\n                let attributeCount = entity.attributesByName.count\n                let relationshipCount = entity.relationshipsByName.count\n                print(\"   - \\(entityName): \\(attributeCount) attributes, \\(relationshipCount) relationships\")\n            }\n        }\n    }\n}\n#endif\n",
        "last_modified": "2026-01-11T19:36:37.969041"
      },
      "task_intent": {
        "title": "001-",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    },
    "003-body-composition-tracking-with-bmr-tdee": {
      "task_id": "003-body-composition-tracking-with-bmr-tdee",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "//\n//  PersistenceController.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-11.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data Stack \uad00\ub9ac\n// Core Data\uc758 \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8\uc778 NSPersistentContainer\ub97c \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager/EntityManagerFactory\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport CoreData\n\n// MARK: - PersistenceController\n\n/// Core Data \uc2a4\ud0dd\uc744 \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n/// - \uc571 \uc804\uccb4\uc5d0\uc11c \uacf5\uc720\ub418\ub294 \uc2f1\uae00\ud134 \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - SwiftUI Preview\uc6a9 \uc778\uba54\ubaa8\ub9ac \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - \uc790\ub3d9 \uacbd\ub7c9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc9c0\uc6d0\nfinal class PersistenceController {\n\n    // MARK: - Shared Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Singleton Pattern in Swift\n    // static let\uc73c\ub85c \uc120\uc5b8\ud558\uba74 lazy\ud558\uac8c \ucd08\uae30\ud654\ub418\uace0 thread-safe\n    // \ud83d\udca1 Java \ube44\uad50: synchronized singleton\uacfc \ub2ec\ub9ac \uc5b8\uc5b4 \ub808\ubca8\uc5d0\uc11c thread-safe \ubcf4\uc7a5\n    static let shared = PersistenceController()\n\n    // MARK: - Preview Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SwiftUI Preview\uc6a9 \uc778\uc2a4\ud134\uc2a4\n    // \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uace0 \uba54\ubaa8\ub9ac\uc5d0\uc11c\ub9cc \ub3d9\uc791\n    // Preview\uc5d0\uc11c \uc2e4\uc81c \ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uba74 \ud14c\uc2a4\ud2b8\uac00 \ub290\ub824\uc9c0\uace0 side effect \ubc1c\uc0dd\n    @MainActor\n    static let preview: PersistenceController = {\n        let controller = PersistenceController(inMemory: true)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview\uc6a9 \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131\n        // \uc2e4\uc81c \uc571\uc5d0\uc11c\ub294 \uc774 \ube14\ub85d\uc5d0\uc11c \uc0d8\ud50c \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc74c\n        // \ud604\uc7ac\ub294 \ube48 \uc0c1\ud0dc\ub85c \uc720\uc9c0 (\uc5d4\ud2f0\ud2f0 \uad6c\ud604 \ud6c4 \ucd94\uac00 \uc608\uc815)\n        let viewContext = controller.container.viewContext\n\n        // TODO: \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131 \ucf54\ub4dc \ucd94\uac00\n        // \uc608: User, DailyLog \ub4f1\uc758 \uc0d8\ud50c \ub370\uc774\ud130\n\n        do {\n            try viewContext.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: fatalError \uc0ac\uc6a9\n            // Preview/\uac1c\ubc1c \ud658\uacbd\uc5d0\uc11c\ub9cc \uc0ac\uc6a9 - \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc801\uc808\ud55c \uc5d0\ub7ec \ucc98\ub9ac \ud544\uc694\n            let nsError = error as NSError\n            fatalError(\"Failed to save preview context: \\(nsError), \\(nsError.userInfo)\")\n        }\n\n        return controller\n    }()\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSPersistentContainer\n    // Core Data \uc2a4\ud0dd\uc758 \ud575\uc2ec - \ubaa8\ub378, \ucee8\ud14d\uc2a4\ud2b8, \uc800\uc7a5\uc18c\ub97c \ubaa8\ub450 \uad00\ub9ac\n    // iOS 10+\uc5d0\uc11c \ub3c4\uc785\ub418\uc5b4 Core Data \uc124\uc815\uc744 \ud06c\uac8c \uac04\uc18c\ud654\n    let container: NSPersistentContainer\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectContext\n    // viewContext\ub294 main queue\uc5d0\uc11c \ub3d9\uc791\ud558\uba70 UI \uc5c5\ub370\uc774\ud2b8\uc5d0 \uc0ac\uc6a9\n    // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager\uc640 \uc720\uc0ac - \uc5d4\ud2f0\ud2f0\uc758 \uc0dd\uba85\uc8fc\uae30 \uad00\ub9ac\n    var viewContext: NSManagedObjectContext {\n        container.viewContext\n    }\n\n    // MARK: - Initialization\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Init with Default Parameters\n    // inMemory: true\ub85c \ud558\uba74 SQLite \ud30c\uc77c \ub300\uc2e0 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\n    // \ud14c\uc2a4\ud2b8\ub098 Preview\uc5d0\uc11c \uc720\uc6a9\n    init(inMemory: Bool = false) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Bundle\uc5d0\uc11c Core Data \ubaa8\ub378 \ub85c\ub4dc\n        // NSPersistentContainer\ub294 \uc790\ub3d9\uc73c\ub85c .xcdatamodeld \ud30c\uc77c\uc744 \ucc3e\uc74c\n        // \ud30c\uc77c\uba85\uc774 \"Bodii\"\uc774\uba74 Bodii.xcdatamodeld\ub97c \ucc3e\uc74c\n        container = NSPersistentContainer(name: \"Bodii\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Lightweight Migration \uc124\uc815\n        // \uc2a4\ud0a4\ub9c8 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc218\ud589\n        // \u26a0\ufe0f \uc8fc\uc758: \ubcf5\uc7a1\ud55c \ubcc0\uacbd\uc740 \uc218\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud544\uc694\n        let description = container.persistentStoreDescriptions.first\n        description?.setOption(true as NSNumber, forKey: NSMigratePersistentStoresAutomaticallyOption)\n        description?.setOption(true as NSNumber, forKey: NSInferMappingModelAutomaticallyOption)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc778\uba54\ubaa8\ub9ac \uc800\uc7a5\uc18c \uc124\uc815\n        // \ud14c\uc2a4\ud2b8/Preview\uc6a9 - \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc18c\uba78\n        if inMemory {\n            description?.url = URL(fileURLWithPath: \"/dev/null\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ube44\ub3d9\uae30 \uc800\uc7a5\uc18c \ub85c\ub4dc\n        // loadPersistentStores\ub294 \ube44\ub3d9\uae30\ub85c \ub3d9\uc791\ud558\uc9c0\ub9cc completion handler\uc5d0\uc11c \uc5d0\ub7ec \ucc98\ub9ac\n        container.loadPersistentStores { [weak self] storeDescription, error in\n            if let error = error as NSError? {\n                // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ub85c\ub4dc \uc2e4\ud328 \ucc98\ub9ac\n                // \u26a0\ufe0f \uc8fc\uc758: \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 fatalError \ub300\uc2e0 \uc801\uc808\ud55c \ubcf5\uad6c \ub85c\uc9c1 \ud544\uc694\n                // \uc608: \uc190\uc0c1\ub41c \uc800\uc7a5\uc18c \uc0ad\uc81c \ud6c4 \uc7ac\uc0dd\uc131, \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9bc \ub4f1\n                fatalError(\"Failed to load Core Data store: \\(error), \\(error.userInfo)\")\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Merge Policy \uc124\uc815\n            // \uc5ec\ub7ec \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \ub3d9\uc2dc\uc5d0 \ubcc0\uacbd \uc2dc \ucda9\ub3cc \ud574\uacb0 \uc815\ucc45\n            // mergeByPropertyObjectTrump: \uba54\ubaa8\ub9ac\uc758 \uac12\uc774 \uc800\uc7a5\uc18c \uac12\uc744 \ub36e\uc5b4\uc500\n            self?.container.viewContext.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc790\ub3d9 \ubcd1\ud569 \uc124\uc815\n            // \ubc31\uadf8\ub77c\uc6b4\ub4dc \ucee8\ud14d\uc2a4\ud2b8\uc758 \ubcc0\uacbd\uc0ac\ud56d\uc744 viewContext\uc5d0 \uc790\ub3d9 \ubc18\uc601\n            self?.container.viewContext.automaticallyMergesChangesFromParent = true\n\n            #if DEBUG\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n            // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n            self?.verifyModelLoaded()\n            #endif\n        }\n    }\n\n    // MARK: - Public Methods\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Context \uc800\uc7a5\n    // Core Data\ub294 \ubcc0\uacbd\uc0ac\ud56d\uc744 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\ub2e4\uac00 save() \ud638\ucd9c \uc2dc \ub514\uc2a4\ud06c\uc5d0 \uae30\ub85d\n    // \u26a0\ufe0f \uc8fc\uc758: save() \ud638\ucd9c\uc744 \uc78a\uc73c\uba74 \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc190\uc2e4\n    func save() {\n        let context = container.viewContext\n        guard context.hasChanges else { return }\n\n        do {\n            try context.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc5d0\ub7ec \ucc98\ub9ac\n            // \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9ac\uac70\ub098 \ub85c\uae45 \ud544\uc694\n            let nsError = error as NSError\n            assertionFailure(\"Failed to save context: \\(nsError), \\(nsError.userInfo)\")\n        }\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context \uc0dd\uc131\n    // \ub300\uc6a9\ub7c9 \ub370\uc774\ud130 \ucc98\ub9ac \uc2dc \uba54\uc778 \uc2a4\ub808\ub4dc \ube14\ub85c\ud0b9 \ubc29\uc9c0\n    // \ud83d\udca1 Java \ube44\uad50: \ubcc4\ub3c4 \uc2a4\ub808\ub4dc\uc5d0\uc11c EntityManager \uc0ac\uc6a9\ud558\ub294 \uac83\uacfc \uc720\uc0ac\n    func newBackgroundContext() -> NSManagedObjectContext {\n        let context = container.newBackgroundContext()\n        context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n        return context\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context\uc5d0\uc11c \uc791\uc5c5 \uc218\ud589\n    // \ud074\ub85c\uc800 \ub0b4\uc5d0\uc11c \ubc31\uadf8\ub77c\uc6b4\ub4dc \uc791\uc5c5 \uc218\ud589 \ud6c4 \uc790\ub3d9\uc73c\ub85c \uc800\uc7a5\n    func performBackgroundTask(_ block: @escaping (NSManagedObjectContext) -> Void) {\n        container.performBackgroundTask { context in\n            context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n            block(context)\n        }\n    }\n}\n\n// MARK: - Debug Helpers\n\n#if DEBUG\nextension PersistenceController {\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ud14c\uc2a4\ud2b8\uc6a9 \ud5ec\ud37c\n    // \uc778\uba54\ubaa8\ub9ac \ucee8\ud2b8\ub864\ub7ec\ub97c \ube60\ub974\uac8c \uc0dd\uc131\ud558\uc5ec \ub2e8\uc704 \ud14c\uc2a4\ud2b8\uc5d0 \ud65c\uc6a9\n    static func makeForTesting() -> PersistenceController {\n        PersistenceController(inMemory: true)\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc800\uc7a5\uc18c \uc704\uce58 \ub514\ubc84\uae45\n    // Core Data \ud30c\uc77c\uc774 \uc5b4\ub514\uc5d0 \uc800\uc7a5\ub418\ub294\uc9c0 \ud655\uc778\uc6a9\n    func printStoreLocation() {\n        guard let url = container.persistentStoreDescriptions.first?.url else {\n            print(\"No store URL found\")\n            return\n        }\n        print(\"Core Data store location: \\(url)\")\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n    // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n    // \ud83d\udca1 \uc774 \uba54\uc11c\ub4dc\ub294 DEBUG \ube4c\ub4dc\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub428\n    func verifyModelLoaded() {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectModel\n        // Core Data \ubaa8\ub378\uc758 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \uc811\uadfc\ud558\uc5ec \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d \ud655\uc778\n        guard let model = container.managedObjectModel as NSManagedObjectModel? else {\n            print(\"\u26a0\ufe0f [Core Data] Failed to access managed object model\")\n            return\n        }\n\n        // \uc571\uc5d0\uc11c \ud544\uc694\ud55c 9\uac1c \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d\n        let expectedEntities: Set<String> = [\n            \"User\",\n            \"BodyRecord\",\n            \"MetabolismSnapshot\",\n            \"Food\",\n            \"FoodRecord\",\n            \"ExerciseRecord\",\n            \"SleepRecord\",\n            \"DailyLog\",\n            \"Goal\"\n        ]\n\n        // \ubaa8\ub378\uc5d0\uc11c \ub85c\ub4dc\ub41c \uc5d4\ud2f0\ud2f0 \uc774\ub984 \ucd94\ucd9c\n        let loadedEntities = Set(model.entities.compactMap { $0.name })\n\n        // \uac80\uc99d: \ubaa8\ub4e0 \ud544\uc218 \uc5d4\ud2f0\ud2f0\uac00 \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n        let missingEntities = expectedEntities.subtracting(loadedEntities)\n        let extraEntities = loadedEntities.subtracting(expectedEntities)\n\n        if missingEntities.isEmpty {\n            print(\"\u2705 [Core Data] Model loaded successfully with all 9 entities:\")\n            for entity in expectedEntities.sorted() {\n                print(\"   - \\(entity)\")\n            }\n        } else {\n            print(\"\u274c [Core Data] Missing entities: \\(missingEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        if !extraEntities.isEmpty {\n            print(\"\u2139\ufe0f [Core Data] Additional entities found: \\(extraEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        // \uac01 \uc5d4\ud2f0\ud2f0\uc758 \uc18d\uc131 \uc218 \ucd9c\ub825 (\ubaa8\ub378 \uad6c\uc870 \ud655\uc778\uc6a9)\n        print(\"\ud83d\udcca [Core Data] Entity details:\")\n        for entityName in expectedEntities.sorted() {\n            if let entity = model.entitiesByName[entityName] {\n                let attributeCount = entity.attributesByName.count\n                let relationshipCount = entity.relationshipsByName.count\n                print(\"   - \\(entityName): \\(attributeCount) attributes, \\(relationshipCount) relationships\")\n            }\n        }\n    }\n}\n#endif\n",
        "timestamp": "2026-01-13T07:46:22.394743"
      },
      "worktree_state": {
        "content": "//\n//  PersistenceController.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-11.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data Stack \uad00\ub9ac\n// Core Data\uc758 \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8\uc778 NSPersistentContainer\ub97c \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager/EntityManagerFactory\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport CoreData\n\n// MARK: - PersistenceController\n\n/// Core Data \uc2a4\ud0dd\uc744 \uad00\ub9ac\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec\n/// - \uc571 \uc804\uccb4\uc5d0\uc11c \uacf5\uc720\ub418\ub294 \uc2f1\uae00\ud134 \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - SwiftUI Preview\uc6a9 \uc778\uba54\ubaa8\ub9ac \uc778\uc2a4\ud134\uc2a4 \uc81c\uacf5\n/// - \uc790\ub3d9 \uacbd\ub7c9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc9c0\uc6d0\nfinal class PersistenceController {\n\n    // MARK: - Shared Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Singleton Pattern in Swift\n    // static let\uc73c\ub85c \uc120\uc5b8\ud558\uba74 lazy\ud558\uac8c \ucd08\uae30\ud654\ub418\uace0 thread-safe\n    // \ud83d\udca1 Java \ube44\uad50: synchronized singleton\uacfc \ub2ec\ub9ac \uc5b8\uc5b4 \ub808\ubca8\uc5d0\uc11c thread-safe \ubcf4\uc7a5\n    static let shared = PersistenceController()\n\n    // MARK: - Preview Instance\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SwiftUI Preview\uc6a9 \uc778\uc2a4\ud134\uc2a4\n    // \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uace0 \uba54\ubaa8\ub9ac\uc5d0\uc11c\ub9cc \ub3d9\uc791\n    // Preview\uc5d0\uc11c \uc2e4\uc81c \ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uba74 \ud14c\uc2a4\ud2b8\uac00 \ub290\ub824\uc9c0\uace0 side effect \ubc1c\uc0dd\n    @MainActor\n    static let preview: PersistenceController = {\n        let controller = PersistenceController(inMemory: true)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview\uc6a9 \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131\n        // SwiftUI Preview\uc640 \uac1c\ubc1c \uc911 \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc0d8\ud50c \ub370\uc774\ud130 \uc0dd\uc131\n        // \uc2e4\uc81c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ub418\uc9c0 \uc54a\uace0 \uba54\ubaa8\ub9ac\uc5d0\ub9cc \uc874\uc7ac\n        let viewContext = controller.container.viewContext\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sample Data Creation\n        // \ub2e4\uc591\ud55c \ub0a0\uc9dc\uc758 \uc2e0\uccb4 \uad6c\uc131 \ub370\uc774\ud130\ub97c \uc0dd\uc131\ud558\uc5ec \ud2b8\ub80c\ub4dc \ud655\uc778 \uac00\ub2a5\n        // BodyRecord\uc640 MetabolismSnapshot\uc744 1:1 \uad00\uacc4\ub85c \uc0dd\uc131\n\n        // \uc0d8\ud50c \ub370\uc774\ud130 \ubc30\uc5f4 \uc0dd\uc131 (30\uc77c\uce58 \ub370\uc774\ud130)\n        let calendar = Calendar.current\n        let today = Date()\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ud604\uc2e4\uc801\uc778 \ub370\uc774\ud130 \ubc94\uc704\n        // \uccb4\uc911: 68-72kg \ubc94\uc704\uc5d0\uc11c \ubcc0\ub3d9\n        // \uccb4\uc9c0\ubc29\ub960: 17-20% \ubc94\uc704\uc5d0\uc11c \ubcc0\ub3d9 (\uac10\uc18c \ud2b8\ub80c\ub4dc)\n        // \uadfc\uc721\ub7c9: 30-33kg \ubc94\uc704\uc5d0\uc11c \uc99d\uac00\n        let sampleDataSpecs: [(daysAgo: Int, weight: Double, bodyFatPercent: Double, muscleMass: Double, activityLevel: ActivityLevel)] = [\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130 \ud328\ud134\n            // \ucd5c\uadfc 30\uc77c \ub3d9\uc548 \uccb4\uc911 \uac10\ub7c9 \ubc0f \uadfc\uc721 \uc99d\uac00 \ucd94\uc138 \uc2dc\ubbac\ub808\uc774\uc158\n            // \uccb4\uc911\uacfc \uccb4\uc9c0\ubc29\ub960\uc740 \uac10\uc18c, \uadfc\uc721\ub7c9\uc740 \uc99d\uac00\ud558\ub294 \uac74\uac15\ud55c \ubcc0\ud654 \ud328\ud134\n\n            // 4\uc8fc \uc804 (Week 1)\n            (28, 72.0, 20.0, 30.0, .lightlyActive),\n            (27, 71.8, 19.9, 30.2, .lightlyActive),\n            (26, 71.6, 19.8, 30.4, .moderatelyActive),\n            (25, 71.5, 19.7, 30.5, .moderatelyActive),\n\n            // 3\uc8fc \uc804 (Week 2)\n            (21, 71.3, 19.5, 30.7, .moderatelyActive),\n            (20, 71.1, 19.4, 30.9, .moderatelyActive),\n            (19, 71.0, 19.3, 31.0, .moderatelyActive),\n            (18, 70.8, 19.2, 31.2, .moderatelyActive),\n\n            // 2\uc8fc \uc804 (Week 3)\n            (14, 70.6, 19.0, 31.4, .moderatelyActive),\n            (13, 70.4, 18.9, 31.6, .moderatelyActive),\n            (12, 70.3, 18.8, 31.8, .moderatelyActive),\n            (11, 70.1, 18.7, 32.0, .veryActive),\n\n            // 1\uc8fc \uc804 (Week 4)\n            (7, 69.9, 18.5, 32.2, .veryActive),\n            (6, 69.7, 18.4, 32.4, .veryActive),\n            (5, 69.5, 18.3, 32.6, .veryActive),\n            (4, 69.3, 18.2, 32.8, .veryActive),\n\n            // \ucd5c\uadfc (This Week)\n            (3, 69.0, 18.0, 33.0, .veryActive),\n            (2, 68.8, 17.9, 33.2, .veryActive),\n            (1, 68.5, 17.8, 33.4, .veryActive),\n            (0, 68.3, 17.7, 33.5, .veryActive),\n        ]\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mapper Pattern Usage\n        // Mapper\ub97c \uc0ac\uc6a9\ud558\uc5ec Domain Entity\ub97c Core Data Entity\ub85c \ubcc0\ud658\n        let bodyMapper = BodyRecordMapper()\n        let metabolismMapper = MetabolismSnapshotMapper()\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc0d8\ud50c UserProfile\n        // BMR/TDEE \uacc4\uc0b0\uc5d0 \ud544\uc694\ud55c \uc0ac\uc6a9\uc790 \uc815\ubcf4\n        let sampleUserProfile = UserProfile(\n            height: Decimal(175.5),\n            birthDate: calendar.date(from: DateComponents(year: 1990, month: 6, day: 15))!,\n            gender: .male,\n            activityLevel: .moderatelyActive\n        )\n\n        // \uac01 \ub0a0\uc9dc\uc5d0 \ub300\ud574 BodyRecord\uc640 MetabolismSnapshot \uc0dd\uc131\n        for spec in sampleDataSpecs {\n            guard let date = calendar.date(byAdding: .day, value: -spec.daysAgo, to: today) else {\n                continue\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Domain Entity \uc0dd\uc131\n            // \uba3c\uc800 Domain Entity\ub97c \uc0dd\uc131\ud558\uace0 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc801\uc6a9\n            let bodyEntry = BodyCompositionEntry(\n                date: date,\n                weight: Decimal(spec.weight),\n                bodyFatPercent: Decimal(spec.bodyFatPercent),\n                muscleMass: Decimal(spec.muscleMass)\n            )\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: BMR/TDEE \uacc4\uc0b0\n            // Mifflin-St Jeor \uacf5\uc2dd\uc73c\ub85c BMR \uacc4\uc0b0\n            // \ub0a8\uc131: (10 \u00d7 weight) + (6.25 \u00d7 height) - (5 \u00d7 age) + 5\n            let age = Decimal(sampleUserProfile.age)\n            let bmr = (10 * bodyEntry.weight) +\n                      (Decimal(6.25) * sampleUserProfile.height) -\n                      (5 * age) + 5\n\n            // TDEE = BMR \u00d7 Activity Level Multiplier\n            let tdee = bmr * Decimal(spec.activityLevel.multiplier)\n\n            let metabolismData = MetabolismData(\n                date: date,\n                bmr: bmr,\n                tdee: tdee,\n                weight: bodyEntry.weight,\n                bodyFatPercent: bodyEntry.bodyFatPercent,\n                activityLevel: spec.activityLevel\n            )\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data Entity \uc0dd\uc131\n            // Mapper\ub97c \ud1b5\ud574 Domain Entity\ub97c Core Data Entity\ub85c \ubcc0\ud658\n            let bodyRecord = bodyMapper.toEntity(bodyEntry, context: viewContext)\n            let metabolismSnapshot = metabolismMapper.toEntity(metabolismData, context: viewContext)\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Relationship \uc124\uc815\n            // BodyRecord\uc640 MetabolismSnapshot\uc744 1:1 \uad00\uacc4\ub85c \uc5f0\uacb0\n            // Core Data\uc758 relationship\uc740 \uc591\ubc29\ud5a5\uc73c\ub85c \uc790\ub3d9 \uc124\uc815\ub428\n            bodyRecord.metabolism = metabolismSnapshot\n            metabolismSnapshot.bodyRecord = bodyRecord\n        }\n\n        do {\n            try viewContext.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: fatalError \uc0ac\uc6a9\n            // Preview/\uac1c\ubc1c \ud658\uacbd\uc5d0\uc11c\ub9cc \uc0ac\uc6a9 - \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc801\uc808\ud55c \uc5d0\ub7ec \ucc98\ub9ac \ud544\uc694\n            let nsError = error as NSError\n            fatalError(\"Failed to save preview context: \\(nsError), \\(nsError.userInfo)\")\n        }\n\n        return controller\n    }()\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSPersistentContainer\n    // Core Data \uc2a4\ud0dd\uc758 \ud575\uc2ec - \ubaa8\ub378, \ucee8\ud14d\uc2a4\ud2b8, \uc800\uc7a5\uc18c\ub97c \ubaa8\ub450 \uad00\ub9ac\n    // iOS 10+\uc5d0\uc11c \ub3c4\uc785\ub418\uc5b4 Core Data \uc124\uc815\uc744 \ud06c\uac8c \uac04\uc18c\ud654\n    let container: NSPersistentContainer\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectContext\n    // viewContext\ub294 main queue\uc5d0\uc11c \ub3d9\uc791\ud558\uba70 UI \uc5c5\ub370\uc774\ud2b8\uc5d0 \uc0ac\uc6a9\n    // \ud83d\udca1 Java \ube44\uad50: JPA\uc758 EntityManager\uc640 \uc720\uc0ac - \uc5d4\ud2f0\ud2f0\uc758 \uc0dd\uba85\uc8fc\uae30 \uad00\ub9ac\n    var viewContext: NSManagedObjectContext {\n        container.viewContext\n    }\n\n    // MARK: - Initialization\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Init with Default Parameters\n    // inMemory: true\ub85c \ud558\uba74 SQLite \ud30c\uc77c \ub300\uc2e0 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\n    // \ud14c\uc2a4\ud2b8\ub098 Preview\uc5d0\uc11c \uc720\uc6a9\n    init(inMemory: Bool = false) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Bundle\uc5d0\uc11c Core Data \ubaa8\ub378 \ub85c\ub4dc\n        // NSPersistentContainer\ub294 \uc790\ub3d9\uc73c\ub85c .xcdatamodeld \ud30c\uc77c\uc744 \ucc3e\uc74c\n        // \ud30c\uc77c\uba85\uc774 \"Bodii\"\uc774\uba74 Bodii.xcdatamodeld\ub97c \ucc3e\uc74c\n        container = NSPersistentContainer(name: \"Bodii\")\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Lightweight Migration \uc124\uc815\n        // \uc2a4\ud0a4\ub9c8 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc218\ud589\n        // \u26a0\ufe0f \uc8fc\uc758: \ubcf5\uc7a1\ud55c \ubcc0\uacbd\uc740 \uc218\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud544\uc694\n        let description = container.persistentStoreDescriptions.first\n        description?.setOption(true as NSNumber, forKey: NSMigratePersistentStoresAutomaticallyOption)\n        description?.setOption(true as NSNumber, forKey: NSInferMappingModelAutomaticallyOption)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc778\uba54\ubaa8\ub9ac \uc800\uc7a5\uc18c \uc124\uc815\n        // \ud14c\uc2a4\ud2b8/Preview\uc6a9 - \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc18c\uba78\n        if inMemory {\n            description?.url = URL(fileURLWithPath: \"/dev/null\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ube44\ub3d9\uae30 \uc800\uc7a5\uc18c \ub85c\ub4dc\n        // loadPersistentStores\ub294 \ube44\ub3d9\uae30\ub85c \ub3d9\uc791\ud558\uc9c0\ub9cc completion handler\uc5d0\uc11c \uc5d0\ub7ec \ucc98\ub9ac\n        container.loadPersistentStores { [weak self] storeDescription, error in\n            if let error = error as NSError? {\n                // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ub85c\ub4dc \uc2e4\ud328 \ucc98\ub9ac\n                // \u26a0\ufe0f \uc8fc\uc758: \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 fatalError \ub300\uc2e0 \uc801\uc808\ud55c \ubcf5\uad6c \ub85c\uc9c1 \ud544\uc694\n                // \uc608: \uc190\uc0c1\ub41c \uc800\uc7a5\uc18c \uc0ad\uc81c \ud6c4 \uc7ac\uc0dd\uc131, \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9bc \ub4f1\n                fatalError(\"Failed to load Core Data store: \\(error), \\(error.userInfo)\")\n            }\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Merge Policy \uc124\uc815\n            // \uc5ec\ub7ec \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \ub3d9\uc2dc\uc5d0 \ubcc0\uacbd \uc2dc \ucda9\ub3cc \ud574\uacb0 \uc815\ucc45\n            // mergeByPropertyObjectTrump: \uba54\ubaa8\ub9ac\uc758 \uac12\uc774 \uc800\uc7a5\uc18c \uac12\uc744 \ub36e\uc5b4\uc500\n            self?.container.viewContext.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc790\ub3d9 \ubcd1\ud569 \uc124\uc815\n            // \ubc31\uadf8\ub77c\uc6b4\ub4dc \ucee8\ud14d\uc2a4\ud2b8\uc758 \ubcc0\uacbd\uc0ac\ud56d\uc744 viewContext\uc5d0 \uc790\ub3d9 \ubc18\uc601\n            self?.container.viewContext.automaticallyMergesChangesFromParent = true\n\n            #if DEBUG\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n            // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n            self?.verifyModelLoaded()\n            #endif\n        }\n    }\n\n    // MARK: - Public Methods\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Context \uc800\uc7a5\n    // Core Data\ub294 \ubcc0\uacbd\uc0ac\ud56d\uc744 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\ub2e4\uac00 save() \ud638\ucd9c \uc2dc \ub514\uc2a4\ud06c\uc5d0 \uae30\ub85d\n    // \u26a0\ufe0f \uc8fc\uc758: save() \ud638\ucd9c\uc744 \uc78a\uc73c\uba74 \uc571 \uc885\ub8cc \uc2dc \ub370\uc774\ud130 \uc190\uc2e4\n    func save() {\n        let context = container.viewContext\n        guard context.hasChanges else { return }\n\n        do {\n            try context.save()\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc5d0\ub7ec \ucc98\ub9ac\n            // \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9ac\uac70\ub098 \ub85c\uae45 \ud544\uc694\n            let nsError = error as NSError\n            assertionFailure(\"Failed to save context: \\(nsError), \\(nsError.userInfo)\")\n        }\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context \uc0dd\uc131\n    // \ub300\uc6a9\ub7c9 \ub370\uc774\ud130 \ucc98\ub9ac \uc2dc \uba54\uc778 \uc2a4\ub808\ub4dc \ube14\ub85c\ud0b9 \ubc29\uc9c0\n    // \ud83d\udca1 Java \ube44\uad50: \ubcc4\ub3c4 \uc2a4\ub808\ub4dc\uc5d0\uc11c EntityManager \uc0ac\uc6a9\ud558\ub294 \uac83\uacfc \uc720\uc0ac\n    func newBackgroundContext() -> NSManagedObjectContext {\n        let context = container.newBackgroundContext()\n        context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n        return context\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Background Context\uc5d0\uc11c \uc791\uc5c5 \uc218\ud589\n    // \ud074\ub85c\uc800 \ub0b4\uc5d0\uc11c \ubc31\uadf8\ub77c\uc6b4\ub4dc \uc791\uc5c5 \uc218\ud589 \ud6c4 \uc790\ub3d9\uc73c\ub85c \uc800\uc7a5\n    func performBackgroundTask(_ block: @escaping (NSManagedObjectContext) -> Void) {\n        container.performBackgroundTask { context in\n            context.mergePolicy = NSMergeByPropertyObjectTrumpMergePolicy\n            block(context)\n        }\n    }\n}\n\n// MARK: - Debug Helpers\n\n#if DEBUG\nextension PersistenceController {\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \ud14c\uc2a4\ud2b8\uc6a9 \ud5ec\ud37c\n    // \uc778\uba54\ubaa8\ub9ac \ucee8\ud2b8\ub864\ub7ec\ub97c \ube60\ub974\uac8c \uc0dd\uc131\ud558\uc5ec \ub2e8\uc704 \ud14c\uc2a4\ud2b8\uc5d0 \ud65c\uc6a9\n    static func makeForTesting() -> PersistenceController {\n        PersistenceController(inMemory: true)\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc800\uc7a5\uc18c \uc704\uce58 \ub514\ubc84\uae45\n    // Core Data \ud30c\uc77c\uc774 \uc5b4\ub514\uc5d0 \uc800\uc7a5\ub418\ub294\uc9c0 \ud655\uc778\uc6a9\n    func printStoreLocation() {\n        guard let url = container.persistentStoreDescriptions.first?.url else {\n            print(\"No store URL found\")\n            return\n        }\n        print(\"Core Data store location: \\(url)\")\n    }\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Core Data \ubaa8\ub378 \uac80\uc99d\n    // \uc571 \uc2dc\uc791 \uc2dc \ubaa8\ub4e0 \uc5d4\ud2f0\ud2f0\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n    // \ud83d\udca1 \uc774 \uba54\uc11c\ub4dc\ub294 DEBUG \ube4c\ub4dc\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub428\n    func verifyModelLoaded() {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObjectModel\n        // Core Data \ubaa8\ub378\uc758 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \uc811\uadfc\ud558\uc5ec \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d \ud655\uc778\n        guard let model = container.managedObjectModel as NSManagedObjectModel? else {\n            print(\"\u26a0\ufe0f [Core Data] Failed to access managed object model\")\n            return\n        }\n\n        // \uc571\uc5d0\uc11c \ud544\uc694\ud55c 9\uac1c \uc5d4\ud2f0\ud2f0 \ubaa9\ub85d\n        let expectedEntities: Set<String> = [\n            \"User\",\n            \"BodyRecord\",\n            \"MetabolismSnapshot\",\n            \"Food\",\n            \"FoodRecord\",\n            \"ExerciseRecord\",\n            \"SleepRecord\",\n            \"DailyLog\",\n            \"Goal\"\n        ]\n\n        // \ubaa8\ub378\uc5d0\uc11c \ub85c\ub4dc\ub41c \uc5d4\ud2f0\ud2f0 \uc774\ub984 \ucd94\ucd9c\n        let loadedEntities = Set(model.entities.compactMap { $0.name })\n\n        // \uac80\uc99d: \ubaa8\ub4e0 \ud544\uc218 \uc5d4\ud2f0\ud2f0\uac00 \ub85c\ub4dc\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n        let missingEntities = expectedEntities.subtracting(loadedEntities)\n        let extraEntities = loadedEntities.subtracting(expectedEntities)\n\n        if missingEntities.isEmpty {\n            print(\"\u2705 [Core Data] Model loaded successfully with all 9 entities:\")\n            for entity in expectedEntities.sorted() {\n                print(\"   - \\(entity)\")\n            }\n        } else {\n            print(\"\u274c [Core Data] Missing entities: \\(missingEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        if !extraEntities.isEmpty {\n            print(\"\u2139\ufe0f [Core Data] Additional entities found: \\(extraEntities.sorted().joined(separator: \", \"))\")\n        }\n\n        // \uac01 \uc5d4\ud2f0\ud2f0\uc758 \uc18d\uc131 \uc218 \ucd9c\ub825 (\ubaa8\ub378 \uad6c\uc870 \ud655\uc778\uc6a9)\n        print(\"\ud83d\udcca [Core Data] Entity details:\")\n        for entityName in expectedEntities.sorted() {\n            if let entity = model.entitiesByName[entityName] {\n                let attributeCount = entity.attributesByName.count\n                let relationshipCount = entity.relationshipsByName.count\n                print(\"   - \\(entityName): \\(attributeCount) attributes, \\(relationshipCount) relationships\")\n            }\n        }\n    }\n}\n#endif\n",
        "last_modified": "2026-01-13T19:18:50.334230"
      },
      "task_intent": {
        "title": "Body Composition Tracking with BMR/TDEE",
        "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
        "from_plan": true
      },
      "commits_behind_main": 1,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-11T19:04:12.115443",
  "last_updated": "2026-01-13T07:46:22.867782"
}