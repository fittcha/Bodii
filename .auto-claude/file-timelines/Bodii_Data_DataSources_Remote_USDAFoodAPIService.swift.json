{
  "file_path": "Bodii/Data/DataSources/Remote/USDAFoodAPIService.swift",
  "main_branch_history": [],
  "task_views": {
    "005-korean-food-database-integration": {
      "task_id": "005-korean-food-database-integration",
      "branch_point": {
        "commit_hash": "c44bfbcd7c1699b176a8bb155e8c35f43ebd4ad9",
        "content": "",
        "timestamp": "2026-01-13T07:46:23.878686"
      },
      "worktree_state": {
        "content": "//\n//  USDAFoodAPIService.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: API Service Layer\n// \uc678\ubd80 API \ud638\ucd9c\uc744 \ucea1\uc290\ud654\ud558\ub294 \uc11c\ube44\uc2a4 \ud074\ub798\uc2a4\n// \ud83d\udca1 Java \ube44\uad50: Retrofit\uc758 Service Interface \uad6c\ud604\uccb4\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport Foundation\n\n/// USDA FoodData Central API \uc11c\ube44\uc2a4\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Service Layer Pattern\n/// \ub124\ud2b8\uc6cc\ud06c \uc694\uccad \ub85c\uc9c1\uc744 \ubd84\ub9ac\ud558\uc5ec \uc7ac\uc0ac\uc6a9\uc131\uacfc \ud14c\uc2a4\ud2b8 \uc6a9\uc774\uc131 \ud5a5\uc0c1\n/// \ud83d\udca1 Java \ube44\uad50: Repository \ud328\ud134\uc758 Remote DataSource\uc640 \uc720\uc0ac\n///\n/// **\uc8fc\uc694 \uae30\ub2a5:**\n/// - \uc2dd\ud488\uba85\uc73c\ub85c \uac80\uc0c9\n/// - \ud398\uc774\uc9d5 \uc9c0\uc6d0 (page number \uae30\ubc18)\n/// - \uc2dd\ud488 \uc0c1\uc138 \uc815\ubcf4 \uc870\ud68c (FDC ID)\n/// - API \uc751\ub2f5 \ud30c\uc2f1 \ubc0f \uc5d0\ub7ec \ucc98\ub9ac\n/// - Rate limit \uc900\uc218\n///\n/// **API \uc815\ubcf4:**\n/// - Provider: USDA (\ubbf8\uad6d \ub18d\ubb34\ubd80)\n/// - API \ubb38\uc11c: https://fdc.nal.usda.gov/api-guide.html\n/// - Rate Limit: DEMO_KEY - 30 requests/hour, 50 requests/day\n/// - API \ud0a4 \uc2e0\uccad: https://fdc.nal.usda.gov/api-key-signup.html\n///\n/// **\uc0ac\uc6a9 \uc608\uc2dc:**\n/// ```swift\n/// let service = USDAFoodAPIService()\n///\n/// // \uc2dd\ud488 \uac80\uc0c9\n/// let result = try await service.searchFoods(query: \"apple\", pageSize: 10, pageNumber: 1)\n/// print(\"Found \\(result.totalHits) foods\")\n/// result.foods?.forEach { food in\n///     let calories = food.getNutrientValue(USDANutrientID.energy)\n///     print(\"\\(food.description): \\(calories ?? 0) kcal\")\n/// }\n///\n/// // \uc2dd\ud488 \uc0c1\uc138 \uc870\ud68c\n/// let detail = try await service.getFoodDetail(fdcId: \"123456\")\n/// ```\nfinal class USDAFoodAPIService {\n\n    // MARK: - Properties\n\n    /// \ub124\ud2b8\uc6cc\ud06c \ub9e4\ub2c8\uc800\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// NetworkManager\ub97c \uc8fc\uc785\ubc1b\uc544 \ud14c\uc2a4\ud2b8 \uc2dc Mock\uc73c\ub85c \uad50\uccb4 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: Constructor Injection \ud328\ud134\n    private let networkManager: NetworkManager\n\n    /// API \uc124\uc815\n    ///\n    /// API URL\uacfc \uc778\uc99d \ud0a4\ub97c \uc81c\uacf5\ud558\ub294 \uc124\uc815 \uac1d\uccb4\n    private let apiConfig: APIConfigProtocol\n\n    // MARK: - Initialization\n\n    /// USDAFoodAPIService \ucd08\uae30\ud654\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// \uc678\ubd80\uc5d0\uc11c \uc758\uc874\uc131\uc744 \uc8fc\uc785\ubc1b\uc544 \ud14c\uc2a4\ud2b8\uc640 \uc720\uc5f0\uc131 \ud5a5\uc0c1\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject \uc5b4\ub178\ud14c\uc774\uc158\uacfc \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameters:\n    ///   - networkManager: \ub124\ud2b8\uc6cc\ud06c \uc694\uccad\uc744 \ucc98\ub9ac\ud560 \ub9e4\ub2c8\uc800 (\uae30\ubcf8\uac12: shared URLSession \uc0ac\uc6a9)\n    ///   - apiConfig: API \uc124\uc815 (\uae30\ubcf8\uac12: APIConfig.shared)\n    init(\n        networkManager: NetworkManager = NetworkManager(\n            timeout: Constants.API.USDA.timeout,\n            maxRetries: Constants.API.USDA.maxRetries\n        ),\n        apiConfig: APIConfigProtocol = APIConfig.shared\n    ) {\n        self.networkManager = networkManager\n        self.apiConfig = apiConfig\n    }\n\n    // MARK: - Public Methods\n\n    /// \uc2dd\ud488\uba85\uc73c\ub85c \uac80\uc0c9\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async/Await Network Call\n    /// \ube44\ub3d9\uae30 \ub124\ud2b8\uc6cc\ud06c \uc694\uccad\uc744 \ub3d9\uae30 \ucf54\ub4dc\ucc98\ub7fc \uc791\uc131\n    /// \ud83d\udca1 Java \ube44\uad50: CompletableFuture\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc \ub354 \uac04\uacb0\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: USDA Pagination\n    /// USDA API\ub294 \ud398\uc774\uc9c0 \ubc88\ud638(pageNumber)\ub97c \uc0ac\uc6a9 (KFDA\uc758 \uc778\ub371\uc2a4 \ubc94\uc704\uc640 \ub2e4\ub984)\n    /// \ud83d\udca1 \uc608: pageNumber=1, pageSize=10 \u2192 1-10\ubc88 \uacb0\uacfc (10\uac1c)\n    ///       pageNumber=2, pageSize=10 \u2192 11-20\ubc88 \uacb0\uacfc (10\uac1c)\n    ///\n    /// - Parameters:\n    ///   - query: \uac80\uc0c9\uc5b4 (\uc2dd\ud488\uba85, \uc608: \"apple\", \"milk\")\n    ///   - pageSize: \ud398\uc774\uc9c0 \ud06c\uae30 (\uae30\ubcf8\uac12: defaultPageSize - 25)\n    ///   - pageNumber: \ud398\uc774\uc9c0 \ubc88\ud638 (1\ubd80\ud130 \uc2dc\uc791, \uae30\ubcf8\uac12: 1)\n    ///   - dataType: \uc2dd\ud488 \ud0c0\uc785 \ud544\ud130 (\uc120\ud0dd\uc801, \uc608: [\"Branded\", \"Foundation\"])\n    ///\n    /// - Returns: API \uc751\ub2f5 (\uc2dd\ud488 \ubaa9\ub85d\uacfc \ud398\uc774\uc9d5 \uc815\ubcf4 \ud3ec\ud568)\n    ///\n    /// - Throws:\n    ///   - NetworkError: \ub124\ud2b8\uc6cc\ud06c \uc694\uccad \uc2e4\ud328\n    ///   - USDAAPIError: API \uc5d0\ub7ec (\uc778\uc99d \uc2e4\ud328, rate limit \ub4f1)\n    ///\n    /// - Example:\n    /// ```swift\n    /// // \uccab \ud398\uc774\uc9c0 \uac80\uc0c9\n    /// let page1 = try await service.searchFoods(query: \"apple\")\n    ///\n    /// // \ub2e4\uc74c \ud398\uc774\uc9c0 \uac80\uc0c9\n    /// let page2 = try await service.searchFoods(\n    ///     query: \"apple\",\n    ///     pageSize: 10,\n    ///     pageNumber: 2\n    /// )\n    ///\n    /// // Foundation \uc2dd\ud488\ub9cc \uac80\uc0c9\n    /// let foundations = try await service.searchFoods(\n    ///     query: \"apple\",\n    ///     dataType: [\"Foundation\"]\n    /// )\n    /// ```\n    func searchFoods(\n        query: String,\n        pageSize: Int = Constants.API.USDA.defaultPageSize,\n        pageNumber: Int = 1,\n        dataType: [String]? = nil\n    ) async throws -> USDASearchResponseDTO {\n\n        // \uc785\ub825 \uac80\uc99d\n        guard !query.trimmingCharacters(in: .whitespaces).isEmpty else {\n            throw USDAAPIError.badRequest(\"\uac80\uc0c9\uc5b4\uac00 \ube44\uc5b4\uc788\uc2b5\ub2c8\ub2e4.\")\n        }\n\n        guard pageNumber > 0 else {\n            throw USDAAPIError.badRequest(\"\ud398\uc774\uc9c0 \ubc88\ud638\ub294 1 \uc774\uc0c1\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.\")\n        }\n\n        guard pageSize > 0 && pageSize <= Constants.API.USDA.maxPageSize else {\n            throw USDAAPIError.badRequest(\n                \"\ud398\uc774\uc9c0 \ud06c\uae30\ub294 1-\\(Constants.API.USDA.maxPageSize) \ubc94\uc704\uc5ec\uc57c \ud569\ub2c8\ub2e4.\"\n            )\n        }\n\n        // URL \uc0dd\uc131\n        let endpoint = APIConfig.USDAEndpoint.search(\n            query: query,\n            pageSize: pageSize,\n            pageNumber: pageNumber\n        )\n\n        guard let url = apiConfig.buildUSDAURL(endpoint: endpoint) else {\n            throw NetworkError.invalidURL(\"USDA API URL \uc0dd\uc131 \uc2e4\ud328\")\n        }\n\n        // dataType \ud544\ud130\uac00 \uc788\uc73c\uba74 URL\uc5d0 \ucd94\uac00\n        var finalURL = url\n        if let dataTypes = dataType, !dataTypes.isEmpty {\n            var components = URLComponents(url: url, resolvingAgainstBaseURL: false)\n            var queryItems = components?.queryItems ?? []\n            dataTypes.forEach { type in\n                queryItems.append(URLQueryItem(name: \"dataType\", value: type))\n            }\n            components?.queryItems = queryItems\n            finalURL = components?.url ?? url\n        }\n\n        // API \uc694\uccad\n        do {\n            let response: USDASearchResponseDTO = try await networkManager.request(\n                url: finalURL.absoluteString,\n                method: .get,\n                timeout: Constants.API.USDA.timeout\n            )\n\n            // API \uc751\ub2f5 \uac80\uc99d\n            guard response.isValid else {\n                throw USDAAPIError.parsingError(\"\uc751\ub2f5 \ub370\uc774\ud130\uac00 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\")\n            }\n\n            return response\n\n        } catch let error as USDAAPIError {\n            // USDA API \uc5d0\ub7ec\ub294 \uadf8\ub300\ub85c \uc804\ub2ec\n            throw error\n\n        } catch let error as NetworkError {\n            // \ub124\ud2b8\uc6cc\ud06c \uc5d0\ub7ec\ub97c USDA \uc5d0\ub7ec\ub85c \ubcc0\ud658\n            throw mapNetworkErrorToUSDAError(error)\n\n        } catch {\n            // \uae30\ud0c0 \uc5d0\ub7ec\n            throw NetworkError.unknown(error)\n        }\n    }\n\n    /// FDC ID\ub85c \uc2dd\ud488 \uc0c1\uc138 \uc815\ubcf4 \uc870\ud68c\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Single Item API Call\n    /// \ud2b9\uc815 \uc2dd\ud488\uc758 \uc0c1\uc138 \uc815\ubcf4\ub97c \uc870\ud68c\ud558\ub294 \uba54\uc11c\ub4dc\n    /// \ud83d\udca1 Java \ube44\uad50: findById()\uc640 \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameter fdcId: FDC ID (USDA \uc2dd\ud488 \uace0\uc720 ID, \uc608: \"123456\")\n    ///\n    /// - Returns: \uc2dd\ud488 \uc0c1\uc138 \uc815\ubcf4\n    ///\n    /// - Throws:\n    ///   - NetworkError: \ub124\ud2b8\uc6cc\ud06c \uc694\uccad \uc2e4\ud328\n    ///   - USDAAPIError: API \uc5d0\ub7ec \ub610\ub294 \uc2dd\ud488\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc74c\n    ///\n    /// - Example:\n    /// ```swift\n    /// let food = try await service.getFoodDetail(fdcId: \"123456\")\n    /// let calories = food.getNutrientValue(USDANutrientID.energy)\n    /// print(\"\\(food.description): \\(calories ?? 0) kcal\")\n    /// ```\n    func getFoodDetail(fdcId: String) async throws -> USDAFoodDTO {\n\n        // \uc785\ub825 \uac80\uc99d\n        guard !fdcId.trimmingCharacters(in: .whitespaces).isEmpty else {\n            throw USDAAPIError.badRequest(\"FDC ID\uac00 \ube44\uc5b4\uc788\uc2b5\ub2c8\ub2e4.\")\n        }\n\n        // URL \uc0dd\uc131\n        let endpoint = APIConfig.USDAEndpoint.food(fdcId: fdcId)\n\n        guard let url = apiConfig.buildUSDAURL(endpoint: endpoint) else {\n            throw NetworkError.invalidURL(\"USDA API URL \uc0dd\uc131 \uc2e4\ud328\")\n        }\n\n        // API \uc694\uccad\n        do {\n            let food: USDAFoodDTO = try await networkManager.request(\n                url: url.absoluteString,\n                method: .get,\n                timeout: Constants.API.USDA.timeout\n            )\n\n            // \ub370\uc774\ud130 \uc720\ud6a8\uc131 \uac80\uc99d\n            guard food.isValid else {\n                throw USDAAPIError.parsingError(\"\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uc2dd\ud488 \ub370\uc774\ud130\uc785\ub2c8\ub2e4.\")\n            }\n\n            return food\n\n        } catch let error as USDAAPIError {\n            // USDA API \uc5d0\ub7ec\ub294 \uadf8\ub300\ub85c \uc804\ub2ec\n            throw error\n\n        } catch let error as NetworkError {\n            // \ub124\ud2b8\uc6cc\ud06c \uc5d0\ub7ec\ub97c USDA \uc5d0\ub7ec\ub85c \ubcc0\ud658\n            throw mapNetworkErrorToUSDAError(error)\n\n        } catch {\n            // \uae30\ud0c0 \uc5d0\ub7ec\n            throw NetworkError.unknown(error)\n        }\n    }\n\n    /// \uc5ec\ub7ec FDC ID\ub85c \uc2dd\ud488 \uc815\ubcf4 \uc77c\uad04 \uc870\ud68c\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Batch API Call\n    /// \uc5ec\ub7ec \uc2dd\ud488\uc744 \ud55c \ubc88\uc5d0 \uc870\ud68c\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc694\uccad \ucd5c\uc18c\ud654\n    /// \ud83d\udca1 Java \ube44\uad50: findAllById()\uc640 \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameter fdcIds: FDC ID \ubc30\uc5f4\n    ///\n    /// - Returns: \uc2dd\ud488 \uc815\ubcf4 \ubc30\uc5f4\n    ///\n    /// - Throws:\n    ///   - NetworkError: \ub124\ud2b8\uc6cc\ud06c \uc694\uccad \uc2e4\ud328\n    ///   - USDAAPIError: API \uc5d0\ub7ec\n    ///\n    /// - Note: \ucd5c\ub300 20\uac1c\uae4c\uc9c0 \ud55c \ubc88\uc5d0 \uc870\ud68c \uac00\ub2a5 (USDA API \uc81c\ud55c)\n    ///\n    /// - Example:\n    /// ```swift\n    /// let foods = try await service.getFoods(fdcIds: [\"123456\", \"789012\"])\n    /// foods.forEach { food in\n    ///     print(food.description)\n    /// }\n    /// ```\n    func getFoods(fdcIds: [String]) async throws -> [USDAFoodDTO] {\n\n        // \uc785\ub825 \uac80\uc99d\n        guard !fdcIds.isEmpty else {\n            throw USDAAPIError.badRequest(\"FDC ID \ubaa9\ub85d\uc774 \ube44\uc5b4\uc788\uc2b5\ub2c8\ub2e4.\")\n        }\n\n        guard fdcIds.count <= 20 else {\n            throw USDAAPIError.badRequest(\"\ucd5c\ub300 20\uac1c\uae4c\uc9c0 \ud55c \ubc88\uc5d0 \uc870\ud68c \uac00\ub2a5\ud569\ub2c8\ub2e4.\")\n        }\n\n        // URL \uc0dd\uc131\n        let endpoint = APIConfig.USDAEndpoint.foods(fdcIds: fdcIds)\n\n        guard let url = apiConfig.buildUSDAURL(endpoint: endpoint) else {\n            throw NetworkError.invalidURL(\"USDA API URL \uc0dd\uc131 \uc2e4\ud328\")\n        }\n\n        // API \uc694\uccad\n        do {\n            let foods: [USDAFoodDTO] = try await networkManager.request(\n                url: url.absoluteString,\n                method: .get,\n                timeout: Constants.API.USDA.timeout\n            )\n\n            // \uc720\ud6a8\ud55c \uc2dd\ud488\ub9cc \ud544\ud130\ub9c1\n            let validFoods = validateFoods(foods)\n\n            return validFoods\n\n        } catch let error as USDAAPIError {\n            // USDA API \uc5d0\ub7ec\ub294 \uadf8\ub300\ub85c \uc804\ub2ec\n            throw error\n\n        } catch let error as NetworkError {\n            // \ub124\ud2b8\uc6cc\ud06c \uc5d0\ub7ec\ub97c USDA \uc5d0\ub7ec\ub85c \ubcc0\ud658\n            throw mapNetworkErrorToUSDAError(error)\n\n        } catch {\n            // \uae30\ud0c0 \uc5d0\ub7ec\n            throw NetworkError.unknown(error)\n        }\n    }\n\n    // MARK: - Private Methods\n\n    /// NetworkError\ub97c USDAAPIError\ub85c \ub9e4\ud551\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Mapping\n    /// \ub124\ud2b8\uc6cc\ud06c \uc5d0\ub7ec\ub97c \ub3c4\uba54\uc778\ubcc4 \uc5d0\ub7ec\ub85c \ubcc0\ud658\ud558\uc5ec \uc0c1\uc704 \ub808\uc774\uc5b4\uc5d0\uc11c \ucc98\ub9ac \uc6a9\uc774\n    /// \ud83d\udca1 Java \ube44\uad50: Exception mapping pattern\n    ///\n    /// - Parameter error: NetworkError\n    ///\n    /// - Returns: USDAAPIError\n    private func mapNetworkErrorToUSDAError(_ error: NetworkError) -> USDAAPIError {\n        switch error {\n        case .httpError(let statusCode, let message):\n            switch statusCode {\n            case 400:\n                return .badRequest(message)\n            case 401, 403:\n                return .authenticationFailed(message)\n            case 404:\n                return .notFound\n            case 429:\n                return .rateLimitExceeded\n            case 500...599:\n                return .serverError(message)\n            default:\n                return .unknown(statusCode, message)\n            }\n\n        case .networkUnavailable:\n            return .serverError(\"\ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.\")\n\n        case .timeout:\n            return .serverError(\"\uc694\uccad \uc2dc\uac04\uc774 \ucd08\uacfc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\")\n\n        case .decodingFailed(let underlyingError):\n            return .parsingError(\"\ub370\uc774\ud130 \ud30c\uc2f1 \uc2e4\ud328: \\(underlyingError.localizedDescription)\")\n\n        case .noData:\n            return .noData\n\n        case .invalidURL(let url):\n            return .badRequest(\"\uc798\ubabb\ub41c URL: \\(url)\")\n\n        case .invalidResponse:\n            return .parsingError(\"\uc798\ubabb\ub41c \uc751\ub2f5 \ud615\uc2dd\uc785\ub2c8\ub2e4.\")\n\n        case .unknown(let underlyingError):\n            return .unknown(0, underlyingError.localizedDescription)\n        }\n    }\n}\n\n// MARK: - Pagination Helper\n\nextension USDAFoodAPIService {\n\n    /// \ub2e4\uc74c \ud398\uc774\uc9c0 \ubc88\ud638 \uacc4\uc0b0\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Pagination Helper\n    /// \ud398\uc774\uc9d5 \ub85c\uc9c1\uc744 \ucea1\uc290\ud654\ud558\uc5ec \ud638\ucd9c \ucf54\ub4dc \ub2e8\uc21c\ud654\n    /// \ud83d\udca1 Java \ube44\uad50: PageRequest.next()\uc640 \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameter response: \ud604\uc7ac \uac80\uc0c9 \uc751\ub2f5\n    ///\n    /// - Returns: \ub2e4\uc74c \ud398\uc774\uc9c0 \ubc88\ud638 (\uc5c6\uc73c\uba74 nil)\n    ///\n    /// - Example:\n    /// ```swift\n    /// var currentPage = 1\n    /// var allFoods: [USDAFoodDTO] = []\n    ///\n    /// while true {\n    ///     let result = try await service.searchFoods(\n    ///         query: \"apple\",\n    ///         pageNumber: currentPage\n    ///     )\n    ///\n    ///     allFoods.append(contentsOf: result.foods ?? [])\n    ///\n    ///     guard let nextPage = service.nextPageNumber(from: result) else {\n    ///         break\n    ///     }\n    ///     currentPage = nextPage\n    /// }\n    /// ```\n    func nextPageNumber(from response: USDASearchResponseDTO) -> Int? {\n        return response.nextPage\n    }\n\n    /// \uc774\uc804 \ud398\uc774\uc9c0 \ubc88\ud638 \uacc4\uc0b0\n    ///\n    /// - Parameter response: \ud604\uc7ac \uac80\uc0c9 \uc751\ub2f5\n    ///\n    /// - Returns: \uc774\uc804 \ud398\uc774\uc9c0 \ubc88\ud638 (\uc5c6\uc73c\uba74 nil)\n    func previousPageNumber(from response: USDASearchResponseDTO) -> Int? {\n        return response.previousPage\n    }\n\n    /// \uc804\uccb4 \ud398\uc774\uc9c0 \uc218 \uacc4\uc0b0\n    ///\n    /// - Parameter response: \uac80\uc0c9 \uc751\ub2f5\n    ///\n    /// - Returns: \uc804\uccb4 \ud398\uc774\uc9c0 \uc218\n    func totalPages(from response: USDASearchResponseDTO) -> Int {\n        return response.totalPages\n    }\n\n    /// \ud604\uc7ac \ud398\uc774\uc9c0\uac00 \ub9c8\uc9c0\ub9c9 \ud398\uc774\uc9c0\uc778\uc9c0 \ud655\uc778\n    ///\n    /// - Parameter response: \uac80\uc0c9 \uc751\ub2f5\n    ///\n    /// - Returns: \ub9c8\uc9c0\ub9c9 \ud398\uc774\uc9c0\uba74 true\n    func isLastPage(response: USDASearchResponseDTO) -> Bool {\n        return !response.hasMorePages\n    }\n}\n\n// MARK: - Validation Helper\n\nextension USDAFoodAPIService {\n\n    /// \uac80\uc0c9 \uacb0\uacfc \uc720\ud6a8\uc131 \uac80\uc99d\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Data Validation\n    /// API \uc751\ub2f5 \ub370\uc774\ud130\uc758 \uc720\ud6a8\uc131\uc744 \uac80\uc99d\ud558\uc5ec \uc798\ubabb\ub41c \ub370\uc774\ud130 \ud544\ud130\ub9c1\n    /// \ud83d\udca1 Java \ube44\uad50: Bean Validation\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter foods: \uac80\uc99d\ud560 \uc2dd\ud488 \ubaa9\ub85d\n    ///\n    /// - Returns: \uc720\ud6a8\ud55c \uc2dd\ud488 \ubaa9\ub85d (\ud544\uc218 \ud544\ub4dc\uac00 \uc788\ub294 \ud56d\ubaa9\ub9cc)\n    ///\n    /// - Note: \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub370\uc774\ud130\ub294 \uc81c\uac70\ub418\uace0 \ub85c\uadf8\uac00 \ucd9c\ub825\ub428\n    ///\n    /// - Example:\n    /// ```swift\n    /// let response = try await service.searchFoods(query: \"apple\")\n    /// let validFoods = service.validateFoods(response.foods ?? [])\n    /// print(\"Valid foods: \\(validFoods.count) / \\(response.foods?.count ?? 0)\")\n    /// ```\n    func validateFoods(_ foods: [USDAFoodDTO]) -> [USDAFoodDTO] {\n        return foods.filter { food in\n            let isValid = food.isValid\n\n            if !isValid {\n                // \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub370\uc774\ud130 \ub85c\uae45 (\ub514\ubc84\uadf8 \ubaa8\ub4dc\uc5d0\uc11c\ub9cc)\n                #if DEBUG\n                print(\"\u26a0\ufe0f Invalid USDA food data: \\(food.fdcId) - \\(food.description)\")\n                #endif\n            }\n\n            return isValid\n        }\n    }\n\n    /// \uac80\uc0c9 \uc751\ub2f5\uc774 \ube44\uc5b4\uc788\ub294\uc9c0 \ud655\uc778\n    ///\n    /// - Parameter response: \uac80\uc0c9 \uc751\ub2f5\n    ///\n    /// - Returns: \uacb0\uacfc\uac00 \uc5c6\uc73c\uba74 true\n    func isEmpty(response: USDASearchResponseDTO) -> Bool {\n        return !response.hasResults\n    }\n}\n\n// MARK: - Testing Support\n\n#if DEBUG\n/// \ud14c\uc2a4\ud2b8\uc6a9 Mock USDA API \uc11c\ube44\uc2a4\n///\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mock Objects for Testing\n/// \ud14c\uc2a4\ud2b8\uc5d0\uc11c \uc2e4\uc81c API \ud638\ucd9c \uc5c6\uc774 \ub3d9\uc791 \uac80\uc99d \uac00\ub2a5\n/// \ud83d\udca1 Java \ube44\uad50: Mockito\uc758 @Mock\uacfc \uc720\uc0ac\nfinal class MockUSDAFoodAPIService {\n\n    /// Mock \uac80\uc0c9 \uc751\ub2f5 \ub370\uc774\ud130\n    var mockSearchResponse: USDASearchResponseDTO?\n\n    /// Mock \uc0c1\uc138 \uc815\ubcf4\n    var mockFoodDetail: USDAFoodDTO?\n\n    /// Mock \uc77c\uad04 \uc870\ud68c \uc751\ub2f5\n    var mockFoods: [USDAFoodDTO]?\n\n    /// \uc5d0\ub7ec \uc2dc\ubbac\ub808\uc774\uc158\n    var shouldThrowError: Error?\n\n    /// \uac80\uc0c9 \uba54\uc11c\ub4dc Mock\n    func searchFoods(\n        query: String,\n        pageSize: Int = Constants.API.USDA.defaultPageSize,\n        pageNumber: Int = 1,\n        dataType: [String]? = nil\n    ) async throws -> USDASearchResponseDTO {\n\n        // \uc5d0\ub7ec \uc2dc\ubbac\ub808\uc774\uc158\n        if let error = shouldThrowError {\n            throw error\n        }\n\n        // Mock \uc751\ub2f5 \ubc18\ud658\n        guard let response = mockSearchResponse else {\n            throw USDAAPIError.noData\n        }\n\n        return response\n    }\n\n    /// \uc0c1\uc138 \uc870\ud68c \uba54\uc11c\ub4dc Mock\n    func getFoodDetail(fdcId: String) async throws -> USDAFoodDTO {\n\n        // \uc5d0\ub7ec \uc2dc\ubbac\ub808\uc774\uc158\n        if let error = shouldThrowError {\n            throw error\n        }\n\n        // Mock \ub370\uc774\ud130 \ubc18\ud658\n        guard let detail = mockFoodDetail else {\n            throw USDAAPIError.notFound\n        }\n\n        return detail\n    }\n\n    /// \uc77c\uad04 \uc870\ud68c \uba54\uc11c\ub4dc Mock\n    func getFoods(fdcIds: [String]) async throws -> [USDAFoodDTO] {\n\n        // \uc5d0\ub7ec \uc2dc\ubbac\ub808\uc774\uc158\n        if let error = shouldThrowError {\n            throw error\n        }\n\n        // Mock \ub370\uc774\ud130 \ubc18\ud658\n        guard let foods = mockFoods else {\n            throw USDAAPIError.noData\n        }\n\n        return foods\n    }\n}\n#endif\n",
        "last_modified": "2026-01-14T22:55:39.261460"
      },
      "task_intent": {
        "title": "005-korean-food-database-integration",
        "description": "Integrate Korean Food & Drug Administration (\uc2dd\uc57d\ucc98) food nutrition database API as primary source, with USDA FoodData Central as fallback for international foods. Prioritize Korean dishes (kimchi jjigae, bibimbap, tteokbokki) that are poorly covered by competitors.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:31.832101",
  "last_updated": "2026-01-13T07:46:24.057393"
}