{
  "file_path": "Bodii/Data/Repositories/ExerciseRecordRepositoryImpl.swift",
  "main_branch_history": [],
  "task_views": {
    "008-exercise-tracking-with-met-calculations": {
      "task_id": "008-exercise-tracking-with-met-calculations",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T11:45:41.765455"
      },
      "worktree_state": {
        "content": "//\n//  ExerciseRecordRepositoryImpl.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-13.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repository \uad6c\ud604\uccb4\n// Repository Pattern\uc740 Clean Architecture\uc5d0\uc11c \ub370\uc774\ud130 \uc18c\uc2a4 \ucd94\uc0c1\ud654\ub97c \ub2f4\ub2f9\n// \ub3c4\uba54\uc778 \uacc4\uce35\uc740 \uc774 \uc778\ud130\ud398\uc774\uc2a4\ub9cc \uc54c\uace0, \uc2e4\uc81c \uad6c\ud604 (Core Data, \ub124\ud2b8\uc6cc\ud06c \ub4f1)\uc744 \uc54c \ud544\uc694 \uc5c6\uc74c\n// \ud83d\udca1 Java \ube44\uad50: Spring Data JPA\uc758 Repository \uc778\ud130\ud398\uc774\uc2a4 \uad6c\ud604\uccb4\uc640 \uc720\uc0ac\n\nimport Foundation\n\n// MARK: - ExerciseRecordRepositoryImpl\n\n/// ExerciseRecordRepository\uc758 \uad6c\ud604\uccb4\n///\n/// ## \ucc45\uc784\n/// - ExerciseRecordRepository \ud504\ub85c\ud1a0\ucf5c \uad6c\ud604\n/// - LocalDataSource\uc640 \ub3c4\uba54\uc778 \uacc4\uce35 \uac04 \uc870\uc815\n/// - \ub370\uc774\ud130 \uc18c\uc2a4 \ubcc0\uacbd(Core Data \u2192 \ub124\ud2b8\uc6cc\ud06c)\uc5d0 \ub300\ud55c \uc720\uc5f0\uc131 \uc81c\uacf5\n///\n/// ## \uc758\uc874\uc131\n/// - ExerciseRecordLocalDataSource: Core Data \uc791\uc5c5 \ub2f4\ub2f9\n///\n/// - Example:\n/// ```swift\n/// let context = PersistenceController.shared.viewContext\n/// let dataSource = ExerciseRecordLocalDataSource(context: context)\n/// let repository: ExerciseRecordRepository = ExerciseRecordRepositoryImpl(\n///     localDataSource: dataSource\n/// )\n///\n/// // \uc6b4\ub3d9 \uae30\ub85d \uc0dd\uc131\n/// let record = ExerciseRecord(...)\n/// let created = try await repository.create(record)\n///\n/// // \uc624\ub298 \uc6b4\ub3d9 \uc870\ud68c\n/// let todayRecords = try await repository.fetchByDate(Date(), userId: userId)\n/// ```\nfinal class ExerciseRecordRepositoryImpl: ExerciseRecordRepository {\n\n    // MARK: - Properties\n\n    // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: \uc758\uc874\uc131 \uc8fc\uc785 (Dependency Injection)\n    // \uad6c\uccb4\uc801\uc778 \uad6c\ud604\uccb4\uac00 \uc544\ub2cc \ud504\ub85c\ud1a0\ucf5c\uc5d0 \uc758\uc874\ud558\uc9c0 \uc54a\uace0,\n    // LocalDataSource \ud074\ub798\uc2a4\uc5d0 \uc9c1\uc811 \uc758\uc874 (\ud604\uc7ac\ub294 \ud558\ub098\uc758 \ub370\uc774\ud130 \uc18c\uc2a4\ub9cc \uc0ac\uc6a9)\n    // \ud83d\udca1 \ud5a5\ud6c4 \ud655\uc7a5: RemoteDataSource \ucd94\uac00 \uc2dc \ud504\ub85c\ud1a0\ucf5c\ub85c \ucd94\uc0c1\ud654 \uac00\ub2a5\n    private let localDataSource: ExerciseRecordLocalDataSource\n\n    // MARK: - Initialization\n\n    /// Repository \ucd08\uae30\ud654\n    ///\n    /// - Parameter localDataSource: Core Data \uc791\uc5c5\uc744 \ub2f4\ub2f9\ud558\ub294 \ub85c\uceec \ub370\uc774\ud130 \uc18c\uc2a4\n    init(localDataSource: ExerciseRecordLocalDataSource) {\n        self.localDataSource = localDataSource\n    }\n\n    // MARK: - Create\n\n    /// \uc0c8\ub85c\uc6b4 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter record: \uc0dd\uc131\ud560 \uc6b4\ub3d9 \uae30\ub85d\n    /// - Throws: \ub370\uc774\ud130 \uc800\uc7a5 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc0dd\uc131\ub41c \uc6b4\ub3d9 \uae30\ub85d (\uc800\uc7a5\uc18c\uc5d0\uc11c \ud560\ub2f9\ub41c ID \ud3ec\ud568)\n    func create(_ record: ExerciseRecord) async throws -> ExerciseRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repository\ub294 \ub2e8\uc21c\ud788 DataSource\uc5d0 \uc704\uc784\n        // \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc740 UseCase\uc5d0\uc11c \ucc98\ub9ac\ud558\uace0,\n        // Repository\ub294 \ub370\uc774\ud130 \uc601\uc18d\uc131\ub9cc \ub2f4\ub2f9\n        return try await localDataSource.create(record)\n    }\n\n    // MARK: - Read\n\n    /// ID\ub85c \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - id: \uc6b4\ub3d9 \uae30\ub85d \uace0\uc720 \uc2dd\ubcc4\uc790\n    ///   - userId: \uc0ac\uc6a9\uc790 ID (\uad8c\ud55c \ud655\uc778\uc6a9)\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc870\ud68c\ub41c \uc6b4\ub3d9 \uae30\ub85d, \uc5c6\uc73c\uba74 nil\n    func fetchById(_ id: UUID, userId: UUID) async throws -> ExerciseRecord? {\n        return try await localDataSource.fetchById(id, userId: userId)\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// \ud574\ub2f9 \ub0a0\uc9dc\uc758 00:00:00 ~ 23:59:59 \ubc94\uc704 \ub0b4 \uc6b4\ub3d9 \uae30\ub85d\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\n    /// \uacb0\uacfc\ub294 \uc0dd\uc131 \uc2dc\uac04\uc21c(\ucd5c\uc2e0\uc21c)\uc73c\ub85c \uc815\ub82c\ub429\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchByDate(_ date: Date, userId: UUID) async throws -> [ExerciseRecord] {\n        return try await localDataSource.fetchByDate(date, userId: userId)\n    }\n\n    /// \ub0a0\uc9dc \ubc94\uc704 \ub0b4 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// startDate(00:00:00)\ubd80\ud130 endDate(23:59:59)\uae4c\uc9c0\uc758 \uc6b4\ub3d9 \uae30\ub85d\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\n    /// \uacb0\uacfc\ub294 \ub0a0\uc9dc\uc21c(\ucd5c\uc2e0\uc21c)\uc73c\ub85c \uc815\ub82c\ub429\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - startDate: \uc2dc\uc791 \ub0a0\uc9dc (\ud3ec\ud568)\n    ///   - endDate: \uc885\ub8cc \ub0a0\uc9dc (\ud3ec\ud568)\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchByDateRange(startDate: Date, endDate: Date, userId: UUID) async throws -> [ExerciseRecord] {\n        return try await localDataSource.fetchByDateRange(\n            startDate: startDate,\n            endDate: endDate,\n            userId: userId\n        )\n    }\n\n    /// \uc0ac\uc6a9\uc790\uc758 \ubaa8\ub4e0 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc870\ud68c\ud569\ub2c8\ub2e4.\n    ///\n    /// \uacb0\uacfc\ub294 \ub0a0\uc9dc\uc21c(\ucd5c\uc2e0\uc21c)\uc73c\ub85c \uc815\ub82c\ub429\ub2c8\ub2e4.\n    ///\n    /// - Parameter userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \ubc30\uc5f4 (\uc5c6\uc73c\uba74 \ube48 \ubc30\uc5f4)\n    func fetchAll(userId: UUID) async throws -> [ExerciseRecord] {\n        return try await localDataSource.fetchAll(userId: userId)\n    }\n\n    // MARK: - Update\n\n    /// \uae30\uc874 \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc218\uc815\ud569\ub2c8\ub2e4.\n    ///\n    /// ID\uac00 \uc77c\uce58\ud558\ub294 \uae30\ub85d\uc744 \ucc3e\uc544 \uc81c\uacf5\ub41c \ub370\uc774\ud130\ub85c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\n    /// userId\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc73c\uba74 \uad8c\ud55c \uc5d0\ub7ec\ub97c throw\ud574\uc57c \ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameter record: \uc218\uc815\ud560 \uc6b4\ub3d9 \uae30\ub85d (ID \ud544\uc218)\n    /// - Throws: \uc5c5\ub370\uc774\ud2b8 \uc2e4\ud328 \ub610\ub294 \uad8c\ud55c \uc5c6\uc74c \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc218\uc815\ub41c \uc6b4\ub3d9 \uae30\ub85d\n    func update(_ record: ExerciseRecord) async throws -> ExerciseRecord {\n        return try await localDataSource.update(record)\n    }\n\n    // MARK: - Delete\n\n    /// \uc6b4\ub3d9 \uae30\ub85d\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4.\n    ///\n    /// userId\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc73c\uba74 \uad8c\ud55c \uc5d0\ub7ec\ub97c throw\ud574\uc57c \ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - id: \uc0ad\uc81c\ud560 \uc6b4\ub3d9 \uae30\ub85d ID\n    ///   - userId: \uc0ac\uc6a9\uc790 ID (\uad8c\ud55c \ud655\uc778\uc6a9)\n    /// - Throws: \uc0ad\uc81c \uc2e4\ud328 \ub610\ub294 \uad8c\ud55c \uc5c6\uc74c \uc2dc \uc5d0\ub7ec\n    func delete(id: UUID, userId: UUID) async throws {\n        try await localDataSource.delete(id: id, userId: userId)\n    }\n\n    // MARK: - Utility\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \uc6b4\ub3d9 \uae30\ub85d \uac1c\uc218\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \uc6b4\ub3d9 \uae30\ub85d \uac1c\uc218\n    func count(forDate date: Date, userId: UUID) async throws -> Int {\n        return try await localDataSource.count(forDate: date, userId: userId)\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ucd1d \uc6b4\ub3d9 \uc2dc\uac04(\ubd84)\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \ucd1d \uc6b4\ub3d9 \uc2dc\uac04 (\ubd84)\n    func totalDuration(forDate date: Date, userId: UUID) async throws -> Int32 {\n        return try await localDataSource.totalDuration(forDate: date, userId: userId)\n    }\n\n    /// \ud2b9\uc815 \ub0a0\uc9dc\uc758 \ucd1d \uc18c\ubaa8 \uce7c\ub85c\ub9ac\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.\n    ///\n    /// - Parameters:\n    ///   - date: \uc870\ud68c\ud560 \ub0a0\uc9dc\n    ///   - userId: \uc0ac\uc6a9\uc790 ID\n    /// - Throws: \uc870\ud68c \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\n    /// - Returns: \ucd1d \uc18c\ubaa8 \uce7c\ub85c\ub9ac (kcal)\n    func totalCaloriesBurned(forDate date: Date, userId: UUID) async throws -> Int32 {\n        return try await localDataSource.totalCaloriesBurned(forDate: date, userId: userId)\n    }\n}\n\n// MARK: - Repository Pattern \uc124\uba85\n\n/// ## Repository Pattern\uc774\ub780?\n///\n/// Repository\ub294 \ub370\uc774\ud130 \uc18c\uc2a4\uc640 \ub3c4\uba54\uc778 \uacc4\uce35 \uc0ac\uc774\uc758 \ucd94\uc0c1\ud654 \uacc4\uce35\uc785\ub2c8\ub2e4.\n///\n/// ### \uc5ed\ud560\n/// 1. **\ub370\uc774\ud130 \uc18c\uc2a4 \ucd94\uc0c1\ud654**: \ub3c4\uba54\uc778 \uacc4\uce35\uc740 \ub370\uc774\ud130\uac00 Core Data, API, \ud30c\uc77c \ub4f1 \uc5b4\ub514\uc11c \uc624\ub294\uc9c0 \uc54c \ud544\uc694 \uc5c6\uc74c\n/// 2. **\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ubd84\ub9ac**: \ub370\uc774\ud130 \uc601\uc18d\uc131 \ub85c\uc9c1\uacfc \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ubd84\ub9ac\n/// 3. **\ud14c\uc2a4\ud2b8 \uc6a9\uc774\uc131**: Mock Repository\ub85c \uc27d\uac8c \ud14c\uc2a4\ud2b8 \uac00\ub2a5\n/// 4. **\ud655\uc7a5\uc131**: \ub370\uc774\ud130 \uc18c\uc2a4 \ubcc0\uacbd \uc2dc Repository \uad6c\ud604\uccb4\ub9cc \uad50\uccb4\ud558\uba74 \ub428\n///\n/// ### \uacc4\uce35 \uad6c\uc870\n/// ```\n/// UseCase (Domain)\n///    \u2193 depends on\n/// Repository Protocol (Domain/Interfaces)\n///    \u2191 implements\n/// Repository Implementation (Data)\n///    \u2193 uses\n/// DataSource (Data)\n///    \u2193 uses\n/// Core Data / Network / File System\n/// ```\n///\n/// ### \ud5a5\ud6c4 \ud655\uc7a5 \uc608\uc2dc\n/// ```swift\n/// // \ud604\uc7ac: \ub85c\uceec\ub9cc \uc0ac\uc6a9\n/// class ExerciseRecordRepositoryImpl {\n///     let localDataSource: ExerciseRecordLocalDataSource\n/// }\n///\n/// // \ud5a5\ud6c4: \ub124\ud2b8\uc6cc\ud06c \ub3d9\uae30\ud654 \ucd94\uac00\n/// class ExerciseRecordRepositoryImpl {\n///     let localDataSource: ExerciseRecordLocalDataSource\n///     let remoteDataSource: ExerciseRecordRemoteDataSource\n///\n///     func create(_ record: ExerciseRecord) async throws -> ExerciseRecord {\n///         // 1. \ub85c\uceec\uc5d0 \uc800\uc7a5\n///         let saved = try await localDataSource.create(record)\n///         // 2. \ub124\ud2b8\uc6cc\ud06c\uc5d0 \ub3d9\uae30\ud654 (\ubc31\uadf8\ub77c\uc6b4\ub4dc)\n///         Task { try? await remoteDataSource.sync(saved) }\n///         return saved\n///     }\n/// }\n/// ```\n",
        "last_modified": "2026-01-14T22:54:09.700746"
      },
      "task_intent": {
        "title": "008-exercise-tracking-with-met-calculations",
        "description": "Exercise logging with activity type selection, duration input, and automatic calorie burn calculation using MET (Metabolic Equivalent of Task) values. Track both cardio and strength training with appropriate calculations.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T19:19:05.952026",
  "last_updated": "2026-01-14T11:45:41.788306"
}