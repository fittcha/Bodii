{
  "file_path": "Bodii/Presentation/Features/Sleep/SleepHistoryViewModel.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepHistoryViewModel.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: History List ViewModel Pattern\n// \uc218\uba74 \uae30\ub85d \ud788\uc2a4\ud1a0\ub9ac \ub9ac\uc2a4\ud2b8 \ud45c\uc2dc \ubc0f \ud3b8\uc9d1/\uc0ad\uc81c\ub97c \uc704\ud55c ViewModel\n// \ud83d\udca1 Java \ube44\uad50: Android\uc758 ViewModel\uacfc \uc720\uc0ac\ud558\uc9c0\ub9cc SwiftUI\uc758 @Published \uc0ac\uc6a9\n\nimport Foundation\nimport SwiftUI\nimport Combine\n\n// MARK: - SleepHistoryViewModel\n\n/// \uc218\uba74 \uae30\ub85d \ud788\uc2a4\ud1a0\ub9ac \ub9ac\uc2a4\ud2b8\ub97c \uc704\ud55c ViewModel\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: MVVM Pattern for List View\n/// - \ud788\uc2a4\ud1a0\ub9ac \ub370\uc774\ud130 \ub85c\ub4dc \ubc0f \uad00\ub9ac\n/// - \ub808\ucf54\ub4dc \uc0ad\uc81c \uae30\ub2a5\n/// - \ub808\ucf54\ub4dc \ud3b8\uc9d1 \ud2b8\ub9ac\uac70\n/// - \uc870\ud68c \ubaa8\ub4dc \ubcc0\uacbd (\uc804\uccb4, \ucd5c\uadfc N\uc77c, \ub0a0\uc9dc \ubc94\uc704)\n/// - \ube48 \uc0c1\ud0dc \ubc0f \ub85c\ub529 \uc0c1\ud0dc \ucc98\ub9ac\n/// \ud83d\udca1 Java \ube44\uad50: Android ViewModel + LiveData<List> \ud328\ud134\n@MainActor\nclass SleepHistoryViewModel: ObservableObject {\n\n    // MARK: - Published Properties (View State)\n\n    /// \ud788\uc2a4\ud1a0\ub9ac \ub370\uc774\ud130 \ucd9c\ub825\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional State\n    /// - nil\uc774\uba74 \uc544\uc9c1 \ub370\uc774\ud130 \ub85c\ub4dc \uc548 \ub428\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \ub9ac\uc2a4\ud2b8\uc5d0 \ud45c\uc2dc\n    /// \ud83d\udca1 Java \ube44\uad50: LiveData<HistoryOutput?>\uc640 \uc720\uc0ac\n    @Published var historyOutput: FetchSleepHistoryUseCase.Output?\n\n    /// \ub85c\ub529 \uc0c1\ud0dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Loading State\n    /// - \ub370\uc774\ud130 \uc870\ud68c \uc911 \ub85c\ub529 \uc778\ub514\ucf00\uc774\ud130 \ud45c\uc2dc\n    /// - \uc0ad\uc81c \uc791\uc5c5 \uc911\uc5d0\ub3c4 true\n    @Published var isLoading: Bool = false\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error State\n    /// - nil\uc774\uba74 \uc5d0\ub7ec \uc5c6\uc74c\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \ud45c\uc2dc (Alert \ub4f1)\n    @Published var errorMessage: String?\n\n    /// \uc131\uacf5 \uba54\uc2dc\uc9c0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Success Feedback\n    /// - \uc0ad\uc81c \uc131\uacf5 \uc2dc \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud53c\ub4dc\ubc31 \uc81c\uacf5\n    @Published var successMessage: String?\n\n    /// \uc120\ud0dd\ub41c \uc870\ud68c \ubaa8\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Query Mode State\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc120\ud0dd\ud55c \uc870\ud68c \ubaa8\ub4dc\n    /// - \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    /// \ud83d\udca1 Java \ube44\uad50: LiveData<QueryMode>\uc640 \uc720\uc0ac\n    @Published var selectedMode: FetchSleepHistoryUseCase.QueryMode = .recent(days: 30)\n\n    /// \ud3b8\uc9d1\ud560 \ub808\ucf54\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sheet Trigger State\n    /// - nil\uc774\uba74 \ud3b8\uc9d1 \uc2dc\ud2b8 \ub2eb\ud798\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \ud3b8\uc9d1 \uc2dc\ud2b8 \uc5f4\ub9bc\n    /// - SwiftUI\uc758 .sheet(item:) \ubc14\uc778\ub529\uc5d0 \uc0ac\uc6a9\n    @Published var recordToEdit: SleepRecord?\n\n    /// \uc0ad\uc81c \ud655\uc778 \ub300\ud654\uc0c1\uc790 \ud45c\uc2dc \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Confirmation Dialog State\n    /// - \uc0ad\uc81c \uc804 \uc0ac\uc6a9\uc790 \ud655\uc778 \ubc1b\uae30\n    @Published var showDeleteConfirmation: Bool = false\n\n    /// \uc0ad\uc81c\ud560 \ub808\ucf54\ub4dc ID\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Pending Action State\n    /// - \uc0ad\uc81c \ud655\uc778 \ub300\uae30 \uc911\uc778 \ub808\ucf54\ub4dc\n    private var recordIdToDelete: UUID?\n\n    // MARK: - Private Properties\n\n    /// \uc218\uba74 \ud788\uc2a4\ud1a0\ub9ac \uc870\ud68c Use Case\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// - Use Case\ub97c \uc678\ubd80\uc5d0\uc11c \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9\n    /// - \ud14c\uc2a4\ud2b8 \uc2dc Mock\uc73c\ub85c \uad50\uccb4 \uac00\ub2a5\n    private let fetchSleepHistoryUseCase: FetchSleepHistoryUseCase\n\n    /// \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repository Pattern\n    /// - \uc0ad\uc81c \ubc0f \uc5c5\ub370\uc774\ud2b8 \uc791\uc5c5\uc744 \uc704\ud574 \ud544\uc694\n    /// - Protocol\uc744 \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9\n    private let sleepRepository: SleepRepositoryProtocol\n\n    /// Combine \uad6c\ub3c5 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reactive Programming\n    /// - selectedMode \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    /// - \uba54\ubaa8\ub9ac \ub204\uc218 \ubc29\uc9c0\ub97c \uc704\ud55c \uad6c\ub3c5 \uad00\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: RxJava\uc758 CompositeDisposable\uacfc \uc720\uc0ac\n    private var cancellables = Set<AnyCancellable>()\n\n    // MARK: - Initialization\n\n    /// SleepHistoryViewModel \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection via Constructor\n    /// - \ubaa8\ub4e0 \uc758\uc874\uc131\uc744 \uc0dd\uc131\uc790\ub97c \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc74c\n    /// - \uc758\uc874\uc131 \uc5ed\uc804 \uc6d0\uce59 (Dependency Inversion Principle) \uc900\uc218\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject constructor\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - fetchSleepHistoryUseCase: \uc218\uba74 \ud788\uc2a4\ud1a0\ub9ac \uc870\ud68c Use Case\n    ///   - sleepRepository: \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    ///   - defaultMode: \uae30\ubcf8 \uc870\ud68c \ubaa8\ub4dc (\uae30\ubcf8\uac12: \ucd5c\uadfc 30\uc77c)\n    init(\n        fetchSleepHistoryUseCase: FetchSleepHistoryUseCase,\n        sleepRepository: SleepRepositoryProtocol,\n        defaultMode: FetchSleepHistoryUseCase.QueryMode = .recent(days: 30)\n    ) {\n        self.fetchSleepHistoryUseCase = fetchSleepHistoryUseCase\n        self.sleepRepository = sleepRepository\n        self.selectedMode = defaultMode\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reactive State Observation\n        // selectedMode \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n        setupModeObserver()\n\n        // \ucd08\uae30 \ub370\uc774\ud130 \ub85c\ub4dc\n        Task {\n            await loadHistory()\n        }\n    }\n\n    // MARK: - Computed Properties\n\n    /// \ub370\uc774\ud130\uac00 \ube44\uc5b4\uc788\ub294\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property for Empty State\n    /// - View\uc5d0\uc11c empty state UI \ud45c\uc2dc \uc5ec\ubd80 \uacb0\uc815\n    var isEmpty: Bool {\n        historyOutput?.isEmpty ?? true\n    }\n\n    /// \ub370\uc774\ud130 \uac1c\uc218\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Quick Access Property\n    /// - UI\uc5d0\uc11c \ubc14\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud3b8\uc758 \uc18d\uc131\n    var recordCount: Int {\n        historyOutput?.count ?? 0\n    }\n\n    /// \uc218\uba74 \uae30\ub85d \ubc30\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Property\n    /// - View\uc5d0\uc11c \uc9c1\uc811 \uc811\uadfc \uac00\ub2a5\ud55c \ub808\ucf54\ub4dc \ubc30\uc5f4\n    /// - List\uc5d0 \ubc14\ub85c \uc0ac\uc6a9 \uac00\ub2a5\n    var records: [SleepRecord] {\n        historyOutput?.records ?? []\n    }\n\n    /// \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UI Helper Property\n    /// - \ud1b5\uacc4 \ud45c\uc2dc\ub97c \uc704\ud55c \ud3ec\ub9f7\ud305\ub41c \ubb38\uc790\uc5f4\n    var averageDurationString: String {\n        guard let avg = historyOutput?.averageDurationFormatted else {\n            return \"-\"\n        }\n        if avg.minutes == 0 {\n            return \"\\(avg.hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(avg.hours)\uc2dc\uac04 \\(avg.minutes)\ubd84\"\n        }\n    }\n\n    /// \uac00\uc7a5 \ub9ce\uc740 \uc218\uba74 \uc0c1\ud0dc \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Statistics Display\n    /// - \uc0ac\uc6a9\uc790\uc758 \uc8fc\ub41c \uc218\uba74 \ud328\ud134 \ud45c\uc2dc\n    var mostCommonStatusString: String {\n        guard let status = historyOutput?.mostCommonStatus else {\n            return \"-\"\n        }\n        return status.displayName\n    }\n\n    // MARK: - Public Methods\n\n    /// \ud788\uc2a4\ud1a0\ub9ac \ub370\uc774\ud130 \ub85c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async Data Loading\n    /// - Use Case\ub97c \ud638\ucd9c\ud558\uc5ec \ub370\uc774\ud130 \uc870\ud68c\n    /// - \ub85c\ub529 \uc0c1\ud0dc \ubc0f \uc5d0\ub7ec \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: Kotlin Coroutines\uc758 suspend function\uacfc \uc720\uc0ac\n    func loadHistory() async {\n        isLoading = true\n        errorMessage = nil\n\n        do {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Use Case Execution\n            // \uc120\ud0dd\ub41c \ubaa8\ub4dc\uc5d0 \ub530\ub77c \ub370\uc774\ud130 \uc870\ud68c\n            let input = FetchSleepHistoryUseCase.Input(mode: selectedMode)\n            historyOutput = try await fetchSleepHistoryUseCase.execute(input: input)\n\n        } catch let error as FetchSleepHistoryUseCase.HistoryError {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Specific Error Handling\n            // Use Case\uc758 \ub3c4\uba54\uc778 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801 \uba54\uc2dc\uc9c0\ub85c \ubcc0\ud658\n            errorMessage = error.localizedDescription\n            historyOutput = nil\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Generic Error Handling\n            errorMessage = \"\ud788\uc2a4\ud1a0\ub9ac \ub85c\ub4dc \uc2e4\ud328: \\(error.localizedDescription)\"\n            historyOutput = nil\n        }\n\n        isLoading = false\n    }\n\n    /// \uc870\ud68c \ubaa8\ub4dc \ubcc0\uacbd\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Update Method\n    /// - \ubaa8\ub4dc \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc (observer\ub97c \ud1b5\ud574)\n    ///\n    /// - Parameter mode: \uc0c8\ub85c\uc6b4 \uc870\ud68c \ubaa8\ub4dc\n    func changeMode(to mode: FetchSleepHistoryUseCase.QueryMode) {\n        selectedMode = mode\n    }\n\n    /// \uc0c8\ub85c\uace0\uce68\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manual Refresh\n    /// - Pull-to-refresh \ub4f1\uc5d0\uc11c \uc0ac\uc6a9\n    /// - \ud604\uc7ac \ubaa8\ub4dc\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    func refresh() async {\n        await loadHistory()\n    }\n\n    /// \ub808\ucf54\ub4dc \ud3b8\uc9d1 \uc2dc\ud2b8 \ud45c\uc2dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sheet Trigger Method\n    /// - recordToEdit\ub97c \uc124\uc815\ud558\uc5ec \ud3b8\uc9d1 \uc2dc\ud2b8 \ud2b8\ub9ac\uac70\n    /// - View\uc5d0\uc11c .sheet(item: $viewModel.recordToEdit) \uc0ac\uc6a9\n    ///\n    /// - Parameter record: \ud3b8\uc9d1\ud560 \uc218\uba74 \uae30\ub85d\n    func editRecord(_ record: SleepRecord) {\n        recordToEdit = record\n    }\n\n    /// \ub808\ucf54\ub4dc \ud3b8\uc9d1 \uc644\ub8cc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Completion Handler\n    /// - \ud3b8\uc9d1 \uc644\ub8cc \ud6c4 \uc2dc\ud2b8\ub97c \ub2eb\uace0 \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    func didFinishEditing() {\n        recordToEdit = nil\n        Task {\n            await loadHistory()\n        }\n    }\n\n    /// \ub808\ucf54\ub4dc \uc0ad\uc81c \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Confirmation Dialog Trigger\n    /// - \uc0ad\uc81c \uc804 \uc0ac\uc6a9\uc790 \ud655\uc778 \ubc1b\uae30\n    /// - recordIdToDelete\uc5d0 ID \uc800\uc7a5 \ud6c4 \ub2e4\uc774\uc5bc\ub85c\uadf8 \ud45c\uc2dc\n    ///\n    /// - Parameter record: \uc0ad\uc81c\ud560 \uc218\uba74 \uae30\ub85d\n    func confirmDelete(record: SleepRecord) {\n        recordIdToDelete = record.id\n        showDeleteConfirmation = true\n    }\n\n    /// \ub808\ucf54\ub4dc \uc0ad\uc81c \uc2e4\ud589\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async Delete Operation\n    /// - Repository\ub97c \ud1b5\ud574 \uc0ad\uc81c \uc218\ud589\n    /// - \uc131\uacf5 \uc2dc \ud788\uc2a4\ud1a0\ub9ac \ub2e4\uc2dc \ub85c\ub4dc\n    /// - \uc2e4\ud328 \uc2dc \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \ud45c\uc2dc\n    func deleteRecord() async {\n        guard let recordId = recordIdToDelete else { return }\n\n        isLoading = true\n        errorMessage = nil\n        successMessage = nil\n\n        do {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repository Delete Operation\n            // Repository\uc758 delete \uba54\uc11c\ub4dc \ud638\ucd9c\n            // - Core Data\uc5d0\uc11c \ub808\ucf54\ub4dc \uc0ad\uc81c\n            // - \ud574\ub2f9 \ub0a0\uc9dc\uc758 DailyLog \uc5c5\ub370\uc774\ud2b8\n            try await sleepRepository.delete(by: recordId)\n\n            // \uc131\uacf5 \uba54\uc2dc\uc9c0\n            successMessage = \"\uc218\uba74 \uae30\ub85d\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\"\n\n            // \ud788\uc2a4\ud1a0\ub9ac \ub2e4\uc2dc \ub85c\ub4dc\n            await loadHistory()\n\n        } catch let error as RepositoryError {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Repository Error Handling\n            switch error {\n            case .notFound:\n                errorMessage = \"\uc0ad\uc81c\ud560 \uc218\uba74 \uae30\ub85d\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\"\n            case .deleteFailed(let message):\n                errorMessage = \"\uc0ad\uc81c \uc2e4\ud328: \\(message)\"\n            default:\n                errorMessage = \"\uc0ad\uc81c \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.\"\n            }\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Generic Error Handling\n            errorMessage = \"\uc0ad\uc81c \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: \\(error.localizedDescription)\"\n        }\n\n        isLoading = false\n        recordIdToDelete = nil\n        showDeleteConfirmation = false\n    }\n\n    /// \uc0ad\uc81c \ucde8\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Cancel Action\n    /// - \ud655\uc778 \ub300\ud654\uc0c1\uc790\uc5d0\uc11c \ucde8\uc18c \ubc84\ud2bc \ub204\ub97c \ub54c\n    func cancelDelete() {\n        recordIdToDelete = nil\n        showDeleteConfirmation = false\n    }\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uac70\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Cleanup\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc5d0\ub7ec \ud655\uc778 \ud6c4 \ud638\ucd9c\n    func clearError() {\n        errorMessage = nil\n    }\n\n    /// \uc131\uacf5 \uba54\uc2dc\uc9c0 \uc81c\uac70\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Cleanup\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc131\uacf5 \uba54\uc2dc\uc9c0 \ud655\uc778 \ud6c4 \ud638\ucd9c\n    func clearSuccess() {\n        successMessage = nil\n    }\n\n    // MARK: - Private Methods\n\n    /// \uc870\ud68c \ubaa8\ub4dc \ubcc0\uacbd \uac10\uc9c0 \uc124\uc815\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Combine Publisher Observation\n    /// - @Published \ud504\ub85c\ud37c\ud2f0 \ubcc0\uacbd\uc744 \uac10\uc9c0\ud558\uc5ec \uc790\ub3d9 \ub3d9\uc791 \uc2e4\ud589\n    /// - debounce\ub85c \uc5f0\uc18d \ubcc0\uacbd \uc2dc \ub9c8\uc9c0\ub9c9\ub9cc \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: RxJava\uc758 Observable.debounce()\uc640 \uc720\uc0ac\n    private func setupModeObserver() {\n        // selectedMode \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n        $selectedMode\n            .dropFirst() // \ucd08\uae30\uac12 \ubb34\uc2dc\n            .debounce(for: .milliseconds(300), scheduler: DispatchQueue.main) // 300ms \ub51c\ub808\uc774\n            .sink { [weak self] _ in\n                guard let self = self else { return }\n                Task {\n                    await self.loadHistory()\n                }\n            }\n            .store(in: &cancellables)\n    }\n\n    // MARK: - Helper Methods\n\n    /// \ub0a0\uc9dc \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Formatting Helper\n    /// - \uc77c\uad00\ub41c \ub0a0\uc9dc \ud45c\uc2dc\ub97c \uc704\ud55c \ud5ec\ud37c \uba54\uc11c\ub4dc\n    ///\n    /// - Parameters:\n    ///   - date: \ud3ec\ub9f7\ud560 \ub0a0\uc9dc\n    ///   - style: \ub0a0\uc9dc \uc2a4\ud0c0\uc77c (\uae30\ubcf8\uac12: .medium)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4\n    func formatDate(_ date: Date, style: DateFormatter.Style = .medium) -> String {\n        let formatter = DateFormatter()\n        formatter.dateStyle = style\n        formatter.timeStyle = .none\n        formatter.locale = Locale(identifier: \"ko_KR\")\n        return formatter.string(from: date)\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Duration Formatting Helper\n    /// - \ubd84 \ub2e8\uc704\ub97c \uc2dc\uac04:\ubd84 \ud615\uc2dd\uc73c\ub85c \ubcc0\ud658\n    ///\n    /// - Parameter minutes: \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"7\uc2dc\uac04 30\ubd84\")\n    func formatDuration(_ minutes: Int32) -> String {\n        let hours = Int(minutes) / 60\n        let mins = Int(minutes) % 60\n        if mins == 0 {\n            return \"\\(hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(hours)\uc2dc\uac04 \\(mins)\ubd84\"\n        }\n    }\n}\n\n// MARK: - Preview Support\n\n#if DEBUG\nextension SleepHistoryViewModel {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview Helper\n    /// SwiftUI Preview\ub97c \uc704\ud55c Mock ViewModel\n    /// \ud83d\udca1 Java \ube44\uad50: Test fixture\uc640 \uc720\uc0ac\n    static func makePreview() -> SleepHistoryViewModel {\n        // Mock Repository\uc640 Use Case \ud544\uc694 (\uc2e4\uc81c\ub85c\ub294 DIContainer\uc5d0\uc11c \uc8fc\uc785)\n        fatalError(\"Preview support not yet implemented. Use DIContainer.shared.makeSleepHistoryViewModel() instead.\")\n    }\n\n    /// \uc0d8\ud50c \ub370\uc774\ud130\uac00 \uc788\ub294 ViewModel\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sample Data for Preview\n    /// - \ub9ac\uc2a4\ud2b8 \ubbf8\ub9ac\ubcf4\uae30\ub97c \uc704\ud55c \uc0d8\ud50c \ub370\uc774\ud130 \ud3ec\ud568\n    static func makePreviewWithData(\n        fetchSleepHistoryUseCase: FetchSleepHistoryUseCase,\n        sleepRepository: SleepRepositoryProtocol\n    ) -> SleepHistoryViewModel {\n        let viewModel = SleepHistoryViewModel(\n            fetchSleepHistoryUseCase: fetchSleepHistoryUseCase,\n            sleepRepository: sleepRepository\n        )\n\n        // \uc0d8\ud50c \ub370\uc774\ud130 \uc124\uc815\n        viewModel.historyOutput = FetchSleepHistoryUseCase.sampleOutput()\n\n        return viewModel\n    }\n}\n#endif\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepHistoryViewModel \uc774\ud574\n///\n/// SleepHistoryViewModel\uc758 \uc5ed\ud560:\n/// - \uc218\uba74 \uae30\ub85d \ud788\uc2a4\ud1a0\ub9ac \ub9ac\uc2a4\ud2b8 \uad00\ub9ac\n/// - \uc870\ud68c \ubaa8\ub4dc \ubcc0\uacbd (\uc804\uccb4, \ucd5c\uadfc N\uc77c, \ub0a0\uc9dc \ubc94\uc704)\n/// - \ub808\ucf54\ub4dc \uc0ad\uc81c \uae30\ub2a5\n/// - \ub808\ucf54\ub4dc \ud3b8\uc9d1 \ud2b8\ub9ac\uac70\n/// - \ube48 \uc0c1\ud0dc \ubc0f \ub85c\ub529 \uc0c1\ud0dc \ucc98\ub9ac\n/// - \ud1b5\uacc4 \uc815\ubcf4 \uc81c\uacf5 (\ud3c9\uade0 \uc218\uba74 \uc2dc\uac04, \uac00\uc7a5 \ub9ce\uc740 \uc0c1\ud0dc \ub4f1)\n///\n/// MVVM \ud328\ud134\uc5d0\uc11c\uc758 \uc704\uce58:\n/// - Model: Domain entities (SleepRecord, SleepStatus)\n/// - View: SwiftUI Views (SleepHistoryView, SleepRecordRow)\n/// - ViewModel: \uc774 \ud074\ub798\uc2a4 (SleepHistoryViewModel)\n///\n/// \uc0c1\ud0dc \uad00\ub9ac:\n/// - historyOutput: \uc870\ud68c\ub41c \ud788\uc2a4\ud1a0\ub9ac \ub370\uc774\ud130\n/// - selectedMode: \uc0ac\uc6a9\uc790\uac00 \uc120\ud0dd\ud55c \uc870\ud68c \ubaa8\ub4dc\n/// - isLoading: \ub85c\ub529 \uc911 \uc0c1\ud0dc\n/// - errorMessage/successMessage: \uc0ac\uc6a9\uc790 \ud53c\ub4dc\ubc31\n/// - recordToEdit: \ud3b8\uc9d1\ud560 \ub808\ucf54\ub4dc (\uc2dc\ud2b8 \ud2b8\ub9ac\uac70)\n/// - showDeleteConfirmation: \uc0ad\uc81c \ud655\uc778 \ub300\ud654\uc0c1\uc790 \ud45c\uc2dc \uc5ec\ubd80\n///\n/// \ube44\uc988\ub2c8\uc2a4 \ud50c\ub85c\uc6b0:\n/// 1. ViewModel \ucd08\uae30\ud654 \uc2dc \uc790\ub3d9\uc73c\ub85c \ud788\uc2a4\ud1a0\ub9ac \ub85c\ub4dc\n/// 2. \uc0ac\uc6a9\uc790\uac00 \uc870\ud68c \ubaa8\ub4dc \ubcc0\uacbd (\uc804\uccb4/\ucd5c\uadfc 7\uc77c/30\uc77c/90\uc77c)\n/// 3. selectedMode \ubcc0\uacbd \uac10\uc9c0 \u2192 \uc790\ub3d9\uc73c\ub85c loadHistory() \ud638\ucd9c\n/// 4. Use Case\ub97c \ud1b5\ud574 \ub370\uc774\ud130 \uc870\ud68c\n/// 5. historyOutput \uc5c5\ub370\uc774\ud2b8 \u2192 View \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8\n///\n/// \uc0ad\uc81c \ud50c\ub85c\uc6b0:\n/// 1. \uc0ac\uc6a9\uc790\uac00 \ub808\ucf54\ub4dc\ub97c swipe\ud558\uc5ec \uc0ad\uc81c \ubc84\ud2bc \ud074\ub9ad\n/// 2. confirmDelete() \ud638\ucd9c \u2192 showDeleteConfirmation = true\n/// 3. \ud655\uc778 \ub300\ud654\uc0c1\uc790 \ud45c\uc2dc\n/// 4. \uc0ac\uc6a9\uc790\uac00 \"\uc0ad\uc81c\" \uc120\ud0dd \u2192 deleteRecord() \ud638\ucd9c\n/// 5. Repository\ub97c \ud1b5\ud574 \ub808\ucf54\ub4dc \uc0ad\uc81c\n/// 6. \uc131\uacf5 \uc2dc \ud788\uc2a4\ud1a0\ub9ac \ub2e4\uc2dc \ub85c\ub4dc\n///\n/// \ud3b8\uc9d1 \ud50c\ub85c\uc6b0:\n/// 1. \uc0ac\uc6a9\uc790\uac00 \ub808\ucf54\ub4dc\ub97c \ud0ed\ud558\uc5ec \ud3b8\uc9d1\n/// 2. editRecord() \ud638\ucd9c \u2192 recordToEdit \uc124\uc815\n/// 3. View\uc5d0\uc11c .sheet(item: $viewModel.recordToEdit) \ud2b8\ub9ac\uac70\n/// 4. SleepInputSheet \ud45c\uc2dc (\ud3b8\uc9d1 \ubaa8\ub4dc)\n/// 5. \ud3b8\uc9d1 \uc644\ub8cc \u2192 didFinishEditing() \ud638\ucd9c\n/// 6. recordToEdit = nil \u2192 \uc2dc\ud2b8 \ub2eb\ud798\n/// 7. \ud788\uc2a4\ud1a0\ub9ac \ub2e4\uc2dc \ub85c\ub4dc\n///\n/// \uc758\uc874\uc131:\n/// - FetchSleepHistoryUseCase: \ud788\uc2a4\ud1a0\ub9ac \ub370\uc774\ud130 \uc870\ud68c\n/// - SleepRepositoryProtocol: \uc0ad\uc81c/\uc5c5\ub370\uc774\ud2b8 \uc791\uc5c5\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// struct SleepHistoryView: View {\n///     @StateObject private var viewModel: SleepHistoryViewModel\n///\n///     var body: some View {\n///         List {\n///             // \ud1b5\uacc4 \uc139\uc158\n///             Section(\"\ud1b5\uacc4\") {\n///                 HStack {\n///                     Text(\"\ud3c9\uade0 \uc218\uba74 \uc2dc\uac04\")\n///                     Spacer()\n///                     Text(viewModel.averageDurationString)\n///                 }\n///                 HStack {\n///                     Text(\"\uac00\uc7a5 \ub9ce\uc740 \uc0c1\ud0dc\")\n///                     Spacer()\n///                     Text(viewModel.mostCommonStatusString)\n///                 }\n///             }\n///\n///             // \ub808\ucf54\ub4dc \ub9ac\uc2a4\ud2b8\n///             Section(\"\uc218\uba74 \uae30\ub85d\") {\n///                 if viewModel.isEmpty {\n///                     Text(\"\uc218\uba74 \uae30\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.\")\n///                         .foregroundColor(.secondary)\n///                 } else {\n///                     ForEach(viewModel.records) { record in\n///                         SleepRecordRow(record: record)\n///                             .onTapGesture {\n///                                 viewModel.editRecord(record)\n///                             }\n///                             .swipeActions(edge: .trailing) {\n///                                 Button(role: .destructive) {\n///                                     viewModel.confirmDelete(record: record)\n///                                 } label: {\n///                                     Label(\"\uc0ad\uc81c\", systemImage: \"trash\")\n///                                 }\n///                             }\n///                     }\n///                 }\n///             }\n///         }\n///         .refreshable {\n///             await viewModel.refresh()\n///         }\n///         .sheet(item: $viewModel.recordToEdit) { record in\n///             SleepInputSheet(\n///                 viewModel: makeSleepInputViewModel(for: record),\n///                 onComplete: { viewModel.didFinishEditing() }\n///             )\n///         }\n///         .confirmationDialog(\n///             \"\uc218\uba74 \uae30\ub85d\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\",\n///             isPresented: $viewModel.showDeleteConfirmation\n///         ) {\n///             Button(\"\uc0ad\uc81c\", role: .destructive) {\n///                 Task { await viewModel.deleteRecord() }\n///             }\n///             Button(\"\ucde8\uc18c\", role: .cancel) {\n///                 viewModel.cancelDelete()\n///             }\n///         }\n///         .alert(\"\uc5d0\ub7ec\", isPresented: .constant(viewModel.errorMessage != nil)) {\n///             Button(\"\ud655\uc778\") { viewModel.clearError() }\n///         } message: {\n///             Text(viewModel.errorMessage ?? \"\")\n///         }\n///     }\n/// }\n/// ```\n///\n/// \ud83d\udca1 Android ViewModel\uacfc\uc758 \ube44\uad50:\n/// - Android: ViewModel + LiveData<List<SleepRecord>>\n/// - SwiftUI: ObservableObject + @Published\n/// - Android: viewModelScope.launch\ub85c \ube44\ub3d9\uae30 \uc791\uc5c5\n/// - SwiftUI: Task { await ... } with @MainActor\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - \uc0ad\uc81c\ub294 \ud655\uc778 \ub300\ud654\uc0c1\uc790\ub97c \ud1b5\ud574 \uc0ac\uc6a9\uc790 \ud655\uc778 \ubc1b\uae30\n/// - \ud3b8\uc9d1\uc740 .sheet(item:) \ubc14\uc778\ub529\uc73c\ub85c \uc790\ub3d9 \uad00\ub9ac\n/// - selectedMode \ubcc0\uacbd \uc2dc \uc790\ub3d9 \ub9ac\ub85c\ub4dc\ub85c UX \ud5a5\uc0c1\n/// - \ud1b5\uacc4 \uc815\ubcf4\ub97c computed property\ub85c \uc81c\uacf5\ud558\uc5ec View \uac04\uc18c\ud654\n/// - Pull-to-refresh\ub85c \uc218\ub3d9 \uc0c8\ub85c\uace0\uce68 \uc9c0\uc6d0\n///\n/// FetchSleepHistoryUseCase\uc640\uc758 \ud611\ub825:\n/// - ViewModel: UI \uc0c1\ud0dc \uad00\ub9ac \ubc0f \uc0ac\uc6a9\uc790 \uc561\uc158 \ucc98\ub9ac\n/// - Use Case: \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 (\ub370\uc774\ud130 \uc870\ud68c, \ud1b5\uacc4 \uacc4\uc0b0)\n/// - ViewModel\uc740 Use Case\uc758 \uacb0\uacfc\ub9cc \ubc1b\uc544\uc11c UI \uc5c5\ub370\uc774\ud2b8\n///\n/// SleepRepository\uc640\uc758 \ud611\ub825:\n/// - ViewModel: \uc0ad\uc81c/\uc5c5\ub370\uc774\ud2b8 \uc694\uccad\n/// - Repository: \uc2e4\uc81c \ub370\uc774\ud130 \uc791\uc5c5 \uc218\ud589\n/// - Repository\ub294 DailyLog \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8\ub3c4 \ucc98\ub9ac\n///\n",
        "last_modified": "2026-01-18T17:07:01.344755"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:05.204272",
  "last_updated": "2026-01-14T21:03:40.685011"
}