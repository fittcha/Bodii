{
  "file_path": "Bodii/Presentation/Features/Sleep/SleepTrendsViewModel.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepTrendsViewModel.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart-Focused ViewModel Pattern\n// \uc218\uba74 \ucc28\ud2b8 \ub370\uc774\ud130 \uad00\ub9ac\uc640 \uae30\uac04 \uc120\ud0dd\uc744 \uc704\ud55c ViewModel\n// \ud83d\udca1 Java \ube44\uad50: Android\uc758 ViewModel\uacfc \uc720\uc0ac\ud558\uc9c0\ub9cc \ucc28\ud2b8 \uc804\uc6a9 \uc0c1\ud0dc \uad00\ub9ac\n\nimport Foundation\nimport SwiftUI\nimport Combine\n\n// MARK: - SleepTrendsViewModel\n\n/// \uc218\uba74 \ud2b8\ub80c\ub4dc \ucc28\ud2b8\ub97c \uc704\ud55c ViewModel\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart Data Management\n/// - \ucc28\ud2b8 \ud45c\uc2dc\ub97c \uc704\ud55c \uc218\uba74 \ud1b5\uacc4 \ub370\uc774\ud130 \uad00\ub9ac\n/// - \uae30\uac04 \uc120\ud0dd \ubc0f \ub124\ube44\uac8c\uc774\uc158 \ucc98\ub9ac\n/// - \ube48 \uc0c1\ud0dc \ubc0f \ub85c\ub529 \uc0c1\ud0dc \uad00\ub9ac\n/// \ud83d\udca1 Java \ube44\uad50: Android ViewModel + Chart data transformation\n@MainActor\nclass SleepTrendsViewModel: ObservableObject {\n\n    // MARK: - Published Properties (View State)\n\n    /// \uc120\ud0dd\ub41c \ud1b5\uacc4 \uae30\uac04\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: User Selection State\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc120\ud0dd\ud55c \uae30\uac04 (7\uc77c/30\uc77c/90\uc77c)\n    /// - \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    /// \ud83d\udca1 Java \ube44\uad50: LiveData<StatsPeriod>\uc640 \uc720\uc0ac\n    @Published var selectedPeriod: FetchSleepStatsUseCase.StatsPeriod = .week\n\n    /// \ud1b5\uacc4 \ub370\uc774\ud130 \ucd9c\ub825\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional State\n    /// - nil\uc774\uba74 \uc544\uc9c1 \ub370\uc774\ud130 \ub85c\ub4dc \uc548 \ub428\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \ucc28\ud2b8\uc5d0 \ud45c\uc2dc\n    @Published var statsOutput: FetchSleepStatsUseCase.Output?\n\n    /// \ub85c\ub529 \uc0c1\ud0dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Loading State\n    /// - \ub370\uc774\ud130 \uc870\ud68c \uc911 \ub85c\ub529 \uc778\ub514\ucf00\uc774\ud130 \ud45c\uc2dc\n    @Published var isLoading: Bool = false\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error State\n    /// - nil\uc774\uba74 \uc5d0\ub7ec \uc5c6\uc74c\n    /// - \uac12\uc774 \uc788\uc73c\uba74 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \ud45c\uc2dc\n    @Published var errorMessage: String?\n\n    /// \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704 \uc0ac\uc6a9 \uc5ec\ubd80\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Advanced Feature Toggle\n    /// - false: StatsPeriod \uc0ac\uc6a9\n    /// - true: customStartDate/customEndDate \uc0ac\uc6a9\n    @Published var useCustomDateRange: Bool = false\n\n    /// \ucee4\uc2a4\ud140 \uc2dc\uc791 \ub0a0\uc9dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Date Range\n    /// - useCustomDateRange\uac00 true\uc77c \ub54c\ub9cc \uc0ac\uc6a9\n    @Published var customStartDate: Date = Calendar.current.date(byAdding: .day, value: -7, to: Date())!\n\n    /// \ucee4\uc2a4\ud140 \uc885\ub8cc \ub0a0\uc9dc\n    @Published var customEndDate: Date = Date()\n\n    // MARK: - Private Properties\n\n    /// \uc218\uba74 \ud1b5\uacc4 \uc870\ud68c Use Case\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// - Use Case\ub97c \uc678\ubd80\uc5d0\uc11c \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9\n    /// - \ud14c\uc2a4\ud2b8 \uc2dc Mock\uc73c\ub85c \uad50\uccb4 \uac00\ub2a5\n    private let fetchSleepStatsUseCase: FetchSleepStatsUseCase\n\n    /// \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Protocol-Oriented Programming\n    /// - \uc9c1\uc811 \uc870\ud68c\uac00 \ud544\uc694\ud55c \uacbd\uc6b0\ub97c \uc704\ud574 Repository\ub3c4 \ubcf4\uc720\n    private let sleepRepository: SleepRepositoryProtocol\n\n    /// Combine \uad6c\ub3c5 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reactive Programming\n    /// - selectedPeriod \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n    /// - \uba54\ubaa8\ub9ac \ub204\uc218 \ubc29\uc9c0\ub97c \uc704\ud55c \uad6c\ub3c5 \uad00\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: RxJava\uc758 CompositeDisposable\uacfc \uc720\uc0ac\n    private var cancellables = Set<AnyCancellable>()\n\n    // MARK: - Initialization\n\n    /// SleepTrendsViewModel \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection via Constructor\n    /// - \ubaa8\ub4e0 \uc758\uc874\uc131\uc744 \uc0dd\uc131\uc790\ub97c \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc74c\n    /// - \uc758\uc874\uc131 \uc5ed\uc804 \uc6d0\uce59 (Dependency Inversion Principle) \uc900\uc218\n    /// \ud83d\udca1 Java \ube44\uad50: @Inject constructor\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - fetchSleepStatsUseCase: \uc218\uba74 \ud1b5\uacc4 \uc870\ud68c Use Case\n    ///   - sleepRepository: \uc218\uba74 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    init(\n        fetchSleepStatsUseCase: FetchSleepStatsUseCase,\n        sleepRepository: SleepRepositoryProtocol\n    ) {\n        self.fetchSleepStatsUseCase = fetchSleepStatsUseCase\n        self.sleepRepository = sleepRepository\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reactive State Observation\n        // selectedPeriod \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n        setupPeriodObserver()\n\n        // \ucd08\uae30 \ub370\uc774\ud130 \ub85c\ub4dc\n        Task {\n            await loadStats()\n        }\n    }\n\n    // MARK: - Computed Properties\n\n    /// \ub370\uc774\ud130\uac00 \ube44\uc5b4\uc788\ub294\uc9c0 \ud655\uc778\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property for Empty State\n    /// - View\uc5d0\uc11c empty state UI \ud45c\uc2dc \uc5ec\ubd80 \uacb0\uc815\n    var isEmpty: Bool {\n        statsOutput?.isEmpty ?? true\n    }\n\n    /// \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uac1c\uc218\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Quick Access Property\n    /// - UI\uc5d0\uc11c \ubc14\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud3b8\uc758 \uc18d\uc131\n    var dataPointCount: Int {\n        statsOutput?.count ?? 0\n    }\n\n    /// \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Property\n    /// - View\uc5d0\uc11c \uc9c1\uc811 \uc811\uadfc \uac00\ub2a5\ud55c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \ubc30\uc5f4\n    var dataPoints: [FetchSleepStatsUseCase.SleepDataPoint] {\n        statsOutput?.dataPoints ?? []\n    }\n\n    /// \uae30\uac04 \ud45c\uc2dc \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UI Helper Property\n    /// - \"2024.01.01 - 2024.01.07\" \ud615\uc2dd\n    var periodDisplayString: String {\n        guard let output = statsOutput else { return \"\" }\n\n        let formatter = DateFormatter()\n        formatter.dateStyle = .short\n        formatter.timeStyle = .none\n        formatter.locale = Locale(identifier: \"ko_KR\")\n\n        let startStr = formatter.string(from: output.startDate)\n        let endStr = formatter.string(from: output.endDate)\n\n        return \"\\(startStr) - \\(endStr)\"\n    }\n\n    /// \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UI Helper Property\n    /// - \ud1b5\uacc4 \ud45c\uc2dc\ub97c \uc704\ud55c \ud3ec\ub9f7\ud305\ub41c \ubb38\uc790\uc5f4\n    var averageDurationString: String {\n        guard let avg = statsOutput?.averageDurationFormatted else {\n            return \"-\"\n        }\n        if avg.minutes == 0 {\n            return \"\\(avg.hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(avg.hours)\uc2dc\uac04 \\(avg.minutes)\ubd84\"\n        }\n    }\n\n    /// \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Quick Access for Chart\n    /// - \ucc28\ud2b8\uc5d0 \ud3c9\uade0\uc120 \ud45c\uc2dc\ud560 \ub54c \uc0ac\uc6a9\n    var averageDurationMinutes: Int32? {\n        statsOutput?.averageDuration\n    }\n\n    /// \uac00\uc7a5 \ub9ce\uc740 \uc218\uba74 \uc0c1\ud0dc \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Statistics Display\n    /// - \uc0ac\uc6a9\uc790\uc758 \uc8fc\ub41c \uc218\uba74 \ud328\ud134 \ud45c\uc2dc\n    var mostCommonStatusString: String {\n        guard let status = statsOutput?.mostCommonStatus else {\n            return \"-\"\n        }\n        return status.displayName\n    }\n\n    /// \uc88b\uc740 \uc218\uba74 \ube44\uc728 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Quality Metric Display\n    /// - \uc218\uba74 \ud488\uc9c8\uc758 \uc804\ubc18\uc801\uc778 \ud3c9\uac00 \uc9c0\ud45c\n    var goodSleepPercentageString: String {\n        guard let output = statsOutput else { return \"-\" }\n        let percentage = output.goodSleepPercentage * 100\n        return String(format: \"%.0f%%\", percentage)\n    }\n\n    /// \uc218\uba74 \uc77c\uad00\uc131 \uc810\uc218 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Consistency Score Display\n    /// - \uc218\uba74 \ud328\ud134\uc758 \uaddc\uce59\uc131 \ud3c9\uac00\n    var consistencyScoreString: String {\n        guard let score = statsOutput?.consistencyScore else {\n            return \"-\"\n        }\n        let percentage = score * 100\n        return String(format: \"%.0f%%\", percentage)\n    }\n\n    /// \uc0c1\ud0dc\ubcc4 \ud1b5\uacc4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Detailed Statistics Access\n    /// - UI\uc5d0\uc11c \uc0c1\ud0dc\ubcc4 \ubd84\ud3ec \ucc28\ud2b8 \uad6c\uc131\uc5d0 \uc0ac\uc6a9\n    var statusStats: [FetchSleepStatsUseCase.StatusStats] {\n        statsOutput?.statusStats ?? []\n    }\n\n    /// \ucd94\uc138 \uc815\ubcf4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Trend Analysis Access\n    /// - \ucd5c\uadfc vs \uc774\uc804 \uae30\uac04 \ube44\uad50\n    var trendInfo: (recent: Int32, previous: Int32, change: Int32)? {\n        statsOutput?.recentTrend()\n    }\n\n    /// \ucd94\uc138 \ubb38\uc790\uc5f4\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Trend Display Helper\n    /// - \"1\uc2dc\uac04 30\ubd84 \uc99d\uac00\" \ub610\ub294 \"30\ubd84 \uac10\uc18c\" \ud615\uc2dd\n    var trendString: String {\n        guard let trend = trendInfo else { return \"-\" }\n\n        let hours = abs(trend.change) / 60\n        let minutes = abs(trend.change) % 60\n        let direction = trend.change >= 0 ? \"\uc99d\uac00\" : \"\uac10\uc18c\"\n\n        if hours == 0 {\n            return \"\\(minutes)\ubd84 \\(direction)\"\n        } else if minutes == 0 {\n            return \"\\(hours)\uc2dc\uac04 \\(direction)\"\n        } else {\n            return \"\\(hours)\uc2dc\uac04 \\(minutes)\ubd84 \\(direction)\"\n        }\n    }\n\n    // MARK: - Public Methods\n\n    /// \ud1b5\uacc4 \ub370\uc774\ud130 \ub85c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async Data Loading\n    /// - Use Case\ub97c \ud638\ucd9c\ud558\uc5ec \ub370\uc774\ud130 \uc870\ud68c\n    /// - \ub85c\ub529 \uc0c1\ud0dc \ubc0f \uc5d0\ub7ec \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: Kotlin Coroutines\uc758 suspend function\uacfc \uc720\uc0ac\n    func loadStats() async {\n        isLoading = true\n        errorMessage = nil\n\n        do {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Conditional Query Strategy\n            // \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704 \uc0ac\uc6a9 \uc5ec\ubd80\uc5d0 \ub530\ub77c \ub2e4\ub978 \uba54\uc11c\ub4dc \ud638\ucd9c\n            if useCustomDateRange {\n                // \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704\ub85c \uc870\ud68c\n                let input = FetchSleepStatsUseCase.Input(\n                    period: selectedPeriod,\n                    endDate: customEndDate\n                )\n                statsOutput = try await fetchSleepStatsUseCase.execute(input: input)\n            } else {\n                // \ud45c\uc900 \uae30\uac04\uc73c\ub85c \uc870\ud68c\n                statsOutput = try await fetchSleepStatsUseCase.execute(period: selectedPeriod)\n            }\n\n        } catch let error as FetchSleepStatsUseCase.StatsError {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Specific Error Handling\n            // Use Case\uc758 \ub3c4\uba54\uc778 \uc5d0\ub7ec\ub97c \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801 \uba54\uc2dc\uc9c0\ub85c \ubcc0\ud658\n            errorMessage = error.localizedDescription\n            statsOutput = nil\n        } catch {\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Generic Error Handling\n            errorMessage = \"\ud1b5\uacc4 \ub370\uc774\ud130 \ub85c\ub4dc \uc2e4\ud328: \\(error.localizedDescription)\"\n            statsOutput = nil\n        }\n\n        isLoading = false\n    }\n\n    /// \uae30\uac04 \ubcc0\uacbd\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Update Method\n    /// - \uae30\uac04 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc (observer\ub97c \ud1b5\ud574)\n    ///\n    /// - Parameter period: \uc0c8\ub85c\uc6b4 \uae30\uac04\n    func changePeriod(to period: FetchSleepStatsUseCase.StatsPeriod) {\n        selectedPeriod = period\n        useCustomDateRange = false\n    }\n\n    /// \uc774\uc804 \uae30\uac04\uc73c\ub85c \uc774\ub3d9\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Range Navigation\n    /// - \ud604\uc7ac \uae30\uac04\ub9cc\ud07c \uacfc\uac70\ub85c \uc774\ub3d9\n    /// - \uc608: 7\uc77c \uae30\uac04\uc774\uba74 7\uc77c \uc804\uc73c\ub85c \uc774\ub3d9\n    func navigateToPreviousPeriod() async {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Calculation\n        // \ud604\uc7ac \uc885\ub8cc \ub0a0\uc9dc\uc5d0\uc11c \uae30\uac04\ub9cc\ud07c \uc774\uc804\uc73c\ub85c \uc774\ub3d9\n        let days = selectedPeriod.days\n\n        if useCustomDateRange {\n            // \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704 \uc0ac\uc6a9 \uc911\n            customEndDate = customStartDate\n            customStartDate = Calendar.current.date(byAdding: .day, value: -days, to: customStartDate) ?? customStartDate\n        } else {\n            // \ud45c\uc900 \uae30\uac04 \uc0ac\uc6a9 \uc911 \u2192 \ucee4\uc2a4\ud140 \ubaa8\ub4dc\ub85c \uc804\ud658\n            useCustomDateRange = true\n            let now = Date()\n            customEndDate = Calendar.current.date(byAdding: .day, value: -days, to: now) ?? now\n            customStartDate = Calendar.current.date(byAdding: .day, value: -days*2, to: now) ?? now\n        }\n\n        await loadStats()\n    }\n\n    /// \ub2e4\uc74c \uae30\uac04\uc73c\ub85c \uc774\ub3d9\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Range Navigation\n    /// - \ud604\uc7ac \uae30\uac04\ub9cc\ud07c \ubbf8\ub798\ub85c \uc774\ub3d9 (\ucd5c\ub300 \ud604\uc7ac\uae4c\uc9c0)\n    func navigateToNextPeriod() async {\n        let days = selectedPeriod.days\n\n        if useCustomDateRange {\n            // \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704 \uc0ac\uc6a9 \uc911\n            let newEndDate = Calendar.current.date(byAdding: .day, value: days, to: customEndDate) ?? customEndDate\n\n            // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Future Date Prevention\n            // \ubbf8\ub798 \ub0a0\uc9dc\ub294 \ud604\uc7ac \ub0a0\uc9dc\ub85c \uc81c\ud55c\n            let now = Date()\n            if newEndDate > now {\n                // \ud604\uc7ac\ub85c \ub9ac\uc14b\n                useCustomDateRange = false\n            } else {\n                customStartDate = customEndDate\n                customEndDate = newEndDate\n            }\n        }\n\n        await loadStats()\n    }\n\n    /// \ud604\uc7ac \ub0a0\uc9dc\ub85c \ub9ac\uc14b\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Reset to Default State\n    /// - \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704\ub97c \ud574\uc81c\ud558\uace0 \ud604\uc7ac \uae30\uc900\uc73c\ub85c \uc870\ud68c\n    func resetToCurrentPeriod() async {\n        useCustomDateRange = false\n        await loadStats()\n    }\n\n    /// \uc0c8\ub85c\uace0\uce68\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Manual Refresh\n    /// - Pull-to-refresh \ub4f1\uc5d0\uc11c \uc0ac\uc6a9\n    func refresh() async {\n        await loadStats()\n    }\n\n    // MARK: - Private Methods\n\n    /// \uae30\uac04 \ubcc0\uacbd \uac10\uc9c0 \uc124\uc815\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Combine Publisher Observation\n    /// - @Published \ud504\ub85c\ud37c\ud2f0 \ubcc0\uacbd\uc744 \uac10\uc9c0\ud558\uc5ec \uc790\ub3d9 \ub3d9\uc791 \uc2e4\ud589\n    /// - debounce\ub85c \uc5f0\uc18d \ubcc0\uacbd \uc2dc \ub9c8\uc9c0\ub9c9\ub9cc \ucc98\ub9ac\n    /// \ud83d\udca1 Java \ube44\uad50: RxJava\uc758 Observable.debounce()\uc640 \uc720\uc0ac\n    private func setupPeriodObserver() {\n        // selectedPeriod \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c \ub370\uc774\ud130 \ub2e4\uc2dc \ub85c\ub4dc\n        $selectedPeriod\n            .dropFirst() // \ucd08\uae30\uac12 \ubb34\uc2dc\n            .debounce(for: .milliseconds(300), scheduler: DispatchQueue.main) // 300ms \ub51c\ub808\uc774\n            .sink { [weak self] _ in\n                guard let self = self else { return }\n                Task {\n                    await self.loadStats()\n                }\n            }\n            .store(in: &cancellables)\n    }\n\n    // MARK: - Helper Methods\n\n    /// \ub0a0\uc9dc \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Formatting Helper\n    /// - \uc77c\uad00\ub41c \ub0a0\uc9dc \ud45c\uc2dc\ub97c \uc704\ud55c \ud5ec\ud37c \uba54\uc11c\ub4dc\n    ///\n    /// - Parameters:\n    ///   - date: \ud3ec\ub9f7\ud560 \ub0a0\uc9dc\n    ///   - style: \ub0a0\uc9dc \uc2a4\ud0c0\uc77c (\uae30\ubcf8\uac12: .medium)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4\n    func formatDate(_ date: Date, style: DateFormatter.Style = .medium) -> String {\n        let formatter = DateFormatter()\n        formatter.dateStyle = style\n        formatter.timeStyle = .none\n        formatter.locale = Locale(identifier: \"ko_KR\")\n        return formatter.string(from: date)\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Duration Formatting Helper\n    /// - \ubd84 \ub2e8\uc704\ub97c \uc2dc\uac04:\ubd84 \ud615\uc2dd\uc73c\ub85c \ubcc0\ud658\n    ///\n    /// - Parameter minutes: \uc218\uba74 \uc2dc\uac04 (\ubd84)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"7\uc2dc\uac04 30\ubd84\")\n    func formatDuration(_ minutes: Int32) -> String {\n        let hours = Int(minutes) / 60\n        let mins = Int(minutes) % 60\n        if mins == 0 {\n            return \"\\(hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(hours)\uc2dc\uac04 \\(mins)\ubd84\"\n        }\n    }\n\n    /// \uc218\uba74 \uc2dc\uac04 \ubcc0\ud654\ub7c9 \ud3ec\ub9f7\ud305\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Change Formatting with Sign\n    /// - \uc591\uc218\ub294 +, \uc74c\uc218\ub294 - \uae30\ud638 \ud3ec\ud568\n    ///\n    /// - Parameter change: \ubcc0\ud654\ub7c9 (\ubd84)\n    /// - Returns: \ud3ec\ub9f7\ub41c \ubb38\uc790\uc5f4 (\uc608: \"+30\ubd84\", \"-1\uc2dc\uac04\")\n    func formatDurationChange(_ change: Int32?) -> String {\n        guard let change = change else { return \"-\" }\n\n        let hours = abs(change) / 60\n        let mins = abs(change) % 60\n        let sign = change >= 0 ? \"+\" : \"-\"\n\n        if hours == 0 {\n            return \"\\(sign)\\(mins)\ubd84\"\n        } else if mins == 0 {\n            return \"\\(sign)\\(hours)\uc2dc\uac04\"\n        } else {\n            return \"\\(sign)\\(hours)\uc2dc\uac04 \\(mins)\ubd84\"\n        }\n    }\n\n    /// \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uac70\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: State Cleanup\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc5d0\ub7ec \ud655\uc778 \ud6c4 \ud638\ucd9c\n    func clearError() {\n        errorMessage = nil\n    }\n}\n\n// MARK: - Preview Support\n\n#if DEBUG\nextension SleepTrendsViewModel {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Preview Helper\n    /// SwiftUI Preview\ub97c \uc704\ud55c Mock ViewModel\n    /// \ud83d\udca1 Java \ube44\uad50: Test fixture\uc640 \uc720\uc0ac\n    static func makePreview() -> SleepTrendsViewModel {\n        // Mock Repository\uc640 Use Case \ud544\uc694 (\uc2e4\uc81c\ub85c\ub294 DIContainer\uc5d0\uc11c \uc8fc\uc785)\n        fatalError(\"Preview support not yet implemented. Use DIContainer.shared.makeSleepTrendsViewModel() instead.\")\n    }\n\n    /// \uc0d8\ud50c \ub370\uc774\ud130\uac00 \uc788\ub294 ViewModel\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sample Data for Preview\n    /// - \ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30\ub97c \uc704\ud55c \uc0d8\ud50c \ub370\uc774\ud130 \ud3ec\ud568\n    static func makePreviewWithData(\n        fetchSleepStatsUseCase: FetchSleepStatsUseCase,\n        sleepRepository: SleepRepositoryProtocol\n    ) -> SleepTrendsViewModel {\n        let viewModel = SleepTrendsViewModel(\n            fetchSleepStatsUseCase: fetchSleepStatsUseCase,\n            sleepRepository: sleepRepository\n        )\n\n        // \uc0d8\ud50c \ub370\uc774\ud130 \uc124\uc815\n        viewModel.statsOutput = FetchSleepStatsUseCase.sampleOutput()\n\n        return viewModel\n    }\n}\n#endif\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Chart ViewModel Pattern \uc774\ud574\n///\n/// SleepTrendsViewModel\uc758 \uc5ed\ud560:\n/// - \ucc28\ud2b8 \ub370\uc774\ud130 \uad00\ub9ac: FetchSleepStatsUseCase\ub97c \ud1b5\ud574 \ud1b5\uacc4 \ub370\uc774\ud130 \uc870\ud68c\n/// - \uae30\uac04 \uc120\ud0dd: 7/30/90\uc77c \uae30\uac04 \ub610\ub294 \ucee4\uc2a4\ud140 \ub0a0\uc9dc \ubc94\uc704\n/// - \ub124\ube44\uac8c\uc774\uc158: \uc774\uc804/\ub2e4\uc74c \uae30\uac04\uc73c\ub85c \uc774\ub3d9\n/// - \ube48 \uc0c1\ud0dc \ucc98\ub9ac: \ub370\uc774\ud130 \uc5c6\uc744 \ub54c empty state \ud45c\uc2dc\n/// - \ub85c\ub529/\uc5d0\ub7ec \ucc98\ub9ac: \ube44\ub3d9\uae30 \uc791\uc5c5\uc758 \uc0c1\ud0dc \uad00\ub9ac\n///\n/// \uc8fc\uc694 \uae30\ub2a5:\n/// 1. \uae30\uac04 \uc120\ud0dd (7/30/90\uc77c)\n/// 2. \ub0a0\uc9dc \ubc94\uc704 \ub124\ube44\uac8c\uc774\uc158 (\uc774\uc804/\ub2e4\uc74c \uae30\uac04)\n/// 3. \ud1b5\uacc4 \uc815\ubcf4 \uc81c\uacf5 (\ud3c9\uade0, \ucd94\uc138, \uc77c\uad00\uc131 \ub4f1)\n/// 4. \uc2e4\uc2dc\uac04 \uc0c1\ud0dc \ubc18\uc601 (@Published)\n/// 5. \uc790\ub3d9 \ub9ac\ub85c\ub4dc (\uae30\uac04 \ubcc0\uacbd \uc2dc)\n///\n/// \ucc28\ud2b8 \ucd5c\uc801\ud654:\n/// - \ub370\uc774\ud130\ub294 \uc774\ubbf8 \ub0a0\uc9dc\uc21c \uc815\ub82c\ub428 (Use Case\uc5d0\uc11c \ucc98\ub9ac)\n/// - \ud1b5\uacc4\ub294 computed properties\ub85c \uc790\ub3d9 \uacc4\uc0b0\ub428\n/// - \ube48 \uc0c1\ud0dc \uccb4\ud06c \uc6a9\uc774 (isEmpty computed property)\n///\n/// \uc0c1\ud0dc \uad00\ub9ac:\n/// - @Published: \uac12 \ubcc0\uacbd \uc2dc \uc790\ub3d9\uc73c\ub85c View \uc5c5\ub370\uc774\ud2b8\n/// - @MainActor: \ubaa8\ub4e0 \uba54\uc11c\ub4dc\uac00 \uba54\uc778 \uc2a4\ub808\ub4dc\uc5d0\uc11c \uc2e4\ud589\n/// - Combine: \uae30\uac04 \ubcc0\uacbd \uac10\uc9c0 \ubc0f \uc790\ub3d9 \ub9ac\ub85c\ub4dc\n///\n/// \uc758\uc874\uc131:\n/// - FetchSleepStatsUseCase: \ud1b5\uacc4 \ub370\uc774\ud130 \uc870\ud68c\n/// - SleepRepositoryProtocol: \uc9c1\uc811 \uc870\ud68c\uac00 \ud544\uc694\ud55c \uacbd\uc6b0\n///\n/// \uc81c\uacf5\ud558\ub294 \ud1b5\uacc4:\n/// - \ud3c9\uade0 \uc218\uba74 \uc2dc\uac04\n/// - \uac00\uc7a5 \ub9ce\uc740 \uc218\uba74 \uc0c1\ud0dc\n/// - \uc88b\uc740 \uc218\uba74 \ube44\uc728\n/// - \uc77c\uad00\uc131 \uc810\uc218\n/// - \ucd94\uc138 \ubd84\uc11d (\ucd5c\uadfc vs \uc774\uc804)\n/// - \uc0c1\ud0dc\ubcc4 \ubd84\ud3ec\n///\n/// SleepHistoryViewModel\uacfc\uc758 \ucc28\uc774:\n/// - SleepHistoryViewModel: \ub9ac\uc2a4\ud2b8 \ud45c\uc2dc \ubc0f \ud3b8\uc9d1/\uc0ad\uc81c\n/// - SleepTrendsViewModel: \ucc28\ud2b8 \ubc0f \ud1b5\uacc4 \ud45c\uc2dc\n/// - SleepHistoryViewModel: \uae30\ubcf8 \ud1b5\uacc4\ub9cc \uc81c\uacf5\n/// - SleepTrendsViewModel: \uace0\uae09 \ud1b5\uacc4 \ubc0f \ucd94\uc138 \ubd84\uc11d \uc81c\uacf5\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// struct SleepTrendsView: View {\n///     @StateObject private var viewModel: SleepTrendsViewModel\n///\n///     var body: some View {\n///         VStack {\n///             // \uae30\uac04 \uc120\ud0dd\uae30\n///             Picker(\"\uae30\uac04\", selection: $viewModel.selectedPeriod) {\n///                 ForEach(FetchSleepStatsUseCase.StatsPeriod.allCases, id: \\.self) { period in\n///                     Text(period.displayName).tag(period)\n///                 }\n///             }\n///             .pickerStyle(.segmented)\n///\n///             // \ud1b5\uacc4 \uc694\uc57d\n///             VStack(alignment: .leading, spacing: 8) {\n///                 HStack {\n///                     Text(\"\ud3c9\uade0 \uc218\uba74\")\n///                     Spacer()\n///                     Text(viewModel.averageDurationString)\n///                 }\n///                 HStack {\n///                     Text(\"\uc88b\uc740 \uc218\uba74 \ube44\uc728\")\n///                     Spacer()\n///                     Text(viewModel.goodSleepPercentageString)\n///                 }\n///                 HStack {\n///                     Text(\"\uc77c\uad00\uc131 \uc810\uc218\")\n///                     Spacer()\n///                     Text(viewModel.consistencyScoreString)\n///                 }\n///             }\n///\n///             // \ucc28\ud2b8\n///             if viewModel.isEmpty {\n///                 Text(\"\ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4\")\n///             } else {\n///                 Chart(viewModel.dataPoints) { dataPoint in\n///                     BarMark(\n///                         x: .value(\"\ub0a0\uc9dc\", dataPoint.date),\n///                         y: .value(\"\uc218\uba74 \uc2dc\uac04\", dataPoint.duration)\n///                     )\n///                     .foregroundStyle(by: .value(\"\uc0c1\ud0dc\", dataPoint.status.displayName))\n///                 }\n///\n///                 // \ud3c9\uade0\uc120 \ud45c\uc2dc\n///                 if let avg = viewModel.averageDurationMinutes {\n///                     RuleMark(y: .value(\"\ud3c9\uade0\", avg))\n///                         .foregroundStyle(.gray)\n///                         .lineStyle(StrokeStyle(lineWidth: 1, dash: [5, 5]))\n///                 }\n///             }\n///\n///             // \ub124\ube44\uac8c\uc774\uc158\n///             HStack {\n///                 Button(\"\uc774\uc804\") {\n///                     Task { await viewModel.navigateToPreviousPeriod() }\n///                 }\n///                 Spacer()\n///                 Text(viewModel.periodDisplayString)\n///                     .font(.caption)\n///                     .foregroundColor(.secondary)\n///                 Spacer()\n///                 Button(\"\ub2e4\uc74c\") {\n///                     Task { await viewModel.navigateToNextPeriod() }\n///                 }\n///             }\n///         }\n///         .overlay {\n///             if viewModel.isLoading {\n///                 ProgressView()\n///             }\n///         }\n///         .refreshable {\n///             await viewModel.refresh()\n///         }\n///     }\n/// }\n/// ```\n///\n/// \ud83d\udca1 Android ViewModel\uacfc\uc758 \ube44\uad50:\n/// - Android: ViewModel + StateFlow + Chart data\n/// - SwiftUI: ObservableObject + @Published + Chart data\n/// - Android: Flow.collect\ub85c \uc0c1\ud0dc \uad00\ucc30\n/// - SwiftUI: Combine sink\ub85c \uc0c1\ud0dc \uad00\ucc30\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - \uae30\uac04 \uc120\ud0dd\uc740 Picker \ub610\ub294 SegmentedControl \uc0ac\uc6a9\n/// - \ucc28\ud2b8\ub294 Swift Charts \uc0ac\uc6a9 (BarMark \ub610\ub294 LineMark)\n/// - \ud3c9\uade0\uc120\uc740 RuleMark\ub85c \ud45c\uc2dc\n/// - \uc0c1\ud0dc\ubcc4 \uc0c9\uc0c1\uc740 SleepStatus.color \uc0ac\uc6a9\n/// - Pull-to-refresh\ub85c \uc218\ub3d9 \uc0c8\ub85c\uace0\uce68 \uc9c0\uc6d0\n/// - \ub124\ube44\uac8c\uc774\uc158\uc73c\ub85c \uacfc\uac70 \ub370\uc774\ud130 \ud0d0\uc0c9 \uac00\ub2a5\n///\n/// FetchSleepStatsUseCase\uc640\uc758 \ud611\ub825:\n/// - ViewModel: UI \uc0c1\ud0dc \uad00\ub9ac \ubc0f \uc0ac\uc6a9\uc790 \uc561\uc158 \ucc98\ub9ac\n/// - Use Case: \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 (\ub370\uc774\ud130 \uc870\ud68c, \ud1b5\uacc4 \uacc4\uc0b0)\n/// - ViewModel\uc740 Use Case\uc758 \uacb0\uacfc\ub9cc \ubc1b\uc544\uc11c UI \uc5c5\ub370\uc774\ud2b8\n///\n",
        "last_modified": "2026-01-18T17:07:01.347971"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:05.348328",
  "last_updated": "2026-01-14T21:03:40.589144"
}