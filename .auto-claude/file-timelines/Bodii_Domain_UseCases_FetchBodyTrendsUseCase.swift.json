{
  "file_path": "Bodii/Domain/UseCases/FetchBodyTrendsUseCase.swift",
  "main_branch_history": [],
  "task_views": {
    "003-body-composition-tracking-with-bmr-tdee": {
      "task_id": "003-body-composition-tracking-with-bmr-tdee",
      "branch_point": {
        "commit_hash": "2abdae73fb6199bcbf4f21f6deeb7952225f81e6",
        "content": "",
        "timestamp": "2026-01-13T07:46:22.394743"
      },
      "worktree_state": {
        "content": "//\n//  FetchBodyTrendsUseCase.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-12.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Query Use Case Pattern\n// \ub370\uc774\ud130 \uc870\ud68c \ubc0f \ubcc0\ud658\uc744 \ucea1\uc290\ud654\ud558\ub294 Use Case \ud328\ud134\n// \ud83d\udca1 Java \ube44\uad50: Service layer\uc758 \uc870\ud68c \uba54\uc11c\ub4dc\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc \ub354 \uc138\ubd84\ud654\ub428\n\nimport Foundation\n\n// MARK: - FetchBodyTrendsUseCase\n\n/// \uc2e0\uccb4 \uad6c\uc131 \ud2b8\ub80c\ub4dc \uc870\ud68c Use Case\n/// \ucc28\ud2b8 \ud45c\uc2dc\ub97c \uc704\ud574 \uc9c0\uc815\ub41c \uae30\uac04\uc758 \uc2e0\uccb4 \uad6c\uc131 \ub370\uc774\ud130\ub97c \uc870\ud68c\ud558\uace0 \ubcc0\ud658\ud569\ub2c8\ub2e4.\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Clean Architecture - Use Case Layer\n/// - \ud2b9\uc815 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1(\ud2b8\ub80c\ub4dc \ub370\uc774\ud130 \uc870\ud68c)\uc744 \ub3c5\ub9bd\uc801\uc778 \uc720\ub2db\uc73c\ub85c \ucea1\uc290\ud654\n/// - Repository\uc758 raw data\ub97c \ucc28\ud2b8\uc5d0 \ucd5c\uc801\ud654\ub41c \ud615\ud0dc\ub85c \ubcc0\ud658\n/// - UI\ub098 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uc758\uc874\ud558\uc9c0 \uc54a\ub294 \uc21c\uc218\ud55c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\n/// \ud83d\udca1 Java \ube44\uad50: Interactor \ub610\ub294 Service \ud074\ub798\uc2a4\uc758 \ub2e8\uc77c \ucc45\uc784 \uba54\uc11c\ub4dc\nstruct FetchBodyTrendsUseCase {\n\n    // MARK: - Types\n\n    /// \ud2b8\ub80c\ub4dc \uae30\uac04 \uc5f4\uac70\ud615\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Enum with Associated Values\n    /// - \uc0ac\uc6a9\uc790\uac00 \uc120\ud0dd\ud560 \uc218 \uc788\ub294 \ucc28\ud2b8 \uae30\uac04 \uc815\uc758\n    /// - \uac01 \ucf00\uc774\uc2a4\uac00 days \uac12\uc744 \uac00\uc9d0\n    /// \ud83d\udca1 Java \ube44\uad50: Enum with fields\uc640 \uc720\uc0ac\n    enum TrendPeriod: Int, CaseIterable, Codable {\n        /// \ucd5c\uadfc 7\uc77c\n        case week = 7\n\n        /// \ucd5c\uadfc 30\uc77c\n        case month = 30\n\n        /// \ucd5c\uadfc 90\uc77c\n        case quarter = 90\n\n        /// \uc77c\uc218 \uac12\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property\n        /// rawValue\ub97c days\ub85c \uba85\uc2dc\uc801\uc73c\ub85c \ud45c\ud604\n        var days: Int {\n            return self.rawValue\n        }\n\n        /// \ud45c\uc2dc \uc774\ub984\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Localization\n        /// UI\uc5d0 \ud45c\uc2dc\ud560 \ud55c\uae00 \uc774\ub984\n        var displayName: String {\n            switch self {\n            case .week:\n                return \"7\uc77c\"\n            case .month:\n                return \"30\uc77c\"\n            case .quarter:\n                return \"90\uc77c\"\n            }\n        }\n\n        /// \uc2dc\uc791 \ub0a0\uc9dc \uacc4\uc0b0\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Manipulation\n        /// \ud604\uc7ac \ub0a0\uc9dc\uc5d0\uc11c days\ub9cc\ud07c \uc774\uc804 \ub0a0\uc9dc \uacc4\uc0b0\n        /// - Parameter from: \uae30\uc900 \ub0a0\uc9dc (\uae30\ubcf8\uac12: \ud604\uc7ac)\n        /// - Returns: \uc2dc\uc791 \ub0a0\uc9dc\n        func startDate(from date: Date = Date()) -> Date {\n            Calendar.current.date(byAdding: .day, value: -days, to: date) ?? date\n        }\n    }\n\n    /// \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Value Object\n    /// - \ucc28\ud2b8\uc5d0 \ud45c\uc2dc\ud560 \ub2e8\uc77c \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\n    /// - \ub0a0\uc9dc\uc640 \uce21\uc815\uac12\uc744 \uadf8\ub8f9\ud654\n    /// \ud83d\udca1 Java \ube44\uad50: Record (Java 14+) \ub610\ub294 DTO\uc640 \uc720\uc0ac\n    struct TrendDataPoint: Codable, Identifiable, Equatable {\n        /// \uace0\uc720 \uc2dd\ubcc4\uc790 (\ucc28\ud2b8 \ub80c\ub354\ub9c1 \ucd5c\uc801\ud654)\n        let id: UUID\n\n        /// \uce21\uc815 \ub0a0\uc9dc\n        let date: Date\n\n        /// \uccb4\uc911 (kg)\n        let weight: Decimal\n\n        /// \uccb4\uc9c0\ubc29\ub960 (%)\n        let bodyFatPercent: Decimal\n\n        /// \uadfc\uc721\ub7c9 (kg) - \uc120\ud0dd\uc801 \ub370\uc774\ud130\n        let muscleMass: Decimal?\n\n        /// BMR (kcal/day) - \uc120\ud0dd\uc801 \ub370\uc774\ud130\n        let bmr: Decimal?\n\n        /// TDEE (kcal/day) - \uc120\ud0dd\uc801 \ub370\uc774\ud130\n        let tdee: Decimal?\n\n        /// \ud45c\uc2dc\uc6a9 \ub0a0\uc9dc \ubb38\uc790\uc5f4\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Formatting\n        /// UI\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud3ec\ub9f7\ub41c \ub0a0\uc9dc \ubb38\uc790\uc5f4\n        func formattedDate(style: DateFormatter.Style = .short) -> String {\n            let formatter = DateFormatter()\n            formatter.dateStyle = style\n            formatter.timeStyle = .none\n            formatter.locale = Locale(identifier: \"ko_KR\")\n            return formatter.string(from: date)\n        }\n    }\n\n    /// \ud2b8\ub80c\ub4dc \uc870\ud68c\uc5d0 \ud544\uc694\ud55c \uc785\ub825 \ub370\uc774\ud130\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Nested Type\n    /// - Use Case \ub0b4\ubd80\uc5d0 \uad00\ub828\ub41c \ud0c0\uc785\uc744 \uc911\ucca9\ud558\uc5ec \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc815\ub9ac\n    /// - \uc678\ubd80\uc5d0\uc11c\ub294 FetchBodyTrendsUseCase.Input\uc73c\ub85c \uc811\uadfc\n    /// \ud83d\udca1 Java \ube44\uad50: static nested class\uc640 \uc720\uc0ac\n    struct Input {\n        /// \uc870\ud68c \uae30\uac04\n        let period: TrendPeriod\n\n        /// \uc885\ub8cc \ub0a0\uc9dc (\uae30\ubcf8\uac12: \ud604\uc7ac)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Default Parameter\n        /// \ub300\ubd80\ubd84\uc758 \uacbd\uc6b0 \ud604\uc7ac\uae4c\uc9c0\uc758 \ub370\uc774\ud130\ub97c \uc870\ud68c\ud558\uc9c0\ub9cc, \ud2b9\uc815 \uc2dc\uc810\uae4c\uc9c0\uc758 \ub370\uc774\ud130\ub3c4 \uc870\ud68c \uac00\ub2a5\n        let endDate: Date\n\n        /// \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568 \uc5ec\ubd80 (\uae30\ubcf8\uac12: false)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Performance Optimization\n        /// - \ud544\uc694\ud55c \uacbd\uc6b0\uc5d0\ub9cc \ucd94\uac00 \ub370\uc774\ud130 \uc870\ud68c\ud558\uc5ec \uc131\ub2a5 \ucd5c\uc801\ud654\n        /// - \ucc28\ud2b8\uc5d0 BMR/TDEE\ub97c \ud45c\uc2dc\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0 \ubd88\ud544\uc694\ud55c \uc870\ud68c \ubc29\uc9c0\n        let includeMetabolismData: Bool\n\n        /// \uc2dc\uc791 \ub0a0\uc9dc \uacc4\uc0b0\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property\n        /// period\uc640 endDate\ub97c \uae30\ubc18\uc73c\ub85c \uc2dc\uc791 \ub0a0\uc9dc \uc790\ub3d9 \uacc4\uc0b0\n        var startDate: Date {\n            period.startDate(from: endDate)\n        }\n\n        /// \ucd08\uae30\ud654\n        /// - Parameters:\n        ///   - period: \uc870\ud68c \uae30\uac04\n        ///   - endDate: \uc885\ub8cc \ub0a0\uc9dc (\uae30\ubcf8\uac12: \ud604\uc7ac)\n        ///   - includeMetabolismData: \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568 \uc5ec\ubd80 (\uae30\ubcf8\uac12: false)\n        init(period: TrendPeriod, endDate: Date = Date(), includeMetabolismData: Bool = false) {\n            self.period = period\n            self.endDate = endDate\n            self.includeMetabolismData = includeMetabolismData\n        }\n    }\n\n    /// \ud2b8\ub80c\ub4dc \uc870\ud68c \uacb0\uacfc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Result Type\n    /// \uc870\ud68c\ub41c \ub370\uc774\ud130\uc640 \ud1b5\uacc4 \uc815\ubcf4\ub97c \ud568\uaed8 \ubc18\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: DTO (Data Transfer Object)\uc640 \uc720\uc0ac\n    struct Output {\n        /// \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \ubc30\uc5f4 (\ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Collection Type\n        /// - \ucc28\ud2b8 \ub77c\uc774\ube0c\ub7ec\ub9ac\uac00 \uc694\uad6c\ud558\ub294 \ud615\ud0dc\ub85c \uc815\ub82c\n        /// - Swift Charts\ub294 \ub0a0\uc9dc\uc21c \uc815\ub82c\uc744 \uad8c\uc7a5\n        let dataPoints: [TrendDataPoint]\n\n        /// \uc870\ud68c \uae30\uac04\n        let period: TrendPeriod\n\n        /// \uc2dc\uc791 \ub0a0\uc9dc\n        let startDate: Date\n\n        /// \uc885\ub8cc \ub0a0\uc9dc\n        let endDate: Date\n\n        /// \ub370\uc774\ud130 \uc874\uc7ac \uc5ec\ubd80\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Computed Property\n        /// UI\uc5d0\uc11c empty state \ud45c\uc2dc \uc5ec\ubd80 \ud310\ub2e8\uc5d0 \uc0ac\uc6a9\n        var isEmpty: Bool {\n            dataPoints.isEmpty\n        }\n\n        /// \ub370\uc774\ud130 \ud3ec\uc778\ud2b8 \uac1c\uc218\n        var count: Int {\n            dataPoints.count\n        }\n\n        /// \ud3c9\uade0 \uccb4\uc911 (kg)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Aggregate Calculation\n        /// \ucc28\ud2b8 \uc694\uc57d \uc815\ubcf4\ub85c \ud45c\uc2dc\n        var averageWeight: Decimal? {\n            guard !isEmpty else { return nil }\n            let sum = dataPoints.reduce(Decimal(0)) { $0 + $1.weight }\n            return sum / Decimal(count)\n        }\n\n        /// \ud3c9\uade0 \uccb4\uc9c0\ubc29\ub960 (%)\n        var averageBodyFatPercent: Decimal? {\n            guard !isEmpty else { return nil }\n            let sum = dataPoints.reduce(Decimal(0)) { $0 + $1.bodyFatPercent }\n            return sum / Decimal(count)\n        }\n\n        /// \ucd5c\uc18c \uccb4\uc911 (kg)\n        var minWeight: Decimal? {\n            dataPoints.map { $0.weight }.min()\n        }\n\n        /// \ucd5c\ub300 \uccb4\uc911 (kg)\n        var maxWeight: Decimal? {\n            dataPoints.map { $0.weight }.max()\n        }\n\n        /// \ucd5c\uc18c \uccb4\uc9c0\ubc29\ub960 (%)\n        var minBodyFatPercent: Decimal? {\n            dataPoints.map { $0.bodyFatPercent }.min()\n        }\n\n        /// \ucd5c\ub300 \uccb4\uc9c0\ubc29\ub960 (%)\n        var maxBodyFatPercent: Decimal? {\n            dataPoints.map { $0.bodyFatPercent }.max()\n        }\n\n        /// \uccb4\uc911 \ubcc0\ud654\ub7c9 (kg) - \uae30\uac04 \ub0b4 \uccab \uae30\ub85d\uacfc \ub9c8\uc9c0\ub9c9 \uae30\ub85d\uc758 \ucc28\uc774\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Trend Calculation\n        /// \uc591\uc218: \uccb4\uc911 \uc99d\uac00, \uc74c\uc218: \uccb4\uc911 \uac10\uc18c\n        var weightChange: Decimal? {\n            guard let first = dataPoints.first?.weight,\n                  let last = dataPoints.last?.weight else {\n                return nil\n            }\n            return last - first\n        }\n\n        /// \uccb4\uc9c0\ubc29\ub960 \ubcc0\ud654\ub7c9 (%) - \uae30\uac04 \ub0b4 \uccab \uae30\ub85d\uacfc \ub9c8\uc9c0\ub9c9 \uae30\ub85d\uc758 \ucc28\uc774\n        var bodyFatPercentChange: Decimal? {\n            guard let first = dataPoints.first?.bodyFatPercent,\n                  let last = dataPoints.last?.bodyFatPercent else {\n                return nil\n            }\n            return last - first\n        }\n\n        /// \uc694\uc57d \ubb38\uc790\uc5f4\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: UI Helper Method\n        /// UI\uc5d0\uc11c \ubc14\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc694\uc57d \uc815\ubcf4\n        func summary() -> String {\n            guard !isEmpty else {\n                return \"\ub370\uc774\ud130 \uc5c6\uc74c\"\n            }\n\n            let avgWeightStr = String(format: \"%.1f\", NSDecimalNumber(decimal: averageWeight ?? 0).doubleValue)\n            let avgBfStr = String(format: \"%.1f\", NSDecimalNumber(decimal: averageBodyFatPercent ?? 0).doubleValue)\n\n            var summary = \"\"\"\n            \uae30\uac04: \\(period.displayName)\n            \uce21\uc815 \ud69f\uc218: \\(count)\ud68c\n            \ud3c9\uade0 \uccb4\uc911: \\(avgWeightStr) kg\n            \ud3c9\uade0 \uccb4\uc9c0\ubc29\ub960: \\(avgBfStr)%\n            \"\"\"\n\n            if let weightChange = weightChange {\n                let changeStr = String(format: \"%+.1f\", NSDecimalNumber(decimal: weightChange).doubleValue)\n                summary += \"\\n\uccb4\uc911 \ubcc0\ud654: \\(changeStr) kg\"\n            }\n\n            if let bfChange = bodyFatPercentChange {\n                let changeStr = String(format: \"%+.1f\", NSDecimalNumber(decimal: bfChange).doubleValue)\n                summary += \"\\n\uccb4\uc9c0\ubc29\ub960 \ubcc0\ud654: \\(changeStr)%\"\n            }\n\n            return summary\n        }\n    }\n\n    // MARK: - Error\n\n    /// \ud2b8\ub80c\ub4dc \uc870\ud68c \uc911 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc5d0\ub7ec\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Error Type\n    /// Swift\uc758 Error \ud504\ub85c\ud1a0\ucf5c\uc744 conform\ud558\uc5ec throw \uac00\ub2a5\ud55c \ud0c0\uc785 \uc815\uc758\n    /// \ud83d\udca1 Java \ube44\uad50: Custom Exception\uacfc \uc720\uc0ac\n    enum TrendsError: Error, LocalizedError {\n        /// \uc870\ud68c \uc2e4\ud328\n        case fetchFailed(Error)\n\n        /// \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub0a0\uc9dc \ubc94\uc704\n        case invalidDateRange\n\n        /// \uc5d0\ub7ec \uc124\uba85 (\uc0ac\uc6a9\uc790\uc5d0\uac8c \ud45c\uc2dc\ud560 \uba54\uc2dc\uc9c0)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: LocalizedError Protocol\n        /// errorDescription\uc744 \uad6c\ud604\ud558\uc5ec \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n        var errorDescription: String? {\n            switch self {\n            case .fetchFailed(let error):\n                return \"\ud2b8\ub80c\ub4dc \ub370\uc774\ud130 \uc870\ud68c \uc2e4\ud328: \\(error.localizedDescription)\"\n            case .invalidDateRange:\n                return \"\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ub0a0\uc9dc \ubc94\uc704\uc785\ub2c8\ub2e4.\"\n            }\n        }\n    }\n\n    // MARK: - Dependencies\n\n    /// \uc2e0\uccb4 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection\n    /// \uc678\ubd80\uc5d0\uc11c \uc8fc\uc785\ubc1b\uc544 \uc0ac\uc6a9 (\ud14c\uc2a4\ud2b8 \uac00\ub2a5\uc131 \ud5a5\uc0c1)\n    /// \ud83d\udca1 Java \ube44\uad50: @Autowired Repository\uc640 \uc720\uc0ac\n    private let bodyRepository: BodyRepositoryProtocol\n\n    // MARK: - Initialization\n\n    /// FetchBodyTrendsUseCase \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dependency Injection via Constructor\n    /// - \ubaa8\ub4e0 \uc758\uc874\uc131\uc744 \uc0dd\uc131\uc790\ub97c \ud1b5\ud574 \uc8fc\uc785\ubc1b\uc74c\n    /// - \uc758\uc874\uc131 \uc5ed\uc804 \uc6d0\uce59 (Dependency Inversion Principle) \uc900\uc218\n    /// \ud83d\udca1 Java \ube44\uad50: @Autowired constructor injection\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter bodyRepository: \uc2e0\uccb4 \ub370\uc774\ud130 \uc800\uc7a5\uc18c (\ud544\uc218)\n    init(bodyRepository: BodyRepositoryProtocol) {\n        self.bodyRepository = bodyRepository\n    }\n\n    // MARK: - Execute\n\n    /// \ud2b8\ub80c\ub4dc \ub370\uc774\ud130 \uc870\ud68c \uc2e4\ud589\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Async/Await\n    /// - Swift 5.5+\uc758 \ub3d9\uc2dc\uc131 \ubaa8\ub378\n    /// - \ube44\ub3d9\uae30 \uc791\uc5c5\uc744 \ub3d9\uae30 \ucf54\ub4dc\ucc98\ub7fc \uc791\uc131 \uac00\ub2a5\n    /// \ud83d\udca1 Java \ube44\uad50: CompletableFuture \ub610\ub294 Kotlin Coroutines\uc640 \uc720\uc0ac\n    ///\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Query Optimization\n    /// 1. Repository\uc5d0\uc11c \ub0a0\uc9dc \ubc94\uc704\ub85c \ub370\uc774\ud130 \uc870\ud68c\n    /// 2. \ucc28\ud2b8\uc5d0 \ucd5c\uc801\ud654\ub41c \ud615\ud0dc\ub85c \ubcc0\ud658\n    /// 3. \ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c (\ucc28\ud2b8 \ub77c\uc774\ube0c\ub7ec\ub9ac \uc694\uad6c\uc0ac\ud56d)\n    /// 4. \uc120\ud0dd\uc801\uc73c\ub85c \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568\n    ///\n    /// - Parameter input: \ud2b8\ub80c\ub4dc \uc870\ud68c \uc785\ub825 \ub370\uc774\ud130\n    /// - Returns: \ucc28\ud2b8\uc6a9 \ud2b8\ub80c\ub4dc \ub370\uc774\ud130\n    /// - Throws: TrendsError - \uc870\ud68c \uc2e4\ud328 \uc2dc\n    func execute(input: Input) async throws -> Output {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Date Range Validation\n        // \uc2dc\uc791 \ub0a0\uc9dc\uac00 \uc885\ub8cc \ub0a0\uc9dc\ubcf4\ub2e4 \uc774\ud6c4\uc778 \uacbd\uc6b0 \uc5d0\ub7ec\n        guard input.startDate <= input.endDate else {\n            throw TrendsError.invalidDateRange\n        }\n\n        // Step 1: Repository\uc5d0\uc11c \uae30\uac04 \ub0b4 \ub370\uc774\ud130 \uc870\ud68c\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Error Handling with do-catch\n        // Repository \uc5d0\ub7ec\ub97c TrendsError\ub85c \ub798\ud551\ud558\uc5ec \uacc4\uce35\ubcc4 \uc5d0\ub7ec \ubd84\ub9ac\n        let entries: [BodyCompositionEntry]\n        do {\n            entries = try await bodyRepository.fetch(from: input.startDate, to: input.endDate)\n        } catch {\n            throw TrendsError.fetchFailed(error)\n        }\n\n        // Step 2: \ub300\uc0ac\uc728 \ub370\uc774\ud130 \uc870\ud68c (\ud544\uc694\ud55c \uacbd\uc6b0)\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Conditional Data Loading\n        // \uc131\ub2a5 \ucd5c\uc801\ud654\ub97c \uc704\ud574 \ud544\uc694\ud55c \uacbd\uc6b0\uc5d0\ub9cc \ucd94\uac00 \ub370\uc774\ud130 \ub85c\ub4dc\n        var metabolismDataMap: [UUID: MetabolismData] = [:]\n        if input.includeMetabolismData {\n            // \uac01 entry\uc5d0 \ub300\ud55c \ub300\uc0ac\uc728 \ub370\uc774\ud130 \uc870\ud68c\n            for entry in entries {\n                if let metabolismData = try? await bodyRepository.fetchMetabolismData(for: entry.id) {\n                    metabolismDataMap[entry.id] = metabolismData\n                }\n            }\n        }\n\n        // Step 3: \ucc28\ud2b8 \ub370\uc774\ud130 \ud3ec\uc778\ud2b8\ub85c \ubcc0\ud658\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Map Transformation\n        // Domain entity\ub97c View\uc5d0 \ucd5c\uc801\ud654\ub41c \ud615\ud0dc\ub85c \ubcc0\ud658\n        let dataPoints = entries.map { entry -> TrendDataPoint in\n            let metabolism = metabolismDataMap[entry.id]\n            return TrendDataPoint(\n                id: entry.id,\n                date: entry.date,\n                weight: entry.weight,\n                bodyFatPercent: entry.bodyFatPercent,\n                muscleMass: entry.muscleMass,\n                bmr: metabolism?.bmr,\n                tdee: metabolism?.tdee\n            )\n        }\n\n        // Step 4: \ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sorting\n        // Swift Charts\ub294 \ub370\uc774\ud130\uac00 \uc2dc\uac04\uc21c\uc73c\ub85c \uc815\ub82c\ub418\uc5b4 \uc788\uc5b4\uc57c \uc62c\ubc14\ub974\uac8c \ud45c\uc2dc\ub428\n        let sortedDataPoints = dataPoints.sorted { $0.date < $1.date }\n\n        // Step 5: \uacb0\uacfc \ubc18\ud658\n        return Output(\n            dataPoints: sortedDataPoints,\n            period: input.period,\n            startDate: input.startDate,\n            endDate: input.endDate\n        )\n    }\n\n    // MARK: - Convenience Methods\n\n    /// \uae30\uac04\ub9cc \uc9c0\uc815\ud55c \uac04\ud3b8 \uc870\ud68c \uba54\uc11c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Method\n    /// \uac00\uc7a5 \uc77c\ubc18\uc801\uc778 \uc0ac\uc6a9 \ucf00\uc774\uc2a4\ub97c \uc704\ud55c \uac04\ud3b8 \uba54\uc11c\ub4dc\n    /// \ud83d\udca1 \uc0ac\uc6a9\ucc98: ViewModel\uc5d0\uc11c \uc27d\uac8c \ud638\ucd9c \uac00\ub2a5\n    ///\n    /// - Parameter period: \uc870\ud68c \uae30\uac04\n    /// - Returns: \ucc28\ud2b8\uc6a9 \ud2b8\ub80c\ub4dc \ub370\uc774\ud130\n    /// - Throws: TrendsError\n    func execute(period: TrendPeriod) async throws -> Output {\n        let input = Input(period: period)\n        return try await execute(input: input)\n    }\n\n    /// \uc77c\uc218\ub97c \uc9c1\uc811 \uc9c0\uc815\ud55c \uc870\ud68c \uba54\uc11c\ub4dc\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Flexible API\n    /// \ud45c\uc900 \uae30\uac04 \uc678\uc758 \ucee4\uc2a4\ud140 \uae30\uac04 \uc870\ud68c \uac00\ub2a5\n    ///\n    /// - Parameters:\n    ///   - days: \uc870\ud68c\ud560 \uc77c\uc218\n    ///   - endDate: \uc885\ub8cc \ub0a0\uc9dc (\uae30\ubcf8\uac12: \ud604\uc7ac)\n    ///   - includeMetabolismData: \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568 \uc5ec\ubd80 (\uae30\ubcf8\uac12: false)\n    /// - Returns: \ucc28\ud2b8\uc6a9 \ud2b8\ub80c\ub4dc \ub370\uc774\ud130\n    /// - Throws: TrendsError\n    func execute(\n        days: Int,\n        endDate: Date = Date(),\n        includeMetabolismData: Bool = false\n    ) async throws -> Output {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Dynamic Period Creation\n        // TrendPeriod enum\uc5d0 \uc5c6\ub294 \ucee4\uc2a4\ud140 \uae30\uac04\ub3c4 \uc9c0\uc6d0\n        let startDate = Calendar.current.date(byAdding: .day, value: -days, to: endDate) ?? endDate\n        let entries = try await bodyRepository.fetch(from: startDate, to: endDate)\n\n        var metabolismDataMap: [UUID: MetabolismData] = [:]\n        if includeMetabolismData {\n            for entry in entries {\n                if let metabolismData = try? await bodyRepository.fetchMetabolismData(for: entry.id) {\n                    metabolismDataMap[entry.id] = metabolismData\n                }\n            }\n        }\n\n        let dataPoints = entries.map { entry -> TrendDataPoint in\n            let metabolism = metabolismDataMap[entry.id]\n            return TrendDataPoint(\n                id: entry.id,\n                date: entry.date,\n                weight: entry.weight,\n                bodyFatPercent: entry.bodyFatPercent,\n                muscleMass: entry.muscleMass,\n                bmr: metabolism?.bmr,\n                tdee: metabolism?.tdee\n            )\n        }.sorted { $0.date < $1.date }\n\n        // \ucee4\uc2a4\ud140 \uae30\uac04\uc744 \uc704\ud574 \uac00\uc7a5 \uac00\uae4c\uc6b4 TrendPeriod \uc0ac\uc6a9\n        let period: TrendPeriod = {\n            if days <= 7 { return .week }\n            if days <= 30 { return .month }\n            return .quarter\n        }()\n\n        return Output(\n            dataPoints: dataPoints,\n            period: period,\n            startDate: startDate,\n            endDate: endDate\n        )\n    }\n}\n\n// MARK: - Sample Usage\n\nextension FetchBodyTrendsUseCase {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Sample Data for Testing\n    /// Use Case\uc758 \uc0ac\uc6a9 \uc608\uc2dc\uc640 \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc0d8\ud50c \ub370\uc774\ud130\n    /// \ud83d\udca1 Java \ube44\uad50: JUnit\uc758 @Test fixture\uc640 \uc720\uc0ac\n\n    /// \uc0d8\ud50c \uc785\ub825 - \ucd5c\uadfc 7\uc77c\n    static let sampleInputWeek = Input(period: .week)\n\n    /// \uc0d8\ud50c \uc785\ub825 - \ucd5c\uadfc 30\uc77c (\ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568)\n    static let sampleInputMonth = Input(\n        period: .month,\n        includeMetabolismData: true\n    )\n\n    /// \uc0d8\ud50c \ucd9c\ub825 - 7\uc77c \ub370\uc774\ud130\n    static func sampleOutput() -> Output {\n        let now = Date()\n        let dataPoints = [\n            TrendDataPoint(\n                id: UUID(),\n                date: Calendar.current.date(byAdding: .day, value: -6, to: now)!,\n                weight: Decimal(72.0),\n                bodyFatPercent: Decimal(20.0),\n                muscleMass: Decimal(31.0),\n                bmr: Decimal(1680),\n                tdee: Decimal(2016)\n            ),\n            TrendDataPoint(\n                id: UUID(),\n                date: Calendar.current.date(byAdding: .day, value: -3, to: now)!,\n                weight: Decimal(71.2),\n                bodyFatPercent: Decimal(19.3),\n                muscleMass: Decimal(31.5),\n                bmr: Decimal(1665),\n                tdee: Decimal(2290)\n            ),\n            TrendDataPoint(\n                id: UUID(),\n                date: now,\n                weight: Decimal(70.5),\n                bodyFatPercent: Decimal(18.5),\n                muscleMass: Decimal(32.0),\n                bmr: Decimal(1650),\n                tdee: Decimal(2280)\n            )\n        ]\n\n        return Output(\n            dataPoints: dataPoints,\n            period: .week,\n            startDate: Calendar.current.date(byAdding: .day, value: -7, to: now)!,\n            endDate: now\n        )\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Query Use Case \uc774\ud574\n///\n/// FetchBodyTrendsUseCase\uc758 \uc5ed\ud560:\n/// - Repository\uc758 raw data\ub97c \ucc28\ud2b8\uc5d0 \ucd5c\uc801\ud654\ub41c \ud615\ud0dc\ub85c \ubcc0\ud658\n/// - \ub0a0\uc9dc \ubc94\uc704 \uac80\uc99d \ubc0f \ub370\uc774\ud130 \uc815\ub82c\n/// - \uc120\ud0dd\uc801 \ub370\uc774\ud130 \ub85c\ub529\uc744 \ud1b5\ud55c \uc131\ub2a5 \ucd5c\uc801\ud654\n/// - \ud1b5\uacc4 \uc815\ubcf4 \uacc4\uc0b0 (\ud3c9\uade0, \ucd5c\uc18c, \ucd5c\ub300, \ubcc0\ud654\ub7c9 \ub4f1)\n///\n/// \ucc28\ud2b8 \ucd5c\uc801\ud654:\n/// 1. \ub0a0\uc9dc \uc624\ub984\ucc28\uc21c \uc815\ub82c: Swift Charts \uc694\uad6c\uc0ac\ud56d\n/// 2. \ubd88\ud544\uc694\ud55c \ub370\uc774\ud130 \uc81c\uac70: \ucc28\ud2b8\uc5d0 \ud544\uc694\ud55c \ud544\ub4dc\ub9cc \ud3ec\ud568\n/// 3. \uc870\uac74\ubd80 \ub370\uc774\ud130 \ub85c\ub529: includeMetabolismData \ud50c\ub798\uadf8\n/// 4. \uc0ac\uc804 \uacc4\uc0b0\ub41c \ud1b5\uacc4: \ud3c9\uade0, \ucd5c\uc18c, \ucd5c\ub300 \ub4f1\n///\n/// \uc9c0\uc6d0\ud558\ub294 \uae30\uac04:\n/// - 7\uc77c: \uc8fc\uac04 \ud2b8\ub80c\ub4dc (\ube60\ub978 \ubcc0\ud654 \ucd94\uc801)\n/// - 30\uc77c: \uc6d4\uac04 \ud2b8\ub80c\ub4dc (\uc911\uae30 \ubcc0\ud654 \ucd94\uc801)\n/// - 90\uc77c: \ubd84\uae30 \ud2b8\ub80c\ub4dc (\uc7a5\uae30 \ubcc0\ud654 \ucd94\uc801)\n/// - \ucee4\uc2a4\ud140: execute(days:) \uba54\uc11c\ub4dc\ub85c \uc784\uc758 \uae30\uac04 \uc870\ud68c\n///\n/// \uc131\ub2a5 \uace0\ub824\uc0ac\ud56d:\n/// - Repository \ucffc\ub9ac\ub294 0.3\ucd08 \uc774\ub0b4 \ubaa9\ud45c\n/// - \ub300\uc0ac\uc728 \ub370\uc774\ud130\ub294 \ud544\uc694\ud55c \uacbd\uc6b0\uc5d0\ub9cc \uc870\ud68c\n/// - \ub370\uc774\ud130 \ubcc0\ud658 \ubc0f \uc815\ub82c\uc740 \uba54\ubaa8\ub9ac\uc5d0\uc11c \uc218\ud589 (\ube60\ub984)\n/// - \ucd5c\ub300 90\uc77c \ub370\uc774\ud130 \uc870\ud68c \uad8c\uc7a5 (\uc131\ub2a5 \uc720\uc9c0)\n///\n/// Clean Architecture\uc5d0\uc11c\uc758 \uc704\uce58:\n/// - Domain Layer\uc758 Use Case\n/// - BodyRepositoryProtocol\uc5d0 \uc758\uc874\n/// - Presentation Layer (ViewModel)\uc5d0\uc11c \ud638\ucd9c\ub428\n///\n/// \ud83d\udca1 Java Spring\uacfc\uc758 \ube44\uad50:\n/// - Spring: @Service class with query method\n/// - Swift: Struct with async/await\n/// - Spring: Repository\ub97c @Autowired\ub85c \uc8fc\uc785\n/// - Swift: \uc0dd\uc131\uc790\ub85c \uc758\uc874\uc131 \uc8fc\uc785\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// let useCase = FetchBodyTrendsUseCase(bodyRepository: repository)\n///\n/// // \uac04\ub2e8\ud55c \uc870\ud68c\n/// let trends = try await useCase.execute(period: .week)\n///\n/// // \ub300\uc0ac\uc728 \ub370\uc774\ud130 \ud3ec\ud568 \uc870\ud68c\n/// let input = FetchBodyTrendsUseCase.Input(\n///     period: .month,\n///     includeMetabolismData: true\n/// )\n/// let detailedTrends = try await useCase.execute(input: input)\n///\n/// // \ucc28\ud2b8\uc5d0 \ud45c\uc2dc\n/// Chart(trends.dataPoints) { dataPoint in\n///     LineMark(\n///         x: .value(\"Date\", dataPoint.date),\n///         y: .value(\"Weight\", dataPoint.weight)\n///     )\n/// }\n///\n/// // \uc694\uc57d \uc815\ubcf4 \ud45c\uc2dc\n/// print(trends.summary())\n/// ```\n///\n",
        "last_modified": "2026-01-13T19:18:50.333598"
      },
      "task_intent": {
        "title": "Body Composition Tracking with BMR/TDEE",
        "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
        "from_plan": true
      },
      "commits_behind_main": 1,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-13T07:43:04.593957",
  "last_updated": "2026-01-13T07:46:22.847241"
}