{
  "file_path": "Bodii/Data/Mappers/SleepRecordMapper.swift",
  "main_branch_history": [],
  "task_views": {
    "009-sleep-tracking-with-5-status-system": {
      "task_id": "009-sleep-tracking-with-5-status-system",
      "branch_point": {
        "commit_hash": "4e56d606f7b0d4cb74120dd392544f3fe2d4f5b4",
        "content": "",
        "timestamp": "2026-01-14T21:03:40.462795"
      },
      "worktree_state": {
        "content": "//\n//  SleepRecordMapper.swift\n//  Bodii\n//\n//  Created by Auto-Claude on 2026-01-14.\n//\n\n// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Mapper Pattern for Sleep Data\n// Core Data \uc5d4\ud2f0\ud2f0\uc640 Domain \uc5d4\ud2f0\ud2f0 \uac04\uc758 \ubcc0\ud658\uc744 \ub2f4\ub2f9\ud558\ub294 \ub9e4\ud37c\n// \ud83d\udca1 Java \ube44\uad50: ModelMapper \ub610\ub294 MapStruct\uc640 \uc720\uc0ac\ud55c \uc5ed\ud560\n\nimport Foundation\nimport CoreData\n\n// MARK: - SleepRecordMapper\n\n/// SleepRecord (Core Data) \u2194 SleepRecord (Domain) \ub9e4\ud37c\n/// \ub370\uc774\ud130 \ub808\uc774\uc5b4\uc640 \ub3c4\uba54\uc778 \ub808\uc774\uc5b4 \uac04\uc758 \uacbd\uacc4\ub97c \uba85\ud655\ud788 \uad6c\ubd84\ud569\ub2c8\ub2e4.\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Clean Architecture - Data Layer\n/// - Core Data\uc758 NSManagedObject\ub97c \ub3c4\uba54\uc778 \uc5d4\ud2f0\ud2f0\ub85c \ubcc0\ud658\n/// - \ub3c4\uba54\uc778 \ub808\uc774\uc5b4\uac00 Core Data \uc758\uc874\uc131\uc744 \uac16\uc9c0 \uc54a\ub3c4\ub85d \uaca9\ub9ac\n/// - SleepStatus enum \ubcc0\ud658 \ucc98\ub9ac (Int16 \u2194 SleepStatus)\n/// - \uc591\ubc29\ud5a5 \ubcc0\ud658 \uc9c0\uc6d0 (toDomain, toEntity)\n/// \ud83d\udca1 Java \ube44\uad50: DTO \u2194 Entity \ubcc0\ud658 \ub9e4\ud37c\uc640 \uc720\uc0ac\nstruct SleepRecordMapper {\n\n    // MARK: - Types\n\n    /// \ub9e4\ud551 \uc911 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc5d0\ub7ec\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Custom Error Type\n    /// Swift\uc758 Error \ud504\ub85c\ud1a0\ucf5c\uc744 conform\ud558\uc5ec throw \uac00\ub2a5\ud55c \ud0c0\uc785 \uc815\uc758\n    /// \ud83d\udca1 Java \ube44\uad50: Custom Exception\uacfc \uc720\uc0ac\n    enum MappingError: Error, LocalizedError {\n        /// \ud544\uc218 \ud544\ub4dc \ub204\ub77d\n        case missingRequiredField(String)\n\n        /// \uc798\ubabb\ub41c \ub370\uc774\ud130 \ud0c0\uc785\n        case invalidDataType(String)\n\n        /// \uc798\ubabb\ub41c enum \uac12\n        case invalidEnumValue(String)\n\n        /// \uc5d0\ub7ec \uc124\uba85 (\uc0ac\uc6a9\uc790\uc5d0\uac8c \ud45c\uc2dc\ud560 \uba54\uc2dc\uc9c0)\n        /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: LocalizedError Protocol\n        /// errorDescription\uc744 \uad6c\ud604\ud558\uc5ec \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc5d0\ub7ec \uba54\uc2dc\uc9c0 \uc81c\uacf5\n        var errorDescription: String? {\n            switch self {\n            case .missingRequiredField(let field):\n                return \"\ud544\uc218 \ud544\ub4dc\uac00 \ub204\ub77d\ub418\uc5c8\uc2b5\ub2c8\ub2e4: \\(field)\"\n            case .invalidDataType(let field):\n                return \"\uc798\ubabb\ub41c \ub370\uc774\ud130 \ud0c0\uc785\uc785\ub2c8\ub2e4: \\(field)\"\n            case .invalidEnumValue(let field):\n                return \"\uc798\ubabb\ub41c enum \uac12\uc785\ub2c8\ub2e4: \\(field)\"\n            }\n        }\n    }\n\n    // MARK: - Initialization\n\n    /// Mapper \ucd08\uae30\ud654\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Stateless Mapper\n    /// \uc774 Mapper\ub294 \uc0c1\ud0dc\ub97c \uac16\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ubcc4\ub3c4 \ucd08\uae30\ud654 \ubd88\ud544\uc694\n    /// \uadf8\ub7ec\ub098 \uba85\uc2dc\uc801\uc73c\ub85c init\uc744 \uc81c\uacf5\ud558\uc5ec \uc77c\uad00\uc131 \uc720\uc9c0\n    init() {}\n\n    // MARK: - Core Data \u2192 Domain\n\n    /// SleepRecord (Core Data)\ub97c SleepRecord (Domain)\ub85c \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Optional Handling & Enum Conversion\n    /// Core Data\uc758 optional \ud544\ub4dc\ub97c \uc548\uc804\ud558\uac8c \ucc98\ub9ac\ud558\uace0 Int16\uc744 SleepStatus\ub85c \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Optional.ofNullable()\uacfc \uc720\uc0ac\ud55c \ud328\ud134\n    ///\n    /// - Parameter entity: Core Data SleepRecord \uc5d4\ud2f0\ud2f0\n    /// - Returns: Domain SleepRecord\n    /// - Throws: MappingError - \ud544\uc218 \ud544\ub4dc \ub204\ub77d \ub610\ub294 enum \ubcc0\ud658 \uc2e4\ud328 \uc2dc\n    func toDomain(_ entity: SleepRecord) throws -> Bodii.SleepRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Guard Let Pattern\n        // optional\uc744 unwrap\ud558\uace0 \uc2e4\ud328 \uc2dc \uc5d0\ub7ec\ub97c throw\n        // \ud83d\udca1 Java \ube44\uad50: Objects.requireNonNull()\uacfc \uc720\uc0ac\n\n        guard let id = entity.id else {\n            throw MappingError.missingRequiredField(\"id\")\n        }\n\n        guard let userId = entity.userId else {\n            throw MappingError.missingRequiredField(\"userId\")\n        }\n\n        guard let date = entity.date else {\n            throw MappingError.missingRequiredField(\"date\")\n        }\n\n        guard let createdAt = entity.createdAt else {\n            throw MappingError.missingRequiredField(\"createdAt\")\n        }\n\n        guard let updatedAt = entity.updatedAt else {\n            throw MappingError.missingRequiredField(\"updatedAt\")\n        }\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Int16 \u2192 Enum Conversion\n        // Core Data\uc758 Int16 \uac12\uc744 SleepStatus enum\uc73c\ub85c \ubcc0\ud658\n        // \ud83d\udca1 Java \ube44\uad50: Enum.valueOf()\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc optional \ucc98\ub9ac\n        guard let status = SleepStatus(rawValue: entity.status) else {\n            throw MappingError.invalidEnumValue(\"status: \\(entity.status)\")\n        }\n\n        return Bodii.SleepRecord(\n            id: id,\n            userId: userId,\n            date: date,\n            duration: entity.duration,\n            status: status,\n            createdAt: createdAt,\n            updatedAt: updatedAt\n        )\n    }\n\n    /// \uc5ec\ub7ec SleepRecord\ub97c \ud55c \ubc88\uc5d0 \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Collection Transformation\n    /// Swift\uc758 map\uc744 \ud65c\uc6a9\ud55c \uceec\ub809\uc158 \ubcc0\ud658\n    /// \ud83d\udca1 Java \ube44\uad50: Stream.map()\uacfc \uc720\uc0ac\n    ///\n    /// - Parameter entities: Core Data SleepRecord \ubc30\uc5f4\n    /// - Returns: Domain SleepRecord \ubc30\uc5f4\n    /// - Throws: MappingError - \ubcc0\ud658 \uc911 \uc5d0\ub7ec \ubc1c\uc0dd \uc2dc\n    func toDomain(_ entities: [SleepRecord]) throws -> [Bodii.SleepRecord] {\n        return try entities.map { try toDomain($0) }\n    }\n\n    // MARK: - Domain \u2192 Core Data\n\n    /// SleepRecord (Domain)\ub97c SleepRecord (Core Data)\ub85c \ubcc0\ud658\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObject Creation\n    /// Core Data \uc5d4\ud2f0\ud2f0\ub97c \uc0dd\uc131\ud558\ub824\uba74 NSManagedObjectContext\uac00 \ud544\uc694\n    /// \ud83d\udca1 Java \ube44\uad50: EntityManager\ub97c \uc0ac\uc6a9\ud55c \uc5d4\ud2f0\ud2f0 \uc0dd\uc131\uacfc \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - domainEntity: Domain SleepRecord\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Returns: Core Data SleepRecord\n    func toEntity(_ domainEntity: Bodii.SleepRecord, context: NSManagedObjectContext) -> SleepRecord {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: NSManagedObject Initialization\n        // Core Data \uc5d4\ud2f0\ud2f0\ub294 context\uc640 \ud568\uaed8 \uc0dd\uc131\ub418\uc5b4\uc57c \ud568\n        // entity\ub294 context\uac00 \uad00\ub9ac\ud558\ub294 \uac1d\uccb4 \uc124\uba85 \uc815\ubcf4\n        let entity = SleepRecord(context: context)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Value Assignment\n        // Domain entity\uc758 \uac12\uc744 Core Data entity\ub85c \ubcf5\uc0ac\n        entity.id = domainEntity.id\n        entity.userId = domainEntity.userId\n        entity.date = domainEntity.date\n        entity.duration = domainEntity.duration\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Enum \u2192 Int16 Conversion\n        // SleepStatus enum\uc744 Core Data\uc758 Int16 \uac12\uc73c\ub85c \ubcc0\ud658\n        // \ud83d\udca1 Java \ube44\uad50: enum.ordinal()\uacfc \uc720\uc0ac\ud558\uc9c0\ub9cc rawValue \uc0ac\uc6a9\n        entity.status = domainEntity.status.rawValue\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Timestamp Management\n        // createdAt\uacfc updatedAt\uc744 Domain \uac12 \uadf8\ub300\ub85c \uc0ac\uc6a9\n        entity.createdAt = domainEntity.createdAt\n        entity.updatedAt = domainEntity.updatedAt\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Return Unsaved Entity\n        // \uc5ec\uae30\uc11c\ub294 context.save()\ub97c \ud638\ucd9c\ud558\uc9c0 \uc54a\uc74c\n        // \uc800\uc7a5\uc740 Repository \ub808\uc774\uc5b4\uc5d0\uc11c \ub2f4\ub2f9 (\ub2e8\uc77c \ucc45\uc784 \uc6d0\uce59)\n        return entity\n    }\n\n    /// \uae30\uc874 SleepRecord \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Update vs Create\n    /// \uc0c8\ub85c\uc6b4 \uc5d4\ud2f0\ud2f0\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uace0 \uae30\uc874 \uc5d4\ud2f0\ud2f0\ub97c \uc5c5\ub370\uc774\ud2b8\n    /// \ud83d\udca1 Java \ube44\uad50: JPA\uc758 merge() \uba54\uc11c\ub4dc\uc640 \uc720\uc0ac\n    ///\n    /// - Parameters:\n    ///   - entity: \uc5c5\ub370\uc774\ud2b8\ud560 Core Data SleepRecord\n    ///   - domainEntity: \uc0c8\ub85c\uc6b4 \uac12\uc744 \uac00\uc9c4 Domain SleepRecord\n    func updateEntity(_ entity: SleepRecord, from domainEntity: Bodii.SleepRecord) {\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Partial Update\n        // ID\uc640 userId, createdAt\uc740 \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0 \ub098\uba38\uc9c0 \ud544\ub4dc\ub9cc \uc5c5\ub370\uc774\ud2b8\n        // \ubd88\ubcc0(immutable) \ud544\ub4dc\uc640 \uac00\ubcc0(mutable) \ud544\ub4dc \uad6c\ubd84\n\n        entity.date = domainEntity.date\n        entity.duration = domainEntity.duration\n        entity.status = domainEntity.status.rawValue\n        entity.updatedAt = domainEntity.updatedAt\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Audit Trail\n        // updatedAt\uc740 Domain \uc5d4\ud2f0\ud2f0\uc758 \uac12\uc744 \uc0ac\uc6a9\n        // \ub610\ub294 \uc5ec\uae30\uc11c Date()\ub85c \uac31\uc2e0\ud560 \uc218\ub3c4 \uc788\uc74c\n    }\n}\n\n// MARK: - Convenience Extensions\n\nextension SleepRecordMapper {\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Convenience Methods\n    /// \uc790\uc8fc \uc0ac\uc6a9\ub418\ub294 \ud328\ud134\uc744 \uac04\ud3b8\ud558\uac8c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 \ud5ec\ud37c \uba54\uc11c\ub4dc\n\n    /// Domain \uc5d4\ud2f0\ud2f0\ub85c \uc0c8 Core Data \uc5d4\ud2f0\ud2f0 \uc0dd\uc131 \ubc0f \uc989\uc2dc \uc800\uc7a5\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Combined Operation\n    /// \uc0dd\uc131\uacfc \uc800\uc7a5\uc744 \ud55c \ubc88\uc5d0 \ucc98\ub9ac\ud558\ub294 \ud3b8\uc758 \uba54\uc11c\ub4dc\n    /// \ud83d\udca1 \uc8fc\uc758: \uc5d0\ub7ec \ucc98\ub9ac\ub97c \uc704\ud574 throws \uc0ac\uc6a9\n    ///\n    /// - Parameters:\n    ///   - domainEntity: Domain SleepRecord\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Returns: \uc800\uc7a5\ub41c Core Data SleepRecord\n    /// - Throws: Core Data \uc800\uc7a5 \uc5d0\ub7ec\n    func createAndSave(_ domainEntity: Bodii.SleepRecord, context: NSManagedObjectContext) throws -> SleepRecord {\n        let entity = toEntity(domainEntity, context: context)\n\n        // \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Try Expression\n        // context.save()\uac00 throw\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c try \ud0a4\uc6cc\ub4dc \ud544\uc694\n        // \ud83d\udca1 Java \ube44\uad50: checked exception \ucc98\ub9ac\uc640 \uc720\uc0ac\n        try context.save()\n\n        return entity\n    }\n\n    /// Domain \uc5d4\ud2f0\ud2f0\ub85c \uae30\uc874 Core Data \uc5d4\ud2f0\ud2f0 \uc5c5\ub370\uc774\ud2b8 \ubc0f \uc989\uc2dc \uc800\uc7a5\n    /// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: Update and Persist\n    /// \uc5c5\ub370\uc774\ud2b8\uc640 \uc800\uc7a5\uc744 \ud55c \ubc88\uc5d0 \ucc98\ub9ac\n    ///\n    /// - Parameters:\n    ///   - entity: \uc5c5\ub370\uc774\ud2b8\ud560 Core Data SleepRecord\n    ///   - domainEntity: \uc0c8\ub85c\uc6b4 \uac12\uc744 \uac00\uc9c4 Domain SleepRecord\n    ///   - context: Core Data NSManagedObjectContext\n    /// - Throws: Core Data \uc800\uc7a5 \uc5d0\ub7ec\n    func updateAndSave(_ entity: SleepRecord, from domainEntity: Bodii.SleepRecord, context: NSManagedObjectContext) throws {\n        updateEntity(entity, from: domainEntity)\n        try context.save()\n    }\n}\n\n// MARK: - Documentation\n\n/// \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8: SleepRecordMapper\uc758 \ud2b9\uc9d5\n///\n/// BodyRecordMapper\uc640\uc758 \uc720\uc0ac\uc810 \ubc0f \ucc28\uc774\uc810:\n/// 1. Enum \ubcc0\ud658 \ucc98\ub9ac\n///    - SleepStatus enum\uc744 Int16\ub85c \ubcc0\ud658\n///    - \uc798\ubabb\ub41c enum \uac12\uc5d0 \ub300\ud55c \uc5d0\ub7ec \ucc98\ub9ac \ud544\uc694\n///    - MetabolismSnapshotMapper\uc758 ActivityLevel \ubcc0\ud658\uacfc \uc720\uc0ac\ud55c \ud328\ud134\n///\n/// 2. 02:00 \uacbd\uacc4 \ub85c\uc9c1\n///    - date \ud544\ub4dc\ub294 02:00 \uae30\uc900\uc73c\ub85c \ud558\ub8e8\ub97c \uad6c\ubd84\n///    - \ubcc0\ud658 \ub85c\uc9c1\uc774 \uc544\ub2cc Use Case \ub808\uc774\uc5b4\uc5d0\uc11c \ucc98\ub9ac\n///    - Mapper\ub294 \ub2e8\uc21c\ud788 \uac12\uc744 \ubcf5\uc0ac\ub9cc \ud568\n///\n/// 3. updatedAt \ud544\ub4dc \uad00\ub9ac\n///    - SleepRecord\ub294 \uc218\uc815 \uac00\ub2a5\ud55c \uc5d4\ud2f0\ud2f0\n///    - updatedAt\uc744 \ud1b5\ud574 \uc218\uc815 \uc774\ub825 \ucd94\uc801\n///    - BodyRecord\ub294 createdAt\ub9cc \uc788\uc9c0\ub9cc SleepRecord\ub294 \ub458 \ub2e4 \uc788\uc74c\n///\n/// \uc65c \ubcc4\ub3c4\uc758 Mapper\uac00 \ud544\uc694\ud55c\uac00?\n/// - SleepRecord\uc640 BodyRecord\ub294 \uc11c\ub85c \ub2e4\ub978 \uc5d4\ud2f0\ud2f0\n/// - \uac01\uac01 \ub3c5\ub9bd\uc801\uc778 \ub77c\uc774\ud504\uc0ac\uc774\ud074\uc744 \uac00\uc9d0\n/// - SleepRecord\ub294 02:00 \uae30\uc900 \ub0a0\uc9dc \ub85c\uc9c1\uc73c\ub85c DailyLog\uc640 \uc5f0\ub3d9\n/// - \uc218\uba74 \ucd94\uc774 \ubd84\uc11d\uc744 \uc704\ud574 \ubcc4\ub3c4\ub85c fetch \uac00\ub2a5\n///\n/// \uc0ac\uc6a9 \uc608\uc2dc:\n/// ```swift\n/// // Core Data \u2192 Domain\n/// let mapper = SleepRecordMapper()\n/// let sleepRecord = try mapper.toDomain(entity)\n///\n/// // Domain \u2192 Core Data\n/// let entity = mapper.toEntity(sleepRecord, context: context)\n/// try context.save()\n/// ```\n///\n/// \ud83d\udca1 \uc2e4\ubb34 \ud301:\n/// - Enum \ubcc0\ud658 \uc2dc \ud56d\uc0c1 \uc2e4\ud328 \uac00\ub2a5\uc131\uc744 \uace0\ub824\n/// - \uc218\uba74 \uc2dc\uac04\uc740 Int32(\ubd84 \ub2e8\uc704)\ub85c \uc800\uc7a5\ud558\uc5ec \uc815\ubc00\ub3c4 \uc720\uc9c0\n/// - \ubcc0\ud658 \ub85c\uc9c1\uc740 \ucd5c\ub300\ud55c \ub2e8\uc21c\ud558\uac8c \uc720\uc9c0 (\ubcf5\uc7a1\ud55c \ub85c\uc9c1\uc740 Use Case\ub85c)\n/// - \ub0a0\uc9dc \uacbd\uacc4 \ub85c\uc9c1\uc740 DateUtils\uc640 Use Case\uc5d0\uc11c \ucc98\ub9ac\n///\n",
        "last_modified": "2026-01-18T17:07:01.337054"
      },
      "task_intent": {
        "title": "009-sleep-tracking-with-5-status-system",
        "description": "Sleep logging with 5-status tracking (bad, soso, good, excellent, oversleep), duration input, wake time prompts, and correlation with other health metrics. Automatic morning prompt to log previous night's sleep.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-14T18:01:04.933834",
  "last_updated": "2026-01-14T21:03:40.636206"
}