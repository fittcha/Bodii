{
  "feature": "Meal Logging & Nutrition Tracking",
  "description": "Full diet tracking with meal categorization (breakfast, lunch, dinner, snacks), food search, manual entry, serving size adjustment, and daily calorie/macro summary. Support flexible meal slots without arbitrary limitations.",
  "spec_id": "006-meal-logging-nutrition-tracking",
  "created_at": "2026-01-13T07:51:40.627Z",
  "updated_at": "2026-01-13T08:00:00.000Z",
  "status": "in_progress",
  "planStatus": "approved",
  "phases": [
    {
      "id": "phase-1",
      "name": "Data Layer & Core Services",
      "description": "Implement data layer services for food records and daily log management",
      "status": "pending",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Implement FoodRepository",
          "description": "Create repository for Food entity CRUD operations with Core Data. Include methods for searching foods, getting recent foods, and managing user-defined foods.",
          "status": "completed",
          "files": [
            "Bodii/Data/Repositories/FoodRepository.swift",
            "Bodii/Data/Repositories/FoodRepositoryProtocol.swift"
          ],
          "acceptance_criteria": [
            "Create FoodRepositoryProtocol with CRUD methods",
            "Implement FoodRepository using Core Data",
            "Search by name (contains match)",
            "Get recent foods (last 30 days)",
            "Get frequently used foods",
            "Save user-defined foods"
          ],
          "estimated_hours": 3,
          "notes": "Successfully implemented FoodRepository and FoodRepositoryProtocol with all required functionality:\n- CRUD operations (save, findById, findAll, update, delete)\n- Search by name with case-insensitive contains match\n- Recent foods query (last 30 days)\n- Frequent foods query (top 20 by usage count)\n- User-defined foods management\n- Source-based filtering\nAll methods use Swift Concurrency async/await pattern and proper error handling.",
          "updated_at": "2026-01-13T08:00:29.462487+00:00"
        },
        {
          "id": "1.2",
          "title": "Implement FoodRecordRepository",
          "description": "Create repository for FoodRecord entity operations. Handle meal type grouping and date filtering.",
          "status": "completed",
          "files": [
            "Bodii/Data/Repositories/FoodRecordRepository.swift",
            "Bodii/Data/Repositories/FoodRecordRepositoryProtocol.swift"
          ],
          "acceptance_criteria": [
            "Create FoodRecordRepositoryProtocol with CRUD methods",
            "Implement FoodRecordRepository using Core Data",
            "Fetch records by date",
            "Fetch records by date and meal type",
            "Delete food record",
            "Update food record"
          ],
          "estimated_hours": 2,
          "notes": "Successfully implemented FoodRecordRepository and FoodRecordRepositoryProtocol with all required functionality:\n- CRUD operations (save, findById, update, delete)\n- Fetch records by date with proper date range handling (startOfDay to endOfDay)\n- Fetch records by date and meal type\n- Proper relationship handling for User and Food entities\n- Swift Concurrency async/await pattern\n- Comprehensive error handling using RepositoryError\n- Korean documentation following established patterns\nAll methods properly handle Core Data context operations and include proper entity mapping between Core Data and domain models.",
          "updated_at": "2026-01-13T08:02:51.306950+00:00"
        },
        {
          "id": "1.3",
          "title": "Implement DailyLogRepository",
          "description": "Create repository for DailyLog entity to fetch and update daily summaries.",
          "status": "completed",
          "files": [
            "Bodii/Data/Repositories/DailyLogRepository.swift",
            "Bodii/Data/Repositories/DailyLogRepositoryProtocol.swift"
          ],
          "acceptance_criteria": [
            "Create DailyLogRepositoryProtocol",
            "Implement getOrCreate(for date) method",
            "Fetch daily log by date",
            "Update daily log fields"
          ],
          "estimated_hours": 2,
          "notes": "Successfully implemented DailyLogRepository and DailyLogRepositoryProtocol with all required functionality:\n- CRUD operations (save, update, delete)\n- findByDate to query daily log for specific date\n- getOrCreate pattern for date-based unique records (automatically creates with initial values if not exists)\n- findByDateRange for querying multiple days\n- Proper relationship handling for User entity\n- Swift Concurrency async/await pattern\n- Comprehensive error handling using RepositoryError\n- Korean documentation following established patterns\nAll methods properly handle Core Data context operations and include proper entity mapping between Core Data and domain models, including optional fields (carbsRatio, proteinRatio, fatRatio, steps, weight, bodyFatPct, sleepDuration, sleepStatus).",
          "updated_at": "2026-01-13T08:05:42.412320+00:00"
        },
        {
          "id": "1.4",
          "title": "Implement FoodRecordService",
          "description": "Create service layer for food record management with cascade updates to DailyLog. Handle nutrition calculations based on quantity.",
          "status": "completed",
          "files": [
            "Bodii/Domain/Services/FoodRecordService.swift",
            "Bodii/Domain/Services/FoodRecordServiceProtocol.swift"
          ],
          "acceptance_criteria": [
            "Create FoodRecordServiceProtocol",
            "Add food record with nutrition calculation",
            "Update DailyLog on food addition (calories, carbs, protein, fat)",
            "Update DailyLog on food deletion",
            "Calculate macro ratios",
            "Calculate net calories"
          ],
          "estimated_hours": 3,
          "notes": "Successfully implemented FoodRecordServiceProtocol and FoodRecordService with all required functionality:\n- Add food record with automatic nutrition calculation based on quantity and unit\n- Update food record with proper DailyLog recalculation (subtract old values, add new values)\n- Delete food record with DailyLog cascade updates\n- Calculate macro ratios (carbs/protein/fat %) based on calorie contributions (carbs: 4 kcal/g, protein: 4 kcal/g, fat: 9 kcal/g)\n- Calculate net calories (totalCaloriesIn - tdee)\n- Query operations for fetching food records by date and meal type\n\nKey implementation details:\n1. Nutrition calculation: Supports both serving and gram units with proper multiplier calculation\n2. DailyLog cascade updates: Automatically updates totals when adding/deleting/updating records\n3. Macro ratio calculation: Uses standard calorie multipliers and returns percentages\n4. Update handling: Properly subtracts old nutrition values before adding new ones\n5. Error handling: Comprehensive error cases (food not found, food record not found, daily log not found)\n\nFiles created:\n- Bodii/Domain/Services/FoodRecordServiceProtocol.swift (130 lines)\n- Bodii/Domain/Services/FoodRecordService.swift (442 lines)\n\nCommit: ae1d29e\nStatus: Ready for use in view models (next phases)",
          "updated_at": "2026-01-13T08:09:19.064825+00:00"
        },
        {
          "id": "1.5",
          "title": "Implement NutritionCalculator",
          "description": "Create utility for calculating nutrition values based on serving size and quantity. Handle serving vs gram conversions.",
          "status": "completed",
          "files": [
            "Bodii/Domain/Services/NutritionCalculator.swift"
          ],
          "acceptance_criteria": [
            "Calculate calories based on quantity and serving size",
            "Calculate macros (carbs, protein, fat) proportionally",
            "Support serving unit (1x, 0.5x, etc.)",
            "Support gram-based quantity",
            "Calculate macro ratios from totals"
          ],
          "estimated_hours": 1.5,
          "notes": "Successfully implemented NutritionCalculator utility with all required functionality:\n\n**Core Features:**\n1. calculateNutrition: Calculate calories and macros based on quantity and unit\n   - Supports serving unit (multiplier = quantity)\n   - Supports gram unit (multiplier = quantity / servingSize)\n   - Returns NutritionValues with calories, carbs, protein, fat\n\n2. calculateMacroRatios: Calculate percentage breakdown of macros\n   - Uses standard calorie multipliers (carbs: 4 kcal/g, protein: 4 kcal/g, fat: 9 kcal/g)\n   - Returns MacroRatios with percentages\n   - Handles edge case when total calories = 0 (returns nil)\n\n3. Conversion utilities:\n   - gramsToServings: Convert grams to servings\n   - servingsToGrams: Convert servings to grams\n\n**Refactoring:**\n- Updated FoodRecordService to use NutritionCalculator\n- Removed duplicate calculateNutrition and calculateMacroRatios methods\n- Removed duplicate Decimal.rounded extension (now in NutritionCalculator)\n\n**Code Quality:**\n- Comprehensive documentation with examples\n- Follows existing code patterns (Korean docs, structured comments)\n- Stateless utility using static methods\n- Type-safe with dedicated result structs (NutritionValues, MacroRatios)\n\nFile created: Bodii/Domain/Services/NutritionCalculator.swift (330 lines)\nCommit: 2a05ca1",
          "updated_at": "2026-01-13T08:12:18.006268+00:00"
        },
        {
          "id": "1.6",
          "title": "Write Unit Tests for Services",
          "description": "Create comprehensive unit tests for FoodRecordService and NutritionCalculator.",
          "status": "completed",
          "files": [
            "BodiiTests/FoodRecordServiceTests.swift",
            "BodiiTests/NutritionCalculatorTests.swift"
          ],
          "acceptance_criteria": [
            "Test nutrition calculation accuracy",
            "Test DailyLog cascade updates",
            "Test macro ratio calculations",
            "Test edge cases (0 quantity, very large values)"
          ],
          "estimated_hours": 2,
          "notes": "Successfully created comprehensive unit tests for FoodRecordService and NutritionCalculator:\n\n**NutritionCalculatorTests.swift (30+ test cases):**\n1. Nutrition calculation for serving unit:\n   - Test various serving sizes (0.25x, 0.5x, 1x, 1.5x, 2x)\n   - Verify accurate proportional calculations\n\n2. Nutrition calculation for grams unit:\n   - Test exact serving size (210g)\n   - Test half serving (105g)\n   - Test 1.5 servings (315g)\n   - Test non-exact multiples (100g)\n\n3. Edge cases:\n   - Zero quantity (returns zero values)\n   - Very large quantities (10 servings)\n   - Very small quantities (0.01 servings)\n\n4. Macro ratio calculations:\n   - Balanced diet (49.9% carbs, 25% protein, 25.1% fat)\n   - High carb diet (>60% carbs)\n   - High protein diet (>35% protein)\n   - High fat/keto diet (>65% fat)\n   - Zero macros (returns nil ratios)\n   - Verify totals to 100%\n\n5. Serving conversions:\n   - Grams to servings conversion\n   - Servings to grams conversion\n   - Round trip conversion accuracy\n   - Zero serving size handling\n\n**FoodRecordServiceTests.swift (20+ test cases):**\n1. Add food record operations:\n   - Correct nutrition calculation (1 serving = 330 kcal)\n   - DailyLog totals update (cascade updates)\n   - Macro ratios calculation (carbs >80% for rice)\n   - Net calories calculation (intake - TDEE)\n   - Grams unit support (105g = 0.5 serving)\n   - Error handling (food not found)\n   - DailyLog creation if not exists\n\n2. Update food record operations:\n   - Quantity update recalculates nutrition\n   - DailyLog correctly updated (subtract old, add new)\n   - Meal type update support\n   - Error handling (record not found)\n\n3. Delete food record operations:\n   - Record deletion and DailyLog update\n   - Macro ratios recalculation (nil when empty)\n   - Error handling (record not found, daily log not found)\n\n4. Query operations:\n   - Get records by date\n   - Get records by date and meal type\n\n5. Mock repositories:\n   - MockFoodRecordRepository\n   - MockDailyLogRepository\n   - MockFoodRepository\n   - Proper isolation for unit testing\n\n**Code Quality:**\n- Follows established test patterns from ValidationServiceTests\n- Korean and English documentation\n- Given/When/Then structure\n- Clear, descriptive test names\n- Comprehensive edge case coverage\n- 50+ total test cases ensuring robust coverage\n\nAll acceptance criteria met:\n\u2705 Test nutrition calculation accuracy\n\u2705 Test DailyLog cascade updates\n\u2705 Test macro ratio calculations\n\u2705 Test edge cases (0 quantity, very large values)\n\nFiles created:\n- BodiiTests/NutritionCalculatorTests.swift (745 lines)\n- BodiiTests/FoodRecordServiceTests.swift (1,209 lines)\n\nCommit: 11c1ad6\nStatus: Ready for manual verification",
          "updated_at": "2026-01-13T08:16:59.472456+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Food Search & Quick Add",
      "description": "Implement food search functionality with recent and frequent foods",
      "status": "pending",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Implement LocalFoodSearchService",
          "description": "Create service for searching locally stored foods (user-defined and cached API results). Prioritize Korean foods and show nutrition preview.",
          "status": "completed",
          "files": [
            "Bodii/Domain/Services/LocalFoodSearchService.swift",
            "Bodii/Domain/Services/FoodSearchServiceProtocol.swift"
          ],
          "acceptance_criteria": [
            "Search foods by name (contains match)",
            "Sort results by relevance/frequency",
            "Return nutrition preview in results",
            "Handle empty search results"
          ],
          "estimated_hours": 2,
          "notes": "Successfully implemented LocalFoodSearchService with all required functionality:\n\n**Core Features:**\n1. FoodSearchServiceProtocol - Service interface defining:\n   - searchFoods: Search by name with Korean food prioritization\n   - getRecentFoods: Get recent foods (max 10)\n   - getFrequentFoods: Get frequent foods (max 10)\n\n2. LocalFoodSearchService - Implementation with intelligent sorting:\n   - 4-tier priority system:\n     * Priority 1: Korean foods (governmentAPI) + frequently used\n     * Priority 2: Korean foods (governmentAPI) + regular\n     * Priority 3: Other sources + frequently used\n     * Priority 4: Other sources + regular\n   - Alphabetical sorting within same priority level\n   - Empty query handling (returns empty array)\n   - Nutrition preview included in all results\n\n3. LocalFoodSearchServiceTests - Comprehensive test coverage (20+ test cases):\n   - Empty/whitespace query handling\n   - No results handling\n   - Priority-based sorting verification\n   - Name-based secondary sorting\n   - All food source types (governmentAPI, usda, userDefined)\n   - Nutrition preview verification\n   - Recent foods limiting (max 10)\n   - Frequent foods limiting (max 10)\n   - Edge cases and empty results\n\n**Code Quality:**\n- Follows established patterns from FoodRecordService\n- Korean and English documentation\n- Swift Concurrency (async/await)\n- Protocol-based design for testability\n- Comprehensive error handling\n- Clean separation of concerns\n\n**Files Created:**\n- Bodii/Domain/Services/FoodSearchServiceProtocol.swift (65 lines)\n- Bodii/Domain/Services/LocalFoodSearchService.swift (131 lines)\n- BodiiTests/LocalFoodSearchServiceTests.swift (530 lines)\n\n**Files Modified:**\n- BodiiTests/FoodRecordServiceTests.swift - Updated MockFoodRepository to support search testing\n\nAll acceptance criteria met:\n\u2705 Search foods by name (contains match)\n\u2705 Sort results by relevance/frequency\n\u2705 Return nutrition preview in results\n\u2705 Handle empty search results\n\nCommit: dac993c\nStatus: Ready for use in ViewModels (Phase 2 - subtask 2.3)",
          "updated_at": "2026-01-13T08:21:19.679549+00:00"
        },
        {
          "id": "2.2",
          "title": "Implement RecentFoodsService",
          "description": "Create service to track and retrieve recently consumed and frequently consumed foods for quick-add functionality.",
          "status": "completed",
          "files": [
            "Bodii/Domain/Services/RecentFoodsService.swift"
          ],
          "acceptance_criteria": [
            "Get recent foods (last 30 days)",
            "Get frequently consumed foods",
            "Sort by recency and frequency",
            "Limit results (top 10 each)"
          ],
          "estimated_hours": 1.5,
          "notes": "Successfully implemented RecentFoodsService with all required functionality:\n\n**Core Features:**\n1. RecentFoodsServiceProtocol - Service interface defining:\n   - getRecentFoods: Get recent foods (last 30 days, max 10)\n   - getFrequentFoods: Get frequent foods (max 10)\n   - getQuickAddFoods: Combined recent + frequent with deduplication (max 15)\n\n2. RecentFoodsService - Implementation with:\n   - Wraps FoodRepository methods for optimized quick-add functionality\n   - Configurable limits (maxRecentFoods, maxFrequentFoods, maxQuickAddFoods)\n   - Parallel async queries for getQuickAddFoods\n   - Deduplication logic prioritizing recent foods over frequent foods\n   - Empty result handling (returns empty arrays)\n\n3. RecentFoodsServiceTests - Comprehensive test coverage (15+ test cases):\n   - Recent foods retrieval with limit enforcement\n   - Frequent foods retrieval with limit enforcement\n   - Quick-add foods combining and deduplication\n   - Empty results handling\n   - Custom limits configuration\n   - Error propagation from repository\n   - Priority ordering (recent foods first)\n\n**Code Quality:**\n- Follows established patterns from FoodRecordService and LocalFoodSearchService\n- Korean and English documentation\n- Swift Concurrency (async/await with parallel queries)\n- Protocol-based design for testability\n- Comprehensive error handling\n- Clean separation of concerns\n\n**Files Created:**\n- Bodii/Domain/Services/RecentFoodsServiceProtocol.swift (73 lines)\n- Bodii/Domain/Services/RecentFoodsService.swift (113 lines)\n- BodiiTests/RecentFoodsServiceTests.swift (390 lines)\n\nAll acceptance criteria met:\n\u2705 Get recent foods (last 30 days)\n\u2705 Get frequently consumed foods\n\u2705 Sort by recency and frequency\n\u2705 Limit results (top 10 each)\n\nCommit: 4efa58b\nStatus: Ready for use in ViewModels (Phase 2 - subtask 2.3)",
          "updated_at": "2026-01-13T08:25:10.817702+00:00"
        },
        {
          "id": "2.3",
          "title": "Create FoodSearchViewModel",
          "description": "Implement ViewModel for food search screen with debounced search, recent foods, and search results.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/ViewModels/FoodSearchViewModel.swift"
          ],
          "acceptance_criteria": [
            "Debounced search input (300ms)",
            "Load recent foods on appear",
            "Load frequent foods on appear",
            "Handle loading states",
            "Handle error states"
          ],
          "estimated_hours": 2,
          "notes": "Successfully implemented FoodSearchViewModel with all required functionality:\n\n**Core Features:**\n1. Debounced search input:\n   - 300ms debounce using Combine framework\n   - Prevents excessive API calls during typing\n   - Automatic duplicate removal\n\n2. Initial data loading:\n   - Load recent foods (max 10) on appear\n   - Load frequent foods (max 10) on appear\n   - Parallel async queries for optimal performance\n   - Proper loading state management\n\n3. Search functionality:\n   - Uses FoodSearchServiceProtocol for intelligent search\n   - Automatic trimming of whitespace\n   - Empty query handling (clears results)\n   - Search state tracking\n\n4. Error handling:\n   - Comprehensive error catching\n   - User-friendly error messages\n   - RepositoryError type checking\n   - Error state reset on new operations\n\n5. UI state management:\n   - @MainActor for thread-safety with SwiftUI\n   - Computed properties (isEmpty, isInSearchMode, hasSearchResults, etc.)\n   - Loading states (isLoading, isSearching, isAnyLoading)\n   - Clear separation between search and browse modes\n\n**Code Quality:**\n- Follows established patterns from service layer\n- Korean and English documentation\n- Swift Concurrency (async/await) throughout\n- Protocol-based dependency injection\n- Clean separation of concerns\n- ObservableObject for SwiftUI integration\n\n**Files Created:**\n- Bodii/Presentation/Features/Diet/ViewModels/FoodSearchViewModel.swift (240 lines)\n\nAll acceptance criteria met:\n\u2705 Debounced search input (300ms)\n\u2705 Load recent foods on appear\n\u2705 Load frequent foods on appear\n\u2705 Handle loading states\n\u2705 Handle error states\n\nCommit: 437bd1a\nStatus: Ready for UI integration (Phase 4 - subtask 4.1)",
          "updated_at": "2026-01-13T08:27:56.452213+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "UI - Daily Meal View",
      "description": "Implement the daily meal view screen showing meals by category",
      "status": "pending",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Create DailyMealViewModel",
          "description": "Implement ViewModel for daily meal view with date navigation, meal grouping, and nutrition summary.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/ViewModels/DailyMealViewModel.swift"
          ],
          "acceptance_criteria": [
            "Load meals for selected date",
            "Group meals by meal type (breakfast, lunch, dinner, snack)",
            "Calculate and display daily totals",
            "Support date navigation (previous/next day)",
            "Handle empty state"
          ],
          "estimated_hours": 2.5,
          "notes": "Successfully implemented DailyMealViewModel with all required functionality:\n\n**Core Features:**\n1. Date navigation:\n   - navigateToPreviousDay(): Move to previous day\n   - navigateToNextDay(): Move to next day\n   - navigateToDate(date): Jump to specific date\n   - Auto-reload data on date change\n\n2. Data loading:\n   - Parallel async queries for DailyLog and FoodRecords (performance optimization)\n   - getOrCreate pattern for DailyLog (auto-creates if not exists)\n   - Loads Food details for each FoodRecord\n   - Efficient grouping by MealType\n\n3. Meal grouping:\n   - Groups FoodRecords by all 4 MealTypes (breakfast, lunch, dinner, snack)\n   - Pre-initializes empty arrays for all meal types\n   - Returns organized dictionary for easy UI rendering\n\n4. Daily nutrition summary:\n   - Exposes DailyLog for total calories and macros\n   - Computed properties for remaining calories\n   - Calorie intake percentage calculation\n   - Per-meal calorie totals\n\n5. Delete functionality:\n   - deleteFoodRecord(id): Remove food record\n   - Auto-refreshes data after deletion\n   - DailyLog automatically updated via service layer\n\n6. UI state management:\n   - @MainActor for thread-safety with SwiftUI\n   - Loading states (isLoading)\n   - Error handling with user-friendly messages\n   - Empty state detection (hasAnyMeals, hasMeals(for:))\n   - Date helpers (isToday, isFuture, dateString)\n\n**Helper Models:**\n- FoodRecordWithFood: Combines FoodRecord and Food for efficient UI rendering\n- Identifiable protocol for SwiftUI List support\n\n**Code Quality:**\n- Follows established patterns from FoodSearchViewModel\n- Korean and English documentation\n- Swift Concurrency (async/await) throughout\n- Protocol-based dependency injection for testability\n- Comprehensive computed properties for UI logic\n- Clean separation of concerns\n\n**Files Created:**\n- Bodii/Presentation/Features/Diet/ViewModels/DailyMealViewModel.swift (358 lines)\n\nAll acceptance criteria met:\n\u2705 Load meals for selected date\n\u2705 Group meals by meal type (breakfast, lunch, dinner, snack)\n\u2705 Calculate and display daily totals\n\u2705 Support date navigation (previous/next day)\n\u2705 Handle empty state\n\nCommit: fba039b\nStatus: Ready for UI integration (Phase 3 - subtask 3.2)",
          "updated_at": "2026-01-13T08:31:06.488281+00:00"
        },
        {
          "id": "3.2",
          "title": "Create DailyMealView",
          "description": "Implement main daily meal view with date header, meal sections, and daily summary card.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Views/Diet/DailyMealView.swift"
          ],
          "acceptance_criteria": [
            "Date selector header with navigation arrows",
            "Four meal sections (breakfast, lunch, dinner, snack)",
            "Add food button per section",
            "Daily calorie/macro summary card",
            "Empty state for no meals"
          ],
          "estimated_hours": 3,
          "notes": "Successfully implemented DailyMealView with all required functionality:\n\n**Core Features:**\n1. Date selector header with navigation arrows:\n   - Previous day button with chevron.left icon\n   - Next day button with chevron.right icon\n   - Date display with Korean formatting (M\uc6d4 d\uc77c (E))\n   - \"\uc624\ub298\" badge when viewing today\n   - Future date navigation disabled\n\n2. Four meal sections (breakfast, lunch, dinner, snack):\n   - MealSectionView component for each meal type\n   - Displays meal type name using MealType.displayName\n   - Shows total calories per meal section\n   - Empty state message when no foods recorded\n   - Add food button (+) in section header\n\n3. Daily calorie/macro summary card:\n   - Total calories consumed vs TDEE display\n   - Progress bar with color coding (blue < 50%, green 50-90%, orange 90-110%, red > 110%)\n   - Remaining calories with color indication (green if positive, red if negative)\n   - Macro breakdown showing carbs, protein, fat in grams\n   - Percentage display for each macro with colored badges\n\n4. Food record display:\n   - FoodRecordRowView component for individual foods\n   - Shows food name, quantity (with unit), and calculated calories\n   - Swipe-to-delete functionality\n   - Supports both serving and gram units\n\n5. UI/UX Features:\n   - Loading state with ProgressView\n   - Error alert with user-friendly messages\n   - Empty state with helpful guidance message\n   - Refresh button in navigation bar\n   - System colors following iOS design guidelines\n   - Card-based layout with shadows\n   - ScrollView for long meal lists\n\n6. Integration with ViewModel:\n   - Uses DailyMealViewModel for data management\n   - Observes @Published properties for UI updates\n   - Handles date navigation through ViewModel\n   - Calls deleteFoodRecord on swipe action\n   - onAppear lifecycle management\n\n**Code Quality:**\n- Follows established SwiftUI patterns from ContentView\n- Korean and English documentation\n- Private subviews for clean code organization\n- Proper spacing and padding following iOS HIG\n- Mock services for SwiftUI preview functionality\n- Helper methods for formatting (quantityText, formattedDecimal)\n- Color coding for visual feedback\n\n**Files Created:**\n- Bodii/Presentation/Features/Diet/Views/DailyMealView.swift (688 lines)\n\nAll acceptance criteria met:\n\u2705 Date selector header with navigation arrows\n\u2705 Four meal sections (breakfast, lunch, dinner, snack)\n\u2705 Add food button per section\n\u2705 Daily calorie/macro summary card\n\u2705 Empty state for no meals\n\nCommit: 7587229\nStatus: Ready for integration in Phase 7 (subtask 7.1)",
          "updated_at": "2026-01-13T08:34:33.671418+00:00"
        },
        {
          "id": "3.3",
          "title": "Create MealSectionView",
          "description": "Implement reusable meal section component showing foods for a specific meal type with edit/delete actions.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/MealSectionView.swift",
            "Bodii/Presentation/Views/Diet/Components/FoodRecordRow.swift"
          ],
          "acceptance_criteria": [
            "Display meal type header with calorie subtotal",
            "List food items with name, quantity, calories",
            "Swipe to delete functionality",
            "Tap to edit functionality",
            "Add food button"
          ],
          "estimated_hours": 2.5,
          "notes": "Successfully implemented reusable meal section component and food record row component:\n\n**New Components Created:**\n1. MealSectionView.swift (196 lines)\n   - Reusable component for displaying meal sections\n   - Shows meal type header with calorie subtotal\n   - Lists food items with FoodRecordRow component\n   - Includes empty state message when no foods recorded\n   - Add food button in header\n   - Supports edit and delete actions via callbacks\n\n2. FoodRecordRow.swift (243 lines)\n   - Reusable row component for individual food records\n   - Displays food name, quantity (with unit), and calories\n   - Tap to edit functionality (Button wrapper with chevron indicator)\n   - Swipe to delete functionality\n   - Supports both serving and gram units\n   - Proper number formatting with NumberFormatter\n\n**Updated Files:**\n- DailyMealView.swift (553 lines, reduced from 689)\n  - Refactored to use new MealSectionView component\n  - Added selectedFoodRecordId state for edit functionality\n  - Added onEditFood closure to MealSectionView calls\n  - Removed private MealSectionView struct (extracted to separate file)\n  - Removed private FoodRecordRowView struct (extracted to separate file)\n  - Kept NutritionSummaryCardView as private (will extract in subtask 3.4)\n\n**Code Quality:**\n- Follows established SwiftUI patterns from existing codebase\n- Korean and English documentation following project style\n- SwiftUI best practices (PlainButtonStyle for nested buttons to avoid conflicts)\n- Comprehensive previews with multiple examples for both components\n- Proper separation of concerns with callback-based architecture\n- Type-safe with proper protocol usage\n\n**All Acceptance Criteria Met:**\n\u2705 Display meal type header with calorie subtotal\n\u2705 List food items with name, quantity, calories\n\u2705 Swipe to delete functionality\n\u2705 Tap to edit functionality\n\u2705 Add food button\n\nFiles created:\n- Bodii/Presentation/Features/Diet/Views/Components/MealSectionView.swift\n- Bodii/Presentation/Features/Diet/Views/Components/FoodRecordRow.swift\n\nFiles modified:\n- Bodii/Presentation/Features/Diet/Views/DailyMealView.swift\n\nCommit: 75dd9f3\nStatus: Ready for use in production",
          "updated_at": "2026-01-13T08:38:58.461787+00:00"
        },
        {
          "id": "3.4",
          "title": "Create NutritionSummaryCard",
          "description": "Implement daily nutrition summary card showing calories and macro breakdown with visual charts.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/NutritionSummaryCard.swift",
            "Bodii/Presentation/Views/Diet/Components/MacroRatioChart.swift"
          ],
          "acceptance_criteria": [
            "Display total calories consumed vs TDEE",
            "Show remaining calories",
            "Display macro breakdown (carbs, protein, fat in grams)",
            "Pie chart for macro ratios",
            "Color coding for each macro"
          ],
          "estimated_hours": 2.5,
          "notes": "Successfully extracted and implemented NutritionSummaryCard and MacroRatioChart components:\n\n**New Components Created:**\n1. MacroRatioChart.swift (276 lines)\n   - Visual pie chart component for macro ratios\n   - Color-coded slices (carbs: blue, protein: orange, fat: purple)\n   - Custom PieSlice shape using SwiftUI Path API\n   - Handles empty state with gray circle\n   - Comprehensive previews with different diet types (balanced, high-carb, high-protein, empty)\n\n2. NutritionSummaryCard.swift (376 lines)\n   - Enhanced nutrition summary with chart integration\n   - Calorie section:\n     * Total calories vs TDEE display\n     * Progress bar with dynamic color coding (blue < 50%, green 50-90%, orange 90-110%, red > 110%)\n     * Remaining calories with color indication\n   - Macro section:\n     * Integrated MacroRatioChart for visual representation\n     * Detailed macro list with amounts (g) and percentages (%)\n     * Color indicators matching chart colors\n   - Comprehensive previews (balanced diet, high-carb diet, empty state)\n\n**Updated Files:**\n- DailyMealView.swift (375 lines, reduced from 554)\n  - Removed private NutritionSummaryCardView struct (179 lines)\n  - Now uses extracted NutritionSummaryCard component\n  - Cleaner separation of concerns\n  - Improved maintainability and reusability\n\n**Code Quality:**\n- Follows established SwiftUI patterns from existing components\n- Korean and English documentation following project style\n- Reusable components with comprehensive #Preview\n- Type-safe with proper protocol usage\n- Proper color coding for visual feedback and user experience\n- Clean separation between data (DailyLog) and presentation (Charts)\n\n**All Acceptance Criteria Met:**\n\u2705 Display total calories consumed vs TDEE\n\u2705 Show remaining calories\n\u2705 Display macro breakdown (carbs, protein, fat in grams)\n\u2705 Pie chart for macro ratios\n\u2705 Color coding for each macro\n\nCommit: 9f0ee27\nStatus: Ready for production use in Phase 4+",
          "updated_at": "2026-01-13T08:46:34.263106+00:00"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "UI - Food Search Screen",
      "description": "Implement food search and selection screen",
      "status": "pending",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Create FoodSearchView",
          "description": "Implement food search screen with search bar, recent/frequent foods, and search results.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/FoodSearchView.swift"
          ],
          "acceptance_criteria": [
            "Search bar with clear button",
            "Recent foods section (when not searching)",
            "Frequent foods section (when not searching)",
            "Search results list with nutrition preview",
            "Manual entry button at bottom"
          ],
          "estimated_hours": 3,
          "notes": ""
        },
        {
          "id": "4.2",
          "title": "Create FoodSearchResultRow",
          "description": "Implement search result row component showing food name, serving info, and key nutrition facts.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/FoodSearchResultRow.swift"
          ],
          "acceptance_criteria": [
            "Food name display",
            "Serving size info",
            "Calories per serving",
            "Compact macro preview (P/C/F)",
            "Chevron for navigation"
          ],
          "estimated_hours": 1.5,
          "notes": ""
        },
        {
          "id": "4.3",
          "title": "Create QuickAddSection",
          "description": "Implement quick-add section showing recent and frequently consumed foods in a horizontal scroll or grid.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/QuickAddSection.swift",
            "Bodii/Presentation/Views/Diet/Components/QuickAddFoodChip.swift"
          ],
          "acceptance_criteria": [
            "Section header (Recent/Frequent)",
            "Horizontal scrollable food chips",
            "Food chip shows name and calories",
            "Tap to add with default quantity",
            "Long press for quantity picker"
          ],
          "estimated_hours": 2,
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "UI - Food Detail & Add Screen",
      "description": "Implement food detail screen with serving size adjustment",
      "status": "pending",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Create FoodDetailViewModel",
          "description": "Implement ViewModel for food detail screen with quantity adjustment and nutrition calculation.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/ViewModels/FoodDetailViewModel.swift"
          ],
          "acceptance_criteria": [
            "Load food details",
            "Calculate nutrition based on quantity",
            "Support serving multiplier (0.25x, 0.5x, 1x, 1.5x, 2x)",
            "Support custom quantity input",
            "Validate quantity (min 0.1)",
            "Save food record"
          ],
          "estimated_hours": 2,
          "notes": ""
        },
        {
          "id": "5.2",
          "title": "Create FoodDetailView",
          "description": "Implement food detail screen showing full nutrition info with serving size picker and meal type selector.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/FoodDetailView.swift"
          ],
          "acceptance_criteria": [
            "Food name header",
            "Full nutrition facts display",
            "Serving size selector (preset values)",
            "Custom quantity input field",
            "Meal type picker (breakfast/lunch/dinner/snack)",
            "Add to meal button"
          ],
          "estimated_hours": 3,
          "notes": ""
        },
        {
          "id": "5.3",
          "title": "Create ServingSizePicker",
          "description": "Implement serving size picker component with preset values and custom input.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/ServingSizePicker.swift"
          ],
          "acceptance_criteria": [
            "Preset buttons (0.25x, 0.5x, 1x, 1.5x, 2x)",
            "Custom quantity text field",
            "Toggle between serving and gram mode",
            "Real-time nutrition update preview",
            "Input validation"
          ],
          "estimated_hours": 2,
          "notes": ""
        },
        {
          "id": "5.4",
          "title": "Create NutritionFactsCard",
          "description": "Implement nutrition facts card showing detailed breakdown like a nutrition label.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/Components/NutritionFactsCard.swift"
          ],
          "acceptance_criteria": [
            "Calories prominently displayed",
            "Carbohydrates with fiber/sugar breakdown",
            "Protein amount",
            "Fat amount",
            "Sodium amount (if available)",
            "Serving size info"
          ],
          "estimated_hours": 1.5,
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "UI - Manual Food Entry",
      "description": "Implement manual food entry for foods not in database",
      "status": "pending",
      "subtasks": [
        {
          "id": "6.1",
          "title": "Create ManualFoodEntryViewModel",
          "description": "Implement ViewModel for manual food entry with validation and save functionality.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/ViewModels/ManualFoodEntryViewModel.swift"
          ],
          "acceptance_criteria": [
            "Input fields for all nutrition values",
            "Validate required fields (name, calories)",
            "Validate numeric values",
            "Save as user-defined food",
            "Add to meal after saving"
          ],
          "estimated_hours": 2,
          "notes": ""
        },
        {
          "id": "6.2",
          "title": "Create ManualFoodEntryView",
          "description": "Implement manual food entry screen with form for entering food details.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/ManualFoodEntryView.swift"
          ],
          "acceptance_criteria": [
            "Food name text field (required)",
            "Serving size and unit fields",
            "Calories field (required)",
            "Carbohydrates field",
            "Protein field",
            "Fat field",
            "Optional: sodium, fiber, sugar",
            "Save button with validation"
          ],
          "estimated_hours": 2.5,
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Integration & Polish",
      "description": "Wire up all components and add final polish",
      "status": "pending",
      "subtasks": [
        {
          "id": "7.1",
          "title": "Integrate with Tab Navigation",
          "description": "Add Diet tab to main tab view and set up navigation flow between all diet screens.",
          "status": "pending",
          "files": [
            "Bodii/App/ContentView.swift",
            "Bodii/Presentation/Views/Diet/DietTabView.swift"
          ],
          "acceptance_criteria": [
            "Add Diet tab to TabView",
            "Navigation from daily view to search",
            "Navigation from search to detail",
            "Navigation from search to manual entry",
            "Proper back navigation"
          ],
          "estimated_hours": 1.5,
          "notes": ""
        },
        {
          "id": "7.2",
          "title": "Register Services in DI Container",
          "description": "Register all new services and repositories in the dependency injection container.",
          "status": "pending",
          "files": [
            "Bodii/App/DIContainer.swift"
          ],
          "acceptance_criteria": [
            "Register FoodRepository",
            "Register FoodRecordRepository",
            "Register DailyLogRepository",
            "Register FoodRecordService",
            "Register LocalFoodSearchService",
            "Register RecentFoodsService"
          ],
          "estimated_hours": 1,
          "notes": ""
        },
        {
          "id": "7.3",
          "title": "Add Sample Food Data",
          "description": "Create sample Korean food data for testing and initial app usage.",
          "status": "pending",
          "files": [
            "Bodii/Data/SampleData/SampleFoods.swift"
          ],
          "acceptance_criteria": [
            "Create 20+ common Korean foods",
            "Include accurate nutrition data",
            "Cover breakfast, lunch, dinner categories",
            "Add serving size information"
          ],
          "estimated_hours": 2,
          "notes": ""
        },
        {
          "id": "7.4",
          "title": "Write Integration Tests",
          "description": "Create integration tests for the complete meal logging flow.",
          "status": "pending",
          "files": [
            "BodiiTests/MealLoggingIntegrationTests.swift"
          ],
          "acceptance_criteria": [
            "Test add food flow end-to-end",
            "Test DailyLog updates correctly",
            "Test delete food updates totals",
            "Test date navigation"
          ],
          "estimated_hours": 2,
          "notes": ""
        },
        {
          "id": "7.5",
          "title": "UI Polish & Accessibility",
          "description": "Add final UI polish including loading states, animations, and accessibility labels.",
          "status": "pending",
          "files": [
            "Bodii/Presentation/Views/Diet/*.swift"
          ],
          "acceptance_criteria": [
            "Add loading indicators",
            "Add success/error toasts",
            "Smooth transitions between screens",
            "VoiceOver accessibility labels",
            "Dynamic Type support"
          ],
          "estimated_hours": 2,
          "notes": ""
        }
      ]
    }
  ],
  "total_estimated_hours": 55,
  "dependencies": {
    "external": [
      "Core Data model already set up with Food, FoodRecord, DailyLog entities",
      "MealType, QuantityUnit, FoodSource enums already defined",
      "ValidationService for input validation",
      "Date utilities for date handling"
    ],
    "internal": {
      "phase-2": [
        "phase-1"
      ],
      "phase-3": [
        "phase-1",
        "phase-2"
      ],
      "phase-4": [
        "phase-2"
      ],
      "phase-5": [
        "phase-1",
        "phase-4"
      ],
      "phase-6": [
        "phase-1"
      ],
      "phase-7": [
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6"
      ]
    }
  },
  "qa_checklist": {
    "status": "pending",
    "items": [
      "Users can log food to breakfast, lunch, dinner, or snacks",
      "Food search shows nutrition preview",
      "Manual food entry available with all macro fields",
      "Serving size adjustable (0.25x, 0.5x, 1x, 1.5x, 2x, custom)",
      "Daily summary shows total calories, protein, carbs, fat",
      "Meal view shows individual food items with edit/delete",
      "Recent and frequent foods appear in quick-add section",
      "DailyLog correctly updates on food add/delete",
      "Macro ratios calculate correctly",
      "Net calories (intake - TDEE) displays correctly"
    ],
    "tests_passed": "",
    "issues": ""
  },
  "last_updated": "2026-01-13T08:46:34.263113+00:00"
}