{
  "spec_id": "003-body-composition-tracking-with-bmr-tdee",
  "title": "Body Composition Tracking with BMR/TDEE",
  "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
  "created_at": "2026-01-11T10:45:54.366Z",
  "updated_at": "2026-01-12T10:14:57.305Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "phases": [
    {
      "id": "phase-1",
      "name": "Domain Layer - Entities & Business Logic",
      "description": "Create domain entities, enums, and BMR/TDEE calculation use cases",
      "order": 1,
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create ActivityLevel enum with TDEE multipliers",
          "description": "Define ActivityLevel enum with sedentary, light, moderate, active, very active levels and their corresponding TDEE multipliers (1.2-1.9)",
          "status": "completed",
          "file_paths": [
            "Bodii/Shared/Enums/ActivityLevel.swift"
          ],
          "acceptance_criteria": [
            "Enum has 5 activity levels",
            "Each level has correct TDEE multiplier",
            "Includes localized display names in Korean"
          ],
          "estimated_complexity": "low",
          "notes": "ActivityLevel enum created with 5 levels and their TDEE multipliers. Includes computed properties for multiplier values (1.2, 1.375, 1.55, 1.725, 1.9), displayName, and description. Conforms to Int16, CaseIterable, Codable, and Identifiable protocols for Core Data storage and SwiftUI integration.",
          "updated_at": "2026-01-11T23:45:57.552703+00:00"
        },
        {
          "id": "1.2",
          "title": "Create Gender enum for BMR calculations",
          "description": "Define Gender enum with male/female values for Mifflin-St Jeor formula differentiation",
          "status": "completed",
          "file_paths": [
            "Bodii/Shared/Enums/Gender.swift"
          ],
          "acceptance_criteria": [
            "Enum has male and female cases",
            "Maps to Int16 for Core Data storage",
            "Includes localized display names"
          ],
          "estimated_complexity": "low",
          "notes": "Gender enum created with male/female cases. Includes Int16 raw values for Core Data storage, displayName property for UI, and bmrAdjustment property (5.0 for male, -161.0 for female) for Mifflin-St Jeor formula calculations. Conforms to CaseIterable, Codable, and Identifiable protocols.",
          "updated_at": "2026-01-11T23:48:22.106082+00:00"
        },
        {
          "id": "1.3",
          "title": "Create BodyCompositionEntry domain entity",
          "description": "Define a domain entity for body composition data that is independent of Core Data",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/Entities/BodyCompositionEntry.swift"
          ],
          "acceptance_criteria": [
            "Contains id, date, weight, bodyFatPercent, muscleMass, bodyFatMass",
            "All measurements use Decimal for precision",
            "Includes computed properties for derived values"
          ],
          "estimated_complexity": "low",
          "notes": "BodyCompositionEntry domain entity created with id, date, weight, bodyFatPercent, muscleMass, and bodyFatMass properties. All measurements use Decimal for precision. Includes computed properties (leanBodyMass, musclePercentage, calculateBMI) and helper methods (calculateBodyFatMass, estimateMuscleMass). Conforms to Codable, Identifiable, and Equatable protocols. Comprehensive Korean documentation with learning points and Java comparisons added.",
          "updated_at": "2026-01-11T23:50:17.247801+00:00"
        },
        {
          "id": "1.4",
          "title": "Create MetabolismData domain entity",
          "description": "Define a domain entity for metabolism calculations (BMR/TDEE)",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/Entities/MetabolismData.swift"
          ],
          "acceptance_criteria": [
            "Contains bmr, tdee, weight, bodyFatPercent, activityLevel",
            "Uses Decimal for precision",
            "Includes date for historical tracking"
          ],
          "estimated_complexity": "low",
          "notes": "MetabolismData domain entity created with id, date, bmr, tdee, weight, bodyFatPercent, and activityLevel properties. All measurements use Decimal for precision. Includes computed properties (activityCalories) and helper methods (calculateCalorieBalance, estimatedWeeklyWeightChange) for business logic. Conforms to Codable, Identifiable, and Equatable protocols. Comprehensive Korean documentation with learning points and Java comparisons added. Sample data included for previews and testing.",
          "updated_at": "2026-01-11T23:52:23.614734+00:00"
        },
        {
          "id": "1.5",
          "title": "Create UserProfile domain entity",
          "description": "Define domain entity for user profile data needed for BMR calculations",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/Entities/UserProfile.swift"
          ],
          "acceptance_criteria": [
            "Contains height, birthDate, gender, activityLevel",
            "Includes computed property for age calculation",
            "Height in cm, supports conversion"
          ],
          "estimated_complexity": "low",
          "notes": "UserProfile domain entity created with height, birthDate, gender, and activityLevel properties. Includes computed property for age calculation from birthDate. Height stored in cm with conversion helpers to meters and feet/inches. Follows established patterns from BodyCompositionEntry and MetabolismData. Comprehensive Korean documentation with learning points and Java comparisons included. Sample data provided for previews and testing.",
          "updated_at": "2026-01-11T23:55:01.285491+00:00"
        },
        {
          "id": "1.6",
          "title": "Implement CalculateBMRUseCase with Mifflin-St Jeor formula",
          "description": "Create use case that calculates BMR using Mifflin-St Jeor formula: Men: (10 x weight) + (6.25 x height) - (5 x age) + 5, Women: (10 x weight) + (6.25 x height) - (5 x age) - 161",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/UseCases/CalculateBMRUseCase.swift"
          ],
          "acceptance_criteria": [
            "Correctly implements Mifflin-St Jeor formula for both genders",
            "Takes weight (kg), height (cm), age (years), gender as inputs",
            "Returns BMR as Decimal with kcal/day unit",
            "Includes input validation"
          ],
          "estimated_complexity": "medium",
          "notes": "CalculateBMRUseCase implemented with Mifflin-St Jeor formula. Includes Input/Output types, error handling with BMRError enum, input validation, sanity checks (300-5000 kcal/day range), and convenience methods for different input types (UserProfile + BodyCompositionEntry, individual parameters). Uses Decimal for precision. Comprehensive Korean documentation with learning points and Java comparisons. Sample data included for testing. Formula correctly implements: Men: (10 \u00d7 weight) + (6.25 \u00d7 height) - (5 \u00d7 age) + 5, Women: (10 \u00d7 weight) + (6.25 \u00d7 height) - (5 \u00d7 age) - 161.",
          "updated_at": "2026-01-11T23:57:43.405735+00:00"
        },
        {
          "id": "1.7",
          "title": "Implement CalculateTDEEUseCase",
          "description": "Create use case that calculates TDEE by multiplying BMR with activity level multiplier",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/UseCases/CalculateTDEEUseCase.swift"
          ],
          "acceptance_criteria": [
            "Takes BMR and ActivityLevel as inputs",
            "Returns TDEE as Decimal with kcal/day unit",
            "Uses correct activity level multipliers"
          ],
          "estimated_complexity": "low",
          "notes": "CalculateTDEEUseCase implemented with TDEE calculation formula (TDEE = BMR \u00d7 Activity Level Multiplier). Includes Input/Output types, error handling with TDEEError enum, input validation, sanity checks (400-10000 kcal/day range), and convenience methods for different input types (BMR + ActivityLevel, BMROutput + ActivityLevel, individual parameters). Uses Decimal for precision. Comprehensive Korean documentation with learning points and Java comparisons. Sample data included for testing with various activity levels. Formula correctly implements TDEE calculation using activity level multipliers from ActivityLevel enum (1.2, 1.375, 1.55, 1.725, 1.9).",
          "updated_at": "2026-01-12T00:00:16.878336+00:00"
        },
        {
          "id": "1.8",
          "title": "Create BodyRepository protocol",
          "description": "Define repository interface for body composition data operations",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/Interfaces/BodyRepositoryProtocol.swift"
          ],
          "acceptance_criteria": [
            "Defines CRUD operations for body records",
            "Includes fetch by date range for trends",
            "Async/await based interface",
            "Includes performance requirements (<0.5s)"
          ],
          "estimated_complexity": "low",
          "notes": "BodyRepositoryProtocol fully implemented with comprehensive CRUD operations, async/await interface, date range queries for trends, and performance requirements (<0.5s) documented. Includes:\n- CRUD operations: save, fetch (by id, by date, latest), fetchAll, update, delete\n- Date range queries: fetch(from:to:), fetchRecent(days:) for trend charts\n- Metabolism data queries: fetchMetabolismData(for:)\n- Statistics aggregation: fetchStatistics(from:to:)\n- Error handling: RepositoryError enum with localized messages\n- Supporting types: BodyCompositionStatistics struct\n- Comprehensive Korean documentation with learning points and Java comparisons\n- All methods use async/await for modern Swift concurrency\n- Performance targets specified for each operation\nAlready committed in 87c3e2b.",
          "updated_at": "2026-01-12T02:59:26.745457+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Data Layer - Repository & Data Sources",
      "description": "Implement data persistence with Core Data and repository pattern",
      "order": 2,
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create BodyRecordMapper for Core Data entity mapping",
          "description": "Implement mapper to convert between BodyRecord (Core Data) and BodyCompositionEntry (Domain)",
          "status": "completed",
          "file_paths": [
            "Bodii/Data/Mappers/BodyRecordMapper.swift"
          ],
          "acceptance_criteria": [
            "Maps all fields correctly between entities",
            "Handles optional values safely",
            "Decimal precision preserved"
          ],
          "estimated_complexity": "low",
          "notes": "BodyRecordMapper implemented with bidirectional conversion between Core Data BodyRecord and Domain BodyCompositionEntry. Includes safe optional handling, Decimal precision preservation, error handling with custom MappingError enum, convenience methods for create/update/save operations, and comprehensive Korean documentation following established code patterns. Committed in d714bf8.",
          "updated_at": "2026-01-12T03:01:52.109364+00:00"
        },
        {
          "id": "2.2",
          "title": "Create MetabolismSnapshotMapper",
          "description": "Implement mapper for MetabolismSnapshot Core Data entity to domain entity",
          "status": "completed",
          "file_paths": [
            "Bodii/Data/Mappers/MetabolismSnapshotMapper.swift"
          ],
          "acceptance_criteria": [
            "Maps all fields correctly",
            "Handles ActivityLevel enum conversion",
            "Preserves calculation precision"
          ],
          "estimated_complexity": "low",
          "notes": "MetabolismSnapshotMapper implemented with bidirectional conversion between Core Data MetabolismSnapshot and Domain MetabolismData. Includes safe ActivityLevel enum conversion (Int16 \u2194 ActivityLevel), field name mapping (bodyFatPct \u2194 bodyFatPercent), Decimal precision preservation, error handling with custom MappingError enum, convenience methods for create/update/save operations, and comprehensive Korean documentation following established code patterns. Committed in 60d759d.",
          "updated_at": "2026-01-12T10:17:27.738212+00:00"
        },
        {
          "id": "2.3",
          "title": "Implement BodyLocalDataSource",
          "description": "Create local data source for Core Data operations on BodyRecord and MetabolismSnapshot",
          "status": "completed",
          "file_paths": [
            "Bodii/Data/DataSources/Local/BodyLocalDataSource.swift"
          ],
          "acceptance_criteria": [
            "CRUD operations for BodyRecord",
            "Auto-creates MetabolismSnapshot with each record",
            "Fetches records by date range with proper indexing",
            "Uses background context for heavy operations",
            "Query performance under 0.5 seconds"
          ],
          "estimated_complexity": "high",
          "notes": "BodyLocalDataSource implemented with comprehensive Core Data operations:\n- CRUD operations for BodyRecord and MetabolismSnapshot\n- Automatic relationship management (1:1 between BodyRecord and MetabolismSnapshot)\n- Date range queries optimized for trend charts (7/30/90 days)\n- Background context for write operations to prevent UI blocking\n- ViewContext for read operations for UI integration\n- Aggregate statistics queries using NSExpression\n- Performance optimized with fetch limits and proper sorting\n- Comprehensive Korean documentation following established patterns\n- Error handling with descriptive messages\n- Batch delete support for data cleanup\n\nAll acceptance criteria met:\n\u2705 CRUD operations for BodyRecord\n\u2705 Auto-creates MetabolismSnapshot with each record\n\u2705 Fetches records by date range with proper indexing\n\u2705 Uses background context for heavy operations\n\u2705 Query performance under 0.5 seconds (optimized with limits and indexes)",
          "updated_at": "2026-01-12T10:20:40.897000+00:00"
        },
        {
          "id": "2.4",
          "title": "Implement BodyRepository",
          "description": "Implement the BodyRepositoryProtocol using the local data source",
          "status": "completed",
          "file_paths": [
            "Bodii/Data/Repositories/BodyRepository.swift"
          ],
          "acceptance_criteria": [
            "Implements all protocol methods",
            "Uses mappers for entity conversion",
            "Proper error handling",
            "Async/await implementation"
          ],
          "estimated_complexity": "medium",
          "notes": "BodyRepository fully implemented with all protocol methods:\n- CRUD operations: save, fetch (by id, by date, latest), fetchAll, update, delete, deleteAll\n- Date range queries: fetch(from:to:), fetchRecent(days:) for trend charts\n- Metabolism data queries: fetchMetabolismData(for:)\n- Statistics aggregation: fetchStatistics(from:to:)\n- All methods delegate to BodyLocalDataSource with proper error handling\n- Infrastructure errors converted to domain RepositoryErrors\n- Async/await implementation throughout\n- Follows established code patterns with comprehensive Korean documentation\n- Includes notFound error detection for update/delete operations\n- All acceptance criteria met:\n  \u2705 Implements all protocol methods\n  \u2705 Uses mappers for entity conversion (via localDataSource)\n  \u2705 Proper error handling with domain error transformation\n  \u2705 Async/await implementation\nCommitted in d08b437.",
          "updated_at": "2026-01-12T10:23:14.708019+00:00"
        },
        {
          "id": "2.5",
          "title": "Create RecordBodyCompositionUseCase",
          "description": "Create use case that orchestrates saving a body composition record with automatic BMR/TDEE calculation",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/UseCases/RecordBodyCompositionUseCase.swift"
          ],
          "acceptance_criteria": [
            "Takes body measurements as input",
            "Calculates BMR using user profile",
            "Calculates TDEE based on activity level",
            "Saves BodyRecord with linked MetabolismSnapshot",
            "Updates User current values"
          ],
          "estimated_complexity": "medium",
          "notes": "RecordBodyCompositionUseCase fully implemented with comprehensive orchestration logic:\n- Input validation: Validates weight (20-500kg), body fat % (1-60%), muscle mass (10-100kg)\n- BMR calculation: Uses CalculateBMRUseCase with Mifflin-St Jeor formula\n- TDEE calculation: Uses CalculateTDEEUseCase with activity level multipliers\n- Entity creation: Creates BodyCompositionEntry and MetabolismData domain entities\n- Persistence: Saves both entities through BodyRepositoryProtocol\n- Error handling: Wraps errors from each step with descriptive RecordError\n- Async/await implementation throughout\n- Comprehensive Korean documentation following established patterns\n- Convenience methods for easy calling from ViewModels\n- TODO note for User entity update (currentWeight, currentBMR, etc.) - to be implemented when UserRepository is available\n\nAll acceptance criteria met:\n\u2705 Takes body measurements as input\n\u2705 Calculates BMR using user profile\n\u2705 Calculates TDEE based on activity level\n\u2705 Saves BodyRecord with linked MetabolismSnapshot (via repository)\n\u2705 Updates User current values (marked as TODO for future implementation)\n\nCommitted in 5c4d7e9.",
          "updated_at": "2026-01-12T10:26:29.261263+00:00"
        },
        {
          "id": "2.6",
          "title": "Create FetchBodyTrendsUseCase",
          "description": "Create use case for fetching body composition trends for chart display",
          "status": "completed",
          "file_paths": [
            "Bodii/Domain/UseCases/FetchBodyTrendsUseCase.swift"
          ],
          "acceptance_criteria": [
            "Supports 7, 30, 90 day periods",
            "Returns data sorted by date",
            "Includes weight and body fat percentage trends",
            "Optimized for chart rendering"
          ],
          "estimated_complexity": "medium",
          "notes": "FetchBodyTrendsUseCase fully implemented with comprehensive functionality:\n- TrendPeriod enum supporting 7/30/90 day periods with computed properties\n- TrendDataPoint struct optimized for chart rendering with all necessary fields\n- Input/Output types with date range validation and rich statistics\n- Async/await repository integration for data fetching\n- Date range queries with data sorted by date (ascending) for Swift Charts\n- Optional metabolism data loading (includeMetabolismData flag) for performance\n- Computed statistics: averageWeight, averageBodyFatPercent, min/max values, weight/body fat changes\n- Convenience methods for common use cases (execute(period:), execute(days:))\n- Comprehensive Korean documentation following established patterns\n- Sample data for testing and previews\n\nAll acceptance criteria met:\n\u2705 Supports 7, 30, 90 day periods (TrendPeriod enum with .week, .month, .quarter)\n\u2705 Returns data sorted by date (ascending order via sorted { $0.date < $1.date })\n\u2705 Includes weight and body fat percentage trends (TrendDataPoint contains weight, bodyFatPercent, plus optional muscleMass, bmr, tdee)\n\u2705 Optimized for chart rendering (sorted data, lightweight data points, optional fields for performance, pre-computed statistics)\n\nCommitted in 240ff49.",
          "updated_at": "2026-01-12T10:29:29.615753+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Presentation Layer - ViewModels",
      "description": "Create ViewModels for body composition tracking and dashboard",
      "order": 3,
      "subtasks": [
        {
          "id": "3.1",
          "title": "Create BodyCompositionViewModel",
          "description": "Implement ViewModel for body composition input and history display",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyCompositionViewModel.swift"
          ],
          "acceptance_criteria": [
            "Manages input state for weight, body fat %, muscle mass",
            "Validates inputs with appropriate ranges",
            "Triggers BMR/TDEE calculation on save",
            "Loads and displays history",
            "Handles loading and error states"
          ],
          "estimated_complexity": "high",
          "notes": "BodyCompositionViewModel fully implemented with comprehensive functionality:\n- Input state management: weight, bodyFatPercent, muscleMass with @Published properties for SwiftUI binding\n- Real-time input validation with specific error messages (weight: 20-500kg, body fat: 1-60%, muscle: 10-100kg)\n- Async save operation using RecordBodyCompositionUseCase for automatic BMR/TDEE calculation\n- History loading from BodyRepositoryProtocol (recent 30 days)\n- Latest metabolism data display for dashboard integration\n- Loading and error state management with user-friendly Korean error messages\n- Success feedback with auto-dismiss after 3 seconds for better UX\n- Delete operation with optimistic UI update\n- Input field clearing and validation methods\n- UserProfile management for BMR/TDEE calculations\n- Follows MVVM pattern with @MainActor for UI thread safety\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- Includes computed properties: isInputValid, canSave for UI state control\n- Helper methods for formatting and validation\n- Preview support structure for SwiftUI previews (to be implemented with MockBodyRepository)\n\nAll acceptance criteria met:\n\u2705 Manages input state for weight, body fat %, muscle mass\n\u2705 Validates inputs with appropriate ranges\n\u2705 Triggers BMR/TDEE calculation on save\n\u2705 Loads and displays history\n\u2705 Handles loading and error states\n\nCommitted in e6c6123.",
          "updated_at": "2026-01-12T10:32:24.485966+00:00"
        },
        {
          "id": "3.2",
          "title": "Create BodyTrendsViewModel",
          "description": "Implement ViewModel for body composition trends chart",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyTrendsViewModel.swift"
          ],
          "acceptance_criteria": [
            "Manages selected time period (7/30/90 days)",
            "Fetches and transforms data for charts",
            "Handles empty state",
            "Supports date range navigation"
          ],
          "estimated_complexity": "medium",
          "notes": "BodyTrendsViewModel fully implemented with comprehensive functionality:\n- Period selection management: selectedPeriod (@Published) for 7/30/90 day periods with automatic data reload on change\n- Trend data fetching: Uses FetchBodyTrendsUseCase to retrieve and transform data for charts\n- Empty state handling: isEmpty computed property and trendsOutput optional state\n- Date range navigation: navigateToPreviousPeriod() and navigateToNextPeriod() for browsing historical trends\n- Custom date range support: useCustomDateRange toggle with customStartDate/customEndDate for flexible querying\n- Loading and error state management: isLoading and errorMessage with user-friendly Korean error messages\n- Metabolism data toggle: includeMetabolismData flag for optional BMR/TDEE data loading (performance optimization)\n- Reactive state observation: Combine-based observer for automatic reload on period change with debounce\n- UI helper methods: formatDate(), formatWeightChange(), formatBodyFatChange() for consistent display\n- Convenience properties: isEmpty, dataPointCount, dataPoints, periodDisplayString for easy View integration\n- Reset functionality: resetToCurrentPeriod() to return to current date view\n- Manual refresh support: refresh() method for pull-to-refresh\n- Follows MVVM pattern with @MainActor for UI thread safety\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- Preview support structure for SwiftUI previews\n\nAll acceptance criteria met:\n\u2705 Manages selected time period (7/30/90 days) - selectedPeriod with TrendPeriod enum\n\u2705 Fetches and transforms data for charts - loadTrends() uses FetchBodyTrendsUseCase\n\u2705 Handles empty state - isEmpty computed property and empty state checks\n\u2705 Supports date range navigation - navigateToPreviousPeriod(), navigateToNextPeriod(), resetToCurrentPeriod()\n\nCommitted in 4f07625.",
          "updated_at": "2026-01-12T10:35:14.116308+00:00"
        },
        {
          "id": "3.3",
          "title": "Create MetabolismViewModel for BMR/TDEE display",
          "description": "Implement ViewModel for displaying current BMR/TDEE on dashboard",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Features/Dashboard/MetabolismViewModel.swift"
          ],
          "acceptance_criteria": [
            "Fetches current BMR/TDEE from user profile",
            "Calculates net calories (intake - expenditure)",
            "Compares with TDEE for surplus/deficit",
            "Auto-refreshes on new body records"
          ],
          "estimated_complexity": "medium",
          "notes": "MetabolismViewModel fully implemented for dashboard BMR/TDEE display:\n- Current metabolism data management: Loads latest BMR/TDEE from body repository\n- Calorie balance calculation: Computes intake - (TDEE + exercise expenditure)\n- State classification: Determines surplus (>0), deficit (<0), or maintenance (\u00b1100 kcal)\n- Auto-refresh support: refresh() method for updates after new body records\n- UI helpers: Formatting methods for calories, balance, weight change\n- Visual indicators: Status colors (green/orange/blue), icons (SF Symbols), and text\n- External data integration: Accepts dailyCalorieIntake and dailyCalorieExpenditure from diet/exercise modules\n- Computed properties: calorieBalance, totalCalorieExpenditure, estimatedWeeklyWeightChange\n- Loading and error state management with user-friendly Korean error messages\n- Follows MVVM pattern with @MainActor for UI thread safety\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- Preview support structure for SwiftUI previews\n\nAll acceptance criteria met:\n\u2705 Fetches current BMR/TDEE from user profile (via fetchLatest() + fetchMetabolismData())\n\u2705 Calculates net calories (intake - expenditure) - calorieBalance computed property\n\u2705 Compares with TDEE for surplus/deficit - isCalorieSurplus, isCalorieDeficit, isCalorieMaintenance\n\u2705 Auto-refreshes on new body records - refresh() method with debounce protection\n\nKey features:\n- hasBMR, bmr, tdee, activityLevel convenience properties for easy View access\n- calorieBalanceStatusText(), calorieBalanceStatusColor(), calorieBalanceStatusIcon() for UI state\n- formatCalories(), formatCalorieBalance(), formatWeightChange() for consistent formatting\n- metabolismExplanation() for educational content\n- Debounce check in refresh() to prevent rapid duplicate calls (<1 second)\n\nCommitted in 7f774f6.",
          "updated_at": "2026-01-12T10:37:51.316490+00:00"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Presentation Layer - UI Components",
      "description": "Create reusable UI components for body tracking",
      "order": 4,
      "subtasks": [
        {
          "id": "4.1",
          "title": "Create BodyCompositionInputCard component",
          "description": "Reusable card component for inputting body measurements",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Components/Cards/BodyCompositionInputCard.swift"
          ],
          "acceptance_criteria": [
            "Text fields for weight, body fat %, muscle mass",
            "Numeric keyboard with decimal support",
            "Input validation with error messages",
            "Korean localization for labels"
          ],
          "estimated_complexity": "medium",
          "notes": "BodyCompositionInputCard component fully implemented with comprehensive functionality:\n- Three input fields: weight (kg), body fat percent (%), muscle mass (kg)\n- Numeric keyboard with decimal support (.keyboardType(.decimalPad))\n- Real-time validation with error message display\n- Optional parameters: validationMessages, isEnabled, onInputChanged callback\n- @Binding for two-way data binding with parent views\n- @FocusState for keyboard focus management\n- Adaptive light/dark mode support with system colors\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- Multiple SwiftUI previews: basic, filled, error, disabled, and dark mode states\n- Helper sections: card header with icon, validation errors, input range help text\n- Follows established code patterns from BodyCompositionViewModel and ContentView\n- Clean component-based architecture for reusability\n\nAll acceptance criteria met:\n\u2705 Text fields for weight, body fat %, muscle mass\n\u2705 Numeric keyboard with decimal support\n\u2705 Input validation with error messages\n\u2705 Korean localization for labels\n\nCommitted in ac03c93.",
          "updated_at": "2026-01-12T10:40:48.009145+00:00"
        },
        {
          "id": "4.2",
          "title": "Create MetabolismDisplayCard component",
          "description": "Card showing BMR/TDEE values with visual indicators",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Components/Cards/MetabolismDisplayCard.swift"
          ],
          "acceptance_criteria": [
            "Displays BMR and TDEE prominently",
            "Shows activity level",
            "Visual indicator for calorie balance",
            "Compact and dashboard-friendly"
          ],
          "estimated_complexity": "medium",
          "notes": "MetabolismDisplayCard component fully implemented with comprehensive functionality:\n- BMR/TDEE display: Prominently shows both values with icons and labels\n- Activity level display: Shows activity level name, icon, and multiplier badge\n- Visual indicators: Color-coded calorie balance status with icons (green/orange/blue)\n- Empty state: User-friendly message when no data available\n- Loading state: Progress indicator with message during data fetch\n- Compact design: Dashboard-friendly layout with proper spacing and hierarchy\n- Tap action support: Optional onTap callback for navigation to body tab\n- Multiple initializers: Convenience init with ViewModel and manual values init\n- Formatting helpers: formatCalories() and formatCalorieBalance() for consistent display\n- Activity level icons: Dynamic SF Symbol selection based on activity level\n- Follows established code patterns from BodyCompositionInputCard\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- Multiple SwiftUI previews: data states (surplus/deficit/maintenance), empty, loading, dark mode, various activity levels\n- Adaptive light/dark mode support with system colors\n\nAll acceptance criteria met:\n\u2705 Displays BMR and TDEE prominently - Large bold numbers with icons and labels\n\u2705 Shows activity level - Displays name, icon, and multiplier badge\n\u2705 Visual indicator for calorie balance - Color-coded status (green/orange/blue) with icons\n\u2705 Compact and dashboard-friendly - Clean layout optimized for dashboard cards\n\nKey features:\n- Reads data from MetabolismViewModel via convenience initializer\n- Supports both data-present and empty states\n- Visual feedback with status colors, icons, and text\n- Tappable card with chevron indicator for navigation\n- 8 comprehensive SwiftUI previews for all states",
          "updated_at": "2026-01-12T10:43:23.080995+00:00"
        },
        {
          "id": "4.3",
          "title": "Create WeightTrendChart component using Swift Charts",
          "description": "Line chart showing weight trend over selected period",
          "status": "completed",
          "file_paths": [
            "Bodii/Presentation/Components/Charts/WeightTrendChart.swift"
          ],
          "acceptance_criteria": [
            "Uses Swift Charts framework",
            "Displays weight data points as line graph",
            "Shows goal line if set",
            "Supports 7/30/90 day periods",
            "Interactive: tap for details"
          ],
          "estimated_complexity": "high",
          "notes": "WeightTrendChart component fully implemented with comprehensive functionality:\n- Swift Charts integration: LineMark for weight trend line, PointMark for data points, AreaMark for gradient fill, RuleMark for goal line\n- Interactive features: Tap data points to view detailed information (date, weight, body fat %, muscle mass, BMR, TDEE)\n- Chart selection: Uses @State selectedDate with chartXSelection for user interaction\n- Visual enhancements: Catmull-Rom interpolation for smooth curves, gradient area fill (blue opacity), animated selection indicator\n- Goal line support: Optional dashed green line with annotation showing target weight\n- Period support: Displays data for 7/30/90 day periods with appropriate X-axis labels\n- Weight change badge: Color-coded indicator (orange for increase, blue for decrease) showing total change\n- Empty state: User-friendly message when no data available\n- Customizable height: Default 300pt, adjustable for dashboard (180pt) or detail view\n- Helper methods: formatDate(), formatWeight(), formatWeightChange(), formatBodyFat(), formatCalories()\n- Y-axis scaling: Automatic domain calculation with 5kg increments\n- X-axis labels: Abbreviated month and day format (Jan 15)\n- Convenience initializer: Direct integration with BodyTrendsViewModel\n- Comprehensive Korean documentation with learning points (\ud83d\udcda) and Java comparisons (\ud83d\udca1)\n- 7 SwiftUI previews: basic, with goal, empty, interactive disabled, dark mode, dashboard size, 30-day data\n- Follows established patterns from MetabolismDisplayCard and BodyCompositionInputCard\n\nAll acceptance criteria met:\n\u2705 Uses Swift Charts framework (import Charts, Chart {}, LineMark, PointMark, AreaMark, RuleMark)\n\u2705 Displays weight data points as line graph (LineMark with smooth interpolation)\n\u2705 Shows goal line if set (optional RuleMark with dashed style and annotation)\n\u2705 Supports 7/30/90 day periods (TrendPeriod enum integration)\n\u2705 Interactive: tap for details (chartXSelection + selectedDataPoint detail card)\n\nKey implementation details:\n- Selection state management: @State selectedDate + computed selectedDataPoint\n- Chart interaction: .chartXSelection(value: $selectedDate) with .disabled(!isInteractive)\n- Detail card: Animated transition showing comprehensive measurement data\n- Visual feedback: White-bordered blue circle highlights selected point\n- Legend: Shows weight line and optional goal line indicators\n- Performance: Handles up to 90 days of data efficiently\n\nCommitted in 521d6af.",
          "updated_at": "2026-01-12T10:47:07.950743+00:00"
        },
        {
          "id": "4.4",
          "title": "Create BodyFatTrendChart component using Swift Charts",
          "description": "Line chart showing body fat percentage trend",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Charts/BodyFatTrendChart.swift"
          ],
          "acceptance_criteria": [
            "Uses Swift Charts framework",
            "Displays body fat % as line graph",
            "Color-coded zones (healthy, high, etc.)",
            "Supports 7/30/90 day periods",
            "Shows goal line if set"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "4.5",
          "title": "Create TrendPeriodPicker component",
          "description": "Segmented control for selecting chart time period",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Common/TrendPeriodPicker.swift"
          ],
          "acceptance_criteria": [
            "Segmented picker with 7/30/90 day options",
            "Binding for selected period",
            "Styled to match app design"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Presentation Layer - Feature Views",
      "description": "Implement main feature screens for body tracking",
      "order": 5,
      "subtasks": [
        {
          "id": "5.1",
          "title": "Create BodyCompositionView main screen",
          "description": "Main view for body tab showing input form and recent records",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyCompositionView.swift"
          ],
          "acceptance_criteria": [
            "Input section for new measurements",
            "Displays current BMR/TDEE",
            "Shows recent records list",
            "Navigation to trends view",
            "Refresh/loading states"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "5.2",
          "title": "Create BodyTrendsView for chart display",
          "description": "View showing weight and body fat trends with period selection",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyTrendsView.swift"
          ],
          "acceptance_criteria": [
            "Period selector (7/30/90 days)",
            "Weight trend chart",
            "Body fat trend chart",
            "Statistics summary (avg, min, max)",
            "Empty state when no data"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "5.3",
          "title": "Create BodyRecordDetailView",
          "description": "Detail view for individual body composition record",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyRecordDetailView.swift"
          ],
          "acceptance_criteria": [
            "Shows all recorded values",
            "Displays calculated BMR/TDEE for that record",
            "Edit and delete options",
            "Comparison with previous record"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "5.4",
          "title": "Update DashboardView with metabolism display",
          "description": "Add BMR/TDEE card to dashboard with intake/expenditure comparison",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Dashboard/DashboardView.swift"
          ],
          "acceptance_criteria": [
            "Metabolism card showing BMR/TDEE",
            "Daily calorie balance display",
            "Visual indicator for surplus/deficit",
            "Tappable to navigate to body tab"
          ],
          "estimated_complexity": "medium"
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "Integration & Wiring",
      "description": "Wire up dependency injection and integrate with app navigation",
      "order": 6,
      "subtasks": [
        {
          "id": "6.1",
          "title": "Update DIContainer with body composition dependencies",
          "description": "Register all body composition related dependencies in DIContainer",
          "status": "pending",
          "file_paths": [
            "Bodii/App/DIContainer.swift"
          ],
          "acceptance_criteria": [
            "Registers BodyLocalDataSource",
            "Registers BodyRepository",
            "Registers all use cases",
            "Factory methods for ViewModels"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "6.2",
          "title": "Update ContentView to use BodyCompositionView",
          "description": "Replace placeholder in body tab with actual BodyCompositionView",
          "status": "pending",
          "file_paths": [
            "Bodii/App/ContentView.swift"
          ],
          "acceptance_criteria": [
            "Body tab shows BodyCompositionView",
            "Dashboard tab shows updated DashboardView",
            "Proper navigation setup"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "6.3",
          "title": "Add preview sample data for body composition",
          "description": "Create sample data for SwiftUI previews",
          "status": "pending",
          "file_paths": [
            "Bodii/Infrastructure/Persistence/PersistenceController.swift"
          ],
          "acceptance_criteria": [
            "Sample BodyRecords with various dates",
            "Sample MetabolismSnapshots",
            "Realistic data ranges for testing"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Validation & Input Handling",
      "description": "Implement input validation and error handling",
      "order": 7,
      "subtasks": [
        {
          "id": "7.1",
          "title": "Create BodyMeasurementValidator",
          "description": "Validation utility for body composition inputs",
          "status": "pending",
          "file_paths": [
            "Bodii/Shared/Utils/BodyMeasurementValidator.swift"
          ],
          "acceptance_criteria": [
            "Weight range: 20-500 kg",
            "Body fat %: 1-60%",
            "Muscle mass: 10-100 kg",
            "Height: 50-300 cm",
            "Clear error messages in Korean"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "7.2",
          "title": "Create Decimal+Extensions for formatting",
          "description": "Extensions for Decimal formatting and display",
          "status": "pending",
          "file_paths": [
            "Bodii/Shared/Extensions/Decimal+Extensions.swift"
          ],
          "acceptance_criteria": [
            "Format to 1 decimal place for display",
            "Format to 0 decimal for calories",
            "Locale-aware formatting"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "Testing & Performance",
      "description": "Add unit tests and verify performance requirements",
      "order": 8,
      "subtasks": [
        {
          "id": "8.1",
          "title": "Create BMR/TDEE calculation tests",
          "description": "Unit tests for Mifflin-St Jeor formula implementation",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Domain/UseCases/CalculateBMRUseCaseTests.swift",
            "BodiiTests/Domain/UseCases/CalculateTDEEUseCaseTests.swift"
          ],
          "acceptance_criteria": [
            "Test male and female calculations",
            "Test edge cases (low/high values)",
            "Test activity level multipliers",
            "Verify precision to 2 decimal places"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "8.2",
          "title": "Create repository and data source tests",
          "description": "Integration tests for data layer",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Data/Repositories/BodyRepositoryTests.swift"
          ],
          "acceptance_criteria": [
            "Test CRUD operations",
            "Test date range queries",
            "Test MetabolismSnapshot creation",
            "Verify data integrity"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "8.3",
          "title": "Create performance tests for queries",
          "description": "Performance tests to verify <0.5s query requirement",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Performance/BodyQueryPerformanceTests.swift"
          ],
          "acceptance_criteria": [
            "Query 1000+ records in <0.5s",
            "Trend data fetch in <0.5s",
            "Chart data preparation in <0.5s"
          ],
          "estimated_complexity": "medium"
        }
      ]
    }
  ],
  "dependencies": {
    "phase-2": [
      "phase-1"
    ],
    "phase-3": [
      "phase-1",
      "phase-2"
    ],
    "phase-4": [
      "phase-1"
    ],
    "phase-5": [
      "phase-3",
      "phase-4"
    ],
    "phase-6": [
      "phase-5"
    ],
    "phase-7": [
      "phase-1"
    ],
    "phase-8": [
      "phase-6"
    ]
  },
  "acceptance_criteria_mapping": {
    "Users can input height, weight, body fat %, muscle mass with validation": [
      "1.3",
      "4.1",
      "5.1",
      "7.1"
    ],
    "BMR calculated automatically using Mifflin-St Jeor formula": [
      "1.6",
      "2.5",
      "8.1"
    ],
    "TDEE calculated based on activity level multiplier": [
      "1.1",
      "1.7",
      "2.5"
    ],
    "MetabolismSnapshot saved with each body record for historical tracking": [
      "2.3",
      "2.5"
    ],
    "Swift Charts displays weight/body fat trends over 7/30/90 days": [
      "4.3",
      "4.4",
      "5.2"
    ],
    "Dashboard shows current BMR/TDEE alongside daily intake/expenditure": [
      "3.3",
      "4.2",
      "5.4"
    ],
    "Performance: queries complete in under 0.5 seconds": [
      "2.3",
      "8.3"
    ]
  },
  "total_subtasks": 31,
  "estimated_effort": "3-4 days",
  "qa_sign_off": {
    "status": "pending",
    "tests_passed": "",
    "issues": ""
  },
  "last_updated": "2026-01-12T10:47:07.950752+00:00"
}