{
  "spec_id": "003-body-composition-tracking-with-bmr-tdee",
  "title": "Body Composition Tracking with BMR/TDEE",
  "description": "Complete body composition logging system including height, weight, body fat percentage, muscle mass, with automatic BMR (Mifflin-St Jeor) and TDEE calculations. Visualize changes over time with Swift Charts graphs showing trends and goal progress.",
  "created_at": "2026-01-11T10:45:54.366Z",
  "updated_at": "2026-01-12T00:00:00Z",
  "status": "in_progress",
  "planStatus": "ready",
  "phases": [
    {
      "id": "phase-1",
      "name": "Domain Layer - Entities & Business Logic",
      "description": "Create domain entities, enums, and BMR/TDEE calculation use cases",
      "order": 1,
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create ActivityLevel enum with TDEE multipliers",
          "description": "Define ActivityLevel enum with sedentary, light, moderate, active, very active levels and their corresponding TDEE multipliers (1.2-1.9)",
          "status": "completed",
          "file_paths": [
            "Bodii/Shared/Enums/ActivityLevel.swift"
          ],
          "acceptance_criteria": [
            "Enum has 5 activity levels",
            "Each level has correct TDEE multiplier",
            "Includes localized display names in Korean"
          ],
          "estimated_complexity": "low",
          "notes": "ActivityLevel enum created with 5 levels and their TDEE multipliers. Includes computed properties for multiplier values (1.2, 1.375, 1.55, 1.725, 1.9), displayName, and description. Conforms to Int16, CaseIterable, Codable, and Identifiable protocols for Core Data storage and SwiftUI integration.",
          "updated_at": "2026-01-11T23:45:57.552703+00:00"
        },
        {
          "id": "1.2",
          "title": "Create Gender enum for BMR calculations",
          "description": "Define Gender enum with male/female values for Mifflin-St Jeor formula differentiation",
          "status": "pending",
          "file_paths": [
            "Bodii/Shared/Enums/Gender.swift"
          ],
          "acceptance_criteria": [
            "Enum has male and female cases",
            "Maps to Int16 for Core Data storage",
            "Includes localized display names"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "1.3",
          "title": "Create BodyCompositionEntry domain entity",
          "description": "Define a domain entity for body composition data that is independent of Core Data",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/Entities/BodyCompositionEntry.swift"
          ],
          "acceptance_criteria": [
            "Contains id, date, weight, bodyFatPercent, muscleMass, bodyFatMass",
            "All measurements use Decimal for precision",
            "Includes computed properties for derived values"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "1.4",
          "title": "Create MetabolismData domain entity",
          "description": "Define a domain entity for metabolism calculations (BMR/TDEE)",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/Entities/MetabolismData.swift"
          ],
          "acceptance_criteria": [
            "Contains bmr, tdee, weight, bodyFatPercent, activityLevel",
            "Uses Decimal for precision",
            "Includes date for historical tracking"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "1.5",
          "title": "Create UserProfile domain entity",
          "description": "Define domain entity for user profile data needed for BMR calculations",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/Entities/UserProfile.swift"
          ],
          "acceptance_criteria": [
            "Contains height, birthDate, gender, activityLevel",
            "Includes computed property for age calculation",
            "Height in cm, supports conversion"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "1.6",
          "title": "Implement CalculateBMRUseCase with Mifflin-St Jeor formula",
          "description": "Create use case that calculates BMR using Mifflin-St Jeor formula: Men: (10 x weight) + (6.25 x height) - (5 x age) + 5, Women: (10 x weight) + (6.25 x height) - (5 x age) - 161",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/UseCases/CalculateBMRUseCase.swift"
          ],
          "acceptance_criteria": [
            "Correctly implements Mifflin-St Jeor formula for both genders",
            "Takes weight (kg), height (cm), age (years), gender as inputs",
            "Returns BMR as Decimal with kcal/day unit",
            "Includes input validation"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "1.7",
          "title": "Implement CalculateTDEEUseCase",
          "description": "Create use case that calculates TDEE by multiplying BMR with activity level multiplier",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/UseCases/CalculateTDEEUseCase.swift"
          ],
          "acceptance_criteria": [
            "Takes BMR and ActivityLevel as inputs",
            "Returns TDEE as Decimal with kcal/day unit",
            "Uses correct activity level multipliers"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "1.8",
          "title": "Create BodyRepository protocol",
          "description": "Define repository interface for body composition data operations",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/Interfaces/BodyRepositoryProtocol.swift"
          ],
          "acceptance_criteria": [
            "Defines CRUD operations for body records",
            "Includes fetch by date range for trends",
            "Async/await based interface",
            "Includes performance requirements (<0.5s)"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Data Layer - Repository & Data Sources",
      "description": "Implement data persistence with Core Data and repository pattern",
      "order": 2,
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create BodyRecordMapper for Core Data entity mapping",
          "description": "Implement mapper to convert between BodyRecord (Core Data) and BodyCompositionEntry (Domain)",
          "status": "pending",
          "file_paths": [
            "Bodii/Data/Mappers/BodyRecordMapper.swift"
          ],
          "acceptance_criteria": [
            "Maps all fields correctly between entities",
            "Handles optional values safely",
            "Decimal precision preserved"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "2.2",
          "title": "Create MetabolismSnapshotMapper",
          "description": "Implement mapper for MetabolismSnapshot Core Data entity to domain entity",
          "status": "pending",
          "file_paths": [
            "Bodii/Data/Mappers/MetabolismSnapshotMapper.swift"
          ],
          "acceptance_criteria": [
            "Maps all fields correctly",
            "Handles ActivityLevel enum conversion",
            "Preserves calculation precision"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "2.3",
          "title": "Implement BodyLocalDataSource",
          "description": "Create local data source for Core Data operations on BodyRecord and MetabolismSnapshot",
          "status": "pending",
          "file_paths": [
            "Bodii/Data/DataSources/Local/BodyLocalDataSource.swift"
          ],
          "acceptance_criteria": [
            "CRUD operations for BodyRecord",
            "Auto-creates MetabolismSnapshot with each record",
            "Fetches records by date range with proper indexing",
            "Uses background context for heavy operations",
            "Query performance under 0.5 seconds"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "2.4",
          "title": "Implement BodyRepository",
          "description": "Implement the BodyRepositoryProtocol using the local data source",
          "status": "pending",
          "file_paths": [
            "Bodii/Data/Repositories/BodyRepository.swift"
          ],
          "acceptance_criteria": [
            "Implements all protocol methods",
            "Uses mappers for entity conversion",
            "Proper error handling",
            "Async/await implementation"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "2.5",
          "title": "Create RecordBodyCompositionUseCase",
          "description": "Create use case that orchestrates saving a body composition record with automatic BMR/TDEE calculation",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/UseCases/RecordBodyCompositionUseCase.swift"
          ],
          "acceptance_criteria": [
            "Takes body measurements as input",
            "Calculates BMR using user profile",
            "Calculates TDEE based on activity level",
            "Saves BodyRecord with linked MetabolismSnapshot",
            "Updates User current values"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "2.6",
          "title": "Create FetchBodyTrendsUseCase",
          "description": "Create use case for fetching body composition trends for chart display",
          "status": "pending",
          "file_paths": [
            "Bodii/Domain/UseCases/FetchBodyTrendsUseCase.swift"
          ],
          "acceptance_criteria": [
            "Supports 7, 30, 90 day periods",
            "Returns data sorted by date",
            "Includes weight and body fat percentage trends",
            "Optimized for chart rendering"
          ],
          "estimated_complexity": "medium"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Presentation Layer - ViewModels",
      "description": "Create ViewModels for body composition tracking and dashboard",
      "order": 3,
      "subtasks": [
        {
          "id": "3.1",
          "title": "Create BodyCompositionViewModel",
          "description": "Implement ViewModel for body composition input and history display",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyCompositionViewModel.swift"
          ],
          "acceptance_criteria": [
            "Manages input state for weight, body fat %, muscle mass",
            "Validates inputs with appropriate ranges",
            "Triggers BMR/TDEE calculation on save",
            "Loads and displays history",
            "Handles loading and error states"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "3.2",
          "title": "Create BodyTrendsViewModel",
          "description": "Implement ViewModel for body composition trends chart",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyTrendsViewModel.swift"
          ],
          "acceptance_criteria": [
            "Manages selected time period (7/30/90 days)",
            "Fetches and transforms data for charts",
            "Handles empty state",
            "Supports date range navigation"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "3.3",
          "title": "Create MetabolismViewModel for BMR/TDEE display",
          "description": "Implement ViewModel for displaying current BMR/TDEE on dashboard",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Dashboard/MetabolismViewModel.swift"
          ],
          "acceptance_criteria": [
            "Fetches current BMR/TDEE from user profile",
            "Calculates net calories (intake - expenditure)",
            "Compares with TDEE for surplus/deficit",
            "Auto-refreshes on new body records"
          ],
          "estimated_complexity": "medium"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Presentation Layer - UI Components",
      "description": "Create reusable UI components for body tracking",
      "order": 4,
      "subtasks": [
        {
          "id": "4.1",
          "title": "Create BodyCompositionInputCard component",
          "description": "Reusable card component for inputting body measurements",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Cards/BodyCompositionInputCard.swift"
          ],
          "acceptance_criteria": [
            "Text fields for weight, body fat %, muscle mass",
            "Numeric keyboard with decimal support",
            "Input validation with error messages",
            "Korean localization for labels"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "4.2",
          "title": "Create MetabolismDisplayCard component",
          "description": "Card showing BMR/TDEE values with visual indicators",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Cards/MetabolismDisplayCard.swift"
          ],
          "acceptance_criteria": [
            "Displays BMR and TDEE prominently",
            "Shows activity level",
            "Visual indicator for calorie balance",
            "Compact and dashboard-friendly"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "4.3",
          "title": "Create WeightTrendChart component using Swift Charts",
          "description": "Line chart showing weight trend over selected period",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Charts/WeightTrendChart.swift"
          ],
          "acceptance_criteria": [
            "Uses Swift Charts framework",
            "Displays weight data points as line graph",
            "Shows goal line if set",
            "Supports 7/30/90 day periods",
            "Interactive: tap for details"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "4.4",
          "title": "Create BodyFatTrendChart component using Swift Charts",
          "description": "Line chart showing body fat percentage trend",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Charts/BodyFatTrendChart.swift"
          ],
          "acceptance_criteria": [
            "Uses Swift Charts framework",
            "Displays body fat % as line graph",
            "Color-coded zones (healthy, high, etc.)",
            "Supports 7/30/90 day periods",
            "Shows goal line if set"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "4.5",
          "title": "Create TrendPeriodPicker component",
          "description": "Segmented control for selecting chart time period",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Components/Common/TrendPeriodPicker.swift"
          ],
          "acceptance_criteria": [
            "Segmented picker with 7/30/90 day options",
            "Binding for selected period",
            "Styled to match app design"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Presentation Layer - Feature Views",
      "description": "Implement main feature screens for body tracking",
      "order": 5,
      "subtasks": [
        {
          "id": "5.1",
          "title": "Create BodyCompositionView main screen",
          "description": "Main view for body tab showing input form and recent records",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyCompositionView.swift"
          ],
          "acceptance_criteria": [
            "Input section for new measurements",
            "Displays current BMR/TDEE",
            "Shows recent records list",
            "Navigation to trends view",
            "Refresh/loading states"
          ],
          "estimated_complexity": "high"
        },
        {
          "id": "5.2",
          "title": "Create BodyTrendsView for chart display",
          "description": "View showing weight and body fat trends with period selection",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyTrendsView.swift"
          ],
          "acceptance_criteria": [
            "Period selector (7/30/90 days)",
            "Weight trend chart",
            "Body fat trend chart",
            "Statistics summary (avg, min, max)",
            "Empty state when no data"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "5.3",
          "title": "Create BodyRecordDetailView",
          "description": "Detail view for individual body composition record",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Body/BodyRecordDetailView.swift"
          ],
          "acceptance_criteria": [
            "Shows all recorded values",
            "Displays calculated BMR/TDEE for that record",
            "Edit and delete options",
            "Comparison with previous record"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "5.4",
          "title": "Update DashboardView with metabolism display",
          "description": "Add BMR/TDEE card to dashboard with intake/expenditure comparison",
          "status": "pending",
          "file_paths": [
            "Bodii/Presentation/Features/Dashboard/DashboardView.swift"
          ],
          "acceptance_criteria": [
            "Metabolism card showing BMR/TDEE",
            "Daily calorie balance display",
            "Visual indicator for surplus/deficit",
            "Tappable to navigate to body tab"
          ],
          "estimated_complexity": "medium"
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "Integration & Wiring",
      "description": "Wire up dependency injection and integrate with app navigation",
      "order": 6,
      "subtasks": [
        {
          "id": "6.1",
          "title": "Update DIContainer with body composition dependencies",
          "description": "Register all body composition related dependencies in DIContainer",
          "status": "pending",
          "file_paths": [
            "Bodii/App/DIContainer.swift"
          ],
          "acceptance_criteria": [
            "Registers BodyLocalDataSource",
            "Registers BodyRepository",
            "Registers all use cases",
            "Factory methods for ViewModels"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "6.2",
          "title": "Update ContentView to use BodyCompositionView",
          "description": "Replace placeholder in body tab with actual BodyCompositionView",
          "status": "pending",
          "file_paths": [
            "Bodii/App/ContentView.swift"
          ],
          "acceptance_criteria": [
            "Body tab shows BodyCompositionView",
            "Dashboard tab shows updated DashboardView",
            "Proper navigation setup"
          ],
          "estimated_complexity": "low"
        },
        {
          "id": "6.3",
          "title": "Add preview sample data for body composition",
          "description": "Create sample data for SwiftUI previews",
          "status": "pending",
          "file_paths": [
            "Bodii/Infrastructure/Persistence/PersistenceController.swift"
          ],
          "acceptance_criteria": [
            "Sample BodyRecords with various dates",
            "Sample MetabolismSnapshots",
            "Realistic data ranges for testing"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Validation & Input Handling",
      "description": "Implement input validation and error handling",
      "order": 7,
      "subtasks": [
        {
          "id": "7.1",
          "title": "Create BodyMeasurementValidator",
          "description": "Validation utility for body composition inputs",
          "status": "pending",
          "file_paths": [
            "Bodii/Shared/Utils/BodyMeasurementValidator.swift"
          ],
          "acceptance_criteria": [
            "Weight range: 20-500 kg",
            "Body fat %: 1-60%",
            "Muscle mass: 10-100 kg",
            "Height: 50-300 cm",
            "Clear error messages in Korean"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "7.2",
          "title": "Create Decimal+Extensions for formatting",
          "description": "Extensions for Decimal formatting and display",
          "status": "pending",
          "file_paths": [
            "Bodii/Shared/Extensions/Decimal+Extensions.swift"
          ],
          "acceptance_criteria": [
            "Format to 1 decimal place for display",
            "Format to 0 decimal for calories",
            "Locale-aware formatting"
          ],
          "estimated_complexity": "low"
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "Testing & Performance",
      "description": "Add unit tests and verify performance requirements",
      "order": 8,
      "subtasks": [
        {
          "id": "8.1",
          "title": "Create BMR/TDEE calculation tests",
          "description": "Unit tests for Mifflin-St Jeor formula implementation",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Domain/UseCases/CalculateBMRUseCaseTests.swift",
            "BodiiTests/Domain/UseCases/CalculateTDEEUseCaseTests.swift"
          ],
          "acceptance_criteria": [
            "Test male and female calculations",
            "Test edge cases (low/high values)",
            "Test activity level multipliers",
            "Verify precision to 2 decimal places"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "8.2",
          "title": "Create repository and data source tests",
          "description": "Integration tests for data layer",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Data/Repositories/BodyRepositoryTests.swift"
          ],
          "acceptance_criteria": [
            "Test CRUD operations",
            "Test date range queries",
            "Test MetabolismSnapshot creation",
            "Verify data integrity"
          ],
          "estimated_complexity": "medium"
        },
        {
          "id": "8.3",
          "title": "Create performance tests for queries",
          "description": "Performance tests to verify <0.5s query requirement",
          "status": "pending",
          "file_paths": [
            "BodiiTests/Performance/BodyQueryPerformanceTests.swift"
          ],
          "acceptance_criteria": [
            "Query 1000+ records in <0.5s",
            "Trend data fetch in <0.5s",
            "Chart data preparation in <0.5s"
          ],
          "estimated_complexity": "medium"
        }
      ]
    }
  ],
  "dependencies": {
    "phase-2": [
      "phase-1"
    ],
    "phase-3": [
      "phase-1",
      "phase-2"
    ],
    "phase-4": [
      "phase-1"
    ],
    "phase-5": [
      "phase-3",
      "phase-4"
    ],
    "phase-6": [
      "phase-5"
    ],
    "phase-7": [
      "phase-1"
    ],
    "phase-8": [
      "phase-6"
    ]
  },
  "acceptance_criteria_mapping": {
    "Users can input height, weight, body fat %, muscle mass with validation": [
      "1.3",
      "4.1",
      "5.1",
      "7.1"
    ],
    "BMR calculated automatically using Mifflin-St Jeor formula": [
      "1.6",
      "2.5",
      "8.1"
    ],
    "TDEE calculated based on activity level multiplier": [
      "1.1",
      "1.7",
      "2.5"
    ],
    "MetabolismSnapshot saved with each body record for historical tracking": [
      "2.3",
      "2.5"
    ],
    "Swift Charts displays weight/body fat trends over 7/30/90 days": [
      "4.3",
      "4.4",
      "5.2"
    ],
    "Dashboard shows current BMR/TDEE alongside daily intake/expenditure": [
      "3.3",
      "4.2",
      "5.4"
    ],
    "Performance: queries complete in under 0.5 seconds": [
      "2.3",
      "8.3"
    ]
  },
  "total_subtasks": 31,
  "estimated_effort": "3-4 days",
  "qa_sign_off": {
    "status": "pending",
    "tests_passed": "",
    "issues": ""
  },
  "last_updated": "2026-01-11T23:45:57.552713+00:00"
}