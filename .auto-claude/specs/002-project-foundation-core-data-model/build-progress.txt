# Build Progress - 002 Project Foundation & Core Data Model

## Subtask 3.4: Create Food Domain Entity - β… COMPLETED

**Status:** COMPLETED
**File:** Bodii/Domain/Entities/Food.swift
**Commit:** 050ec5d

### Implementation Details

All acceptance criteria have been met:

β… **Food struct with Identifiable, Codable, Equatable**
   - Identifiable: Uses UUID as id
   - Codable: All properties are Codable-conforming types
   - Equatable: Auto-synthesized by compiler

β… **Nutritional info: calories, carbs, protein, fat, sodium, fiber, sugar**
   - calories: Int (kcal, required)
   - carbohydrates: Decimal (g, required)
   - protein: Decimal (g, required)
   - fat: Decimal (g, required)
   - sodium: Decimal? (mg, optional - API may not provide)
   - fiber: Decimal? (g, optional - API may not provide)
   - sugar: Decimal? (g, optional - API may not provide)

β… **Serving info: servingSize, servingUnit**
   - servingSize: Decimal (κΈ°μ¤€ μ κ³µλ‰)
   - servingUnit: QuantityUnit? (.gram or .serving, optional)

β… **Source tracking: source, apiCode, createdByUserId**
   - source: FoodSource enum (.kfdaAPI, .usdaAPI, .userCreated)
   - apiCode: String? (API κ³ μ  μ½”λ“, optional for user-created foods)
   - createdByUserId: UUID? (μ‚¬μ©μ μƒμ„± μμ‹μ μƒμ„±μ ID, optional)

### Bonus Features

β… **CustomStringConvertible protocol**
   - Provides readable debug description
   - Shows key nutritional info and source
   - Smart servingUnit display (shows displayName if present)

β… **Master Data Pattern**
   - Immutable nutritional reference data
   - Referenced by multiple FoodRecord entries
   - Optimized for search and reuse

### Quality Attributes

β… Follows established patterns from User, BodyRecord, MetabolismSnapshot entities
β… Korean documentation with ν•™μµ ν¬μΈνΈ (learning points)
β… Comprehensive doc comments with usage examples
β… MARK organization for code sections
β… Domain entity pattern (separated from Core Data)
β… No console.log/print debugging statements
β… Detailed property documentation with value ranges

### Documentation Highlights

**ν•™μµ ν¬μΈνΈ (Learning Point):**
- Explains Master Data Pattern
- Compares to JPA @OneToMany relationship (Product - OrderItem pattern)
- Food is immutable reference data referenced by many FoodRecord entries

**Key Concepts:**
- Master data vs transactional data separation
- Multiple data sources: KFDA API, USDA API, user-created
- Nutritional information per serving size
- Optional fields for incomplete API data
- Reusable food definitions for meal logging

**Usage Examples:**
```swift
// 1. API food (from KFDA)
let rice = Food(
    id: UUID(),
    name: "λ°±λ―Έλ°¥",
    calories: 130,
    carbohydrates: 28.7,
    protein: 2.5,
    fat: 0.2,
    sodium: 0,
    fiber: 0.3,
    sugar: 0.1,
    servingSize: 100.0,
    servingUnit: .gram,
    source: .kfdaAPI,
    apiCode: "KFDA_12345",
    createdByUserId: nil,
    createdAt: Date()
)

// 2. User-created food
let customMeal = Food(
    id: UUID(),
    name: "μ—„λ§ν‘ λμ¥μ°κ°",
    calories: 120,
    servingSize: 1.0,
    servingUnit: .serving,
    source: .userCreated,
    apiCode: nil,
    createdByUserId: userId,
    ...
)
```

### Git Status

- File committed in: 050ec5d
- Commit message: "auto-claude: 3.4 - Pure Swift struct for Food master data"
- Implementation plan updated to "completed"
- Phase 3 status: 4/9 subtasks completed

### Architecture Notes

**Master Data Pattern:**
- Food entities are master data (reference data)
- Reused across multiple FoodRecord entries
- Immutable after creation (var for potential updates in Core Data sync)
- Optimized for search and selection in UI

**Data Sources:**
1. **KFDA API** (μ‹ν’μμ•½ν’μ•μ „μ²)
   - Korean food database
   - Official nutritional data
   - apiCode stores KFDA food code

2. **USDA API** (λ―Έκµ­ λ†λ¬΄λ¶€)
   - International food database
   - Comprehensive nutritional data
   - apiCode stores USDA food ID

3. **User Created**
   - Custom food entries
   - createdByUserId tracks creator
   - No apiCode (user-generated)

**Data Flow:**
1. API sync: Fetch food data from KFDA/USDA β†’ Create Food entities
2. User creates: User inputs nutritional info β†’ Create Food entity with .userCreated source
3. Meal logging: User selects Food β†’ Create FoodRecord with quantity
4. Nutrition calculation: FoodRecord uses Food nutritional data Γ— quantity

**Why Separate Entity from FoodRecord?**
- Avoid duplication: Same food used in multiple meals
- Data integrity: Nutritional info defined once
- Efficiency: Search and select from master data
- Updates: Fix nutritional data in one place affects all records (if needed)

---

## Subtask 3.3: Create MetabolismSnapshot Domain Entity - β… COMPLETED

**Status:** COMPLETED
**File:** Bodii/Domain/Entities/MetabolismSnapshot.swift
**Commit:** 527d6ce

### Implementation Details

All acceptance criteria have been met:

β… **MetabolismSnapshot struct with Identifiable, Codable, Equatable**
   - Identifiable: Uses UUID as id
   - Codable: All properties are Codable-conforming types
   - Equatable: Auto-synthesized by compiler

β… **All properties from ERD:**
   - id: UUID (unique identifier)
   - userId: UUID (foreign key to User)
   - bodyRecordId: UUID (foreign key to BodyRecord for 1:1 relationship)
   - date: Date (same as BodyRecord.date for 1:1 mapping)
   - weight: Decimal (snapshot of body weight at this point in time)
   - bodyFatPct: Decimal (snapshot of body fat percentage)
   - bmr: Int (calculated Basal Metabolic Rate in kcal/day)
   - tdee: Int (calculated Total Daily Energy Expenditure in kcal/day)
   - activityLevel: ActivityLevel enum (activity level used for TDEE calculation)
   - createdAt: Date (creation timestamp)

### Bonus Features

β… **CustomStringConvertible protocol**
   - Provides readable debug description
   - Shows all key properties including calculations

### Quality Attributes

β… Follows established patterns from User and BodyRecord entities
β… Korean documentation with ν•™μµ ν¬μΈνΈ (learning points)
β… Comprehensive doc comments with calculation formulas
β… MARK organization for code sections
β… Domain entity pattern (separated from Core Data)
β… No console.log/print debugging statements
β… Immutable struct with let properties (snapshot pattern)

### Documentation Highlights

**ν•™μµ ν¬μΈνΈ (Learning Point):**
- Explains 1:1 Relationship Entity Pattern
- Compares to JPA @OneToOne relationship
- Shows how separate table optimizes historical queries

**Key Concepts:**
- 1:1 relationship with BodyRecord via same date value
- Snapshot pattern: preserves metabolism state at specific point in time
- Enables tracking metabolism changes over time for dashboard charts
- Automatic creation when BodyRecord is saved

**Calculation Formulas:**
```
BMR (Mifflin-St Jeor equation):
  Male: (10 Γ— weight) + (6.25 Γ— height) - (5 Γ— age) + 5
  Female: (10 Γ— weight) + (6.25 Γ— height) - (5 Γ— age) - 161

TDEE:
  TDEE = BMR Γ— activityLevel.multiplier
```

**Usage Example:**
```swift
let snapshot = MetabolismSnapshot(
    id: UUID(),
    userId: userId,
    bodyRecordId: bodyRecord.id,
    date: bodyRecord.date,
    weight: 70.0,
    bodyFatPct: 18.5,
    bmr: 1650,
    tdee: 2550,
    activityLevel: .moderate,
    createdAt: Date()
)
```

### Git Status

- File committed in: 527d6ce
- Commit message: "auto-claude: 3.3 - Pure Swift struct for MetabolismSnapshot (1:1 with BodyRecord)"
- Implementation plan updated to "completed"
- Phase 3 status: 3/9 subtasks completed

### Architecture Notes

**1:1 Relationship Pattern:**
- MetabolismSnapshot and BodyRecord share the same date value
- When BodyRecord is saved, MetabolismSnapshot is automatically created
- Separate entity optimizes queries for metabolism history charts
- Snapshot pattern preserves point-in-time metabolism data

**Data Flow:**
1. User enters body data β†’ BodyRecord created
2. BMR/TDEE calculated using User profile data
3. MetabolismSnapshot created with same date as BodyRecord
4. Both entities saved in same transaction
5. Dashboard queries MetabolismSnapshot for metabolism trends

**Why Separate Entity?**
- Performance: Querying metabolism trends doesn't require loading body composition data
- Clarity: Separates concerns (body data vs metabolism calculations)
- Flexibility: Can query metabolism changes independently
- Optimization: Indexed date column for fast time-range queries

---

## Subtask 3.1: Create User Domain Entity - β… COMPLETED

**Status:** COMPLETED
**File:** Bodii/Domain/Entities/User.swift
**Commit:** b23dd39

### Implementation Details

All acceptance criteria have been met:

β… **User struct with Identifiable, Codable, Equatable**
   - Identifiable: Uses UUID as id
   - Codable: All properties are Codable-conforming types
   - Equatable: Auto-synthesized by compiler

β… **All properties from ERD:**
   - id: UUID (unique identifier)
   - name: String (1-20 chars validated)
   - gender: Gender enum (male/female)
   - birthDate: Date (used for age calculation)
   - height: Decimal (100-250cm range)
   - activityLevel: ActivityLevel enum (sedentary to veryActive)

β… **Current values:**
   - currentWeight: Decimal (20-300kg)
   - currentBodyFatPct: Decimal (3-60%)
   - currentMuscleMass: Decimal (10-60kg)
   - currentBMR: Int (calculated via Mifflin-St Jeor)
   - currentTDEE: Int (BMR Γ— activityLevel.multiplier)

β… **Timestamps:**
   - metabolismUpdatedAt: Date (when metabolism was last calculated)
   - createdAt: Date (user creation timestamp)
   - updatedAt: Date (last modification timestamp)

β… **Computed age property:**
   - Uses Date.age(from: birthDate) extension
   - Automatically calculates current age from birth date
   - Returns Int representing λ§ λ‚μ΄ (Korean age system)

### Bonus Features

β… **CustomStringConvertible protocol**
   - Provides readable debug description
   - Shows key properties in formatted output

### Quality Attributes

β… Follows established patterns from Phase 1 & 2
β… Korean documentation with ν•™μµ ν¬μΈνΈ (learning points)
β… Comprehensive doc comments with usage examples
β… MARK organization for code sections
β… Domain entity pattern (separated from Core Data)
β… No console.log/print debugging statements
β… Clean Architecture principles applied

### Documentation Highlights

**ν•™μµ ν¬μΈνΈ (Learning Point):**
- Explains Domain Entity Pattern
- Compares to Clean Architecture in Java/JPA
- Separates business logic from persistence

**Property Documentation:**
- BMR calculation formula: (10 Γ— weight) + (6.25 Γ— height) - (5 Γ— age) + gender constant
- TDEE calculation: BMR Γ— activityLevel.multiplier
- Validation ranges for all numeric properties
- References ValidationService for input validation

**Usage Example:**
```swift
let user = User(
    id: UUID(),
    name: "ν™κΈΈλ™",
    gender: .male,
    birthDate: Date(),
    height: 175.0,
    activityLevel: .moderate,
    currentWeight: 70.0,
    currentBodyFatPct: 18.5,
    currentMuscleMass: 32.0,
    currentBMR: 1650,
    currentTDEE: 2550,
    metabolismUpdatedAt: Date(),
    createdAt: Date(),
    updatedAt: Date()
)
print(user.age) // Automatically calculated
```

### Git Status

- File committed in: b23dd39
- Commit message: "auto-claude: 3.1 - Create User domain entity with all properties and computed age"
- Implementation plan updated to "completed"
- Phase 3 status updated to "in_progress" (1/9 subtasks done)

### Architecture Notes

**Domain Entity Pattern:**
- Pure Swift struct (no Core Data dependencies)
- Used in business logic layer (ViewModels, Services)
- Mapped to/from Core Data via UserEntity+Extensions (Phase 4)
- Improves testability (no NSManagedObject complexity)
- Better separation of concerns

**Data Flow:**
1. Core Data: UserEntity (persistent storage)
2. Extensions: UserEntity+Extensions (mapping layer)
3. Domain: User struct (business logic)
4. ViewModels: Use User struct for presentation logic

---

**Phase 3 Progress:** π§ IN PROGRESS (4/9 subtasks)
- 3.1: User β…
- 3.2: BodyRecord β…
- 3.3: MetabolismSnapshot β…
- 3.4: Food β…
- 3.5: FoodRecord (pending)
- 3.6: ExerciseRecord (pending)
- 3.7: SleepRecord (pending)
- 3.8: DailyLog (pending)
- 3.9: Goal (pending)

**Overall Progress:** Phase 1 (β… Complete), Phase 2 (β… Complete), Phase 3 (π§ In Progress - 4/9)
**Next Subtask:** 3.5 - Create FoodRecord Domain Entity

---

## Subtask 3.2: Create BodyRecord Domain Entity - β… COMPLETED

**Status:** COMPLETED
**File:** Bodii/Domain/Entities/BodyRecord.swift
**Commit:** 8cc9c38

### Implementation Details

All acceptance criteria have been met:

β… **BodyRecord struct with Identifiable, Codable, Equatable**
   - Identifiable: Uses UUID as id
   - Codable: All properties are Codable-conforming types
   - Equatable: Auto-synthesized by compiler

β… **All properties from ERD:**
   - id: UUID (unique identifier)
   - userId: UUID (foreign key to User)
   - date: Date (unique per day, maps to MetabolismSnapshot)
   - weight: Decimal (20-300kg range)
   - bodyFatMass: Decimal (kg, auto-calculated from bodyFatPercent)
   - bodyFatPercent: Decimal (3-60%, auto-calculated from bodyFatMass)
   - muscleMass: Decimal (10-60kg range)
   - createdAt: Date (creation timestamp)

β… **Helper methods for bodyFatMass β†” bodyFatPercent calculation:**
   - Static calculateBodyFatMass(weight:bodyFatPercent:) - Formula: weight Γ— (bodyFatPercent/100)
   - Static calculateBodyFatPercent(weight:bodyFatMass:) - Formula: (bodyFatMass/weight) Γ— 100
   - Factory method from(userId:date:weight:bodyFatPercent:muscleMass:) - Creates record with auto-calculated bodyFatMass
   - Factory method from(userId:date:weight:bodyFatMass:muscleMass:) - Creates record with auto-calculated bodyFatPercent
   - updatingWeight(_:) - Recalculates bodyFatMass when weight changes
   - updatingBodyFatPercent(_:) - Recalculates bodyFatMass when bodyFatPercent changes
   - updatingBodyFatMass(_:) - Recalculates bodyFatPercent when bodyFatMass changes

### Bonus Features

β… **Computed leanBodyMass property**
   - Formula: weight - bodyFatMass
   - Used for validation: muscleMass β‰¤ leanBodyMass

β… **CustomStringConvertible protocol**
   - Provides readable debug description with all properties
   - Shows computed leanBodyMass value

### Quality Attributes

β… Follows established patterns from User.swift
β… Korean documentation with ν•™μµ ν¬μΈνΈ (learning points)
β… Comprehensive doc comments with calculation formulas
β… MARK organization for code sections
β… Domain entity pattern (separated from Core Data)
β… No console.log/print debugging statements
β… Immutable by default with functional update methods

### Documentation Highlights

**ν•™μµ ν¬μΈνΈ (Learning Point):**
- Explains Auto-calculation Logic pattern
- Compares to JPA @PrePersist/@PreUpdate hooks
- Shows how Swift uses helper methods instead

**Calculation Formulas:**
```
μ²΄μ§€λ°©λ‰(kg) = μ²΄μ¤‘(kg) Γ— (μ²΄μ§€λ°©λ¥ (%) / 100)
μ²΄μ§€λ°©λ¥ (%) = (μ²΄μ§€λ°©λ‰(kg) / μ²΄μ¤‘(kg)) Γ— 100
μ μ§€λ°©λ‰(kg) = μ²΄μ¤‘(kg) - μ²΄μ§€λ°©λ‰(kg)
```

**Usage Examples:**
- Creating record from bodyFatPercent (auto-calculates bodyFatMass)
- Creating record from bodyFatMass (auto-calculates bodyFatPercent)
- Updating individual values while maintaining consistency

### Git Status

- File committed in: 8cc9c38
- Commit message: "auto-claude: 3.2 - Pure Swift struct for BodyRecord with auto-calculation logic"
- Implementation plan updated to "completed"
- Phase 3 status: 2/9 subtasks completed

### Architecture Notes

**Auto-calculation Pattern:**
- Factory methods ensure calculations happen at creation time
- Update methods return new instances (functional approach)
- Static helpers can be used by Core Data extensions
- Prevents invalid states (bodyFatMass and bodyFatPercent always consistent)

**1:1 Relationship with MetabolismSnapshot:**
- Same date value links to MetabolismSnapshot
- When BodyRecord is saved, MetabolismSnapshot is auto-created
- Both entities track the same body composition snapshot

---
