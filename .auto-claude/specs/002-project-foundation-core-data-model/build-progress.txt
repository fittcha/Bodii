# Build Progress: Project Foundation & Core Data Model
# Spec ID: 002-project-foundation-core-data-model
# Last Updated: 2026-01-11 20:05

## Current Status: IN PROGRESS - Phase 1.4 Complete

---

## ALREADY IMPLEMENTED âœ…

### 1. Xcode Project Setup
- iOS 17+ target with SwiftUI lifecycle
- BodiiApp.swift with @main entry point
- ContentView with tab-based navigation

### 2. Core Data Model (Bodii.xcdatamodeld)
All 9 entities defined with proper relationships:
- User (14 attributes, 8 relationships)
- BodyRecord (7 attributes, 2 relationships)
- MetabolismSnapshot (8 attributes, 2 relationships)
- Food (14 attributes, 2 relationships)
- FoodRecord (10 attributes, 2 relationships)
- ExerciseRecord (10 attributes, 1 relationship)
- SleepRecord (6 attributes, 1 relationship)
- DailyLog (22 attributes, 1 relationship)
- Goal (17 attributes, 1 relationship)

### 3. Folder Structure (Clean Architecture)
- Bodii/App - Entry point and DI container
- Bodii/Presentation/Features/* - Feature-based UI (Views, ViewModels)
- Bodii/Domain - Use cases, entities, interfaces
- Bodii/Data - Repositories, data sources, DTOs
- Bodii/Infrastructure - Persistence, HealthKit, Network
- Bodii/Shared - Enums, Utils, Extensions

### 4. PersistenceController
- Singleton with shared instance
- Preview instance for SwiftUI
- save(), newBackgroundContext(), performBackgroundTask()
- Lightweight migration support
- DEBUG verifyModelLoaded() helper

---

## REMAINING WORK (32 Subtasks across 5 Phases)

### Phase 1: Enum Definitions & Type Safety (10 subtasks)
- [x] 1.1 Gender enum (male=0, female=1) âœ…
- [x] 1.2 ActivityLevel enum (5 levels with TDEE multipliers) âœ…
- [x] 1.3 MealType enum (breakfast/lunch/dinner/snack) âœ…
- [x] 1.4 ExerciseType enum (8 types with MET values) âœ…
- [ ] 1.5 Intensity enum (low/medium/high)
- [ ] 1.6 FoodSource enum (kfdaAPI/usdaAPI/userCreated)
- [ ] 1.7 GoalType enum (lose/maintain/gain)
- [ ] 1.8 SleepStatus enum (5 statuses with duration thresholds)
- [ ] 1.9 QuantityUnit enum (serving/gram)
- [ ] 1.10 Constants file (validation ranges, defaults)

### Phase 2: Utility Services (5 subtasks)
- [ ] 2.1 DateUtils (02:00 sleep boundary logic) â­ CRITICAL
- [ ] 2.2 ValidationService (input range validation) â­ CRITICAL
- [ ] 2.3 Date+Extensions (convenience methods)
- [ ] 2.4 Decimal+Extensions (Core Data helpers)
- [ ] 2.5 Formatters utility (shared formatters)

### Phase 3: Domain Entities (9 subtasks)
- [ ] 3.1 User domain entity
- [ ] 3.2 BodyRecord domain entity
- [ ] 3.3 MetabolismSnapshot domain entity
- [ ] 3.4 Food domain entity
- [ ] 3.5 FoodRecord domain entity
- [ ] 3.6 ExerciseRecord domain entity
- [ ] 3.7 SleepRecord domain entity
- [ ] 3.8 DailyLog domain entity
- [ ] 3.9 Goal domain entity

### Phase 4: Core Data Entity Extensions (4 subtasks)
- [ ] 4.1 UserEntity+Extensions
- [ ] 4.2 BodyRecordEntity+Extensions
- [ ] 4.3 DailyLogEntity+Extensions
- [ ] 4.4 Remaining entity extensions (6 files)

### Phase 5: Testing & Verification (4 subtasks)
- [ ] 5.1 DateUtilsTests
- [ ] 5.2 ValidationServiceTests
- [ ] 5.3 SleepStatusTests
- [ ] 5.4 Build and Core Data verification

---

## ACCEPTANCE CRITERIA STATUS

| Criteria | Status |
|----------|--------|
| Xcode project with iOS 17+ and SwiftUI | âœ… DONE |
| Core Data model with 9 entities | âœ… DONE |
| MVVM folder structure | âœ… DONE |
| PersistenceController with CRUD | âœ… DONE |
| DateUtils with 02:00 boundary | â³ PENDING |
| ValidationService for all ranges | â³ PENDING |

---

## KEY REFERENCES

### Validation Ranges (from spec.md and ERD.md)
- Height: 100-250cm
- Weight: 20-300kg
- Body Fat: 3-60%
- Muscle Mass: 10-60kg
- Name: 1-20 characters
- Exercise Duration: 1-480 minutes
- Food Quantity: 0.1-100 servings or 1-10000 grams

### Sleep Boundary Logic (02:00 = logical day boundary)
```swift
// 02:00 ~ ë‹¤ìŒë‚  02:00 = í•˜ë£¨
// 00:00 ~ 01:59 â†’ previous day (ìˆ˜ë©´ì€ ì „ë‚ ì— ì†í•¨)
// 02:00 ~ 23:59 â†’ current day
func getLogicalDate(for date: Date) -> Date {
    let hour = Calendar.current.component(.hour, from: date)
    if hour < 2 {
        return Calendar.current.date(byAdding: .day, value: -1, to: date)!.startOfDay
    }
    return date.startOfDay
}
```

### Activity Level Multipliers (TDEE = BMR Ã— multiplier)
| Level | Name | Multiplier |
|-------|------|-----------|
| 1 | Sedentary (ë¹„í™œë™ì ) | 1.2 |
| 2 | Light (ê°€ë²¼ìš´ í™œë™) | 1.375 |
| 3 | Moderate (ë³´í†µ í™œë™) | 1.55 |
| 4 | Active (í™œë™ì ) | 1.725 |
| 5 | Very Active (ë§¤ìš° í™œë™ì ) | 1.9 |

### Sleep Status Thresholds (minutes)
| Status | Min | Max | Emoji |
|--------|-----|-----|-------|
| bad (0) | 0 | 329 | ðŸ”´ |
| soso (1) | 330 | 389 | ðŸŸ¡ |
| good (2) | 390 | 449 | ðŸŸ¢ |
| excellent (3) | 450 | 540 | ðŸ”µ |
| oversleep (4) | 541 | âˆž | ðŸŸ  |

### Exercise MET Values (by type and intensity)
| Type | Low | Medium | High |
|------|-----|--------|------|
| walking | 3.5 | 4.0 | 5.0 |
| running | 7.0 | 8.0 | 10.0 |
| cycling | 5.0 | 6.0 | 8.0 |
| swimming | 6.0 | 7.0 | 9.0 |
| weight | 4.0 | 6.0 | 8.0 |
| crossfit | 6.0 | 8.0 | 10.0 |
| yoga | 2.5 | 3.0 | 4.0 |
| other | 4.0 | 5.0 | 6.0 |

---

## NOTES
- Korean localization required for all display names (displayName í”„ë¡œí¼í‹°)
- Error messages must be in Korean for user-facing validation
- All enums use Int16 rawValue to match Core Data attributes
- Domain entities should be pure Swift structs (Identifiable, Codable, Equatable)
- Core Data entity extensions provide toDomain() and update(from:) methods

---

## ESTIMATED TIME
- Total: ~720 minutes (12 hours)
- Phase 1: ~130 minutes
- Phase 2: ~130 minutes
- Phase 3: ~180 minutes
- Phase 4: ~115 minutes
- Phase 5: ~80 minutes
