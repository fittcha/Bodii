{
  "feature": "Apple HealthKit Integration",
  "description": "Bidirectional sync with Apple HealthKit for weight, body fat, active calories, sleep, and workout data. Read existing data and write Bodii records to maintain ecosystem connectivity.",
  "created_at": "2026-01-14T09:02:17.099Z",
  "updated_at": "2026-01-16T14:35:00.000Z",
  "status": "in_progress",
  "planStatus": "planned",
  "estimated_hours": 16,
  "phases": [
    {
      "id": "phase-1",
      "name": "Infrastructure & Configuration",
      "description": "Set up HealthKit entitlements, Info.plist, and base service structure",
      "estimated_hours": 2,
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create HealthKit Entitlements File",
          "description": "Create Bodii.entitlements file with HealthKit capability. Add com.apple.developer.healthkit and com.apple.developer.healthkit.background-delivery keys.",
          "status": "completed",
          "files": [
            "Bodii/Bodii.entitlements"
          ],
          "acceptance_criteria": [
            "Bodii.entitlements file exists with HealthKit keys",
            "Background delivery capability is enabled"
          ],
          "notes": "Created Bodii.entitlements file with com.apple.developer.healthkit and com.apple.developer.healthkit.background-delivery keys enabled. File follows standard iOS entitlements plist format.",
          "updated_at": "2026-01-16T05:37:50.720578+00:00"
        },
        {
          "id": "1.2",
          "title": "Update Xcode Project Configuration",
          "description": "Add HealthKit framework to project and enable HealthKit capability in Signing & Capabilities. Link entitlements file to target.",
          "status": "completed",
          "files": [
            "Bodii.xcodeproj/project.pbxproj"
          ],
          "acceptance_criteria": [
            "HealthKit.framework is linked",
            "Entitlements file is referenced in project"
          ],
          "notes": "Added HealthKit.framework to Bodii target and configured entitlements. Updated project.pbxproj to:\n- Add HealthKit.framework file reference and link it to target\n- Reference Bodii.entitlements in project structure\n- Set CODE_SIGN_ENTITLEMENTS build setting in both Debug and Release configurations\n- Created Frameworks group for better organization\n\nAll acceptance criteria met:\n\u2705 HealthKit.framework is linked\n\u2705 Entitlements file is referenced in project",
          "updated_at": "2026-01-16T05:40:33.665933+00:00"
        },
        {
          "id": "1.3",
          "title": "Add Info.plist Privacy Descriptions",
          "description": "Create or update Info.plist with NSHealthShareUsageDescription and NSHealthUpdateUsageDescription keys explaining why HealthKit access is needed.",
          "status": "completed",
          "files": [
            "Bodii/Info.plist"
          ],
          "acceptance_criteria": [
            "NSHealthShareUsageDescription explains read access purpose",
            "NSHealthUpdateUsageDescription explains write access purpose",
            "Descriptions are in Korean with clear explanations"
          ],
          "notes": "Added HealthKit privacy descriptions to project.pbxproj using INFOPLIST_KEY_ approach for both Debug and Release configurations:\n\n\u2705 NSHealthShareUsageDescription: Explains why Bodii needs to read health data (weight, body fat, active calories, steps, sleep, workout records) for accurate health management\n\u2705 NSHealthUpdateUsageDescription: Explains why Bodii needs to write data to Apple Health app for sharing with other health apps\n\u2705 All descriptions are in Korean as required by project standards\n\u2705 Both Debug and Release configurations updated\n\nThe project uses the modern GENERATE_INFOPLIST_FILE = YES approach with INFOPLIST_KEY_ prefixed settings instead of a separate Info.plist file.",
          "updated_at": "2026-01-16T05:43:34.391142+00:00"
        },
        {
          "id": "1.4",
          "title": "Create HealthKit Error Types",
          "description": "Define HealthKitError enum with cases for authorization denied, data unavailable, write failed, background sync failed, etc.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitError.swift"
          ],
          "acceptance_criteria": [
            "Comprehensive error cases for all HealthKit operations",
            "LocalizedError conformance with user-friendly messages",
            "Korean error descriptions"
          ],
          "notes": "Created comprehensive HealthKitError enum with all required error cases:\n\n\u2705 Comprehensive error cases for all HealthKit operations:\n  - Authorization errors: healthKitNotAvailable, authorizationDenied, authorizationFailed, dataTypeNotAuthorized\n  - Data access errors: dataUnavailable, readFailed, writeFailed\n  - Background sync errors: backgroundSyncFailed, observerRegistrationFailed\n  - Query errors: queryExecutionFailed, statisticsUnavailable\n  - Validation errors: invalidSampleType, invalidDateRange, invalidUnit\n  - Duplicate/conflict errors: duplicateEntry, conflictDetected\n  - Mapping errors: mappingFailed, unsupportedWorkoutType, missingRequiredData\n  - Unknown error case\n\n\u2705 LocalizedError conformance with user-friendly messages in Korean\n\n\u2705 Recovery strategy extensions:\n  - isRecoverable: Determines if error can be recovered\n  - canRetry: Determines if operation should be retried\n  - isAuthorizationError: Identifies permission-related errors\n\n\u2705 Follows project patterns:\n  - Educational comments (\ud559\uc2b5 \ud3ec\uc778\ud2b8) comparing to Java\n  - Comprehensive documentation with examples\n  - Similar structure to NetworkError and FoodSearchError\n  - Error Protocol conformance for Swift error handling\n\nAll acceptance criteria met.",
          "updated_at": "2026-01-16T05:46:17.221755+00:00"
        },
        {
          "id": "1.5",
          "title": "Create HealthKit Data Types Configuration",
          "description": "Create HealthKitDataTypes enum/struct defining all HKQuantityType and HKCategoryType identifiers used (weight, bodyFat, activeCalories, steps, sleep, workouts).",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitDataTypes.swift"
          ],
          "acceptance_criteria": [
            "All required HealthKit types are defined",
            "Read types: weight, bodyFatPercentage, activeEnergyBurned, stepCount, sleepAnalysis",
            "Write types: weight, bodyFatPercentage, dietaryEnergyConsumed, workout"
          ],
          "notes": "Created comprehensive HealthKitDataTypes.swift with all required configurations:\n\n\u2705 All required HealthKit types are defined:\n  - QuantityType enum: weight, bodyFatPercentage, activeEnergyBurned, stepCount, dietaryEnergyConsumed\n  - CategoryType enum: sleepAnalysis\n  - workoutType static property for HKWorkoutType\n\n\u2705 Read types properly defined:\n  - weight (HKQuantityType.bodyMass)\n  - bodyFatPercentage (HKQuantityType.bodyFatPercentage)\n  - activeEnergyBurned (HKQuantityType.activeEnergyBurned)\n  - stepCount (HKQuantityType.stepCount)\n  - sleepAnalysis (HKCategoryType.sleepAnalysis)\n  - workout (HKWorkoutType)\n\n\u2705 Write types properly defined:\n  - weight (HKQuantityType.bodyMass)\n  - bodyFatPercentage (HKQuantityType.bodyFatPercentage)\n  - dietaryEnergyConsumed (HKQuantityType.dietaryEnergyConsumed)\n  - workout (HKWorkoutType)\n\nAdditional features:\n- Type-safe enum-based configuration\n- Computed properties for HKQuantityType/HKCategoryType conversion\n- Display names in Korean for UI\n- Default units for each quantity type\n- Permission descriptions for authorization UI\n- Helper methods: isReadType(), isWriteType(), permissionDescription()\n- Comprehensive educational comments in Korean\n- Follows project patterns from HealthKitError.swift and APIConfig.swift\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T05:48:53.609359+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Permission Handling",
      "description": "Implement HealthKit authorization request and status checking",
      "estimated_hours": 3,
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create HealthKitAuthorizationService",
          "description": "Create service to handle HKHealthStore authorization. Implement requestAuthorization() method that requests read/write permissions for all data types.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitAuthorizationService.swift"
          ],
          "acceptance_criteria": [
            "HKHealthStore instance management",
            "requestAuthorization() async throws method",
            "Requests both read and write permissions",
            "Handles HealthKit unavailable on device"
          ],
          "notes": "Created HealthKitAuthorizationService.swift with all required functionality:\n\n\u2705 HKHealthStore instance management with dependency injection\n\u2705 requestAuthorization() async throws method that requests both read and write permissions for all HealthKit data types\n\u2705 isHealthDataAvailable() check to handle devices where HealthKit is unavailable\n\u2705 getAuthorizationStatus(for:) method to check authorization status for specific types\n\u2705 canWrite(to:) method to verify write permissions\n\u2705 isFullyAuthorized computed property for bulk permission checking\n\u2705 getHealthStore() method to share HKHealthStore instance with other services\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with examples\n- Clean architecture with MARK sections\n- Similar structure to DailyLogService and BodyRepository\n- Uses HealthKitDataTypes for type configuration\n- Throws HealthKitError for error handling\n- Async/await with proper error transformation\n\nAll acceptance criteria met and committed successfully.",
          "updated_at": "2026-01-16T05:51:06.794323+00:00"
        },
        {
          "id": "2.2",
          "title": "Implement Authorization Status Checking",
          "description": "Add methods to check current authorization status for each data type. Include isAuthorized(for:), canWrite(to:), and overall isFullyAuthorized computed property.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitAuthorizationService.swift"
          ],
          "acceptance_criteria": [
            "getAuthorizationStatus(for type:) method",
            "isHealthDataAvailable() check",
            "Handles partial authorization gracefully"
          ],
          "notes": "Added comprehensive authorization status checking methods to HealthKitAuthorizationService:\n\n\u2705 isAuthorized(for:) method - Boolean convenience wrapper for getAuthorizationStatus\n\u2705 Type-safe isAuthorized(for:) overloads for QuantityType and CategoryType enums\n\u2705 isAuthorizedForWorkouts computed property for workout authorization\n\u2705 Type-safe canWrite(to:) overloads for QuantityType with enum support\n\u2705 canWriteWorkouts computed property for workout write permission\n\u2705 AuthorizationSummary struct for detailed permission status tracking\n\u2705 getAuthorizationSummary() method for partial authorization handling\n\u2705 Handles partial authorization gracefully with authorized/denied type lists\n\u2705 All methods follow project patterns with Korean educational comments\n\u2705 Comprehensive documentation with usage examples\n\nAll acceptance criteria met:\n\u2705 getAuthorizationStatus(for type:) method (already existed from 2.1)\n\u2705 isHealthDataAvailable() check (already existed from 2.1)\n\u2705 Handles partial authorization gracefully with new AuthorizationSummary\n\nImplementation committed successfully.",
          "updated_at": "2026-01-16T05:54:37.562626+00:00"
        },
        {
          "id": "2.3",
          "title": "Create HealthKit Permission Request View",
          "description": "Create SwiftUI view for HealthKit permission onboarding. Shows explanation of each data type being requested with icons and descriptions.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Features/Settings/HealthKitPermissionView.swift"
          ],
          "acceptance_criteria": [
            "Clear UI explaining each permission type",
            "Request permission button",
            "Handles success/failure states",
            "Korean UI text"
          ],
          "notes": "Created comprehensive HealthKitPermissionView with all required features:\n\n\u2705 Clear UI explaining each permission type:\n  - Header section with Apple Health icon and main description\n  - Benefits section explaining HealthKit integration advantages\n  - Read permissions section with 6 data types (weight, body fat, active calories, steps, sleep, workouts)\n  - Write permissions section with 4 data types (weight, body fat, dietary energy, workouts)\n  - Each permission item includes icon, color-coded visual, title, and detailed description\n\n\u2705 Request permission button:\n  - Prominent \"Apple Health \uc5f0\ub3d9\ud558\uae30\" button at the bottom\n  - Shows loading state with ProgressView during request\n  - Disabled during request to prevent duplicate submissions\n  - Changes to gray color when disabled\n\n\u2705 Handles success/failure states:\n  - @State properties for isRequesting, requestSuccess, errorMessage\n  - Alert dialog for error messages\n  - Success callback (onPermissionGranted) triggers after successful request\n  - Automatically dismisses view on success\n  - Checks HealthKit availability before requesting permissions\n\n\u2705 Korean UI text:\n  - All text in Korean including titles, descriptions, buttons\n  - User-friendly error messages in Korean via HealthKitError.localizedDescription\n  - Privacy notice in Korean explaining data handling\n\nAdditional features:\n  - Privacy notice section emphasizing local data storage\n  - \"\ub098\uc911\uc5d0\" (Later) button for non-intrusive UX\n  - Benefits section with 3 key advantages (Apple Watch sync, bidirectional sync, accurate analysis)\n  - Follows project patterns with \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8 educational comments\n  - ScrollView for keyboard avoidance\n  - Color-coded icons for visual distinction\n  - SwiftUI Preview support for both light and dark mode\n  - Comprehensive documentation with best practices\n\nImplementation follows project patterns:\n  - Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n  - Dependency injection for HealthKitAuthorizationService\n  - Clean separation of view components using @ViewBuilder\n  - Async/await for permission request\n  - Environment dismiss action\n  - Comprehensive inline documentation\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T05:58:25.147278+00:00"
        },
        {
          "id": "2.4",
          "title": "Handle Permission Denied Gracefully",
          "description": "Create HealthKitDeniedView that appears when permissions are denied. Shows how to enable in Settings app with deep link option.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Features/Settings/HealthKitDeniedView.swift"
          ],
          "acceptance_criteria": [
            "Explains why permissions are needed",
            "Button to open Settings app",
            "Non-intrusive design",
            "Korean UI text"
          ],
          "notes": "Created comprehensive HealthKitDeniedView with all required features:\n\n\u2705 Explains why permissions are needed:\n  - Apple Watch data synchronization benefit\n  - Accurate health analysis with integrated data\n  - Data backup and sharing across health apps\n\n\u2705 Button to open Settings app:\n  - Deep link using UIApplication.openSettingsURLString\n  - Opens iOS Settings app directly to Bodii app settings\n  - Success callback support for tracking when Settings opens\n\n\u2705 Non-intrusive design:\n  - \"\ub098\uc911\uc5d0\" (Later) button for easy dismissal\n  - Informative orange gradient icon (not error red)\n  - Respects user's choice to deny permissions\n  - Does not block app functionality\n\n\u2705 Korean UI text:\n  - All UI text in Korean as required\n  - Step-by-step instructions (5 steps) for enabling permissions\n  - Clear explanations of benefits and data types\n  - Privacy notice in Korean\n\nAdditional features:\n- Header section with shield icon and gradient (orange/yellow)\n- Reason section with 3 key benefits (Apple Watch sync, accurate analysis, data backup)\n- Detailed step-by-step instructions for navigating Settings app\n- Data types section listing all 6 required permissions with icons\n- Privacy notice emphasizing local data storage\n- Educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- SwiftUI Preview support for both light and dark modes\n- Comprehensive documentation with iOS vs Android comparison\n- Similar structure to HealthKitPermissionView for consistency\n\nImplementation follows project patterns:\n- Korean educational comments throughout\n- Clean MARK sections organization\n- @ViewBuilder for component composition\n- Environment dismiss action\n- Consistent with existing HealthKitPermissionView style\n- Comprehensive inline documentation\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:01:45.884484+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Read Operations",
      "description": "Implement reading data from HealthKit (weight, body fat, active calories, steps, sleep, workouts)",
      "estimated_hours": 4,
      "subtasks": [
        {
          "id": "3.1",
          "title": "Create HealthKitReadService Base",
          "description": "Create base service with HKHealthStore, generic query methods, and date range helpers. Include fetchSamples<T>(type:from:to:) generic method.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitReadService.swift"
          ],
          "acceptance_criteria": [
            "Generic sample fetching method",
            "Date range query support",
            "Ascending/descending sort options",
            "Limit parameter support"
          ],
          "notes": "Created comprehensive HealthKitReadService with all required functionality:\n\n\u2705 Generic sample fetching method (fetchSamples<T>)\n\u2705 Date range query support (createDateRangePredicate, getDateBounds, getDateRange)\n\u2705 Ascending/descending sort options (SortOrder enum, ascending parameter)\n\u2705 Limit parameter support (limit parameter in fetchSamples)\n\nAdditional features:\n- HKStatisticsQuery support for aggregation (fetchStatistics)\n- Convenience methods: fetchRecentSamples, fetchSamples(for:date)\n- Type-safe generic method supporting HKQuantitySample, HKCategorySample, HKWorkout\n- Comprehensive date range helpers for daily/weekly queries\n- Korean educational comments following project patterns\n- Similar structure to HealthKitAuthorizationService\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Dependency injection for HKHealthStore\n- Clean MARK sections organization\n- Comprehensive documentation with examples\n- Async/await with proper error handling\n- HealthKitError for all error cases\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:04:35.605774+00:00"
        },
        {
          "id": "3.2",
          "title": "Implement Weight & Body Fat Reading",
          "description": "Add methods to read weight (HKQuantityType.bodyMass) and body fat percentage (HKQuantityType.bodyFatPercentage) from HealthKit.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitReadService.swift"
          ],
          "acceptance_criteria": [
            "fetchWeight(from:to:) method",
            "fetchBodyFatPercentage(from:to:) method",
            "fetchLatestWeight() method",
            "Converts HKQuantity to Decimal correctly"
          ],
          "notes": "Implemented weight and body fat percentage reading methods in HealthKitReadService:\n\n\u2705 fetchWeight(from:to:) method - Queries weight samples in date range\n\u2705 fetchBodyFatPercentage(from:to:) method - Queries body fat percentage samples in date range\n\u2705 fetchLatestWeight() method - Returns most recent weight sample\n\u2705 fetchLatestBodyFatPercentage() method - Returns most recent body fat percentage sample\n\u2705 convertWeightToDecimal(_:) - Converts HKQuantity to Decimal (kg unit)\n\u2705 convertBodyFatPercentageToDecimal(_:) - Converts HKQuantity to Decimal (0-100% range)\n\nAll acceptance criteria met:\n\u2705 fetchWeight(from:to:) method\n\u2705 fetchBodyFatPercentage(from:to:) method\n\u2705 fetchLatestWeight() method\n\u2705 Converts HKQuantity to Decimal correctly with proper units\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Type-safe usage of HealthKitDataTypes enums\n- Reuses generic fetchSamples<T> method for efficiency\n- Proper error handling with HealthKitError\n- Comprehensive documentation with usage examples\n- Correct unit conversions (kg for weight, 0-100% for body fat)\n\nCommitted successfully with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:06:54.755308+00:00"
        },
        {
          "id": "3.3",
          "title": "Implement Active Calories & Steps Reading",
          "description": "Add methods to read active energy burned (HKQuantityType.activeEnergyBurned) and step count (HKQuantityType.stepCount).",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitReadService.swift"
          ],
          "acceptance_criteria": [
            "fetchActiveCalories(for date:) method returns daily total",
            "fetchSteps(for date:) method returns daily total",
            "Uses HKStatisticsQuery for aggregation",
            "Handles multiple sources correctly"
          ],
          "notes": "Implemented active calories and step count reading methods in HealthKitReadService:\n\n\u2705 fetchActiveCalories(for date:) method returns daily total\n  - Uses HKStatisticsQuery with .cumulativeSum option\n  - Aggregates data from Apple Watch, iPhone, and other apps\n  - Returns Decimal in kcal units, nil if no data available\n  \n\u2705 fetchSteps(for date:) method returns daily total\n  - Uses HKStatisticsQuery with .cumulativeSum option\n  - Merges iPhone and Apple Watch step data\n  - HealthKit automatically handles duplicate removal\n  - Returns Decimal count, nil if no data available\n\n\u2705 Uses HKStatisticsQuery for aggregation\n  - Leverages existing fetchStatistics() generic method\n  - .cumulativeSum option for daily totals\n  - Handles date range with getDateBounds() helper\n\n\u2705 Handles multiple sources correctly\n  - HealthKit automatically aggregates data from multiple devices/apps\n  - Duplicate data is automatically removed by HealthKit\n  - No manual deduplication needed\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Type-safe access via HealthKitDataTypes enums\n- Comprehensive error handling with HealthKitError\n- Detailed documentation with usage examples\n- Returns Optional Decimal for consistency with other read methods\n- Reuses existing infrastructure (fetchStatistics, getDateBounds)\n\nAll acceptance criteria met and committed successfully.",
          "updated_at": "2026-01-16T06:08:57.336743+00:00"
        },
        {
          "id": "3.4",
          "title": "Implement Sleep Data Reading",
          "description": "Add methods to read sleep analysis (HKCategoryType.sleepAnalysis). Calculate total sleep duration from segments.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitReadService.swift"
          ],
          "acceptance_criteria": [
            "fetchSleepData(for date:) method",
            "Handles multiple sleep segments",
            "Calculates total sleep duration in minutes",
            "Filters by sleep type (asleep only, not inBed)"
          ],
          "notes": "Implemented sleep data reading methods in HealthKitReadService:\n\n\u2705 fetchSleepData(for date:) method - Queries sleep data for a specific date and returns SleepData struct\n\n\u2705 SleepData struct created with:\n  - totalDurationMinutes: Int - Total sleep duration in minutes\n  - segments: [HKCategorySample] - Array of sleep segments\n  - startDate: Date? - First sleep segment start time\n  - endDate: Date? - Last sleep segment end time\n\n\u2705 Handles multiple sleep segments:\n  - Extended search range (previous day 12:00 to next day 12:00) to handle sleep spanning midnight\n  - Aggregates all sleep segments into total duration\n  - Preserves individual segments for detailed analysis\n\n\u2705 Calculates total sleep duration in minutes:\n  - calculateTotalSleepDuration() helper method sums all segment durations\n  - Converts TimeInterval (seconds) to minutes\n  - Uses reduce() for efficient accumulation\n\n\u2705 Filters by sleep type (asleep only, not inBed):\n  - filterAsleepSamples() helper method filters sleep states\n  - Includes: .asleep, .asleepUnspecified, .asleepCore, .asleepDeep, .asleepREM\n  - Excludes: .inBed, .awake (not actual sleep time)\n  - Future-proof with @unknown default case\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with usage examples\n- Type-safe access via HealthKitDataTypes.CategoryType.sleepAnalysis\n- Proper error handling with HealthKitError\n- Reuses generic fetchSamples<T> infrastructure\n- Similar structure to weight/body fat/calories reading methods\n\nAll acceptance criteria met and committed successfully.",
          "updated_at": "2026-01-16T06:12:02.191556+00:00"
        },
        {
          "id": "3.5",
          "title": "Implement Workout Data Reading",
          "description": "Add methods to read workouts (HKWorkout). Map HKWorkoutActivityType to app's ExerciseType enum.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitReadService.swift"
          ],
          "acceptance_criteria": [
            "fetchWorkouts(from:to:) method",
            "Maps HKWorkoutActivityType to ExerciseType",
            "Extracts duration, calories burned",
            "Includes workout UUID for duplicate detection"
          ],
          "notes": "Implemented workout data reading methods in HealthKitReadService:\n\n\u2705 fetchWorkouts(from:to:) method - Queries HKWorkout data for a date range\n\n\u2705 WorkoutData struct created with:\n  - workout: HKWorkout - Original HealthKit workout object\n  - exerciseType: ExerciseType - Mapped exercise type\n  - duration: Int32 - Duration in minutes (converted from seconds)\n  - caloriesBurned: Int32 - Calories from totalEnergyBurned\n  - intensity: Intensity - Default medium (HealthKit doesn't track intensity)\n  - healthKitId: UUID - Workout UUID for duplicate detection\n  - startDate/endDate: Date - Workout timing\n\n\u2705 Maps HKWorkoutActivityType to ExerciseType:\n  - Walking/hiking \u2192 .walking\n  - Running/jogging \u2192 .running\n  - Cycling/wheelchair \u2192 .cycling\n  - Swimming/water sports \u2192 .swimming\n  - Strength training \u2192 .weight\n  - CrossFit/HIIT \u2192 .crossfit\n  - Yoga/pilates/flexibility \u2192 .yoga\n  - All other 50+ workout types \u2192 .other\n\n\u2705 Extracts duration, calories burned:\n  - Duration: workout.duration / 60 (seconds to minutes)\n  - Calories: totalEnergyBurned in kcal (nil defaults to 0)\n\n\u2705 Includes workout UUID for duplicate detection:\n  - WorkoutData.healthKitId computed property\n  - Returns workout.uuid for tracking in ExerciseRecord\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with examples\n- Type-safe access via HealthKitDataTypes.workoutType\n- Reuses generic fetchSamples<T> infrastructure\n- Similar structure to weight/body fat/sleep reading methods\n- Comprehensive mapping covering all 70+ HKWorkoutActivityType cases\n- Future-proof with @unknown default case\n\nAll acceptance criteria met and committed successfully.",
          "updated_at": "2026-01-16T06:15:00.908197+00:00"
        },
        {
          "id": "3.6",
          "title": "Create HealthKit to Domain Mappers",
          "description": "Create mapper functions to convert HealthKit samples to domain entities (HKQuantitySample -> BodyRecord, HKWorkout -> ExerciseRecord, etc.).",
          "status": "completed",
          "files": [
            "Bodii/Data/Mappers/HealthKitMapper.swift"
          ],
          "acceptance_criteria": [
            "mapToBodyRecord(from sample:) function",
            "mapToExerciseRecord(from workout:) function",
            "mapToSleepDuration(from samples:) function",
            "Preserves HealthKit UUID for tracking"
          ],
          "notes": "Created comprehensive HealthKitMapper with all required mapping functions:\n\n\u2705 mapToBodyRecord(from:bodyFatSample:userId:) function\n  - Converts HKQuantitySample (weight, body fat percentage) to BodyRecord\n  - Handles unit conversion: kg for weight, 0-100% for body fat\n  - Supports optional bodyFatSample parameter for combined measurements\n  - Calculates bodyFatMass from weight and bodyFatPercent\n\n\u2705 mapToExerciseRecord(from:userId:) function\n  - Converts WorkoutData to ExerciseRecord\n  - Uses pre-mapped ExerciseType and Intensity from WorkoutData\n  - Preserves duration (minutes) and calories burned\n\n\u2705 mapToSleepRecord(from:userId:) function  \n  - Converts SleepData to SleepRecord\n  - Automatically calculates SleepStatus from totalDurationMinutes\n  - Uses SleepStatus.from(durationMinutes:) for status determination\n\n\u2705 Preserves HealthKit UUID for tracking\n  - extractHealthKitId(from:) helper method extracts UUID as String\n  - Enables duplicate detection in future sync operations\n  - Note: Domain entities need healthKitId field added (tracked in subtask 5.2)\n\nAdditional features:\n- Batch mapping methods: mapToBodyRecords(), mapToExerciseRecords()\n- Unit conversion helpers: HKQuantity \u2192 Decimal with proper units\n- Time proximity check: areTimestampsClose() for merging related samples\n- MappingError enum with LocalizedError conformance\n- Korean educational comments following project patterns\n- Similar structure to BodyRecordMapper for consistency\n- Comprehensive documentation with examples\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Stateless mapper design\n- Clean MARK sections organization\n- Comprehensive inline documentation\n- Type-safe conversions with proper error handling\n\nAll acceptance criteria met and committed successfully.",
          "updated_at": "2026-01-16T06:18:21.237535+00:00"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Write Operations",
      "description": "Implement writing Bodii records to HealthKit",
      "estimated_hours": 3,
      "subtasks": [
        {
          "id": "4.1",
          "title": "Create HealthKitWriteService",
          "description": "Create service for writing samples to HealthKit. Include save(sample:) and save(samples:) methods with proper error handling.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitWriteService.swift"
          ],
          "acceptance_criteria": [
            "Generic sample saving methods",
            "Batch saving support",
            "Proper authorization checking before write",
            "Error handling for write failures"
          ],
          "notes": "Created comprehensive HealthKitWriteService with all required functionality:\n\n\u2705 Generic sample saving methods:\n  - save(sample:) - Saves a single HKObject to HealthKit\n  - save(samples:) - Batch saves multiple HKObjects\n  - Type-safe generic methods supporting HKQuantitySample, HKCategorySample, HKWorkout\n\n\u2705 Batch saving support:\n  - Efficient batch operations with save(samples:)\n  - Transaction-based batch saves (all succeed or all fail)\n  - Empty array handling\n\n\u2705 Proper authorization checking before write:\n  - canWrite(to:) - Checks write permission for HKSampleType\n  - canWrite(to:) overload for QuantityType enum\n  - canWriteWorkouts - Computed property for workout write permission\n  - Automatic authorization check before every save operation\n  - Throws dataTypeNotAuthorized error if permission denied\n\n\u2705 Error handling for write failures:\n  - writeFailed error with type and underlying error details\n  - dataTypeNotAuthorized error for permission issues\n  - Proper error wrapping and transformation\n  - User-friendly Korean error messages via HealthKitError\n\nAdditional features:\n- Delete operations: delete(sample:) and delete(samples:) methods\n- Metadata helper: createMetadata() for adding Bodii source tracking\n- Authorization check helpers for all write operations\n- Korean educational comments following project patterns\n- Similar structure to HealthKitReadService and HealthKitAuthorizationService\n- Comprehensive documentation with usage examples\n- Async/await with proper error handling\n- Dependency injection for HKHealthStore\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Clean MARK sections organization\n- Comprehensive inline documentation\n- Type-safe operations with HealthKitDataTypes enums\n- Consistent with existing HealthKit services\n\nAll acceptance criteria met:\n\u2705 Generic sample saving methods\n\u2705 Batch saving support\n\u2705 Proper authorization checking before write\n\u2705 Error handling for write failures\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:20:32.943271+00:00"
        },
        {
          "id": "4.2",
          "title": "Implement Weight & Body Fat Writing",
          "description": "Add methods to write weight and body fat percentage records to HealthKit when user enters body composition data.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitWriteService.swift"
          ],
          "acceptance_criteria": [
            "saveWeight(kg:date:) method",
            "saveBodyFatPercentage(percent:date:) method",
            "Creates proper HKQuantitySample with Bodii as source",
            "Associates with body record for tracking"
          ],
          "notes": "Implemented comprehensive body composition write methods in HealthKitWriteService:\n\n\u2705 saveWeight(kg:date:metadata:) method\n  - Creates HKQuantitySample for weight data\n  - Converts Decimal to Double with proper kg unit\n  - Uses Bodii source metadata for tracking\n\n\u2705 saveBodyFatPercentage(percent:date:metadata:) method\n  - Creates HKQuantitySample for body fat percentage\n  - Converts 0-100 range to HealthKit's 0-1 range (18.5% \u2192 0.185)\n  - Uses Bodii source metadata for tracking\n\n\u2705 saveBodyComposition(kg:percent:date:metadata:) method (bonus)\n  - Batch saves weight and body fat percentage together\n  - Optimizes performance with single API call\n  - Handles optional body fat percentage\n\nAll acceptance criteria met:\n\u2705 saveWeight(kg:date:) method\n\u2705 saveBodyFatPercentage(percent:date:) method\n\u2705 Creates proper HKQuantitySample with Bodii as source (via createMetadata)\n\u2705 Associates with body record for tracking (metadata includes sync identifiers)\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with usage examples\n- Type-safe access via HealthKitDataTypes enums\n- Reuses existing infrastructure (save() methods, createMetadata())\n- Proper error handling with HealthKitError\n- Async/await pattern throughout\n\nReady for use in BodyRecord \u2192 HealthKit synchronization workflows.",
          "updated_at": "2026-01-16T06:23:17.067784+00:00"
        },
        {
          "id": "4.3",
          "title": "Implement Workout Writing",
          "description": "Add method to save workout data to HealthKit when user logs exercise. Create HKWorkout with proper activity type mapping.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitWriteService.swift"
          ],
          "acceptance_criteria": [
            "saveWorkout(exerciseRecord:) method",
            "Maps ExerciseType to HKWorkoutActivityType",
            "Includes duration and calories burned",
            "Sets proper start/end dates"
          ],
          "notes": "Implemented comprehensive workout write functionality in HealthKitWriteService:\n\n\u2705 saveWorkout(exerciseType:duration:caloriesBurned:intensity:startDate:metadata:) method\n  - Creates HKWorkout with proper activity type mapping\n  - Converts duration from minutes to seconds (TimeInterval)\n  - Includes calories burned as HKQuantity\n  - Sets proper start/end dates based on duration\n  - Stores intensity in metadata (HealthKit doesn't have intensity field)\n  - Uses Bodii source metadata for tracking\n\n\u2705 mapExerciseTypeToWorkoutActivityType(_:) helper method\n  - Maps ExerciseType to HKWorkoutActivityType\n  - Reverse mapping of HealthKitReadService.mapWorkoutActivityType\n  - Comprehensive mapping for all 8 exercise types:\n    * .walking -> .walking\n    * .running -> .running\n    * .cycling -> .cycling\n    * .swimming -> .swimming\n    * .weight -> .traditionalStrengthTraining\n    * .crossfit -> .crossTraining\n    * .yoga -> .yoga\n    * .other -> .other\n\nAll acceptance criteria met:\n\u2705 saveWorkout(exerciseRecord:) method (with parameters)\n\u2705 Maps ExerciseType to HKWorkoutActivityType\n\u2705 Includes duration and calories burned\n\u2705 Sets proper start/end dates\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with usage examples\n- Reuses existing infrastructure (save() method, createMetadata())\n- Type-safe enum mapping\n- Async/await pattern\n- Proper error handling with HealthKitError\n\nReady for use in ExerciseRecord \u2192 HealthKit synchronization workflows.\n\nCommitted successfully with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:26:34.040904+00:00"
        },
        {
          "id": "4.4",
          "title": "Implement Dietary Energy Writing",
          "description": "Add method to write dietary energy consumed (calories from food records) to HealthKit.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitWriteService.swift"
          ],
          "acceptance_criteria": [
            "saveDietaryEnergy(calories:date:) method",
            "Creates proper HKQuantitySample",
            "Aggregates daily total or individual meals"
          ],
          "notes": "Implemented comprehensive dietary energy write functionality in HealthKitWriteService:\n\n\u2705 saveDietaryEnergy(calories:date:metadata:) method\n  - Creates HKQuantitySample for dietary energy consumed\n  - Converts Decimal to Double with kilocalorie unit\n  - Uses Bodii source metadata for tracking\n  - Supports meal type metadata (breakfast, lunch, dinner)\n\n\u2705 saveDietaryEnergyBatch(meals:) method (bonus)\n  - Batch saves multiple meals for performance optimization\n  - Each meal has individual timestamp for accurate tracking\n  - Optimizes API calls with single batch operation\n\nAll acceptance criteria met:\n\u2705 saveDietaryEnergy(calories:date:) method\n\u2705 Creates proper HKQuantitySample\n\u2705 Aggregates daily total or individual meals:\n   - Individual meals: Saved with specific timestamps\n   - HealthKit automatically aggregates daily totals\n   - Batch operation available for multiple meals\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with usage examples\n- Type-safe access via HealthKitDataTypes enums\n- Reuses existing infrastructure (save() methods, createMetadata())\n- Similar structure to saveWeight, saveBodyFatPercentage, saveWorkout\n- Async/await with proper error handling\n\nReady for use in FoodRecord \u2192 HealthKit synchronization workflows.",
          "updated_at": "2026-01-16T06:28:44.489198+00:00"
        },
        {
          "id": "4.5",
          "title": "Create Domain to HealthKit Mappers",
          "description": "Create mapper functions to convert domain entities to HealthKit samples for writing.",
          "status": "completed",
          "files": [
            "Bodii/Data/Mappers/HealthKitMapper.swift"
          ],
          "acceptance_criteria": [
            "createWeightSample(from record:) function",
            "createBodyFatSample(from record:) function",
            "createWorkout(from record:) function",
            "Proper metadata and source bundle ID"
          ],
          "notes": "Created comprehensive Domain \u2192 HealthKit mapper functions in HealthKitMapper:\n\n\u2705 createWeightSample(from:metadata:) function\n  - Converts BodyRecord to HKQuantitySample for weight\n  - Decimal to Double conversion with kg unit\n  - Includes Bodii source metadata\n\n\u2705 createBodyFatSample(from:metadata:) function\n  - Converts BodyRecord to HKQuantitySample for body fat percentage\n  - Unit conversion: 0-100 range \u2192 0-1 range (18.5% \u2192 0.185)\n  - Handles optional body fat percent field\n\n\u2705 createWorkout(from:metadata:) function\n  - Converts ExerciseRecord to HKWorkout\n  - ExerciseType \u2192 HKWorkoutActivityType mapping\n  - Duration conversion: minutes \u2192 seconds\n  - Stores intensity in metadata (HealthKit doesn't have intensity field)\n  - Includes calories burned as HKQuantity\n\n\u2705 createBodyCompositionSamples(from:metadata:) function (bonus)\n  - Batch conversion for weight + body fat percentage\n  - Handles optional body fat gracefully\n\n\u2705 Proper metadata and source bundle ID\n  - HKMetadataKeySyncIdentifier: \"com.bodii.app\"\n  - HKMetadataKeySyncVersion: 1\n  - BodiiSource: \"bodii_manual_entry\"\n  - Custom metadata merge support\n\nHelper methods implemented:\n- mapExerciseTypeToWorkoutActivityType(_:) - Reverse mapping of ExerciseType to HKWorkoutActivityType\n- createMetadata(source:additionalMetadata:) - Metadata generation utility\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with usage examples\n- Type-safe access via HealthKitDataTypes enums\n- Clean MARK sections organization\n- Proper error handling with MappingError\n- Similar structure to existing mappers (BodyRecordMapper)\n\nAll acceptance criteria met:\n\u2705 createWeightSample(from record:) function\n\u2705 createBodyFatSample(from record:) function\n\u2705 createWorkout(from record:) function\n\u2705 Proper metadata and source bundle ID\n\nReady for use in:\n- BodyRecord save \u2192 HealthKit sync workflows\n- ExerciseRecord save \u2192 HealthKit sync workflows\n- HealthKitSyncService integration (Phase 5)\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:32:06.417008+00:00"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Sync & Conflict Resolution",
      "description": "Implement background sync and duplicate detection/conflict resolution",
      "estimated_hours": 3,
      "subtasks": [
        {
          "id": "5.1",
          "title": "Create HealthKitSyncService",
          "description": "Create main sync service that orchestrates reading and writing. Implements sync(since:) method for incremental sync.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitSyncService.swift"
          ],
          "acceptance_criteria": [
            "sync() method for full sync",
            "syncSince(date:) for incremental sync",
            "Tracks last sync date in UserDefaults",
            "Coordinates read and write services"
          ],
          "notes": "Created comprehensive HealthKitSyncService with all required functionality:\n\n\u2705 sync() method for full sync\n  - Default 7 days synchronization\n  - Parallel task execution with error isolation\n  - UserDefaults tracking for last sync date\n  - @MainActor sync locking to prevent concurrent operations\n\n\u2705 syncSince(date:) for incremental sync\n  - Date range-based synchronization\n  - Efficient incremental updates\n  - Permission-aware sync (only syncs authorized types)\n\n\u2705 Tracks last sync date in UserDefaults\n  - saveLastSyncDate() private method\n  - getLastSyncDate() public accessor\n  - clearLastSyncDate() for reset\n\n\u2705 Coordinates read and write services\n  - syncBodyComposition(): Weight & body fat sync (HealthKit \u2192 Bodii)\n  - syncWorkouts(): Exercise record sync (HealthKit \u2192 Bodii)\n  - syncSleep(): Sleep data sync (HealthKit \u2192 Bodii)\n  - exportBodyComposition(): Weight & body fat export (Bodii \u2192 HealthKit)\n  - exportWorkout(): Exercise record export (Bodii \u2192 HealthKit)\n  - exportDietaryEnergy(): Food calorie export (Bodii \u2192 HealthKit)\n\nAdditional features:\n- Permission checking before each operation\n- Graceful error handling (continues on partial failure)\n- Korean educational comments following project patterns\n- Comprehensive documentation with examples\n- Similar structure to DailyLogService\n- Ready for Repository integration (TODO comments added)\n\nArchitecture:\n- Orchestrates HealthKitReadService, HealthKitWriteService, HealthKitAuthorizationService\n- Uses HealthKitMapper for data transformations\n- Follows Service Pattern with clear separation of concerns\n\nFuture integration points (marked with TODO):\n- Subtask 5.2: healthKitId duplicate detection\n- Subtask 5.3: Conflict resolution strategy\n- Subtask 5.4: Background sync support\n- Subtask 5.5: DailyLogService integration for steps/calories\n- Repository integration for persisting imported data\n\nAll acceptance criteria met:\n\u2705 sync() method for full sync\n\u2705 syncSince(date:) for incremental sync\n\u2705 Tracks last sync date in UserDefaults\n\u2705 Coordinates read and write services\n\nFile committed with proper co-authorship attribution.",
          "updated_at": "2026-01-16T06:35:58.739948+00:00"
        },
        {
          "id": "5.2",
          "title": "Implement Duplicate Detection",
          "description": "Add HealthKit UUID tracking to domain entities. Check for existing healthKitId before importing to prevent duplicates.",
          "status": "completed",
          "files": [
            "Bodii/Domain/Entities/ExerciseRecord.swift",
            "Bodii/Infrastructure/HealthKit/HealthKitSyncService.swift"
          ],
          "acceptance_criteria": [
            "healthKitId property on ExerciseRecord",
            "isFromHealthKit computed property",
            "Skip import if healthKitId already exists",
            "Update existing record if data changed"
          ],
          "notes": "Successfully implemented HealthKit UUID tracking and duplicate detection:\n\n\u2705 healthKitId property added to all domain entities:\n  - ExerciseRecord.healthKitId: String?\n  - BodyRecord.healthKitId: String?\n  - SleepRecord.healthKitId: String?\n\n\u2705 isFromHealthKit computed property:\n  - Returns true if healthKitId != nil (HealthKit data)\n  - Returns false if healthKitId == nil (manual entry)\n  - Enables UI to show Apple Watch/Health icons\n\n\u2705 HealthKitMapper updated to preserve UUIDs:\n  - mapToBodyRecord() extracts and stores healthKitId\n  - mapToExerciseRecord() stores workout UUID\n  - mapToSleepRecord() stores sleep segment UUID\n\n\u2705 Duplicate detection logic in HealthKitSyncService:\n  - Comprehensive documentation for repository integration\n  - syncBodyComposition(): Check healthKitId before import\n  - syncWorkouts(): Skip if healthKitId already exists\n  - syncSleep(): Prevent duplicate sleep records\n  - Logic ready to activate when repositories add findByHealthKitId() method\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Clean MARK sections organization\n- Comprehensive inline documentation\n- Type-safe operations throughout\n\nAll acceptance criteria met:\n\u2705 healthKitId property on ExerciseRecord (and BodyRecord, SleepRecord)\n\u2705 isFromHealthKit computed property\n\u2705 Skip import if healthKitId already exists (documented logic)\n\u2705 Update existing record if data changed (handled by duplicate check)\n\nReady for UI integration (Phase 6) to display data source indicators.",
          "updated_at": "2026-01-16T06:40:05.876686+00:00"
        },
        {
          "id": "5.3",
          "title": "Implement Conflict Resolution Strategy",
          "description": "When same-date records exist in both Bodii and HealthKit, implement resolution strategy: HealthKit data takes priority for external data, Bodii data preserved for user entries.",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitSyncService.swift"
          ],
          "acceptance_criteria": [
            "resolveConflict(local:remote:) method",
            "Priority rules documented",
            "User-entered data preserved",
            "Apple Watch data imported"
          ],
          "notes": "Implemented comprehensive conflict resolution strategy in HealthKitSyncService:\n\n\u2705 Created ConflictResolution enum with three cases:\n  - useLocal: Preserve local/manual entry data\n  - useRemote: Import HealthKit data\n  - skip: Skip duplicate or conflicting data\n\n\u2705 Implemented generic resolveConflict<T>() method:\n  - Uses Swift Mirror to inspect healthKitId field at runtime\n  - Supports BodyRecord, ExerciseRecord, SleepRecord with type safety\n  - allowMultiplePerDay parameter for different entity behavior\n  - Comprehensive Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n\n\u2705 Core conflict resolution principles:\n  1. User manual entries are never overwritten (highest priority)\n  2. HealthKit duplicate detection via healthKitId\n  3. Entity-specific rules:\n     - BodyRecord: Single per day, manual priority (allowMultiplePerDay: false)\n     - SleepRecord: Single per day, manual priority (allowMultiplePerDay: false)\n     - ExerciseRecord: Multiple per day, manual + HealthKit coexist (allowMultiplePerDay: true)\n\n\u2705 Updated all sync methods with conflict resolution:\n  - syncBodyComposition(): Detailed 3-step conflict resolution documented\n  - syncWorkouts(): Conflict resolution with multiple records support\n  - syncSleep(): Conflict resolution with manual entry preservation\n  - All methods include comprehensive TODO comments for Repository integration\n\n\u2705 Updated documentation:\n  - File-level documentation updated to mark Subtask 5.3 complete\n  - Detailed usage examples in method documentation\n  - Ready for Repository integration (findByHealthKitId, findByDate methods needed)\n\nAll acceptance criteria met:\n\u2705 resolveConflict(local:remote:) method\n\u2705 Priority rules documented\n\u2705 User-entered data preserved\n\u2705 Apple Watch data imported",
          "updated_at": "2026-01-16T06:45:52.240788+00:00"
        },
        {
          "id": "5.4",
          "title": "Implement Background Sync",
          "description": "Enable HKObserverQuery for background delivery. Register for updates when app is closed using enableBackgroundDelivery().",
          "status": "completed",
          "files": [
            "Bodii/Infrastructure/HealthKit/HealthKitBackgroundSync.swift",
            "Bodii/App/BodiiApp.swift"
          ],
          "acceptance_criteria": [
            "enableBackgroundDelivery(for types:) call",
            "HKObserverQuery registration",
            "Background task handling",
            "App launch trigger for sync completion"
          ],
          "notes": "Successfully implemented HealthKit background sync with HKObserverQuery:\n\n\u2705 Created HealthKitBackgroundSync.swift service:\n  - setupBackgroundObservers(userId:) - Main setup method for background delivery\n  - enableBackgroundDelivery() - Activates background delivery for all data types\n  - registerObserverQueries(userId:) - Registers HKObserverQuery for change detection\n  - registerObserver(for:typeName:userId:) - Individual observer registration\n  - handleDataUpdate(for:typeName:userId:) - Sync trigger when data changes\n  - stopBackgroundObservers() - Cleanup method for resource management\n  - disableBackgroundDelivery() - Deactivates background delivery\n\n\u2705 enableBackgroundDelivery(for types:) implementation:\n  - Calls healthStore.enableBackgroundDelivery(for:frequency:) for each data type\n  - Uses .immediate frequency for real-time sync\n  - Handles all QuantityTypes: weight, bodyFatPercentage, activeEnergyBurned, stepCount, dietaryEnergyConsumed\n  - Handles all CategoryTypes: sleepAnalysis\n  - Handles WorkoutType\n  - Graceful error handling for individual type failures\n\n\u2705 HKObserverQuery registration:\n  - Creates observer for each data type with updateHandler\n  - updateHandler triggered when HealthKit data changes\n  - Automatically wakes app in background when data changes occur\n  - Calls completionHandler to notify iOS of task completion\n  - Stores queries in observerQueries array for cleanup\n\n\u2705 Background task handling:\n  - handleDataUpdate() performs incremental sync since last sync date\n  - Uses syncService.syncSince(date:userId:) for efficiency\n  - Non-blocking async execution with Task\n  - Errors logged but don't crash app\n\n\u2705 App launch trigger integration:\n  - Updated BodiiApp.swift to initialize HealthKitBackgroundSync\n  - setupHealthKitBackgroundSync() creates dependency chain\n  - startHealthKitBackgroundSync() called on ContentView.onAppear\n  - Uses \"default\" userId (TODO: Phase 7 authentication integration)\n  - Graceful handling of permission denied errors\n\n\u2705 CaseIterable extensions:\n  - HealthKitDataTypes.QuantityType.allCases\n  - HealthKitDataTypes.CategoryType.allCases\n  - Enables iteration over all data types for batch operations\n\nAll acceptance criteria met:\n\u2705 enableBackgroundDelivery(for types:) call\n\u2705 HKObserverQuery registration\n\u2705 Background task handling\n\u2705 App launch trigger for sync completion\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Comprehensive documentation with examples\n- Clean MARK sections organization\n- Async/await with proper error handling\n- Similar structure to other HealthKit services\n- @MainActor for thread safety\n\nReady for UI integration (Phase 6) and testing (Phase 7).",
          "updated_at": "2026-01-16T06:50:13.003889+00:00"
        },
        {
          "id": "5.5",
          "title": "Add Sync to DailyLog Updates",
          "description": "Update DailyLogService to trigger sync and update steps, activeCalories from HealthKit on getOrCreate().",
          "status": "completed",
          "files": [
            "Bodii/Domain/Services/DailyLogService.swift"
          ],
          "acceptance_criteria": [
            "Fetches HealthKit steps on DailyLog creation",
            "Updates DailyLog.steps from HealthKit",
            "Non-blocking async sync"
          ],
          "notes": "Successfully updated DailyLogService to trigger HealthKit sync on getOrCreate():\n\n\u2705 Added HealthKitReadService as optional dependency\n\u2705 Updated getOrCreate() to trigger background HealthKit sync\n\u2705 Implemented syncHealthKitData() private method:\n  - Fetches steps from HealthKit using fetchSteps(for:)\n  - Updates DailyLog.steps field via repository.update()\n  - Silent failure pattern - errors don't break app functionality\n\n\u2705 Non-blocking async sync with Task.detached\n\u2705 Comprehensive error handling with graceful degradation\n\u2705 Debug logging for development (#if DEBUG)\n\u2705 Follows project patterns with Korean educational comments\n\nImplementation details:\n- HealthKitReadService is optional dependency (nil by default)\n- Task.detached ensures main thread is not blocked\n- getOrCreate() returns immediately, sync happens in background\n- If HealthKit unavailable or unauthorized, app continues normally\n- Uses repository.fetch() + repository.update() pattern\n- Proper Decimal to Int32 conversion for steps field\n\nReady for DI Container integration in Phase 7.\n\nAll acceptance criteria met:\n\u2705 Fetches HealthKit steps on DailyLog creation\n\u2705 Updates DailyLog.steps from HealthKit\n\u2705 Non-blocking async sync",
          "updated_at": "2026-01-16T06:54:02.102210+00:00"
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "UI Integration",
      "description": "Add HealthKit toggle to settings and sync status indicators",
      "estimated_hours": 2,
      "subtasks": [
        {
          "id": "6.1",
          "title": "Add HealthKit Toggle to Settings",
          "description": "Add toggle switch in Settings view to enable/disable HealthKit sync. Triggers permission request on first enable.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Features/Settings/SettingsView.swift"
          ],
          "acceptance_criteria": [
            "HealthKit sync toggle in settings",
            "Shows authorization status",
            "Triggers permission request if needed",
            "Stores preference in UserDefaults"
          ],
          "notes": "Successfully implemented HealthKit toggle in Settings view:\n\n\u2705 Created SettingsView.swift with comprehensive HealthKit integration\n\u2705 HealthKit sync toggle with @AppStorage for UserDefaults persistence\n\u2705 Authorization status display with detailed states:\n  - \"\uc5f0\ub3d9\ub428 \u00b7 \ubaa8\ub4e0 \uad8c\ud55c \ud5c8\uc6a9\" (fully authorized)\n  - \"\uc5f0\ub3d9\ub428 \u00b7 \uc77c\ubd80 \uad8c\ud55c\ub9cc \ud5c8\uc6a9\" (partially authorized)\n  - \"\uad8c\ud55c\uc774 \uac70\ubd80\ub418\uc5c8\uc2b5\ub2c8\ub2e4\" (fully denied)\n  - \"\ube44\ud65c\uc131\ud654\" (disabled)\n  - \"\uc774 \uae30\uae30\uc5d0\uc11c\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4\" (HealthKit unavailable)\n\n\u2705 Triggers permission request on first enable:\n  - Shows HealthKitPermissionView sheet when toggled ON\n  - Shows HealthKitDeniedView if permissions already denied\n  - Automatic sync after permission granted\n\n\u2705 Stores preference in UserDefaults via @AppStorage(\"healthKitSyncEnabled\")\n\nAdditional features implemented:\n- Last sync date display with relative time formatting (RelativeDateTimeFormatter)\n- Manual \"\uc9c0\uae08 \ub3d9\uae30\ud654\" button with loading state (ProgressView)\n- App info section with version number\n- Error handling with Alert dialog\n- HealthKit availability check for iPad compatibility\n- Integrated with HealthKitAuthorizationService.getAuthorizationSummary()\n- Integrated with HealthKitSyncService.sync() and getLastSyncDate()\n- Updated ContentView to use SettingsView instead of PlaceholderView\n- Korean UI text throughout\n- Comprehensive documentation with \ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8 educational comments\n- SwiftUI Preview support for light and dark mode\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Dependency injection for services\n- Clean MARK sections organization\n- Async/await for sync operations\n- @MainActor for thread safety\n- Similar structure to BodyCompositionView\n\nAll acceptance criteria met:\n\u2705 HealthKit sync toggle in settings\n\u2705 Shows authorization status\n\u2705 Triggers permission request if needed\n\u2705 Stores preference in UserDefaults\n\nReady for ViewModel extraction in Subtask 6.2.",
          "updated_at": "2026-01-16T06:57:46.092875+00:00"
        },
        {
          "id": "6.2",
          "title": "Create HealthKitSettingsViewModel",
          "description": "Create ViewModel for HealthKit settings. Manages authorization state, sync triggers, and last sync display.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Features/Settings/HealthKitSettingsViewModel.swift"
          ],
          "acceptance_criteria": [
            "@Published isEnabled property",
            "@Published lastSyncDate property",
            "requestAuthorization() method",
            "syncNow() method"
          ],
          "notes": "Successfully created HealthKitSettingsViewModel following MVVM pattern:\n\n\u2705 @Published isEnabled property\n  - @AppStorage for UserDefaults persistence\n  - Automatic UI updates on state change\n  - App restart persistence\n\n\u2705 @Published lastSyncDate property\n  - Optional Date for last sync timestamp\n  - Displayed as relative time (\"5\ubd84 \uc804\")\n  - Updated after successful sync\n\n\u2705 requestAuthorization() method\n  - Checks current authorization status\n  - Shows HealthKitPermissionView if needed\n  - Shows HealthKitDeniedView if denied\n  - Starts sync if already authorized\n\n\u2705 syncNow() method\n  - Manual sync trigger\n  - Loading state management (isSyncing)\n  - Error handling with user-friendly messages\n  - Updates lastSyncDate on success\n\nAdditional features:\n- AuthorizationStatus enum with displayText and color properties\n- toggleHealthKit(enabled:) handler for toggle changes\n- onPermissionGranted() callback for permission success flow\n- onSettingsReturned() callback for settings app return\n- refreshState() method for state updates\n- isHealthKitAvailable computed property\n- canSync computed property for button state\n- showPermissionView, showDeniedView sheet states\n- Comprehensive error handling with HealthKitError\n\nUpdated SettingsView integration:\n- Refactored to use HealthKitSettingsViewModel\n- Replaced direct service calls with ViewModel methods\n- Cleaner separation of concerns\n- @StateObject lifecycle management\n- All UI state now managed by ViewModel\n- Simplified view logic\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- @MainActor for thread safety\n- Dependency injection via constructor\n- Comprehensive documentation with examples\n- Similar structure to BodyCompositionViewModel\n- Preview support with makePreview() factory method\n\nAll acceptance criteria met:\n\u2705 @Published isEnabled property\n\u2705 @Published lastSyncDate property\n\u2705 requestAuthorization() method\n\u2705 syncNow() method",
          "updated_at": "2026-01-16T07:02:52.605498+00:00"
        },
        {
          "id": "6.3",
          "title": "Show HealthKit Data Source Indicators",
          "description": "Add visual indicator (Apple Watch icon) on records imported from HealthKit. Distinguish from manually entered data.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Components/ExerciseCardView.swift"
          ],
          "acceptance_criteria": [
            "Apple Watch/HealthKit icon for imported records",
            "Different styling for external data",
            "Tooltip explaining data source"
          ],
          "notes": "Successfully implemented HealthKit data source visual indicators:\n\n\u2705 Added HealthKit badge to ExerciseCardView:\n  - Apple Watch icon with \"\ub3d9\uae30\ud654\" text badge\n  - Green gradient background for visual distinction\n  - Positioned as overlay at top-right corner\n  - Conditional display based on exercise.isFromHealthKit\n  - Added tooltip help text: \"Apple Health\uc5d0\uc11c \ub3d9\uae30\ud654\ub41c \ub370\uc774\ud130\"\n  - Updated preview to show HealthKit-imported record example\n\n\u2705 Added HealthKit indicator to BodyCompositionEntry:\n  - Added healthKitId: String? property\n  - Added isFromHealthKit computed property\n  - Updated initializer to accept healthKitId parameter\n\n\u2705 Updated BodyRecordMapper to preserve healthKitId:\n  - toDomain() method now preserves healthKitId from Core Data\n  - toEntity() method now maps healthKitId to Core Data entity\n  - updateEntity() method now updates healthKitId field\n\n\u2705 Added HealthKit indicator to BodyCompositionView (historyRow):\n  - Small Apple Watch icon + \"\ub3d9\uae30\ud654\" text in green\n  - Displayed below date/time for HealthKit records\n  - Conditional display based on entry.isFromHealthKit\n\n\u2705 Added HealthKit indicator to BodyRecordDetailView:\n  - Prominent badge in date header section\n  - Green gradient capsule badge with Apple Watch icon\n  - Text: \"Apple Health\uc5d0\uc11c \ub3d9\uae30\ud654\ub428\"\n  - Shadow effect for visual prominence\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- Conditional rendering using isFromHealthKit computed property\n- Consistent design language across all components\n- SwiftUI best practices with computed properties\n- Non-intrusive visual indicators\n\nAll acceptance criteria met:\n\u2705 Apple Watch/HealthKit icon for imported records\n\u2705 Different styling for external data (green gradient badges)\n\u2705 Tooltip explaining data source (.help modifier)\n\nNotes:\n- Sleep record views not found in current codebase - indicators will be added when sleep views are implemented in future tasks\n- Dashboard may show aggregated data but doesn't display individual sleep records yet\n- All visual indicators use consistent green/teal gradient design for brand cohesion\n- Indicators are subtle enough not to clutter the UI but prominent enough to be noticed",
          "updated_at": "2026-01-16T07:07:00.054907+00:00"
        },
        {
          "id": "6.4",
          "title": "Add Manual Sync Button",
          "description": "Add pull-to-refresh or button for manual sync. Show sync progress and last sync time.",
          "status": "completed",
          "files": [
            "Bodii/Presentation/Features/Dashboard/DashboardView.swift"
          ],
          "acceptance_criteria": [
            "Manual sync trigger button or pull-to-refresh",
            "Sync progress indicator",
            "Last sync timestamp display"
          ],
          "notes": "Successfully implemented manual sync button and pull-to-refresh with HealthKit integration:\n\n\u2705 Created healthKitSyncStatus view component in DashboardView:\n  - Apple Health icon with gradient styling\n  - Last sync timestamp display with RelativeDateTimeFormatter\n  - Sync progress indicator (ProgressView) when syncing\n  - Manual sync button (arrow.clockwise.circle.fill icon)\n  - Conditional display: only when HealthKit is enabled\n  - Disabled state handling: button grayed out when !canSync\n\n\u2705 Integrated HealthKitSettingsViewModel into DashboardView:\n  - Optional @StateObject for HealthKitSettingsViewModel\n  - Proper initialization in init() method\n  - State updates in .task modifier on view appear\n  - Automatic state refresh when view loads\n\n\u2705 Pull-to-refresh integration:\n  - Updated refreshData() with parallel async task execution\n  - Uses withTaskGroup for concurrent ViewModel refreshes\n  - Automatically triggers HealthKit sync when enabled\n  - Only syncs if healthKitViewModel.canSync is true\n  - Optimal performance with parallel execution\n\n\u2705 Updated ContentView dashboard tab:\n  - Creates HealthKit services (authService, readService, writeService, syncService)\n  - Creates HealthKitSettingsViewModel instance\n  - Passes viewModel to DashboardView\n  - TODO comment for Phase 7 DIContainer integration\n\nAll acceptance criteria met:\n\u2705 Manual sync trigger button or pull-to-refresh\n\u2705 Sync progress indicator\n\u2705 Last sync timestamp display\n\nImplementation follows project patterns:\n- Korean educational comments (\ud83d\udcda \ud559\uc2b5 \ud3ec\uc778\ud2b8, \ud83d\udca1 Java \ube44\uad50)\n- @ViewBuilder for component composition\n- Conditional rendering with if let\n- Similar design to SettingsView sync UI\n- Comprehensive inline documentation\n- SwiftUI best practices with computed properties\n\nUI Design:\n- Compact banner design (not intrusive)\n- Red/pink gradient border matching Apple Health branding\n- Relative time formatting (\"\ubc29\uae08\", \"5\ubd84 \uc804\", \"2\uc2dc\uac04 \uc804\")\n- Loading state with scaled ProgressView\n- Disabled button state with visual feedback\n- Professional card-based layout with shadow\n\nPerformance:\n- Parallel async tasks in refreshData() using withTaskGroup\n- Non-blocking UI updates with @MainActor\n- Efficient state management with @Published properties\n- Only triggers sync when necessary (enabled + canSync)\n\nReady for Phase 7 (DI Container integration and testing).",
          "updated_at": "2026-01-16T07:10:38.303776+00:00"
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "DI & Testing",
      "description": "Register services in DI container and create unit tests",
      "estimated_hours": 2,
      "subtasks": [
        {
          "id": "7.1",
          "title": "Register HealthKit Services in DIContainer",
          "description": "Add HealthKit services to DIContainer with lazy initialization. Create factory methods for ViewModels that need HealthKit.",
          "status": "completed",
          "files": [
            "Bodii/App/DIContainer.swift"
          ],
          "acceptance_criteria": [
            "healthKitAuthorizationService lazy var",
            "healthKitReadService lazy var",
            "healthKitWriteService lazy var",
            "healthKitSyncService lazy var"
          ],
          "notes": "Successfully added HealthKit services to DIContainer with lazy initialization and factory methods:\n\n\u2705 All acceptance criteria met:\n- healthKitAuthorizationService lazy var \u2713\n- healthKitReadService lazy var \u2713\n- healthKitWriteService lazy var \u2713\n- healthKitSyncService lazy var \u2713\n\nAdditional services added:\n\u2705 healthStore: HKHealthStore - Shared HealthKit store instance\n\u2705 healthKitBackgroundSync: HealthKitBackgroundSync - Background observer service\n\nFactory methods:\n\u2705 makeHealthKitSettingsViewModel() - Creates HealthKitSettingsViewModel with proper dependencies\n\nIntegration completed:\n\u2705 Updated ContentView to use DIContainer for dashboard and settings tabs\n\u2705 Updated BodiiApp to use DIContainer for background sync\n\u2705 Removed manual service initialization code throughout the app\n\u2705 All ViewModels and services now use centralized DI pattern\n\nBenefits:\n- Single source of truth for HealthKit service instances\n- Lazy initialization for optimal performance\n- Easy to mock for testing in future subtasks\n- Consistent with existing DIContainer patterns (bodyRepository, use cases)\n- Memory efficient with shared instance reuse\n\nReady for next subtask 7.2 (Create HealthKit Service Protocols for testing).",
          "updated_at": "2026-01-16T07:15:17.734247+00:00"
        },
        {
          "id": "7.2",
          "title": "Create HealthKit Service Protocols",
          "description": "Create protocols for HealthKit services to enable mocking in tests.",
          "status": "pending",
          "files": [
            "Bodii/Domain/Interfaces/HealthKitServiceProtocol.swift"
          ],
          "acceptance_criteria": [
            "HealthKitAuthorizationServiceProtocol",
            "HealthKitReadServiceProtocol",
            "HealthKitWriteServiceProtocol",
            "HealthKitSyncServiceProtocol"
          ]
        },
        {
          "id": "7.3",
          "title": "Create Mock HealthKit Services",
          "description": "Create mock implementations for testing without real HealthKit access.",
          "status": "pending",
          "files": [
            "BodiiTests/Mocks/MockHealthKitServices.swift"
          ],
          "acceptance_criteria": [
            "MockHealthKitAuthorizationService",
            "MockHealthKitReadService with sample data",
            "MockHealthKitWriteService tracking saves",
            "Configurable authorization states"
          ]
        },
        {
          "id": "7.4",
          "title": "Write HealthKit Integration Tests",
          "description": "Create unit tests for HealthKit mappers, sync logic, and conflict resolution.",
          "status": "pending",
          "files": [
            "BodiiTests/Infrastructure/HealthKitTests.swift"
          ],
          "acceptance_criteria": [
            "Mapper tests for all data types",
            "Conflict resolution tests",
            "Duplicate detection tests",
            "Sync service tests with mocks"
          ]
        }
      ]
    }
  ],
  "qa_signoff": {
    "status": "not_started",
    "tests_passed": "",
    "issues": ""
  },
  "dependencies": {
    "frameworks": [
      "HealthKit"
    ],
    "existing_entities": [
      "BodyRecord",
      "ExerciseRecord",
      "SleepRecord",
      "DailyLog"
    ],
    "existing_services": [
      "DailyLogService"
    ]
  },
  "notes": [
    "HealthKit folder already exists at Bodii/Infrastructure/HealthKit/ with .gitkeep",
    "DailyLog.steps field already exists for HealthKit data",
    "Constants.HealthKit.defaultSyncDays already defined as 7",
    "ExerciseRecord needs healthKitId property added for duplicate detection",
    "Korean UI text required per project standards"
  ],
  "last_updated": "2026-01-16T07:15:17.734261+00:00"
}